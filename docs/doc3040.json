["S", "orting", " revis", "ited", ".", "\n", "\n", "I", " previously", " posted", " an", " algorithm", " that", " allows", " one", " to", " sort", " with", " less", " than", " all", " the", " facts", " (", "specific", "ally", ",", " if", " computing", " the", " transit", "ivity", " of", " \"<", "\"", " is", " not", " trivial", ".)", " But", " here", " I", "'d", " like", " to", " revisit", " just", " straight", " sorting", ".", "\n", "\n", "Con", "ventional", " wisdom", " is", " as", " follows", ":", "\n", "\n", "qu", "icks", "ort", " is", " the", " fastest", " sorting", " algorithm", " in", " practice", " but", " has", " a", " number", " of", " pathological", " cases", " that", " can", " make", " it", " perform", " as", " badly", " as", " O", "(", "n", " 2", " )", ".", "\n", "\n", ".", " he", "aps", "ort", " is", " guaranteed", " to", " run", " in", " O", "(", "n", "*", "ln", "(", "n", "))", " and", " requires", " only", " finite", " additional", " storage", ".", " But", " there", " are", " many", " citations", " of", " real", " world", " tests", " which", " show", " that", " he", "aps", "ort", " is", " significantly", " slower", " than", " qu", "icks", "ort", " on", " average", ".", "\n", "\n", "and", " requires", " only", " finite", " additional", " storage", ".", " But", " there", " are", " many", " citations", " of", " real", " world", " tests", " which", " show", " that", " he", "aps", "ort", " is", " significantly", " slower", " than", " qu", "icks", "ort", " on", " average", ".", " Because", " of", " the", " above", " two", " facts", ",", " a", " relatively", " new", " hybrid", " sorting", " algorithm", " called", " \"", "int", "ro", "spective", " sort", "\"", " looks", " very", " promising", ".", " Intro", "spective", " sort", " basically", " applies", " qu", "icks", "ort", " rec", "urs", "ively", " until", " it", " realizes", " something", " has", " gone", " wrong", " then", " switches", " to", " he", "aps", "ort", ".", " In", " this", " way", " it", " has", " a", " worst", " case", " performance", " of", " O", "(", "n", "*", "ln", "(", "n", "))", " and", " an", " average", " performance", " basically", " equal", " to", " qu", "icks", "ort", ".", "\n", "\n", "and", " an", " average", " performance", " basically", " equal", " to", " qu", "icks", "ort", ".", " mer", "ges", "ort", " is", " guaranteed", " to", " run", " in", " O", "(", "n", "*", "ln", "(", "n", "))", " but", " requires", " n", " units", " of", " additional", " temporary", " storage", ".", "\n", "\n", "Now", " when", " thinking", " about", " all", " of", " this", ",", " what", " struck", " me", " is", " that", " I", " could", " not", " see", " really", " why", " he", "aps", "ort", " is", " slower", " than", " qu", "icks", "ort", ".", " And", " I", "'ve", " not", " heard", " or", " read", " a", " credible", " explanation", " for", " this", " either", ".", "\n", "\n", "Update", ":", " David", " Mac", "Kay", " explains", " it", " here", ".", "\n", "\n", "Quick", "Sort", "\n", "\n", "For", " large", " enough", " n", ",", " some", " sub", "par", "itions", " of", " will", " contain", " small", " pathological", " cases", ".", " Furthermore", ",", " the", " partition", "ing", " breakdown", " will", " be", " arbitrary", " and", " thus", " necessarily", " not", " be", " even", " and", " therefore", " will", " perform", " more", " like", " n", "*", "(", "l", "g", "(", "n", ")+", "eps", ")", " comparisons", "/", "sw", "aps", ".", " Work", " around", "s", " like", " \"", "med", "ian", " of", " 3", "\"", " are", " not", " convincing", ",", " and", " just", " shifts", " the", " pathological", " cases", ".", " Bal", "ancing", " this", " out", " is", " the", " fact", " that", " quick", " sort", " is", " just", " a", " context", " insensitive", " recursive", " algorithm", " --", " so", " its", " limited", " mostly", " by", " the", " speed", " at", " which", " it", " sorts", " the", " very", " smallest", " sub", "-", "lists", " (", "for", " each", " partition", " of", " size", " m", " processed", " there", " are", " two", " other", " partitions", " of", " smaller", " size", " that", " are", " processed", ".)", " By", " putting", " in", " a", " trivial", " check", " for", " small", " lists", " and", " performing", " them", " with", " explicit", " hand", " coded", " optimal", " sorts", " will", " boost", " quick", " sort", "'s", " overall", " performance", ".", "\n", "\n", "He", "ap", "Sort", "\n", "\n", "He", "ap", " sort", " is", " based", " around", " the", " idea", " of", " arranging", " the", " elements", " into", " a", " \"", "he", "ap", "\"", " which", " allows", " an", " O", "(", "1", ")", " algorithm", " for", " finding", " the", " maximum", " element", " and", " an", " O", "(", "ln", "(", "n", "))", " for", " deleting", " it", " out", " of", " the", " array", ".", " By", " expressing", " the", " heap", " in", " clever", " way", ",", " this", " can", " all", " be", " mapped", " in", "-", "place", " with", " the", " original", " array", ".", " One", " common", " error", " made", " in", " implementing", " heap", " sort", " is", " by", " breaking", " the", " operations", " down", " all", " the", " way", " to", " paired", " element", " swaps", ".", " The", " operation", " of", " re", "-", "establish", "ing", " the", " heap", " property", " of", " a", " heap", " after", " its", " maximum", " element", " is", " deleted", " (", "called", " s", "ifting", ")", " is", " essentially", " a", " rotation", " of", " a", " sequence", " of", " sub", "-", "he", "ap", " maximum", "s", ".", " As", " I", " showed", " in", " my", " article", " about", " in", "-", "place", " array", " rotation", ",", " rot", "ations", " require", " only", " one", " extra", " temporary", " and", " one", " read", " and", " write", " for", " each", " position", " of", " the", " cycle", " to", " be", " rotated", ".", " This", " leads", " to", " nearly", " a", " 2", "x", " improvement", " on", " the", " number", " of", " required", " reads", "/", "writ", "es", " to", " the", " array", ".", " I", " was", " not", " able", " to", " find", " anyone", " else", "'s", " reference", " implementation", " which", " took", " this", " into", " account", ".", "\n", "\n", "But", " otherwise", ",", " he", "aps", "ort", " doesn", "'t", " have", " any", " substantial", " number", " of", " interesting", " degener", "ate", " cases", " (", "other", " than", " the", " inf", "requent", " short", " rotation", ")", " to", " leverage", " its", " overall", " performance", ".", "\n", "\n", "Mer", "ge", "Sort", "\n", "\n", "Mer", "ges", "ort", " kind", " of", " combines", " the", " good", " features", " of", " qu", "icks", "ort", " and", " he", "aps", "ort", ".", " It", " is", " also", " context", " ins", "ent", "ively", " recursive", ",", " so", " small", " cases", " are", " a", " major", " leverage", " point", " for", " overall", " performance", " as", " well", ".", " However", ",", " it", " also", " is", " recursive", " in", " a", " static", " way", ",", " so", " that", " it", " cannot", " vary", " or", " be", " caught", " in", " bad", " cases", " where", " it", " might", " perform", " un", "character", "istically", " badly", ".", " The", " problem", " with", " Mer", "ges", "ort", " is", " that", " every", " element", " will", " move", " l", "g", "(", "n", ")", " steps", " (", "or", " perhaps", " a", " few", " less", " because", " of", " the", " exploit", "ability", " of", " direct", " sorting", " of", " small", " sub", "-", "lists", ")", " regardless", ".", " So", " the", " average", ",", " worst", " and", " best", " case", " running", " time", " is", " identical", " no", " matter", " what", ".", "\n", "\n", "Measure", "ments", "\n", "\n", "Now", " given", " all", " this", " information", " its", " a", " bit", " hard", " to", " see", " which", " of", " these", " should", " really", " be", " fastest", " in", " real", " life", ".", " That", " leaves", " us", " with", " one", " final", " possibility", " --", " actually", " try", " it", " out", " in", " practice", ".", " Below", " are", " the", " results", " from", " just", " such", " a", " test", ":", "\n", "\n", "A", "th", "lon", " XP", " 1", ".", "620", "G", "hz", " Power", "4", " 1", "G", "hz", " Intel", " C", "/", "C", "++", "\n", "\n", "/", "O", "2", " /", "G", "6", " /", "Q", "ax", "i", " /", "Q", "xi", " /", "Q", "ip", " W", "AT", "COM", " C", "/", "C", "++", "\n", "\n", "/", "ot", "ex", "an", " /", "6", "r", " GCC", "\n", "\n", "-", "O", "3", " -", "m", "arch", "=", "athlon", "-", "xp", " MS", "VC", "\n", "\n", "/", "O", "2", " /", "O", "t", " /", "O", "g", " /", "G", "6", " CC", "\n", "\n", "-", "O", "3", " He", "aps", "ort", " 2", ".", "09", " 4", ".", "06", " 4", ".", "16", " 4", ".", "12", " 16", ".", "91", " Qu", "icks", "ort", " 2", ".", "58", " 3", ".", "24", " 3", ".", "42", " 2", ".", "80", " 14", ".", "99", " Mer", "ges", "ort", " 3", ".", "51", " 4", ".", "28", " 4", ".", "83", " 4", ".", "01", " 16", ".", "90", " Data", " is", " time", " in", " seconds", " taken", " to", " sort", " 10000", " lists", " of", " varying", " size", " of", " about", " 3000", " integers", " each", ".", " Download", " test", " here", "\n", "\n", "I", " suspected", " that", " he", "aps", "ort", " should", " do", " better", " than", " its", " poor", " reputation", " and", " I", " think", " these", " results", " bear", " that", " out", ".", " Only", " MS", "VC", " really", " shows", " it", " to", " be", " more", " than", " 20", "%", " slower", " than", " qu", "icks", "ort", " and", " the", " always", " awesome", " Intel", " compiler", " turns", " in", " the", " best", " overall", " score", " with", " he", "aps", "ort", " (", "by", " a", " large", " margin", ".)", "\n", "\n", "It", " turns", " out", " that", " much", " of", " the", " reason", " for", " Intel", "'s", " large", " margin", " of", " victory", " are", " the", " /", "Q", "ax", "i", " /", "Q", "xi", " flags", " used", " to", " build", " the", " test", ".", " The", " inner", " loop", " for", " he", "aps", "ort", " has", " an", " opportunity", " to", " perform", " conditional", " computation", " rather", " than", " an", " unpredictable", " conditional", " branch", " (", "a", " big", " no", " no", " on", " modern", " micro", "process", "ors", ")", " and", " these", " flags", " allow", " the", " Intel", " compiler", " to", " exploit", " this", " situation", " while", " the", " other", " comp", "ilers", " were", " unable", " to", " do", " this", ".", " The", " qu", "icks", "ort", " algorithm", " inner", " loop", " cannot", " be", " pred", "icated", ",", " and", " the", " Intel", " compiler", " did", " not", " do", " it", " with", " mer", "ges", "ort", " (", "even", " though", " it", " is", " possible", " to", " do", " it", ".)", "\n", "\n", "The", " academics", " commonly", " cite", " comparison", " and", " swap", " counts", ".", " Of", " course", ",", " with", " my", " implementation", " of", " he", "aps", "ort", " there", " are", " no", " swaps", " per", " se", ".", " So", " its", " more", " comparable", " to", " count", " the", " number", " of", " reads", " and", " writes", ".", " So", " lets", " count", " them", " up", ":", "\n", "\n", "Compar", "isons", " Read", "s", "/", "Writ", "es", " He", "aps", "ort", " 610", "45", ".", "4", " 408", "78", ".", "2", " Qu", "icks", "ort", " 220", "37", ".", "8", " 163", "22", ".", "5", " Mer", "ges", "ort", " 317", "55", ".", "0", " 312", "25", ".", "0", " Data", " is", " average", " number", " of", " operations", " taken", " to", " sort", " 1000", " lists", " of", " varying", " size", " of", " about", " 3000", " integers", " each", ".", "\n", "\n", "Ok", ",", " this", " is", " appears", " to", " be", " the", " source", " of", " the", " conventional", " wisdom", ".", " Indeed", ",", " qu", "icks", "ort", " will", " perform", " almost", " 3", " times", " better", " than", " he", "aps", "ort", " and", " almost", " 2", " times", " better", " than", " mer", "gs", "ort", ".", " (", "It", " should", " be", " noticed", " that", " my", " results", " show", " he", "aps", "ort", " to", " be", " far", " better", " here", " than", " results", " obtained", " by", " others", " who", " count", " swaps", " which", " show", " relative", " differences", " closer", " to", " 10", " times", ".)", " So", " whenever", " the", " performance", " is", " dominated", " by", " comparison", " or", " memory", " bandwidth", " costs", " qu", "icks", "ort", " really", " is", " the", " best", " choice", ".", " This", " will", " be", " the", " case", " when", " using", " generic", " callback", " mechanisms", " like", " q", "sort", "()", " does", ",", " or", " when", " dealing", " with", " generic", " objects", " like", " STL", " does", ".", "\n", "\n", "In", " the", " face", " of", " these", " counts", ",", " how", " is", " it", " possible", " for", " he", "aps", "ort", " to", " do", " as", " well", " as", " it", " does", " in", " my", " previous", " measurements", "?", " Its", " not", " explained", " just", " by", " compiler", " efficiency", ".", " For", " this", " we", " have", " to", " really", " dive", " in", " under", " the", " hood", " of", " these", " algorithms", " and", " understand", " how", " this", " relates", " to", " modern", " micro", "processor", " performance", ".", " The", " key", " considerations", " are", " parallel", "ism", " and", " branching", " penalties", ".", "\n", "\n", "He", "aps", "ort", " at", " a", " low", " level", "\n", "\n", "Between", " each", " extraction", " of", " maximum", " elements", " in", " heap", " sort", ",", " a", " s", "ift", " down", " operation", " occur", "rs", " that", " takes", " l", "g", "(", "i", ")", " steps", " where", " i", " varies", " from", " 1", " to", " n", ".", " This", " s", "ift", " down", " operation", " is", " basically", " a", " loop", " which", " travers", "es", " the", " binary", " tree", " structure", " of", " the", " heap", " always", " ch", "osing", " the", " node", " with", " the", " higher", " value", " and", " shuff", "ling", " these", " nodes", " upward", ".", " The", " direction", " down", " the", " tree", " that", " this", " operation", " goes", " each", " time", " is", " basically", " unpredictable", ",", " but", " at", " its", " lowest", " level", " manifests", " as", " adding", " either", " 0", " or", " 1", " to", " the", " current", " node", " index", ".", " For", " a", " modern", " compiler", " and", " underlying", " micro", "processor", " this", " allows", " it", " to", " convert", " the", " comparison", " to", " this", " computation", " without", " a", " branch", " --", " so", " the", " reduces", " the", " branch", " penalties", " to", " just", " one", " at", " the", " loop", " exit", ".", " For", " older", " comp", "ilers", "/", "micro", "process", "ors", ",", " there", " are", " l", "g", "(", "i", ")", " unpredictable", " branches", ".", " So", " in", " total", " there", " are", " about", " l", "g", "(", "1", ")+", "l", "g", "(", "2", ")+", "...", "+", "l", "g", "(", "n", ")", " (", "which", " is", " less", " than", " n", "*", "l", "g", "(", "n", "))", " unp", "red", "ic", "atable", " branches", " for", " older", " comp", "ilers", " and", " basically", " just", " n", " unpredictable", " branches", " for", " newer", " comp", "ilers", "/", "CPU", "s", ".", "\n", "\n", "The", " operations", " in", " each", " instance", " of", " the", " s", "ift", " down", " loop", " are", " all", " pip", "elin", "ably", " parallel", " with", " respect", " to", " each", " other", " without", " a", " lot", " of", " intervening", " branch", " control", ".", " What", " this", " means", " is", " that", " for", " super", "-", "sc", "al", "ar", ",", " out", " of", " order", ",", " post", " modern", " micro", "process", "ors", " as", " instructions", " from", " one", " pass", " through", " the", " loop", " executing", " instructions", " from", " subsequent", " instances", " can", " actually", " start", " executing", " in", " parallel", ".", " So", " while", " copying", " the", " previous", " node", " upwards", ",", " the", " CPU", " can", " determine", " which", " of", " the", " next", " two", " nodes", " is", " the", " correct", " path", " to", " follow", " in", " parallel", ".", "\n", "\n", "Qu", "icks", "ort", " at", " a", " low", " level", "\n", "\n", "For", " each", " scanned", " element", " there", " is", " an", " unpredictable", " branch", ".", " So", " there", " are", " roughly", " n", "*", "l", "g", "(", "n", ")", " mis", "pred", "icted", " branches", ".", " However", ",", " there", " is", " no", " simple", " way", " to", " translate", " these", " to", " conditional", " comput", "ations", ".", " This", " is", " mit", "igated", " somewhat", " by", " leveraging", " optimal", " sorting", " for", " the", " smallest", " sub", "-", "lists", ".", "\n", "\n", "Each", " operation", " inside", " the", " par", "ition", "ing", " step", " is", " essentially", " directly", " dependent", " on", " the", " results", " of", " the", " previous", " one", ".", " Because", " of", " this", ",", " there", " is", " almost", " no", " real", " parallel", "ism", " available", ".", "\n", "\n", "Mer", "ges", "ort", " at", " a", " low", " level", "\n", "\n", "Mer", "ges", "ort", " actually", " requires", " somewhere", " between", " 1", " and", " 3", " predictable", " branches", " per", " read", "/", "write", " operation", ".", " It", " starts", " out", " mostly", " requiring", " 1", ",", " but", " will", " degener", "ate", " to", " closer", " to", " 3", " as", " each", " half", " gets", " smaller", ".", " So", " the", " result", " is", " between", " n", "*", "l", "g", "(", "n", ")", " and", " 3", "*", "n", "*", "l", "g", "(", "n", ")", " unpredictable", " branches", ".", " Although", " it", " is", " possible", " for", " a", " modern", " CPU", " to", " use", " conditional", " computation", " instructions", " in", " mer", "ges", "ort", " as", " well", ",", " the", " Intel", " C", "/", "C", "++", " did", " not", " do", " it", ".", " Some", " experimentation", " by", " hand", " with", " it", " myself", " indicates", " that", " trying", " to", " force", " such", " a", " thing", " creates", " an", " additional", " ind", "irection", " (", "aka", " \"", "store", " to", " load", " forwarding", "\")", " problem", " which", " makes", " the", " loop", " even", " slower", ".", " So", " conditional", " computation", " instructions", " don", "'t", " help", " in", " this", " case", ".", "\n", "\n", "As", " to", " parallel", "ism", ",", " the", " conditional", " is", " dependent", " on", " the", " results", " from", " the", " store", " and", " variable", " increment", ",", " so", " there", " is", " no", " opportunity", " for", " mer", "ges", "ort", " either", ".", "\n", "\n", "Conclusion", " and", " future", " work", " to", " be", " considered", "\n", "\n", "Where", " modern", " processor", " and", " compiler", " considerations", " dominates", ",", " he", "aps", "ort", " will", " actually", " outper", "form", " qu", "icks", "ort", " both", " theoretically", " and", " in", " practice", ".", " Only", " when", " the", " cost", " of", " comparisons", " and", "/", "or", " the", " operation", " of", " moving", " the", " entry", " itself", " starts", " to", " dominate", " will", " qu", "icks", "ort", " retake", " the", " lead", ".", " This", " is", " something", " to", " consider", " when", " designing", " an", " abstract", " data", " type", ".", " If", " one", " has", " a", " list", " of", " pointers", ",", " or", " which", " can", " otherwise", " be", " satisf", "actor", "ily", " sorted", " by", " indirect", " index", ",", " and", " it", " is", " essentially", " being", " sorted", " by", " a", " scal", "ar", " (", "something", " desirable", " to", " for", " sort", " performance", ",", " regardless", ")", " then", " he", "aps", "ort", " can", " be", " the", " most", " attractive", " option", ".", "\n", "\n", "This", " leads", " us", " with", " one", " open", " question", " about", " a", " common", " sorting", " scenario", ".", " What", " if", " we", " want", " to", " sort", " text", " strings", "?", " Here", " the", " comparison", " performance", " is", " variable", ",", " and", " likely", " to", " have", " higher", " average", " cost", " than", " scal", "ar", " comparison", ",", " but", " the", " read", "/", "write", " penalties", " will", " not", " necessarily", " change", ".", " While", " we", " expect", " qu", "icks", "ort", " to", " benefit", " from", " this", ",", " if", " the", " strings", " are", " totally", " random", " (", "which", " will", " lead", " to", " the", " roughly", " minimum", " cost", " for", " the", " string", " comparisons", ")", " would", " it", " be", " enough", " to", " tip", " the", " balance", " back", " in", " favor", " or", " qu", "icks", "ort", " when", " using", " the", " Intel", " compiler", "?", " This", " is", " unanswered", ".", "\n", "\n", "Intel", "'s", " compiler", " has", " quite", " an", " excellent", " reputation", " for", " delivering", " performance", " (", "established", " by", " many", " objective", " tests", ")", " and", " this", " has", " motivated", " competitors", " to", " try", " to", " improve", " their", " comp", "ilers", ".", " In", " this", " sense", " it", " is", " hoped", " that", " more", " comp", "ilers", " will", " deliver", " the", " same", " capabilities", " as", " Intel", "'s", " does", " in", " the", " future", ".", " But", " as", " a", " consequence", ",", " he", "aps", "ort", " will", " return", " as", " a", " serious", " candidate", " for", " raw", " sorting", ".", "\n", "\n", "Update", ":", " Feedback", "\n", "\n", "I", " have", " been", " contacted", " by", " various", " people", " who", " have", " challenged", " my", " results", ".", " Specifically", ",", " they", " claim", " that", " my", " qu", "icks", "ort", " implementation", " is", " unfairly", " sub", "-", "opt", "imal", ".", " The", " complaints", " are", " roughly", " as", " follows", ":", "\n", "\n", "Instead", " of", " using", " the", " more", " typical", " \"", "sw", "ap", "\"", " operation", ",", " the", " inner", " loop", " of", " my", " qu", "icks", "ort", " contains", " got", "os", " and", " appears", " more", " complicated", ",", " and", " thus", " must", " be", " slower", ".", " This", " is", " pure", " nonsense", ".", " I", " started", " with", " a", " more", " typical", " \"", "sw", "ap", "\"", " loop", " and", " actually", " modified", " the", " loop", " in", " stages", ",", " measuring", " the", " results", ",", " and", " examining", " the", " compiler", " dis", "assembly", " (", "from", " more", " than", " one", " compiler", ")", " every", " step", " of", " the", " way", ".", " I", " highly", " doubt", " that", " any", " prior", " effort", " has", " had", " comparable", " analysis", ".", " The", " result", " is", " my", " loop", " has", " roughly", " half", " as", " many", " reads", "/", "writ", "es", " as", " the", " swap", " version", ".", " But", " the", " got", "os", " also", " minim", "izes", " all", " control", " logic", " totally", ".", " This", " reduces", " the", " overhead", " for", " partition", "ing", " which", " changes", " other", " analysis", ".", " Once", " the", " partition", " size", " drops", " below", " a", " certain", " number", " (", "higher", " than", " 3", ")", " the", " algorithm", " should", " switch", " to", " Insert", " Sort", " (", "or", " some", " other", " O", "(", "n", "2", ")", " sort", ").", " I", " tried", " to", " do", " this", ",", " and", " in", " fact", " automatically", " searched", " for", " the", " optimal", " value", " for", " such", " a", " cutoff", ".", " The", " results", " were", " different", " for", " different", " comp", "ilers", " (", "which", " reflects", " the", " importance", " of", " the", " overhead", " of", " the", " pivot", " part", " of", " the", " loop", ")", " but", " no", " result", " showed", " a", " relevant", " improvement", " over", " the", " version", " shown", ".", " It", " should", " be", " noted", " that", " sort", "3", " and", " sort", "2", " are", " optimal", " (", "for", " our", " random", " data", " situation", ")", " sort", " algorithms", ".", " That", " means", ",", " the", " disadvantage", " for", " using", " more", " partition", "ing", " (", "vers", "us", " an", " earlier", " cutoff", " to", " Insert", "Sort", " style", " solution", ")", " is", " offset", " by", " the", " advantage", " of", " using", " these", " optimal", " sorts", ".", " sort", "3", " and", " sort", "2", " are", " many", " many", " times", " faster", " than", " Insert", "Sort", " on", " 3", " or", " 2", " elements", ".", " But", ",", " Insert", "Sort", " is", " an", " O", "(", "n", "2", ")", " algorithm", ",", " so", " its", " performance", " on", " 6", " elements", " is", " 4", " times", " slower", " than", " its", " performance", " on", " 3", " elements", " etc", ".", " So", " for", " an", " Insert", "Sort", " cut", " over", " to", " be", " a", " better", " solution", " it", " needs", " to", " outper", "form", " the", " partition", " speed", " (", "since", " it", " cannot", " hold", " a", " candle", " to", " the", " sort", "3", "/", "sort", "2", " functions", ".)", " For", " large", " n", " it", " has", " no", " chance", " of", " doing", " this", ",", " and", " considering", " the", " improved", " partition", " loop", " as", " described", " above", ",", " it", " will", " have", " a", " hard", " time", " beating", " the", " partition", " code", " as", " well", ".", " So", " this", " result", " should", " not", " come", " as", " a", " surprise", " at", " all", ".", " The", " number", " of", " elements", " of", " each", " array", " is", " too", " small", ".", " Yes", " this", " is", " true", " --", " I", " picked", " something", " that", " would", " be", " sure", " to", " fit", " into", " the", " on", "-", "chip", " CPU", " cache", " of", " any", " modern", " CPU", ".", " The", " reason", " for", " this", " is", " that", " the", " Compar", "isons", " and", " Read", "s", "/", "Writ", "es", " table", " that", " is", " shown", " above", " already", " tells", " us", " what", "'s", " going", " to", " happen", ".", " As", " we", " add", " cost", " to", " read", "/", "writ", "es", ",", " Qu", "icks", "ort", " will", " clearly", " be", " a", " better", " solution", ".", " Furthermore", ",", " he", "aps", "ort", " has", " very", " poor", " data", " locality", ",", " while", " Qu", "icks", "ort", " has", " excellent", " locality", ",", " which", " means", " the", " read", "/", "write", " penalties", " will", " be", " worse", " for", " he", "aps", "ort", " than", " Qu", "icks", "ort", ".", " Under", " these", " circumstances", " its", " clear", " that", " he", "aps", "ort", " will", " lose", " if", " the", " data", " doesn", "'t", " all", " fit", " into", " the", " on", "-", "chip", " cache", " of", " the", " CPU", ".", " But", " this", " leads", " us", " to", " an", " \"", "Int", "ros", "ort", "\"", " style", " of", " hybrid", " algorithm", ".", " Int", "ros", "ort", " is", " just", " a", " qu", "icks", "ort", " that", " calls", " itself", " rec", "urs", "ively", " as", " normal", " until", " its", " stack", " depth", " exceeds", " a", " certain", " threshold", " and", " just", " switches", " to", " he", "aps", "ort", " for", " such", " bad", " partitions", ".", " Well", " in", " addition", ",", " the", " qu", "icks", "ort", " could", " also", " switch", " to", " heap", " sort", " once", " the", " partition", "'s", " size", " falls", " below", " that", " of", " the", " L", "1", "-", "cache", " (", "and", " if", " we", " are", " using", " the", " Intel", " compiler", ")", " which", " would", " make", " the", " algorithm", "'s", " constant", " factor", " over", " O", "(", "n", "*", "l", "g", "(", "n", "))", " really", " be", " limited", " by", " he", "aps", "ort", " efficiency", ",", " not", " qu", "icks", "ort", " efficiency", ".", "\n", "\n", "Besides", " missing", " the", " above", " things", ",", " others", " who", " have", " written", " to", " me", " have", " tried", " to", " compare", " this", " to", " sorting", " floating", " point", " (", "increasing", " the", " comparison", " cost", "),", " sticking", " with", " SW", "AP", "()", " as", " the", " lowest", " level", " data", " movement", " primitive", " (", "just", " plain", " dumb", "),", " and", " using", " slower", " languages", " (", "such", " as", " Basic", ")", " that", " are", " inappropriate", " for", " performance", " analysis", ".", "\n", "\n", "Update", ":", " Feedback", " (", "2", ")", "\n", "\n", "I", " have", " received", " some", " insightful", " feedback", " from", " James", " Barb", "etti", ",", " who", " has", " clearly", " studied", " this", " problem", " far", " beyond", " what", " you", " get", " from", " most", " academic", " study", " or", " from", " typical", " text", " books", ".", " He", " suggests", " 1", ")", " multip", "ro", "cess", "or", " environments", " would", " behave", " differently", " (", "that", " should", " not", " surprise", " anyone", "),", " 2", ")", " there", " are", " ways", " of", " improving", " he", "aps", "ort", " by", " running", " it", " the", " opposite", " direction", " (", "I", " have", " not", " confirmed", " this", "),", " 3", ")", " Qu", "icks", "ort", " can", " be", " guaranteed", " to", " use", " O", "(", "1", "+", "log", "(", "n", "))", " of", " stack", " by", " not", " rec", "urs", "ing", " the", " larger", " partition", " but", " rather", " by", " loop", "ing", " back", " to", " the", " top", " after", " adjusting", " the", " input", " parameters", " to", " match", " the", " larger", " partition", ".", "\n", "\n", "I", " have", " updated", " the", " Qu", "icks", "ort", " loop", " with", " non", "-", "rec", "ursion", " on", " the", " larger", " partition", ",", " and", " added", " a", " 4", " entry", " sort", "4", "()", " optimal", " sort", ".", " This", " improves", " the", " qu", "icks", "ort", " results", " marginally", " for", " most", " of", " the", " comp", "ilers", ",", " and", " significantly", " for", " the", " Intel", " compiler", ".", " I", "'ve", " updated", " the", " performance", " results", " in", " the", " table", " above", " and", " the", " test", " source", " code", "."]