["Cl", "ang", "-", "T", "idy", ",", " part", " 2", ":", " Modern", "ize", " your", " source", " code", " using", " C", "++", "11", "/", "C", "++", "14", ".", " The", " blog", " series", " introduces", " you", " to", " the", " cl", "ang", "-", "t", "idy", " utility", " and", " how", " to", " use", " it", " to", " automatically", " ref", "actor", " C", "++", " source", " code", " and", " integrate", " it", " with", " your", " build", " system", ".", "\n", "\n", "Introduction", "\n", "\n", "This", " article", " is", " part", " of", " a", " blog", " series", " about", " Cl", "ang", " T", "idy", ".", " In", " the", " previous", " article", " we", " learned", " about", " the", " general", " usage", " of", " Cl", "ang", " T", "idy", " to", " automatically", " ref", "actor", " source", " code", " for", " projects", " using", " the", " C", "Make", " build", " system", ".", " In", " this", " particular", " episode", " we", "\ufffd", "\ufffd", "ll", " discuss", " using", " Cl", "ang", " Tool", "ing", " on", " projects", " using", " different", " build", " systems", " with", " the", " help", " of", " Bear", ".", "\n", "\n", "Mot", "ivation", ":", " So", " you", " want", " to", " use", " Cl", "ang", " Tool", "ing", " on", " your", " project", " \u2014", " but", " what", " if", " your", " particular", " project", " of", " interest", " is", " using", " another", " build", " system", " such", " as", " q", "make", ",", " a", " build", " system", " predominantly", " used", " in", " the", " Qt", " world", "?", " There", " is", " a", " way", " to", " leverage", " Cl", "ang", " Tool", "ing", " on", " any", " build", " system", " out", " there", " by", " just", " using", " a", " small", " helper", " tool", ".", "\n", "\n", "Introdu", "cing", " Bear", "\n", "\n", "Bear", " (", "Build", " EAR", ")", " is", " a", " tool", " that", " generates", " a", " compilation", " database", " for", " cl", "ang", " tool", "ing", ".", " As", " we", "\ufffd", "\ufffd", "ve", " learned", " in", " the", " previous", " article", " in", " this", " blog", " series", ",", " all", " that", " Cl", "ang", " Tool", "ing", " needs", " to", " know", " about", " your", " project", " is", " a", " JSON", " Comp", "ilation", " Database", ",", " which", " is", " basically", " a", " replay", " of", " all", " the", " comp", "il", "ations", " (", "i", ".", "e", ".", " compiler", " inv", "ocations", ")", " happening", " during", " a", " project", " build", ".", " While", " the", " C", "Make", " build", " system", " can", " generate", " one", " out", " of", " the", " box", ",", " other", " build", " systems", " usually", " require", " additional", " work", " to", " get", " one", ".", "\n", "\n", "Bear", " is", " a", " generic", " way", " to", " generate", " the", " compilation", " database", " during", " the", " build", " process", ",", " i", ".", "e", ".", " when", " running", " make", " for", " any", " build", " system", ".", " The", " concept", " behind", " Bear", " is", " that", " it", " intercept", "s", " the", " exec", " calls", " done", " by", " the", " build", " tool", " (", "i", ".", "e", ".", " make", " )", " and", " uses", " the", " command", "-", "line", " arguments", " passed", " to", " the", " compiler", " and", " stores", " them", " in", " the", " compilation", " database", ".", " Think", " of", " a", " str", "ace", " -", "like", " tool", " filtering", " for", " exec", " system", " calls", ".", "\n", "\n", "Unfortunately", ",", " Bear", " currently", " only", " works", " on", " Unix", "-", "based", " systems", " (", "Free", "BSD", ",", " GNU", "/", "Linux", " and", " macOS", "),", " since", " it", "\ufffd", "\ufffd", "s", " heavily", " relying", " on", " the", " LD", "_", "P", "REL", "OAD", " mechanism", " on", " *", "BSD", "/", "Linux", " and", " its", " macOS", " counterpart", " to", " intercept", " the", " system", " calls", ".", "\n", "\n", "Getting", " Bear", "\n", "\n", "On", " Ubuntu", " (", "since", " at", " least", " 14", ".", "04", " L", "TS", ")", " or", " Debian", " (", "since", " at", " least", " j", "ess", "ie", "):", "\n", "\n", "sudo", " apt", "-", "get", " install", " bear", "\n", "\n", "On", " any", " other", " distributions", " not", " providing", " a", " package", ":", "\n", "\n", "git", " clone", " https", "://", "github", ".", "com", "/", "riz", "s", "otto", "/", "Bear", " cd", " Bear", " cm", "ake", ".", ";", " make", ";", " make", " install", "\n", "\n", "Refer", " to", " the", " official", " documentation", " for", " more", " information", ".", "\n", "\n", "Using", " Bear", "\n", "\n", "This", " section", " will", " show", " how", " to", " use", " Bear", " with", " different", " build", " systems", ".", " Always", " remember", " that", " Bear", " is", " just", " a", " helper", " tool", " used", " to", " intercept", " the", " build", " tool", " used", ".", " The", " end", " result", " of", " Bear", " is", " a", " compilation", " database", " which", " can", " be", " consumed", " by", " Cl", "ang", " Tool", "ing", " later", ".", "\n", "\n", "Using", " Bear", " with", " q", "make", "\n", "\n", "The", " q", "make", " build", " system", " is", " predominantly", " used", " in", " the", " Qt", " world", ".", " While", " this", " little", " tutorial", " is", " specific", " to", " q", "make", ",", " the", " same", " workflow", " can", " be", " applied", " to", " any", " other", " build", " system", ".", "\n", "\n", "Let", "\ufffd", "\ufffd", "s", " use", " Bear", " on", " an", " example", " project", " called", " q", "t", "remote", "objects", ",", " which", " is", " a", " Qt", " module", " hosted", " on", " Qt", " Git", ".", "\n", "\n", "<", "check", "out", " q", "t", "remote", "objects", ">", " cd", " q", "t", "remote", "objects", " mk", "cd", " build", "\n", "\n", "PS", ":", " Tip", ":", " mk", "cd", " just", " creates", " a", " directory", " and", " cd", "\ufffd", "\ufffd", "s", " into", " it", " \u2014", " source", ".", "\n", "\n", "At", " this", " point", " we", " want", " to", " set", " up", " the", " build", " system", ".", " Note", " we", " cannot", " just", " call", " q", "make", "..", " alone", ",", " since", " on", " Linux", " this", " will", " use", " the", " linux", "-", "g", "cc", " spec", " by", " default", ".", " The", " compile", " flags", " used", " in", " the", " Make", "files", " generated", " using", " this", " spec", " won", "\ufffd", "\ufffd", "t", " be", " compatible", " with", " cl", "ang", ",", " thus", " we", " need", " to", " resort", " to", " using", " the", " linux", "-", "cl", "ang", " m", "ks", "pec", ".", "\n", "\n", "q", "make", " -", "spec", " linux", "-", "cl", "ang", "..", "\n", "\n", "This", " generated", " the", " root", " Make", "file", ".", " Now", " we", " have", " to", " run", " make", ",", " but", " since", " we", " want", " to", " generate", " the", " compilation", " database", " on", " the", " fly", " as", " well", ",", " we", " have", " to", " \ufffd", "\ufffd", "pre", "load", "\ufffd", "\ufffd", " bear", ".", "\n", "\n", "bear", " make", "\n", "\n", "After", " bear", " make", " finished", ",", " you", "\ufffd", "\ufffd", "ll", " end", " up", " with", " a", " file", " called", " compile", "_", "comm", "ands", ".", "json", " in", " the", " current", " working", " directory", ".", " Similarly", " as", " if", " you", " would", " have", " let", " C", "Make", " generate", " this", " compilation", " database", " for", " you", ".", "\n", "\n", "Let", "\ufffd", "\ufffd", "s", " check", " what", "\ufffd", "\ufffd", "s", " inside", ":", "\n", "\n", "head", " compile", "_", "comm", "ands", ".", "json", " [", " {", " \"", "command", "\":", " \"", "c", "++", " -", "c", " -", "pipe", " -", "g", " -", "std", "=", "c", "++", "1", "z", " -", "f", "vis", "ibility", "=", "hidden", " -", "f", "vis", "ibility", "-", "in", "lines", "-", "hidden", " -", "f", "no", "-", "ex", "ceptions", " -", "Wall", " -", "W", " -", "D", "_", "RE", "ENT", "RANT", " -", "f", "P", "IC", " -", "D", "Q", "T", "_", "BU", "ILD", "_", "REM", "OT", "EO", "B", "J", "EC", "TS", "_", "LIB", "...", " -", "I", "/", "home", "/", "k", "f", "unk", "/", "de", "vel", "/", "src", "/", "qt", "5", ".", "8", "/", "qt", "remote", "objects", "/", "src", "/", "remote", "objects", "...", " -", "o", ".", "obj", "/", "q", "connection", "_", "local", "_", "back", "end", ".", "o", " /", "home", "/", "k", "f", "unk", "/", "de", "vel", "/", "src", "/", "qt", "5", ".", "8", "/", "qt", "remote", "objects", "/", "src", "/", "remote", "objects", "/", "q", "connection", "_", "local", "_", "back", "end", ".", "cpp", "\",", " \"", "directory", "\":", " \"/", "home", "/", "k", "f", "unk", "/", "de", "vel", "/", "src", "/", "qt", "5", ".", "8", "/", "qt", "remote", "objects", "/", "build", "/", "src", "/", "remote", "objects", "\",", " \"", "file", "\":", " \"/", "home", "/", "k", "f", "unk", "/", "de", "vel", "/", "src", "/", "qt", "5", ".", "8", "/", "qt", "remote", "objects", "/", "src", "/", "remote", "objects", "/", "q", "connection", "_", "local", "_", "back", "end", ".", "cpp", "\"", " },", " {", " \"", "command", "\":", " \"", "c", "++", "...", " /", "home", "/", "k", "f", "unk", "/", "de", "vel", "/", "src", "/", "qt", "5", ".", "8", "/", "qt", "remote", "objects", "/", "src", "/", "remote", "objects", "/", "q", "connection", "_", "t", "cp", "ip", "_", "back", "end", ".", "cpp", "\",", "...", "\n", "\n", "Looking", " good", ".", "\n", "\n", "Note", ":", " If", " you", " interrupt", " bear", " make", ",", " a", " consecutive", " run", " of", " bear", " make", " will", " just", " *", "over", "ride", " this", " compile", "_", "comm", "ands", ".", "json", " file", ".", " In", " other", " words", ",", " you", "\ufffd", "\ufffd", "ll", " lose", " the", " information", " inside", " that", " file", " from", " the", " previous", " make", " run", ",", " of", " targ", "est", " which", " have", " been", " compiled", " already", ".", " Thus", " in", " order", " to", " get", " a", " complete", " compile", "_", "comm", "ands", ".", "json", ",", " clear", " the", " build", " directory", " first", ",", " then", " invoke", " bear", "...", " as", " before", " again", ".", "\n", "\n", "Using", " Bear", " with", " any", " other", " build", " tool", " (", "for", " comple", "teness", " sake", ")", "\n", "\n", "This", " is", " what", " you", " need", ":", "\n", "\n", "bear", " <", "build", " tool", ">", "\n", "\n", "The", " build", " tool", " could", " be", " anything", " \u2014", " it", " can", " even", " be", " a", " totally", " different", " build", " system", " which", " does", " not", " leverage", " traditional", " build", " tools", " such", " as", " make", "/", "nin", "ja", " to", " invoke", " the", " compiler", ".", "\n", "\n", "Running", " cl", "ang", "-", "t", "idy", " as", " usual", "\n", "\n", "Next", ",", " as", " soon", " as", " we", " have", " a", " valid", " compile", "_", "comm", "ands", ".", "json", " file", ",", " we", " can", " run", " run", " cl", "ang", "-", "t", "idy", " as", " we", " learned", " in", " part", " 1", " of", " this", " blog", " series", ",", " using", " the", " run", "-", "cl", "ang", "-", "t", "idy", " script", ":", "\n", "\n", "run", "-", "cl", "ang", "-", "t", "idy", "-", "3", ".", "9", ".", "py", " -", "cl", "ang", "-", "t", "idy", "-", "binary", " cl", "ang", "-", "t", "idy", "-", "3", ".", "9", " -", "cl", "ang", "-", "apply", "-", "repl", "acements", "-", "binary", " cl", "ang", "-", "apply", "-", "repl", "acements", "-", "3", ".", "9", " -", "header", "-", "filter", "=", "'.", "*", "'", " -", "checks", "='", "-", "*,", "modern", "ize", "-", "use", "-", "auto", "'", " -", "fix", "...", " /", "home", "/", "k", "f", "unk", "/", "de", "vel", "/", "src", "/", "qt", "5", ".", "8", "/", "qt", "remote", "objects", "/", "src", "/", "remote", "objects", "/", "q", "remote", "object", "node", ".", "cpp", ":", "419", ":", "5", ":", " warning", ":", " use", " auto", " when", " initial", "izing", " with", " new", " to", " avoid", " dupl", "icating", " the", " type", " name", " [", "modern", "ize", "-", "use", "-", "auto", "]", " Q", "Connect", "ed", "Repl", "ica", "Private", " *", "r", "p", " =", " new", " Q", "Connect", "ed", "Repl", "ica", "Private", "(", "name", ",", " meta", ",", " q", ");", " ^", " auto", " /", "home", "/", "k", "f", "unk", "/", "de", "vel", "/", "src", "/", "qt", "5", ".", "8", "/", "qt", "remote", "objects", "/", "src", "/", "remote", "objects", "/", "q", "remote", "object", "node", ".", "cpp", ":", "440", ":", "9", ":", " warning", ":", " use", " auto", " when", " initial", "izing", " with", " new", " to", " avoid", " dupl", "icating", " the", " type", " name", " [", "modern", "ize", "-", "use", "-", "auto", "]", " Q", "In", "Process", "Repl", "ica", "Private", " *", "r", "p", " =", " new", " Q", "In", "Process", "Repl", "ica", "Private", "(", "name", ",", " meta", ",", " q", ");", " ^", " auto", "...", "\n", "\n", "We", "\ufffd", "\ufffd", "ll", " end", " up", " with", " a", " couple", " of", " changes", " in", " the", " source", " directory", " which", " we", " can", " commit", " afterwards", ".", "\n", "\n", "T", "rou", "bles", "hooting", "\n", "\n", "Unfortunately", " there", " are", " a", " couple", " of", " issues", " when", " running", " Bear", " which", " one", " needs", " to", " take", " into", " account", " when", " using", " it", ".", "\n", "\n", "Problem", " with", " P", "CH", "s", " from", " a", " different", " compiler", "\n", "\n", "If", " we", " had", " used", " q", "make", " -", "spec", " linux", "-", "g", "cc", "...", " before", ",", " the", " cl", "ang", "-", "t", "idy", " invocation", " would", " have", " failed", ".", " You", "\ufffd", "\ufffd", "d", " run", " into", " issues", " such", " as", " this", " one", " here", ":", "\n", "\n", "error", ":", " no", " suitable", " pre", "comp", "iled", " header", " file", " found", " in", " directory", " '.", "p", "ch", "/", "Q", "t", "5", "Remote", "Object", "s", ".", "g", "ch", "'", " [", "cl", "ang", "-", "diagn", "ostic", "-", "error", "]", "\n", "\n", "In", " other", " words", ":", " Cl", "ang", " tries", " to", " read", " a", " pre", "comp", "iled", " header", " (", "P", "CH", ")", " generated", " by", " GCC", " which", " it", " isn", "\ufffd", "\ufffd", "t", " capable", " of", " =>", " compilation", " fails", ".", "\n", "\n", "Solution", ":", " Use", " q", "make", " -", "spec", " linux", "-", "cl", "ang", "...", " in", " order", " to", " use", " the", " correct", " compiler", " from", " the", " start", ".", "\n", "\n", "Problem", " with", " P", "CH", " from", " a", " different", " compiler", " version", "\n", "\n", "If", " we", " had", " used", " q", "make", "...", " without", " CONFIG", "-", "=", "pre", "comp", "ile", "_", "header", " and", " cl", "ang", "++", " is", " of", " a", " different", " version", " than", " the", " cl", "ang", "-", "t", "idy", " executable", ",", " we", " would", " have", " run", " into", " this", " issue", ":", "\n", "\n", "error", ":", " P", "CH", " file", " built", " from", " a", " different", " branch", " ((", "tags", "/", "RE", "LEASE", "_", "400", "/", "rc", "1", "))", " than", " the", " compiler", " ((", "tags", "/", "RE", "LEASE", "_", "391", "/", "rc", "2", "))", " [", "cl", "ang", "-", "diagn", "ostic", "-", "error", "]", "\n", "\n", "Solution", ":", " Either", " make", " sure", " the", " cl", "ang", "-", "t", "idy", " version", " and", " the", " cl", "ang", " version", " match", ",", " or", " just", " disable", " pre", "comp", "iled", " headers", " in", " q", "make", " by", " passing", " CONFIG", "-", "=", "pre", "comp", "ile", "_", "header", " to", " it", ".", "\n", "\n", "cl", "ang", "-", "apply", "-", "repl", "acements", " executable", " se", "g", "f", "ault", "ing", "\n", "\n", "Problem", ":", " When", " running", " cl", "ang", "-", "apply", "-", "repl", "acements", " on", " a", " set", " of", " suggested", " fixes", " (", "st", "ored", " as", ".", "y", "ml", " files", " in", " a", " tmp", " directory", ")", " \u2014", " which", " is", " done", " as", " part", " of", " the", " run", "-", "cl", "ang", "-", "t", "idy", " script", " \u2014", " one", " may", " encounter", " invalid", " file", " references", ".", " When", " encountering", " the", " same", " invalid", " file", " references", " a", " second", " time", ",", " any", " currently", " released", " version", " of", " cl", "ang", "-", "apply", "-", "repl", "acements", " will", " crash", ".", "\n", "\n", "Example", " invocation", ":", "\n", "\n", "%", " cl", "ang", "-", "apply", "-", "repl", "acements", " /", "tmp", "/", "tmp", "I", "q", "tp", "7", "m", "...", " Des", "cribed", " file", " '.", "m", "oc", "/", "../", "../", "../", "../", "../", "../", "src", "/", "qt", "5", ".", "8", "/", "qt", "remote", "objects", "/", "src", "/", "remote", "objects", "/", "q", "remote", "object", "ab", "stract", "item", "model", "repl", "ica", "_", "p", ".", "h", "'", " doesn", "'t", " exist", ".", " Ign", "oring", "...", " Des", "cribed", " file", " '.", "m", "oc", "/", "../", "../", "../", "../", "../", "../", "src", "/", "qt", "5", ".", "8", "/", "qt", "remote", "objects", "/", "src", "/", "remote", "objects", "/", "q", "remote", "object", "p", "ending", "call", ".", "h", "'", " doesn", "'t", " exist", ".", " Ign", "oring", "...", " z", "sh", ":", " segment", "ation", " fault", " cl", "ang", "-", "apply", "-", "repl", "acements", " /", "tmp", "/", "tmp", "I", "q", "tp", "7", "m", "\n", "\n", "The", " cl", "ang", "-", "apply", "-", "repl", "acements", " executable", " crashes", ".", " Note", " I", " haven", "\ufffd", "\ufffd", "t", " investigated", " why", " the", " invalid", " file", " references", " happen", " in", " the", " first", " place", ",", " but", " I", "\ufffd", "\ufffd", "ve", " fixed", " the", " crash", " in", " cl", "ang", "-", "apply", "-", "repl", "acements", " upstream", " for", " good", ".", "\n", "\n", "Solution", ":", " Apply", " this", " patch", " when", " you", " have", " a", " source", " checkout", " of", " the", " Cl", "ang", " Tool", "ing", ".", "\n", "\n", "Unfortunately", " that", " means", " you", "\ufffd", "\ufffd", "ll", " have", " to", " compile", " the", " cl", "ang", "-", "apply", "-", "repl", "acements", " project", " yourself", " in", " order", " to", " take", " advantage", " of", " the", " patch", " for", " now", " or", " wait", " for", " a", " new", " Cl", "ang", " release", ".", "\n", "\n", "Conclusion", "\n", "\n", "With", " Bear", " one", " can", " use", " Cl", "ang", " Tool", "ing", " on", " projects", " based", " on", " other", " build", " systems", " such", " as", " C", "Make", ".", " It", "\ufffd", "\ufffd", "s", " a", " simple", " str", "ace", "-", "like", " tool", " which", " intercept", "s", " the", " build", " tool", " and", " logs", " the", " way", " the", " compiler", " is", " invoked", " in", " a", " compilation", " database", " file", ",", " which", " can", " later", " be", " consumed", " by", " cl", "ang", "-", "t", "idy", " and", " other", " Cl", "ang", " Tool", "ing", " helpers", ".", "\n", "\n", "Any", " thoughts", ",", " questions", "?"]