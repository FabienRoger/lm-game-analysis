["I", "'m", " upgrading", " my", " home", " server", " to", " be", " a", " bit", " beef", "ier", ",", " as", " I", "'ve", " started", " using", " it", " for", " some", " video", " processing", " and", " other", " demanding", " tasks", ".", " Along", " the", " way", " of", " config", "uring", " a", " new", " blank", " machine", " from", " scratch", ",", " I", " decided", " to", " set", " up", " disk", " encryption", " (", "better", " safe", " than", " sorry", ",", " eh", "?),", " something", " I", "'ve", " never", " done", " for", " a", " linux", " server", " before", ".", " I", " found", " it", " a", " bit", " tricky", ",", " so", " here", "'s", " a", " log", ",", " with", " some", " explanations", ",", " of", " what", " I", " did", ".", " If", " it", "'s", " useful", " to", " you", ",", " great", "!", " It", "'s", " geared", " towards", " the", " Gent", "oo", " linux", " distribution", ",", " as", " that", "'s", " what", " I", " use", " and", " love", ",", " and", " generally", " towards", " experts", ".", " If", " you", " don", "'t", " understand", " anything", " below", ",", " please", " research", " it", ",", " before", " you", " try", " to", " do", " something", " like", " this", ".", "\n", "\n", "Boot", " a", " recent", " Gent", "oo", " Min", "imal", " Live", "CD", ".", " I", " used", " install", "-", "x", "86", "-", "min", "imal", "-", "200", "91", "103", ".", "iso", ".", " Anything", " newer", " than", " that", " should", " probably", " also", " work", ".", "\n", "\n", "Work", " through", " the", " Gent", "oo", " Handbook", " until", " step", " 4", ".", " Using", " f", "disk", " as", " described", " there", ",", " define", " one", " small", " partition", " (", "I", " used", " 256", "M", ")", " to", " boot", " from", ",", " and", " one", " more", " taking", " the", " rest", " of", " the", " drive", ".", " This", " left", " me", " with", ":", " #", " f", "disk", " -", "l", " /", "dev", "/", "s", "da", " Disk", " /", "dev", "/", "s", "da", ":", " 640", ".", "1", " GB", ",", " 64", "01", "350", "287", "36", " bytes", " 255", " heads", ",", " 63", " sectors", "/", "track", ",", " 7", "78", "25", " cylinders", " Units", " =", " cylinders", " of", " 160", "65", " *", " 512", " =", " 82", "25", "280", " bytes", " Disk", " identifier", ":", " 0", "x", "83", "e", "6", "d", "949", " Device", " Boot", " Start", " End", " Blocks", " Id", " System", " /", "dev", "/", "s", "da", "1", " 1", " 34", " 27", "30", "73", "+", " 83", " Linux", " /", "dev", "/", "s", "da", "2", " 35", " 7", "78", "25", " 6", "248", "56", "207", "+", " 83", " Linux", " With", " that", " done", ",", " format", " the", " boot", " partition", ":", " #", " m", "ke", "2", "fs", " /", "dev", "/", "s", "da", "1", " m", "ke", "2", "fs", " 1", ".", "41", ".", "3", " (", "12", "-", "Oct", "-", "2008", ")", " Files", "ystem", " label", "=", " OS", " type", ":", " Linux", " Block", " size", "=", "1024", " (", "log", "=", "0", ")", " Frag", "ment", " size", "=", "1024", " (", "log", "=", "0", ")", " 68", "272", " in", "odes", ",", " 27", "30", "72", " blocks", " 13", "653", " blocks", " (", "5", ".", "00", "%)", " reserved", " for", " the", " super", " user", " First", " data", " block", "=", "1", " Maximum", " filesystem", " blocks", "=", "676", "33", "152", " 34", " block", " groups", " 8", "192", " blocks", " per", " group", ",", " 8", "192", " fragments", " per", " group", " 2008", " in", "odes", " per", " group", " Super", "block", " backups", " stored", " on", " blocks", ":", " 8", "193", ",", " 245", "77", ",", " 4096", "1", ",", " 5", "73", "45", ",", " 737", "29", ",", " 2048", "01", ",", " 22", "11", "85", " Writing", " in", "ode", " tables", ":", " done", " Writing", " super", "blocks", " and", " filesystem", " accounting", " information", ":", " done", " This", " filesystem", " will", " be", " automatically", " checked", " every", " 20", " mounts", " or", " 180", " days", ",", " whichever", " comes", " first", ".", " Use", " tune", "2", "fs", " -", "c", " or", " -", "i", " to", " override", ".", " And", " the", " encrypted", " partition", ":", " #", " crypt", "setup", " --", "ver", "ify", "-", "pass", "phrase", " l", "u", "ks", "Format", " /", "dev", "/", "s", "da", "2", " WARNING", "!", " =====", "===", " This", " will", " overwrite", " data", " on", " /", "dev", "/", "s", "da", "2", " irre", "voc", "ably", ".", " Are", " you", " sure", "?", " (", "Type", " u", "pperc", "ase", " yes", "):", " YES", " Enter", " L", "UK", "S", " pass", "phrase", ":", " Verify", " pass", "phrase", ":", " Command", " successful", ".", "\n", "\n", "At", " this", " point", " we", " need", " to", " set", " up", " the", " encrypted", " partition", " layer", ".", " #", " crypt", "setup", " l", "u", "ks", "Open", " /", "dev", "/", "s", "da", "2", " root", " In", " order", " to", " get", " multiple", " \"", "part", "itions", "\"", " inside", " the", " single", " encrypted", " layer", ",", " we", " set", " up", " L", "VM", ".", " I", " keep", " /", "tmp", " (", "nos", "uid", " and", " no", " execute", "),", " as", " well", " as", " /", "var", " (", "in", " case", " logs", " fill", " it", " up", ")", " and", " /", "home", ",", " separate", " from", " /", ",", " so", " I", " did", ":", " #", " p", "v", "create", " /", "dev", "/", "m", "apper", "/", "root", " Physical", " volume", " \"/", "dev", "/", "m", "apper", "/", "root", "\"", " successfully", " created", " #", " v", "g", "create", " v", "g", " /", "dev", "/", "m", "apper", "/", "root", " Volume", " group", " \"", "vg", "\"", " successfully", " created", " #", " l", "v", "create", " --", "size", " 1", "G", " --", "name", " swap", " v", "g", " Log", "ical", " volume", " \"", "sw", "ap", "\"", " created", " #", " l", "v", "create", " --", "size", " 10", "G", " --", "name", " root", " v", "g", " Log", "ical", " volume", " \"", "root", "\"", " created", " #", " l", "v", "create", " --", "size", " 1", "G", " --", "name", " tmp", " v", "g", " Log", "ical", " volume", " \"", "tmp", "\"", " created", " #", " l", "v", "create", " --", "size", " 10", "G", " --", "name", " var", " v", "g", " Log", "ical", " volume", " \"", "var", "\"", " created", " #", " l", "v", "create", " --", "ext", "ents", " 100", "%", "FREE", " --", "name", " home", " v", "g", " R", "ounding", " up", " size", " to", " full", " physical", " extent", " 5", "73", ".", "90", " GB", " Log", "ical", " volume", " \"", "home", "\"", " created", " #", " v", "g", "change", " --", "available", " y", " 5", " logical", " volume", "(", "s", ")", " in", " volume", " group", " \"", "vg", "\"", " now", " active", " Use", " v", "gs", " or", " v", "g", "display", " to", " find", " out", " how", " much", " room", " you", " have", " left", " for", " the", " last", " logical", " volume", ".", " Format", " these", " partitions", " as", " you", " like", ",", " I", " did", ":", " #", " m", "ks", "w", "ap", " /", "dev", "/", "m", "apper", "/", "vg", "-", "sw", "ap", " Setting", " up", " swaps", "pace", " version", " 1", ",", " size", " =", " 10", "48", "572", " Ki", "B", " no", " label", ",", " U", "UID", "=", "b", "434", "68", "c", "8", "-", "8", "652", "-", "40", "35", "-", "9", "227", "-", "6", "ef", "56", "29", "75", "db", "d", " #", " mk", "fs", ".", "x", "fs", " /", "dev", "/", "m", "apper", "/", "vg", "-", "root", " meta", "-", "data", "=/", "dev", "/", "m", "apper", "/", "vg", "-", "root", " is", "ize", "=", "256", " ag", "count", "=", "4", ",", " ag", "size", "=", "655", "360", " bl", "ks", " =", " sects", "z", "=", "512", " att", "r", "=", "2", "...", " #", " mk", "fs", ".", "x", "fs", " /", "dev", "/", "m", "apper", "/", "vg", "-", "tmp", " meta", "-", "data", "=/", "dev", "/", "m", "apper", "/", "vg", "-", "tmp", " is", "ize", "=", "256", " ag", "count", "=", "4", ",", " ag", "size", "=", "655", "36", " bl", "ks", " =", " sects", "z", "=", "512", " att", "r", "=", "2", "...", " #", " mk", "fs", ".", "x", "fs", " /", "dev", "/", "m", "apper", "/", "vg", "-", "var", " meta", "-", "data", "=/", "dev", "/", "m", "apper", "/", "vg", "-", "var", " is", "ize", "=", "256", " ag", "count", "=", "4", ",", " ag", "size", "=", "655", "360", " bl", "ks", " =", " sects", "z", "=", "512", " att", "r", "=", "2", "...", " #", " mk", "fs", ".", "x", "fs", " /", "dev", "/", "m", "apper", "/", "vg", "-", "home", " meta", "-", "data", "=/", "dev", "/", "m", "apper", "/", "vg", "-", "home", " is", "ize", "=", "256", " ag", "count", "=", "4", ",", " ag", "size", "=", "37", "61", "12", "64", " bl", "ks", " =", " sects", "z", "=", "512", " att", "r", "=", "2", "...", "\n", "\n", "Continue", " with", " the", " Gent", "oo", " Handbook", ",", " until", " step", " seven", ".", " We", " need", " crypt", "setup", " installed", " and", " configured", " properly", " before", " we", " build", " our", " kernel", ",", " so", " first", " emerge", " crypt", "setup", ".", " Now", " follow", " step", " seven", " as", " normal", ",", " but", " be", " sure", " to", " use", " gen", "kernel", ".", " Do", " not", " use", " any", " splash", ",", " v", "ga", " or", " frame", "buffer", " related", " options", " (", "t", "rying", " to", " use", " these", " caused", " me", " lots", " of", " grief", ").", " #", " gen", "kernel", " --", "menu", "config", " --", "install", " --", "sy", "ml", "ink", " --", "lv", "m", " --", "lu", "ks", " all", " *", " Gent", "oo", " Linux", " Gen", "kernel", ";", " Version", " 3", ".", "4", ".", "10", ".", "9", "04", " *", " Running", " with", " options", ":", " --", "menu", "config", " --", "install", " --", "sy", "ml", "ink", " --", "lv", "m", " --", "lu", "ks", " all", " *", " Linux", " Kernel", " 2", ".", "6", ".", "28", "-", "hard", "ened", "-", "r", "9", " for", " x", "86", "...", " *", " kernel", ":", " >>", " Running", " m", "r", "pro", "per", "...", " *", " config", ":", " Using", " config", " from", " /", "etc", "/", "k", "ernels", "/", "kernel", "-", "config", "-", "x", "86", "-", "2", ".", "6", ".", "28", "-", "hard", "ened", "-", "r", "9", " *", " Previous", " config", " backed", " up", " to", ".", "config", ".", "b", "ak", " *", " >>", " Running", " old", "config", "...", " *", " kernel", ":", " >>", " Clean", "ing", "...", " *", " config", ":", " >>", " Inv", "oking", " menu", "config", "...", " ***", " End", " of", " Linux", " kernel", " configuration", ".", " ***", " Exec", "ute", " '", "make", "'", " to", " build", " the", " kernel", " or", " try", " '", "make", " help", "'.", " *", " >>", " Comp", "iling", " 2", ".", "6", ".", "28", "-", "hard", "ened", "-", "r", "9", " b", "z", "Image", "...", " *", " >>", " Comp", "iling", " 2", ".", "6", ".", "28", "-", "hard", "ened", "-", "r", "9", " modules", "...", " *", " Cop", "ying", " config", " for", " successful", " build", " to", " /", "etc", "/", "k", "ernels", "/", "kernel", "-", "config", "-", "x", "86", "-", "2", ".", "6", ".", "28", "-", "hard", "ened", "-", "r", "9", " *", " busy", "box", ":", " >>", " Using", " cache", " *", " init", "ram", "fs", ":", " >>", " Initial", "izing", "...", " *", " >>", " App", "ending", " base", "_", "layout", " cp", "io", " data", "...", " *", " >>", " App", "ending", " aux", "il", "ary", " cp", "io", " data", "...", " *", " >>", " App", "ending", " busy", "box", " cp", "io", " data", "...", " *", " >>", " App", "ending", " l", "vm", " cp", "io", " data", "...", " *", " L", "VM", ":", " Adding", " support", " (", "comp", "iling", " binaries", ")...", " *", " >>", " App", "ending", " l", "u", "ks", " cp", "io", " data", "...", " *", " Including", " L", "UK", "S", " support", " *", " >>", " App", "ending", " modules", " cp", "io", " data", "...", " *", " *", " Kernel", " compiled", " successfully", "!", "...", " Since", " you", " might", " be", " running", " gen", "kernel", " again", " in", " the", " future", ",", " for", " upgrades", ",", " it", " might", " be", " worth", " looking", " at", " /", "etc", "/", "gen", "kernel", ".", "conf", " to", " set", " the", " options", " passed", " on", " the", " command", "line", ",", " above", ".", " In", " the", " config", " step", " be", " sure", " to", " include", " these", " kernel", " options", " statically", " (", "not", " as", " a", " module", "):", " Device", " Drivers", " --", "->", " [*]", " Multiple", " devices", " driver", " support", " (", "RA", "ID", " and", " L", "VM", ")", " --", "->", " Device", " m", "apper", " support", " Crypt", " target", " support", " -", "*", "-", " Crypt", "ographic", " API", " --", "->", " ***", " Digest", " ***", " -", "*", "-", " SHA", "224", " and", " SHA", "256", " digest", " algorithm", " ***", " C", "ip", "hers", " ***", " AES", " cipher", " algorithms", "\n", "\n", "The", " machine", " I", "'m", " setting", " up", " has", " some", " sort", " of", " problem", " with", " gr", "ub", ".", " I", "'m", " not", " sure", " what", ",", " but", " it", " detects", " free", " memory", " incorrectly", ",", " thinks", " there", "'s", " 0", "k", " available", ",", " and", " refuses", " to", " run", " anything", ",", " because", " 0", "k", " is", " not", " enough", " room", ".", " So", " at", " the", " boot", "loader", " step", ",", " this", " time", " I", "'m", " using", " L", "IL", "O", ".", " So", ":", " #", " echo", " \"", "sys", "-", "boot", "/", "l", "ilo", " device", "-", "m", "apper", "\"", " >>", " /", "etc", "/", "port", "age", "/", "package", ".", "use", " #", " emerge", " l", "ilo", " Then", ",", " I", " need", " to", " properly", " fill", " out", " /", "etc", "/", "l", "ilo", ".", "conf", ",", " based", " on", " Handbook", " step", " 10", "c", ".", " Note", " the", " crypt", "_", "root", ",", " which", " is", " the", " real", " device", ",", " encrypted", " with", " L", "UK", "S", ",", " and", " the", " real", "_", "root", " which", " is", " the", " virtual", " (", "L", "VM", ")", " device", ",", " under", " the", " L", "UK", "S", " encryption", " layer", ",", " that", " we", " tell", " the", " kernel", " is", " the", " real", " root", ",", " after", " L", "UK", "S", " and", " L", "VM", " has", " been", " set", " up", " properly", ".", " append", "=\"", "init", "=/", "linux", "rc", " d", "ol", "vm", " crypt", "_", "root", "=/", "dev", "/", "s", "da", "2", " real", "_", "root", "=/", "dev", "/", "m", "apper", "/", "vg", "-", "root", "\"", " boot", "=/", "dev", "/", "s", "da", " compact", " default", "=", "gent", "oo", " l", "ba", "32", " prompt", " read", "-", "only", " root", "=/", "dev", "/", "ram", "0", " timeout", "=", "50", " image", "=/", "boot", "/", "kernel", " init", "rd", "=/", "boot", "/", "init", "ram", "fs", " label", "=", "gent", "oo", " image", "=/", "boot", "/", "kernel", ".", "old", " init", "rd", "=/", "boot", "/", "init", "ram", "fs", ".", "old", " label", "=", "back", "up", " optional", " Finally", ",", " install", " L", "IL", "O", " as", " the", " boot", " loader", " with", ":", " #", " /", "s", "bin", "/", "l", "ilo", " Added", " gent", "oo", " *", " Added", " backup"]