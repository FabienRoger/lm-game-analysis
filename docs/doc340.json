["How", " to", " write", " an", " NS", "Q", " consumer", " in", " Go", "\n", "\n", "E", "rik", " Ben", "o", "ist", " Bl", "ocked", " Un", "block", " Follow", " Following", " Dec", " 12", ",", " 2016", "\n", "\n", "Recently", " Re", "verb", " began", " using", " NS", "Q", " as", " a", " distributed", " message", " queue", ".", " After", " establishing", " producers", " in", " our", " Rails", " app", ",", " we", " wrote", " a", " simple", " Go", " consumer", " for", " some", " of", " our", " services", " to", " use", " the", " new", " queue", ".", "\n", "\n", "What", " the", " NS", "Q", "?", "\n", "\n", "Before", " detailing", " our", " consumer", ",", " let", "\ufffd", "\ufffd", "s", " talk", " a", " bit", " about", " queues", ".", " While", " there", " are", " a", " number", " of", " open", " source", " options", ",", " we", " chose", " NS", "Q", " for", " its", " ease", " of", " deployment", ",", " its", " simple", " local", " broker", " strategy", ",", " its", " res", "ili", "ency", ",", " and", " speed", ".", "\n", "\n", "NS", "Q", "\ufffd", "\ufffd", "s", " architecture", " is", " made", " up", " of", " n", "sq", "d", " instances", " and", " n", "sq", "look", "up", "d", " instances", " for", " topic", " discovery", ".", " With", " no", " single", " point", " of", " failure", " consumers", " need", " to", " query", " the", " n", "sq", "look", "up", "d", " instances", " to", " discover", " topics", " and", " their", " producers", ".", " At", " Re", "verb", " we", " have", " n", "sq", "d", " instances", " deployed", " to", " every", " box", " where", " we", " produce", " messages", ".", " This", " makes", " our", " system", " resilient", " to", " failure", " while", " allowing", " us", " to", " scale", " simply", ".", "\n", "\n", "ns", "q", "\ufffd", "\ufffd", "s", " messaging", " architecture", " also", " allows", " each", " queue", " to", " have", " either", " topic", " or", " queue", " like", " semantics", ".", " This", " allows", " us", " to", " choose", " whether", " we", " round", " rob", "in", " messages", " to", " a", " number", " of", " consumers", " on", " a", " shared", " channel", " or", " replicate", " messages", " to", " a", " number", " of", " different", " consumers", ".", "\n", "\n", "ns", "q", " provides", " both", " a", " TCP", " and", " a", " simple", " HTTP", " interface", ",", " while", " we", " will", " be", " using", " the", " TCP", " protocol", " in", " our", " consumer", ",", " the", " HTTP", " interface", " provides", " a", " simple", " way", " to", " interact", " with", " n", "sq", ".", "\n", "\n", "Writing", " a", " consumer", " in", " Go", " is", " simple", " with", " the", " official", " n", "sq", " go", " package", ".", " While", " light", " on", " documentation", " the", " official", " client", " has", " a", " number", " of", " examples", " that", " ship", " along", " with", " n", "sq", ".", "\n", "\n", "Our", " Consumer", "\n", "\n", "One", " of", " the", " benefits", " of", " using", " NS", "Q", "\ufffd", "\ufffd", "s", " official", " package", " is", " that", " replaced", " a", " large", " amount", " of", " worker", " boiler", "plate", " code", " that", " we", " were", " using", " with", " a", " previous", " messaging", " architecture", ".", " Go", " is", " great", " at", " this", " worker", " pattern", ",", " but", " the", " package", " provides", " everything", " you", "\ufffd", "\ufffd", "d", " normally", " need", ".", "\n", "\n", "We", " want", " a", " single", " consumer", " to", " concurrently", " consume", " a", " number", " of", " messages", " from", " a", " shared", " topic", ".", " We", " will", " create", " a", " channel", " specific", " to", " our", " application", " called", " \ufffd", "\ufffd", "met", "rics", "\ufffd", "\ufffd", " and", " log", " any", " messages", " to", " STD", "OUT", ".", " We", "\ufffd", "\ufffd", "ll", " also", " ensure", " that", " we", " shutdown", " properly", " without", " any", " messages", " still", " in", " flight", ".", "\n", "\n", "Have", " any", " questions", "?", " Feel", " free", " to", " leave", " us", " a", " comment", ".", " Like", " writing", " Go", " and", " have", " a", " passion", " for", " music", " gear", "?", " We", "\ufffd", "\ufffd", "re", " hiring", ".", "\n", "\n", "E", "rik", " Ben", "o", "ist", "\n", "\n", "Joe", " Lever", "ing"]