["Jon", " is", " a", " Member", " of", " Technical", " Staff", " at", " Bell", " Labs", ".", " He", " can", " be", " reached", " at", " [", "email", " protected", "]", ".", "bell", "-", "l", "abs", ".", "com", ".", "\n", "\n", "S", "uff", "ix", " trees", " are", " simple", ",", " yet", " powerful", ",", " data", " structures", ":", " Fill", " an", " array", " with", " pointers", " to", " every", " position", " in", " a", " string", ",", " sort", " the", " array", ",", " then", " quickly", " search", " the", " string", " for", " long", " phrases", ".", " A", " few", " lines", " of", " code", " suffice", " to", " implement", " this", " structure", ",", " which", " can", " be", " near", " optimal", " in", " time", " and", " space", ".", " In", " this", " column", ",", " I", "'ll", " introduce", " the", " structure", " with", " a", " simple", " problem", ",", " then", " apply", " it", " to", " a", " more", " subtle", " task", ".", "\n", "\n", "Given", " an", " input", " file", " of", " text", ",", " how", " can", " a", " program", " find", " the", " longest", " dupl", "icated", " subst", "ring", " of", " characters", "?", " For", " instance", ",", " the", " longest", " repeated", " string", " in", " \"", "Ask", " not", " what", " your", " country", " can", " do", " for", " you", ",", " but", " what", " you", " can", " do", " for", " your", " country", "\"", " is", " \"", " can", " do", " for", " you", ",\"", " with", " \"", "your", " country", "\"", " a", " close", " second", ".", " How", " would", " you", " write", " a", " program", " to", " solve", " this", " problem", "?", "\n", "\n", "If", " the", " input", " string", " is", " stored", " in", " c", "[", "0", "..", "n", "-", "1", "],", " a", " simple", " program", " could", " compare", " every", " pair", " of", " sub", "strings", " with", " the", " following", " pseud", "oc", "ode", ":", "\n", "\n", "max", "len", " =", " -", "1", " for", " (", "i", " =", " 0", ";", " i", " <", " n", ";", " i", "++)", " for", " (", "j", " =", " 0", ";", " j", " <", " n", ";", " j", "++)", " this", "len", " =", " com", "len", "(&", "c", "[", "i", "],", " &", "c", "[", "j", "])", " if", " this", "len", " >", " max", "len", " max", "len", " =", " this", "len", " max", "i", " =", " i", " max", "j", " =", " j", "\n", "\n", "The", " com", "len", " function", " returns", " the", " length", " that", " its", " two", " parameter", " strings", " have", " in", " common", ",", " starting", " with", " their", " first", " characters", ":", "\n", "\n", "int", " com", "len", "(", "char", " *", "p", ",", " char", " *", "q", ")", " i", " =", " 0", " while", " *", "p", " &&", " (*", "p", "++", " ==", " *", "q", "++)", " i", "++", " return", " i", "\n", "\n", "Because", " the", " algorithm", " looks", " at", " all", " pairs", " of", " sub", "strings", ",", " it", " takes", " time", " proportional", " to", " n", "2", ",", " at", " least", ".", "\n", "\n", "S", "uff", "ix", " arrays", " give", " a", " faster", " algorithm", ".", " The", " program", " processes", " at", " most", " MAX", "N", " characters", ",", " which", " it", " stores", " in", " the", " array", " c", ":", "\n", "\n", "#", "define", " MAX", "N", " 5", "000000", " char", " c", "[", "MAX", "N", "],", " *", "a", "[", "MAX", "N", "];", "\n", "\n", "The", " suffix", " array", " is", " the", " array", " a", " of", " pointers", " to", " characters", ".", " As", " the", " program", " reads", " the", " input", ",", " it", " initial", "izes", " a", " so", " that", " each", " element", " points", " to", " the", " corresponding", " character", " in", " the", " input", " string", ":", "\n", "\n", "while", " (", "ch", " =", " get", "char", "())", "!=", " E", "OF", " a", "[", "n", "]", " =", " &", "c", "[", "n", "]", " c", "[", "n", "++", "]", " =", " ch", " c", "[", "n", "]", " =", " 0", "\n", "\n", "The", " final", " element", " of", " c", " contains", " a", " null", " character", ",", " which", " termin", "ates", " all", " strings", ".", "\n", "\n", "The", " element", " a", "[", "0", "]", " points", " to", " the", " entire", " string", ";", " the", " next", " element", " points", " to", " the", " suffix", " of", " the", " array", " beginning", " with", " the", " second", " character", ",", " and", " so", " on", ".", " On", " the", " input", " string", " \"", "ban", "ana", ",\"", " the", " array", " will", " represent", " these", " suffix", "es", ":", "\n", "\n", "a", "[", "0", "]:", " banana", " a", "[", "1", "]:", " an", "ana", " a", "[", "2", "]:", " n", "ana", " a", "[", "3", "]:", " ana", " a", "[", "4", "]:", " na", " a", "[", "5", "]:", " a", "\n", "\n", "The", " pointers", " in", " the", " array", " a", " together", " point", " to", " every", " suffix", " in", " the", " string", ",", " hence", " the", " name", " \"", "suff", "ix", " array", ".\"", "\n", "\n", "If", " a", " long", " string", " occurs", " twice", " in", " the", " array", " c", ",", " it", " appears", " in", " two", " different", " suffix", "es", ".", " The", " program", " therefore", " sorts", " the", " array", " to", " bring", " together", " equal", " suffix", "es", ".", " The", " \"", "ban", "ana", "\"", " array", " sorts", " to", " the", " following", ":", "\n", "\n", "a", "[", "0", "]:", " a", " a", "[", "1", "]:", " ana", " a", "[", "2", "]:", " an", "ana", " a", "[", "3", "]:", " banana", " a", "[", "4", "]:", " na", " a", "[", "5", "]:", " n", "ana", "\n", "\n", "The", " code", " then", " scans", " through", " this", " array", " comparing", " adjacent", " elements", " to", " find", " the", " longest", " repeated", " string", ",", " which", ",", " in", " this", " case", ",", " is", " \"", "ana", ".\"", " The", " suffix", " array", " structure", " is", " that", " simple", ":", " Fill", " an", " array", " with", " pointers", ",", " and", " sort", " them", ".", " It", " has", " been", " used", " at", " least", " since", " the", " 1970", "s", ",", " though", " the", " term", " was", " introduced", " in", " the", " 1990", "s", ".", "\n", "\n", "The", " program", " will", " sort", " the", " suffix", " array", " with", " the", " q", "sort", " function", ":", "\n", "\n", "q", "sort", "(", "a", ",", " n", ",", " sizeof", "(", "char", " *", "),", " p", "str", "cmp", ")", "\n", "\n", "The", " p", "str", "cmp", " comparison", " function", " adds", " one", " level", " of", " ind", "irection", " to", " the", " library", " str", "cmp", " function", ".", " This", " scan", " through", " the", " array", " uses", " the", " com", "len", " function", " to", " count", " the", " number", " of", " letters", " that", " two", " adjacent", " words", " have", " in", " common", ":", "\n", "\n", "for", " (", "i", " =", " 0", ";", " i", " <", " n", ";", " i", "++)", " if", " com", "len", "(", "a", "[", "i", "],", " a", "[", "i", "+", "1", "])", " >", " max", "len", " max", "len", " =", " com", "len", "(", "a", "[", "i", "],", " a", "[", "i", "+", "1", "])", " max", "i", " =", " i", " printf", "(\"", "%.", "*", "s", "\\", "en", "\",", " max", "len", ",", " a", "[", "max", "i", "])", "\n", "\n", "The", " printf", " statement", " uses", " the", " \"", "*", "\"", " precision", " to", " print", " max", "len", " characters", " of", " the", " string", ".", "\n", "\n", "S", "uff", "ix", " arrays", " represent", " every", " subst", "ring", " in", " n", " characters", " of", " input", " text", " using", " the", " text", " itself", " and", " n", " additional", " pointers", ".", " On", " typical", " text", " files", " of", " n", " characters", ",", " the", " algorithm", " runs", " in", " O", "(", "nl", "ogn", ")", " time", ",", " due", " to", " sorting", ".", " The", " complete", " program", " in", " List", "ing", " One", " found", " the", " longest", " repeated", " string", " in", " the", " 4", ",", "460", ",", "05", "6", " characters", " of", " the", " King", " James", " Bible", " in", " about", " 36", " seconds", " on", " a", " 600", "-", "MHz", " Cel", "er", "on", " processor", " (", "check", " out", " the", " seventh", " chapter", " of", " the", " \"", "Book", " of", " Numbers", "\").", "\n", "\n", "Mark", "ov", " Text", "\n", "\n", "How", " can", " you", " generate", " random", " text", "?", " A", " classic", " approach", " is", " to", " let", " loose", " that", " poor", " monkey", " on", " his", " aging", " typew", "riter", ".", " If", " the", " beast", " is", " equally", " likely", " to", " hit", " any", " lower", "case", " letter", " or", " the", " space", " bar", ",", " the", " output", " might", " look", " like", " this", ":", "\n", "\n", "c", "bc", "z", "q", "pb", "tv", "f", "by", "ak", " z", "fw", " ec", "rod", "tg", "dd", " b", "aut", "fx", "q", "k", "d", "aj", "x", "oc", "\n", "\n", "This", " is", " pretty", " uncon", "v", "inc", "ing", " English", " text", ".", "\n", "\n", "If", " you", " count", " the", " letters", " in", " word", " games", " (", "like", " Sc", "rab", "ble", " or", " B", "oggle", "),", " you", " notice", " that", " there", " are", " different", " numbers", " of", " the", " various", " letters", ".", " There", " are", " many", " more", " As", ",", " for", " instance", ",", " than", " there", " are", " Z", "s", ".", " A", " monkey", " could", " produce", " more", " convincing", " text", " by", " counting", " the", " letters", " in", " a", " document", " \ufffd", "\ufffd", " if", " A", " occurs", " 300", " times", " in", " the", " text", " while", " B", " occurs", " just", " 100", " times", ",", " then", " the", " monkey", " should", " be", " three", "-", "times", " more", " likely", " to", " type", " an", " A", " than", " a", " B", ".", " This", " moves", " a", " small", " step", " closer", " to", " English", ":", "\n", "\n", "sa", "oo", " n", "te", " on", " sch", " w", "ir", "T", ",", "hh", "ths", " few", "r", " lo", "ies", "e", "ium", " r", "ase", "\n", "\n", "Most", " events", " occur", " in", " context", ".", " Suppose", " that", " you", " wanted", " to", " generate", " randomly", " a", " year", "'s", " worth", " of", " Fahrenheit", " temperature", " data", ".", " A", " series", " of", " 365", " random", " integers", " between", " 0", " and", " 100", " wouldn", "'t", " fool", " the", " average", " observer", ".", " You", " could", " be", " more", " convincing", " by", " making", " today", "'s", " temperature", " a", " (", "random", ")", " function", " of", " yesterday", "'s", " temperature", ":", " If", " it", " is", " 85", " degrees", " today", ",", " it", " is", " unlikely", " to", " be", " 15", " degrees", " tomorrow", ".", "\n", "\n", "The", " same", " is", " true", " of", " English", " words", ":", " If", " this", " letter", " is", " a", " Q", ",", " then", " the", " next", " letter", " is", " quite", " likely", " to", " be", " a", " U", ".", " A", " generator", " can", " make", " more", " interesting", " text", " by", " making", " each", " letter", " a", " random", " function", " of", " its", " predecessor", ".", " You", " could", ",", " therefore", ",", " read", " a", " sample", " text", " and", " count", " how", " many", " times", " every", " letter", " follows", " an", " A", ",", " how", " many", " times", " they", " follow", " a", " B", ",", " and", " so", " on", " for", " each", " letter", " of", " the", " alphabet", ".", " When", " the", " generator", " writes", " the", " random", " text", ",", " it", " produces", " the", " next", " letter", " as", " a", " random", " function", " of", " the", " current", " letter", ".", " The", " Order", "-", "1", " text", " was", " made", " by", " exactly", " this", " scheme", ":", "\n", "\n", "Order", "-", "1", ".", " H", "ixt", " of", "tor", "awa", " op", "ik", "ie", " the", " w", "anos", "?", " so", "f", " I", " th", "inc", "ks", " my", " be", "eh", "im", "of", "ove", ",", " f", " f", "on", "em", "ar", "\n", "\n", "Order", "-", "2", ".", " l", "igs", " art", " my", "r", "rh", " lover", " com", "ous", "ali", "pper", " good", "ge", " sh", "ing", " sp", "ould", " be", "ly", ",", " he", " not", " h", "art", " socks", " gal", "hat", " is", " the", "\n", "\n", "Order", "-", "3", ".", " Many", " of", " scar", "ly", " of", " Israel", ".", " What", " spices", ".", " Thy", " love", ";", " and", ",", " and", " the", " like", " the", " us", " sword", " my", " bel", "ove", ";", " forth", ",", " and", " my", " sp", "ous", "al", "em", ",", " bund", " gold", " lil", "ie", " art", " fl", "ook", " not", ".", "\n", "\n", "Order", "-", "4", ".", " We", " hath", " banners", ".", " The", " fox", "es", ",", " as", " the", " lions", "?", " My", " bel", "ove", ",", " new", " and", " frank", "ince", "'s", " daughters", " of", " sm", "ote", " merchant", "?", " I", " would", " none", " through", "t", " handles", " of", " being", " house", ";", "\n", "\n", "This", " idea", " extends", " to", " longer", " sequences", " of", " letters", ".", " The", " Order", "-", "2", " text", " was", " made", " by", " generating", " each", " letter", " as", " a", " function", " of", " the", " two", " letters", " preceding", " it", " (", "a", " letter", " pair", " is", " often", " called", " a", " \"", "dig", "ram", "\").", " The", " dig", "ram", " TH", ",", " for", " instance", ",", " is", " often", " followed", " in", " English", " by", " the", " vow", "els", " A", ",", " E", ",", " I", ",", " O", ",", " U", " and", " Y", ",", " less", " frequently", " by", " R", " and", " W", ",", " and", " rarely", " by", " other", " letters", ".", " The", " Order", "-", "3", " text", " is", " built", " by", " choosing", " the", " next", " letter", " as", " a", " function", " of", " the", " three", " previous", " letters", " (", "a", " trig", "ram", ").", " In", " Order", "-", "4", " text", ",", " most", " words", " are", " English", ",", " and", " you", " might", " not", " be", " surprised", " to", " learn", " that", " it", " was", " generated", " from", " the", " King", " James", " Version", " of", " the", " \"", "Song", " of", " Solomon", ".\"", " (", "See", " the", " \"", "Further", " Reading", "\"", " section", " at", " the", " end", " of", " this", " column", " for", " more", " examples", " of", " randomly", " generated", " text", ".)", "\n", "\n", "Read", "ers", " with", " a", " mathematical", " background", " might", " recognize", " this", " process", " as", " a", " Mark", "ov", " chain", ".", " One", " state", " represents", " each", " k", "-", "gram", ",", " and", " the", " odds", " of", " going", " from", " one", " to", " another", " don", "'t", " change", ",", " so", " this", " is", " a", " \"", "f", "inite", "-", "state", " Mark", "ov", " chain", " with", " stationary", " transition", " probabilities", ".\"", "\n", "\n", "You", " can", " also", " generate", " random", " text", " at", " the", " word", " level", ".", " The", " dumb", "est", " approach", " is", " to", " spew", " forth", " the", " words", " in", " a", " dictionary", " at", " random", ".", " A", " slightly", " better", " approach", " reads", " a", " document", ",", " counts", " each", " word", ",", " and", " then", " selects", " the", " next", " word", " to", " be", " printed", " with", " the", " appropriate", " probability", ".", " More", " interesting", " text", ",", " though", ",", " is", " produced", " by", " using", " Mark", "ov", " chains", " that", " take", " into", " account", " a", " few", " preceding", " words", " as", " they", " generate", " the", " next", " word", ".", " Here", " is", " some", " random", " text", " produced", " from", " my", " book", " Programming", " Pear", "ls", ":", "\n", "\n", "Order", "-", "1", ".", " the", " STL", " also", " adds", " the", " same", " sequence", " of", " the", " large", " they", " didn", "'t", ",", " they", " are", " those", " structures", ",", " design", " can", " sometimes", " decrease", " storage", " allocation", " is", " trivial", " program", " in", " increasing", " y", "-", " order", ",", "\n", "\n", "order", ",", " Order", "-", "2", ".", " The", " 40", "-", "pass", " algorithm", " in", " Solution", " 4", ")", " to", " run", " out", " of", " order", " with", " its", " push", "-", "button", " encoding", ",", " sort", " by", " column", " then", " row", ",", " and", " then", " bring", " together", " all", " words", " with", " the", " sizeof", " structures", ".", " We", " therefore", " used", " a", " total", " of", " 96", " meg", "abytes", ".", "\n", "\n", "struct", "ures", ".", " We", " therefore", " used", " a", " total", " of", " 96", " meg", "abytes", ".", " Order", "-", "3", ".", " I", " despise", " having", " to", " use", " a", " binary", " search", ".", " These", " techniques", " apply", " to", " any", " piece", "wise", "-", "linear", " functions", ".", " 3", ".", " This", " C", " code", " implements", " the", " sorting", " algorithm", ",", " using", " the", " functions", " defined", " in", " Solution", " 2", ".", "\n", "\n", "The", " Order", "-", "1", " text", " is", " almost", " readable", " aloud", ",", " while", " the", " Order", "-", "3", " text", " consists", " of", " very", " long", " phrases", " from", " the", " original", " input", ",", " with", " random", " transitions", " between", " them", ".", " For", " purposes", " of", " parody", ",", " Order", "-", "2", " text", " is", " usually", " ju", "ic", "iest", ".", " (", "See", " the", " \"", "Further", " Reading", "\"", " section", " for", " many", " more", " examples", " of", " word", "-", "level", " Mark", "ov", " text", ".)", "\n", "\n", "Autom", "ating", " Par", "ody", "\n", "\n", "I", " first", " saw", " letter", "-", "level", " and", " word", "-", "level", " order", "-", "k", " approx", "im", "ations", " to", " English", " text", " in", " Shannon", "'s", " 1948", " classic", " Mathemat", "ical", " Theory", " of", " Communication", ".", " Shannon", " describes", " how", " he", " generated", " such", " text", ":", "\n", "\n", "To", " construct", " [", "order", "-", "1", " letter", "-", "level", " text", "]", " for", " example", ",", " one", " opens", " a", " book", " at", " random", " and", " selects", " a", " letter", " at", " random", " on", " the", " page", ".", " This", " letter", " is", " recorded", ".", " The", " book", " is", " then", " opened", " to", " another", " page", " and", " one", " reads", " until", " this", " letter", " is", " encountered", ".", " The", " succeeding", " letter", " is", " then", " recorded", ".", " Turning", " to", " another", " page", " this", " second", " letter", " is", " searched", " for", " and", " the", " succeeding", " letter", " recorded", ",", " etc", ".", " A", " similar", " process", " was", " used", " for", " [", "order", "-", "1", " and", " order", "-", "2", " letter", "-", "level", " text", ",", " and", " order", "-", "0", " and", " order", "-", "1", " word", "-", "level", " text", "].", " It", " would", " be", " interesting", " if", " further", " approx", "im", "ations", " could", " be", " constructed", ",", " but", " the", " labor", " involved", " becomes", " enormous", " at", " the", " next", " stage", ".\"", "\n", "\n", "Program", "s", " have", " been", " autom", "ating", " this", " labor", "ious", " task", " since", " the", " early", " 1950", "s", ".", " Shannon", "'s", " method", " scans", " the", " input", " text", " for", " the", " current", " k", "-", "gram", " to", " generate", " the", " next", " word", ";", " this", " approximation", " works", " well", " when", " k", " is", " small", ",", " but", " gives", " biased", " output", " when", " there", " are", " uneven", " gaps", " between", " k", "-", "gram", "s", ".", " Fast", " machines", " can", " instead", " scan", " the", " complete", " input", " text", " to", " choose", " a", " truly", " random", " successor", ".", " A", " program", " at", " http", "://", "www", ".", "program", "ming", "pe", "arl", "s", ".", "com", "/", " implements", " this", " approach", ",", " but", " it", " generates", " only", " a", " few", " outputs", " per", " second", " when", " processing", " the", " 4", "-", "million", " characters", " in", " the", " King", " James", " Bible", ".", "\n", "\n", "A", " suffix", " array", " lets", " a", " program", " search", " for", " the", " next", " phrase", " more", " efficiently", ".", " The", " Order", "-", "k", " C", " program", " will", " store", " at", " most", " 5", " MB", " of", " text", " in", " the", " array", " input", "ch", "ars", ":", "\n", "\n", "int", " k", " =", " 2", ";", " char", " input", "ch", "ars", "[", "5", "000000", "];", " char", " *", "word", "[", "1", "000000", "];", " int", " n", "word", " =", " 0", ";", "\n", "\n", "It", " will", " employ", " the", " array", " word", " as", " a", " suffix", " array", " pointing", " to", " the", " characters", " that", " start", " on", " word", " boundaries", " (", "a", " common", " modification", ").", " The", " variable", " n", "word", " holds", " the", " number", " of", " words", ".", " It", " reads", " the", " file", " with", " the", " following", " code", ":", "\n", "\n", "word", "[", "0", "]", " =", " input", "ch", "ars", " while", " scan", "f", "(\"", "%", "s", "\",", " word", "[", "n", "word", "])", "!=", " E", "OF", " word", "[", "n", "word", "+", "1", "]", " =", " word", "[", "n", "word", "]", " +", " str", "len", "(", "word", "[", "n", "word", "])", " +", " 1", " n", "word", "++", "\n", "\n", "Each", " word", " is", " app", "ended", " to", " input", "ch", "ars", " (", "no", " other", " storage", " allocation", " is", " needed", "),", " and", " is", " terminated", " by", " the", " null", " character", " supplied", " by", " scan", "f", ".", "\n", "\n", "After", " reading", " the", " input", ",", " the", " program", " sorts", " the", " word", " array", " to", " bring", " together", " all", " pointers", " that", " point", " to", " the", " same", " sequence", " of", " k", " words", ".", " The", " following", " function", " does", " the", " comparisons", ":", "\n", "\n", "int", " word", "nc", "mp", "(", "char", " *", "p", ",", " char", "*", " q", ")", " n", " =", " k", " for", " (", " ;", " *", "p", " ==", " *", "q", ";", " p", "++", ",", " q", "++)", " if", " (*", "p", " ==", " 0", " &&", " --", "n", " ==", " 0", ")", " return", " 0", " return", " *", "p", " -", " *", "q", "\n", "\n", "It", " scans", " through", " the", " two", " strings", " while", " the", " characters", " are", " equal", ".", " At", " every", " null", " character", ",", " it", " decre", "ments", " the", " counter", " n", " and", " returns", " equal", " after", " seeing", " k", " identical", " words", ".", " When", " it", " finds", " unequal", " characters", ",", " it", " returns", " the", " difference", ".", "\n", "\n", "After", " reading", " the", " input", ",", " the", " program", " app", "ends", " k", " null", " characters", " (", "so", " the", " comparison", " function", " doesn", "'t", " run", " off", " the", " end", "),", " prints", " the", " first", " k", " words", " in", " the", " document", " (", "to", " start", " the", " random", " output", "),", " and", " calls", " the", " sort", ":", "\n", "\n", "for", " (", "i", " =", " 0", ";", " i", " <", " k", ";", " i", "++)", " word", "[", "n", "word", "][", "i", "]", " =", " 0", " for", " (", "i", " =", " 0", ";", " i", " <", " k", ";", " i", "++)", " print", " word", "[", "i", "]", " q", "sort", "(", "word", ",", " n", "word", ",", " sizeof", "(", "word", "[", "0", "]),", " sort", "cmp", ")", "\n", "\n", "The", " sort", "cmp", " function", ",", " as", " usual", ",", " adds", " a", " level", " of", " ind", "irection", " to", " its", " pointers", ".", "\n", "\n", "The", " space", "-", "efficient", " structure", " now", " contains", " a", " great", " deal", " of", " information", " about", " the", " k", "-", "gram", "s", " in", " the", " text", ".", " If", " k", " is", " 1", " and", " the", " input", " text", " is", " \"", "of", " the", " people", ",", " by", " the", " people", ",", " for", " the", " people", ",\"", " the", " word", " array", " might", " look", " like", " this", ":", "\n", "\n", "word", "[", "0", "]:", " by", " the", " word", "[", "1", "]:", " for", " the", " word", "[", "2", "]:", " of", " the", " word", "[", "3", "]:", " people", " word", "[", "4", "]:", " people", ",", " for", " word", "[", "5", "]:", " people", ",", " by", " word", "[", "6", "]:", " the", " people", ",", " word", "[", "7", "]:", " the", " people", " word", "[", "8", "]:", " the", " people", ",", "\n", "\n", "For", " clarity", ",", " this", " picture", " shows", " only", " the", " first", " k", "+", "1", " words", " pointed", " to", " by", " each", " element", " of", " word", ",", " even", " though", " more", " words", " usually", " follow", ".", " To", " find", " a", " word", " to", " follow", " the", " phrase", " \"", "the", ",\"", " a", " program", " looks", " it", " up", " in", " the", " suffix", " array", " to", " discover", " three", " choices", ":", " \"", "people", ",\"", " twice", " and", " \"", "people", "\"", " once", ".", "\n", "\n", "The", " program", " may", " now", " generate", " nonsense", " text", " with", " the", " pseud", "oc", "ode", " in", " Example", " 1", ".", " The", " loop", " is", " initialized", " by", " setting", " phrase", " to", " the", " first", " characters", " in", " the", " input", " (", "rec", "all", " that", " those", " words", " were", " already", " printed", " on", " the", " output", " file", ").", " The", " binary", " search", " loc", "ates", " the", " first", " occurrence", " of", " phrase", " (", "it", " is", " crucial", " to", " find", " the", " very", " first", " occurrence", ").", " The", " next", " loop", " scans", " through", " all", " equal", " phrases", ",", " selects", " one", " of", " them", " at", " random", ".", " If", " the", " k", "-", "th", " word", " of", " that", " phrase", " is", " of", " length", " zero", ",", " the", " current", " phrase", " is", " the", " last", " in", " the", " document", ",", " and", " an", " early", " exit", " is", " taken", " from", " the", " loop", ".", "\n", "\n", "The", " complete", " pseud", "oc", "ode", " (", "see", " Example", " 2", ")", " implements", " those", " ideas", ",", " and", " also", " puts", " an", " upper", " bound", " on", " the", " number", " of", " words", " it", " generates", ".", " List", "ing", " Two", " is", " the", " complete", " C", " program", ".", " (", "See", " \"", "Further", " Reading", "\"", " for", " a", " description", " of", " a", " more", " typical", " program", " for", " generating", " Mark", "ov", " text", " that", " doesn", "'t", " use", " suffix", " arrays", ".", " The", " suffix", " array", " approach", " is", " about", " half", " the", " length", " in", " code", ",", " has", " similar", " run", " time", ",", " and", " uses", " an", " order", " of", " magnitude", " less", " memory", ".)", "\n", "\n", "Prin", "ciples", "\n", "\n", "Need", " to", " search", " for", " phrases", " in", " a", " long", " string", "?", " Create", " an", " array", " of", " pointers", " to", " every", " relevant", " position", " in", " the", " string", " (", "every", " character", " or", " every", " word", "),", " and", " sort", " it", ".", " The", " resulting", " suffix", " array", " gathers", " together", " similar", " strings", ",", " and", " lets", " you", " look", " up", " a", " string", " using", " binary", " search", ".", " It", " requires", " only", " a", " few", " lines", " of", " code", " to", " build", ",", " n", " extra", " pointers", " of", " space", ",", " and", " a", " small", " and", " fast", " binary", " search", " to", " answer", " a", " query", ".", "\n", "\n", "Further", " Reading", "\n", "\n", "This", " column", " is", " based", " on", " Chapter", " 15", " of", " the", " second", " edition", " of", " Programming", " Pear", "ls", " (", "Add", "ison", "-", "W", "esley", ",", " 2000", ").", " The", " full", " column", " is", " available", " at", " http", "://", "www", ".", "program", "ming", "pe", "arl", "s", ".", "com", "/.", " It", " contains", " exercises", ",", " solutions", ",", " code", ",", " references", " to", " related", " work", ",", " and", " numerous", " examples", " of", " Mark", "ov", " text", ".", "\n", "\n", "DD", "J", "\n", "\n", "/*", " Copyright", " (", "C", ")", " 1999", " Lu", "cent", " Technologies", " */", " /*", " From", " '", "Program", "ming", " Pear", "ls", "'", " by", " Jon", " Bentley", " */", " /*", " long", "du", "p", ".", "c", " --", " Print", " longest", " string", " dupl", "icated", " M", " times", " */", " #", "include", " <", "std", "lib", ".", "h", ">", " #", "include", " <", "string", ".", "h", ">", " #", "include", " <", "std", "io", ".", "h", ">", " int", " p", "str", "cmp", "(", "char", " **", "p", ",", " char", " **", "q", ")", " {", " return", " str", "cmp", "(*", "p", ",", " *", "q", ");", " }", " int", " com", "len", "(", "char", " *", "p", ",", " char", " *", "q", ")", " {", " int", " i", " =", " 0", ";", " while", " (*", "p", " &&", " (*", "p", "++", " ==", " *", "q", "++", "))", " i", "++;", " return", " i", ";", " }", " #", "define", " M", " 1", " #", "define", " MAX", "N", " 5", "000000", " char", " c", "[", "MAX", "N", "],", " *", "a", "[", "MAX", "N", "];", " int", " main", "()", " {", " int", " i", ",", " ch", ",", " n", " =", " 0", ",", " max", "i", ",", " max", "len", " =", " -", "1", ";", " while", " ((", "ch", " =", " get", "char", "())", "!=", " E", "OF", ")", " {", " a", "[", "n", "]", " =", " &", "c", "[", "n", "];", " c", "[", "n", "++", "]", " =", " ch", ";", " }", " c", "[", "n", "]", " =", " 0", ";", " q", "sort", "(", "a", ",", " n", ",", " sizeof", "(", "char", " *", "),", " p", "str", "cmp", ");", " for", " (", "i", " =", " 0", ";", " i", " <", " n", "-", "M", ";", " i", "++)", " if", " (", "com", "len", "(", "a", "[", "i", "],", " a", "[", "i", "+", "M", "])", " >", " max", "len", ")", " {", " max", "len", " =", " com", "len", "(", "a", "[", "i", "],", " a", "[", "i", "+", "M", "]);", " max", "i", " =", " i", ";", " }", " printf", "(\"", "%.", "*", "s", "\n", "\n", "\",", " max", "len", ",", " a", "[", "max", "i", "]);", " return", " 0", ";", " }", "\n", "\n", "Back", " to", " Article", "\n", "\n", "/*", " Copyright", " (", "C", ")", " 1999", " Lu", "cent", " Technologies", " */", " /*", " From", " '", "Program", "ming", " Pear", "ls", "'", " by", " Jon", " Bentley", " */", " /*", " mark", "ov", ".", "c", " --", " generate", " random", " text", " from", " input", " document", " */", " #", "include", " <", "std", "io", ".", "h", ">", " #", "include", " <", "std", "lib", ".", "h", ">", " #", "include", " <", "string", ".", "h", ">", " char", " input", "ch", "ars", "[", "43", "00000", "];", " char", " *", "word", "[", "800", "000", "];", " int", " n", "word", " =", " 0", ";", " int", " k", " =", " 2", ";", " int", " word", "nc", "mp", "(", "char", " *", "p", ",", " char", "*", " q", ")", " {", " int", " n", " =", " k", ";", " for", " (", " ;", " *", "p", " ==", " *", "q", ";", " p", "++", ",", " q", "++)", " if", " (*", "p", " ==", " 0", " &&", " --", "n", " ==", " 0", ")", " return", " 0", ";", " return", " *", "p", " -", " *", "q", ";", " }", " int", " sort", "cmp", "(", "char", " **", "p", ",", " char", " **", "q", ")", " {", " return", " word", "nc", "mp", "(*", "p", ",", " *", "q", ");", " }", " char", " *", "skip", "(", "char", " *", "p", ",", " int", " n", ")", " {", " for", " (", " ;", " n", " >", " 0", ";", " p", "++)", " if", " (*", "p", " ==", " 0", ")", " n", "--", ";", " return", " p", ";", " }", " int", " main", "()", " {", " int", " i", ",", " words", "left", " =", " 10000", ",", " l", ",", " m", ",", " u", ";", " char", " *", "phrase", ",", " *", "p", ";", " word", "[", "0", "]", " =", " input", "ch", "ars", ";", " while", " (", "scan", "f", "(\"", "%", "s", "\",", " word", "[", "n", "word", "])", "!=", " E", "OF", ")", " {", " word", "[", "n", "word", "+", "1", "]", " =", " word", "[", "n", "word", "]", " +", " str", "len", "(", "word", "[", "n", "word", "])", " +", " 1", ";", " n", "word", "++;", " }", " for", " (", "i", " =", " 0", ";", " i", " <", " k", ";", " i", "++)", " word", "[", "n", "word", "][", "i", "]", " =", " 0", ";", " for", " (", "i", " =", " 0", ";", " i", " <", " k", ";", " i", "++)", " printf", "(\"", "%", "s", "\n", "\n", "\",", " word", "[", "i", "]);", " q", "sort", "(", "word", ",", " n", "word", ",", " sizeof", "(", "word", "[", "0", "]),", " sort", "cmp", ");", " phrase", " =", " input", "ch", "ars", ";", " for", " (", " ;", " words", "left", " >", " 0", ";", " words", "left", "--", ")", " {", " l", " =", " -", "1", ";", " u", " =", " n", "word", ";", " while", " (", "l", "+", "1", "!=", " u", ")", " {", " m", " =", " (", "l", " +", " u", ")", " /", " 2", ";", " if", " (", "word", "nc", "mp", "(", "word", "[", "m", "],", " phrase", ")", " <", " 0", ")", " l", " =", " m", ";", " else", " u", " =", " m", ";", " }", " for", " (", "i", " =", " 0", ";", " word", "nc", "mp", "(", "phrase", ",", " word", "[", "u", "+", "i", "])", " ==", " 0", ";", " i", "++)", " if", " (", "rand", "()", " %", " (", "i", "+", "1", ")", " ==", " 0", ")", " p", " =", " word", "[", "u", "+", "i", "];", " phrase", " =", " skip", "(", "p", ",", " 1", ");", " if", " (", "str", "len", "(", "skip", "(", "phrase", ",", " k", "-", "1", "))", " ==", " 0", ")", " break", ";", " printf", "(\"", "%", "s", "\n", "\n", "\",", " skip", "(", "phrase", ",", " k", "-", "1", "));", " }", " return", " 0", ";", " }", "\n", "\n", "Back", " to", " Article"]