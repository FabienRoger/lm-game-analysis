["\n", "\n", "index", " 3", "ee", "292", "a", "..", "da", "949", "27", " 100", "644", "\n", "\n", "---", " a", "/", "\n", "\n", "+++", " b", "/", " diff", " --", "git", " a", "/", "src", "/", "Make", "file", ".", "am", " b", "/", "src", "/", "Make", "file", ".", "am", "index", " 3", "ee", "292", "a", "..", "da", "949", "27", " 100", "644", "---", " a", "/", " src", "/", "Make", "file", ".", "am", " +++", " b", "/", " src", "/", "Make", "file", ".", "am", " @@", " -", "68", ",", "7", " +", "68", ",", "6", " @@", " if", " GL", "AM", "OR", " AM", "_", "C", "FLAG", "S", " +=", " @", "LIB", "GL", "AM", "OR", "_", "C", "FLAG", "S", "@", " r", "adeon", "_", "dr", "v", "_", "la", "_", "LIB", "ADD", " +=", " @", "LIB", "GL", "AM", "OR", "_", "LI", "BS", "@", " r", "adeon", "_", "dr", "v", "_", "la", "_", "S", "OU", "RC", "ES", " +=", " \\", " -", " r", "adeon", "_", "g", "lam", "or", "_", "wra", "ppers", ".", "c", " \\", " r", "adeon", "_", "g", "lam", "or", ".", "c", " endif", " @@", " -", "97", ",", "7", " +", "96", ",", "6", " @@", " EXT", "RA", "_", "D", "IST", " =", " \\", " r", "adeon", "_", "ex", "a", "_", "fun", "cs", ".", "c", " \\", " r", "adeon", "_", "ex", "a", "_", "shared", ".", "h", " \\", " r", "adeon", "_", "g", "lam", "or", ".", "h", " \\", " -", " r", "adeon", "_", "g", "lam", "or", "_", "wra", "ppers", ".", "h", " \\", " r", "adeon", ".", "h", " \\", " r", "adeon", "_", "pro", "be", ".", "h", " \\", " r", "adeon", "_", "reg", ".", "h", " \\", "\n", "\n", "index", " 99", "bc", "666", "..", "c", "232", "cc", "2", " 100", "644", "\n", "\n", "---", " a", "/", "\n", "\n", "+++", " b", "/", " diff", " --", "git", " a", "/", "src", "/", "r", "adeon", "_", "g", "lam", "or", ".", "c", " b", "/", "src", "/", "r", "adeon", "_", "g", "lam", "or", ".", "c", "index", " 99", "bc", "666", "..", "c", "232", "cc", "2", " 100", "644", "---", " a", "/", " src", "/", "r", "adeon", "_", "g", "lam", "or", ".", "c", " +++", " b", "/", " src", "/", "r", "adeon", "_", "g", "lam", "or", ".", "c", " @@", " -", "144", ",", "83", " +", "144", ",", "18", " @@", " B", "ool", " r", "adeon", "_", "g", "lam", "or", "_", "p", "ix", "map", "_", "is", "_", "off", "screen", "(", "P", "ix", "map", "Ptr", " p", "ix", "map", ")", " return", " priv", " &&", " priv", "->", "bo", ";", " }", " -", "B", "ool", " r", "adeon", "_", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "P", "ix", "map", "Ptr", " p", "ix", "map", ",", " glam", "or", "_", "access", "_", "t", " access", ")", " -", "{", " -", " Sc", "rn", "Info", "Ptr", " scr", "n", " =", " x", "f", "86", "Screen", "To", "Sc", "rn", "(", "p", "ix", "map", "->", "draw", "able", ".", "p", "Screen", ");", " -", " R", "ADE", "ON", "Info", "Ptr", " info", " =", " R", "ADE", "ON", "P", "TR", "(", "sc", "rn", ");", " -", " struct", " r", "adeon", "_", "bo", " *", "bo", ";", " -", " int", " ret", ";", " -", " -", " if", " (", "access", " ==", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", " ||", " access", " ==", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ")", " {", " -", " if", " (", "info", "->", "Chip", "Family", " <", " CH", "IP", "_", "F", "AM", "ILY", "_", "TA", "H", "IT", "I", ")", " -", " return", " TRUE", ";", " -", " -", " return", " info", "->", "ac", "cel", "_", "state", "->", "force", ";", " -", " }", " -", " -", " bo", " =", " r", "adeon", "_", "get", "_", "p", "ix", "map", "_", "bo", "(", "p", "ix", "map", ");", " -", " if", " (", "bo", ")", " {", " -", " /*", " When", " falling", " back", " to", " sw", "rast", ",", " flush", " all", " pending", " operations", " */", " -", " if", " (", "info", "->", "Chip", "Family", " <", " CH", "IP", "_", "F", "AM", "ILY", "_", "TA", "H", "IT", "I", ")", " -", " r", "adeon", "_", "g", "lam", "or", "_", "flush", "(", "sc", "rn", ");", " -", " -", " ret", " =", " r", "adeon", "_", "bo", "_", "map", "(", "bo", ",", " 1", ");", " -", " if", " (", "ret", ")", " {", " -", " x", "f", "86", "Dr", "v", "Msg", "(", "sc", "rn", "->", "sc", "rn", "Index", ",", " X", "_", "WARNING", ",", " -", " \"%", "s", ":", " bo", " map", " (", "t", "iling", "_", "flags", " %", "d", ",", " access", " %", "d", ")", " failed", ":", " %", "s", "\n", "\n", "\",", " -", " __", "FUN", "CT", "ION", "__", ",", " -", " r", "adeon", "_", "get", "_", "p", "ix", "map", "_", "private", "(", "p", "ix", "map", ")", "->", "t", "iling", "_", "flags", ",", " -", " access", ",", " -", " stre", "r", "ror", "(-", "ret", "));", " -", " return", " FALSE", ";", " -", " }", " -", " -", " p", "ix", "map", "->", "dev", "Private", ".", "ptr", " =", " bo", "->", "ptr", ";", " -", " }", " -", " -", " return", " TRUE", ";", " -", "}", " -", " -", "void", " -", "r", "adeon", "_", "g", "lam", "or", "_", "fin", "ish", "_", "access", "(", "P", "ix", "map", "Ptr", " p", "ix", "map", ",", " glam", "or", "_", "access", "_", "t", " access", ")", " -", "{", " -", " struct", " r", "adeon", "_", "bo", " *", "bo", ";", " -", " -", " switch", "(", "access", ")", " {", " -", " case", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ":", " -", " case", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ":", " -", " break", ";", " -", " case", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ":", " -", " case", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ":", " -", " bo", " =", " r", "adeon", "_", "get", "_", "p", "ix", "map", "_", "bo", "(", "p", "ix", "map", ");", " -", " if", " (", "bo", ")", " {", " -", " r", "adeon", "_", "bo", "_", "un", "map", "(", "bo", ");", " -", " p", "ix", "map", "->", "dev", "Private", ".", "ptr", " =", " NULL", ";", " -", " }", " -", " break", ";", " -", " default", ":", " -", " Error", "F", "(\"", "Invalid", " access", " mode", " %", "d", "\n", "\n", "\",", " access", ");", " -", " }", " -", " -", " return", ";", " -", "}", " -", " static", " Pix", "map", "Ptr", " r", "adeon", "_", "g", "lam", "or", "_", "create", "_", "p", "ix", "map", "(", "Screen", "Ptr", " screen", ",", " int", " w", ",", " int", " h", ",", " int", " depth", ",", " unsigned", " usage", ")", " {", " Sc", "rn", "Info", "Ptr", " scr", "n", " =", " x", "f", "86", "Screen", "To", "Sc", "rn", "(", "screen", ");", " -", " R", "ADE", "ON", "Info", "Ptr", " info", " =", " R", "ADE", "ON", "P", "TR", "(", "sc", "rn", ");", " struct", " r", "adeon", "_", "p", "ix", "map", " *", "priv", ";", " Pix", "map", "Ptr", " p", "ix", "map", ",", " new", "_", "p", "ix", "map", " =", " NULL", ";", " if", " (!", "(", "usage", " &", " R", "ADE", "ON", "_", "CRE", "ATE", "_", "P", "IX", "MAP", "_", "D", "RI", "2", "))", " {", " -", " if", " (", "info", "->", "Chip", "Family", " <", " CH", "IP", "_", "F", "AM", "ILY", "_", "TA", "H", "IT", "I", ")", " {", " -", " p", "ix", "map", " =", " glam", "or", "_", "create", "_", "p", "ix", "map", "(", "screen", ",", " w", ",", " h", ",", " depth", ",", " usage", ");", " -", " if", " (", "p", "ix", "map", ")", " -", " return", " p", "ix", "map", ";", " -", " }", " else", " -", " return", " f", "b", "Create", "P", "ix", "map", "(", "screen", ",", " w", ",", " h", ",", " depth", ",", " usage", ");", " +", " p", "ix", "map", " =", " glam", "or", "_", "create", "_", "p", "ix", "map", "(", "screen", ",", " w", ",", " h", ",", " depth", ",", " usage", ");", " +", " if", " (", "p", "ix", "map", ")", " +", " return", " p", "ix", "map", ";", " }", " if", " (", "w", " >", " 327", "67", " ||", " h", " >", " 327", "67", ")", " @@", " -", "304", ",", "13", " +", "239", ",", "9", " @@", " B", "ool", " r", "adeon", "_", "g", "lam", "or", "_", "init", "(", "Screen", "Ptr", " screen", ")", " {", " Sc", "rn", "Info", "Ptr", " scr", "n", " =", " x", "f", "86", "Screen", "To", "Sc", "rn", "(", "screen", ");", " -", " R", "ADE", "ON", "Info", "Ptr", " info", " =", " R", "ADE", "ON", "P", "TR", "(", "sc", "rn", ");", " -", " unsigned", " int", " glam", "or", "_", "init", "_", "flags", " =", " GL", "AM", "OR", "_", "IN", "VERT", "ED", "_", "Y", "_", "AX", "IS", " |", " GL", "AM", "OR", "_", "USE", "_", "EG", "L", "_", "SC", "RE", "EN", ";", " -", " if", " (", "info", "->", "Chip", "Family", " <", " CH", "IP", "_", "F", "AM", "ILY", "_", "TA", "H", "IT", "I", ")", " -", " glam", "or", "_", "init", "_", "flags", " |", "=", " GL", "AM", "OR", "_", "USE", "_", "SC", "RE", "EN", " |", " GL", "AM", "OR", "_", "USE", "_", "P", "ICT", "URE", "_", "SC", "RE", "EN", ";", " -", " -", " if", " (!", "g", "lam", "or", "_", "init", "(", "screen", ",", " glam", "or", "_", "init", "_", "flags", "))", " {", " +", " if", " (!", "g", "lam", "or", "_", "init", "(", "screen", ",", " GL", "AM", "OR", "_", "IN", "VERT", "ED", "_", "Y", "_", "AX", "IS", " |", " GL", "AM", "OR", "_", "USE", "_", "EG", "L", "_", "SC", "RE", "EN", " |", " +", " GL", "AM", "OR", "_", "USE", "_", "SC", "RE", "EN", " |", " GL", "AM", "OR", "_", "USE", "_", "P", "ICT", "URE", "_", "SC", "RE", "EN", "))", " {", " x", "f", "86", "Dr", "v", "Msg", "(", "sc", "rn", "->", "sc", "rn", "Index", ",", " X", "_", "ERROR", ",", " \"", "F", "ailed", " to", " initialize", " glam", "or", ".", "\n", "\n", "\");", " return", " FALSE", ";", " @@", " -", "329", ",", "13", " +", "260", ",", "6", " @@", " r", "adeon", "_", "g", "lam", "or", "_", "init", "(", "Screen", "Ptr", " screen", ")", " #", "endif", " return", " FALSE", ";", " -", " if", " (!", "(", "g", "lam", "or", "_", "init", "_", "flags", " &", " GL", "AM", "OR", "_", "USE", "_", "SC", "RE", "EN", ")", " &&", " -", "!", "g", "lam", "or", "_", "screen", "_", "init", "(", "screen", "))", " {", " -", " x", "f", "86", "Dr", "v", "Msg", "(", "sc", "rn", "->", "sc", "rn", "Index", ",", " X", "_", "ERROR", ",", " -", " \"", "GL", "AM", "OR", " initialization", " failed", "\n", "\n", "\");", " -", " return", " FALSE", ";", " -", " }", " -", " screen", "->", "Create", "P", "ix", "map", " =", " r", "adeon", "_", "g", "lam", "or", "_", "create", "_", "p", "ix", "map", ";", " screen", "->", "Destroy", "P", "ix", "map", " =", " r", "adeon", "_", "g", "lam", "or", "_", "destroy", "_", "p", "ix", "map", ";", "\n", "\n", "index", " f", "8", "14", "e", "46", "..", "40", "c", "909", "2", " 100", "644", "\n", "\n", "---", " a", "/", "\n", "\n", "+++", " b", "/", " diff", " --", "git", " a", "/", "src", "/", "r", "adeon", "_", "g", "lam", "or", ".", "h", " b", "/", "src", "/", "r", "adeon", "_", "g", "lam", "or", ".", "h", "index", " f", "8", "14", "e", "46", "..", "40", "c", "909", "2", " 100", "644", "---", " a", "/", " src", "/", "r", "adeon", "_", "g", "lam", "or", ".", "h", " +++", " b", "/", " src", "/", "r", "adeon", "_", "g", "lam", "or", ".", "h", " @@", " -", "29", ",", "7", " +", "29", ",", "6", " @@", " #", "if", "def", " USE", "_", "GL", "AM", "OR", " -", "#", "include", " \"", "r", "adeon", "_", "g", "lam", "or", "_", "wra", "ppers", ".", "h", "\"", " #", "include", " \"", "r", "adeon", "_", "surface", ".", "h", "\"", " B", "ool", " r", "adeon", "_", "g", "lam", "or", "_", "pre", "_", "init", "(", "Sc", "rn", "Info", "Ptr", " scr", "n", ");", " @@", " -", "43", ",", "8", " +", "42", ",", "6", " @@", " B", "ool", " r", "adeon", "_", "g", "lam", "or", "_", "create", "_", "text", "ured", "_", "p", "ix", "map", "(", "P", "ix", "map", "Ptr", " p", "ix", "map", ");", " void", " r", "adeon", "_", "g", "lam", "or", "_", "ex", "change", "_", "buff", "ers", "(", "P", "ix", "map", "Ptr", " src", ",", " Pix", "map", "Ptr", " dst", ");", " B", "ool", " r", "adeon", "_", "g", "lam", "or", "_", "p", "ix", "map", "_", "is", "_", "off", "screen", "(", "P", "ix", "map", "Ptr", " p", "ix", "map", ");", " -", "B", "ool", " r", "adeon", "_", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "P", "ix", "map", "Ptr", " p", "ix", "map", ",", " glam", "or", "_", "access", "_", "t", " access", ");", " -", "void", " r", "adeon", "_", "g", "lam", "or", "_", "fin", "ish", "_", "access", "(", "P", "ix", "map", "Ptr", " p", "ix", "map", ",", " glam", "or", "_", "access", "_", "t", " access", ");", " struct", " r", "adeon", "_", "p", "ix", "map", " {", " struct", " r", "adeon", "_", "surface", " surface", ";", " @@", " -", "88", ",", "8", " +", "85", ",", "6", " @@", " static", " inline", " B", "ool", " r", "adeon", "_", "g", "lam", "or", "_", "create", "_", "text", "ured", "_", "p", "ix", "map", "(", "P", "ix", "map", "Ptr", " p", "ix", "map", ")", " {", " ret", "u", " static", " inline", " void", " r", "adeon", "_", "g", "lam", "or", "_", "ex", "change", "_", "buff", "ers", "(", "P", "ix", "map", "Ptr", " src", ",", " Pix", "map", "Ptr", " dst", ")", " {}", " static", " inline", " B", "ool", " r", "adeon", "_", "g", "lam", "or", "_", "p", "ix", "map", "_", "is", "_", "off", "screen", "(", "P", "ix", "map", "Ptr", " p", "ix", "map", ")", " {", " return", " FALSE", ";", " }", " -", "static", " inline", " B", "ool", " r", "adeon", "_", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "P", "ix", "map", "Ptr", " p", "ix", "map", ",", " int", " access", ")", " {", " return", " FALSE", ";", " }", " -", "static", " inline", " void", " r", "adeon", "_", "g", "lam", "or", "_", "fin", "ish", "_", "access", "(", "P", "ix", "map", "Ptr", " p", "ix", "map", ",", " int", " access", ")", " {}", " static", " inline", " struct", " r", "adeon", "_", "p", "ix", "map", " *", "r", "adeon", "_", "get", "_", "p", "ix", "map", "_", "private", "(", "P", "ix", "map", "Ptr", " p", "ix", "map", ")", " {", " return", " NULL", ";", " }", "\n", "\n", "de", "leted", " file", " mode", " 100", "644", "\n", "\n", "index", " 01", "04", "2", "f", "5", "..", "0000000", "\n", "\n", "---", " a", "/", "\n", "\n", "+++", " /", "dev", "/", "null", " diff", " --", "git", " a", "/", "src", "/", "r", "adeon", "_", "g", "lam", "or", "_", "wra", "ppers", ".", "c", " b", "/", "src", "/", "r", "adeon", "_", "g", "lam", "or", "_", "wra", "ppers", ".", "c", "de", "leted", " file", " mode", " 100", "644", "index", " 01", "04", "2", "f", "5", "..", "0000000", "---", " a", "/", " src", "/", "r", "adeon", "_", "g", "lam", "or", "_", "wra", "ppers", ".", "c", " +++", " /", "dev", "/", "null", " @@", " -", "1", ",", "18", "70", " +", "0", ",", "0", " @@", " -", "/*", " -", " *", " Copyright", " \ufffd", " 2001", " Keith", " Pack", "ard", " -", " *", " 2010", " Intel", " Corporation", " -", " *", " 2012", " Advanced", " Micro", " Devices", ",", " Inc", ".", " -", " *", " -", " *", " Part", "ly", " based", " on", " code", " Copyright", " \ufffd", " 2008", " Red", " Hat", ",", " Inc", ".", " -", " *", " Part", "ly", " based", " on", " code", " Copyright", " \ufffd", " 2000", " Su", "SE", ",", " Inc", ".", " -", " *", " -", " *", " Part", "ly", " based", " on", " code", " that", " is", " Copyright", " \ufffd", " The", " X", "Free", "86", " Project", " Inc", ".", " -", " *", " -", " *", " Per", "mission", " to", " use", ",", " copy", ",", " modify", ",", " distribute", ",", " and", " sell", " this", " software", " and", " its", " -", " *", " documentation", " for", " any", " purpose", " is", " hereby", " granted", " without", " fee", ",", " provided", " that", " -", " *", " the", " above", " copyright", " notice", " appear", " in", " all", " copies", " and", " that", " both", " that", " -", " *", " copyright", " notice", " and", " this", " permission", " notice", " appear", " in", " supporting", " -", " *", " documentation", ",", " and", " that", " the", " name", " of", " the", " op", "yright", " holders", " not", " be", " used", " in", " -", " *", " advertising", " or", " publicity", " pertaining", " to", " distribution", " of", " the", " software", " without", " -", " *", " specific", ",", " written", " prior", " permission", ".", " The", " copyright", " holders", " make", " no", " -", " *", " representations", " about", " the", " suit", "ability", " of", " this", " software", " for", " any", " purpose", ".", " It", " -", " *", " is", " provided", " \"", "as", " is", "\"", " without", " express", " or", " implied", " warranty", ".", " -", " *", " -", " *", " THE", " COP", "YR", "IGHT", " H", "OLD", "ERS", " DIS", "CLAIM", " ALL", " WARRANT", "IES", " WITH", " REG", "ARD", " TO", " THIS", " SOFTWARE", ",", " -", " *", " INCLUD", "ING", " ALL", " IM", "PLIED", " WARRANT", "IES", " OF", " MER", "CH", "AN", "TA", "BILITY", " AND", " F", "ITNESS", ",", " IN", " NO", " -", " *", " EVENT", " SHALL", " THE", " COP", "YR", "IGHT", " H", "OLD", "ERS", " BE", " LIA", "BLE", " FOR", " ANY", " SPECIAL", ",", " IN", "DI", "RECT", " OR", " -", " *", " CON", "SE", "QU", "ENT", "IAL", " DAM", "AGES", " OR", " ANY", " DAM", "AGES", " WHAT", "SO", "E", "VER", " RES", "ULT", "ING", " FROM", " L", "OSS", " OF", " USE", ",", " -", " *", " DATA", " OR", " PR", "OF", "ITS", ",", " WH", "ET", "HER", " IN", " AN", " ACTION", " OF", " CONTR", "ACT", ",", " N", "EG", "L", "IG", "ENCE", " OR", " OTHER", " -", " *", " T", "ORT", "I", "OUS", " ACTION", ",", " AR", "IS", "ING", " OUT", " OF", " OR", " IN", " CON", "N", "ECTION", " WITH", " THE", " USE", " OR", " -", " *", " PER", "FOR", "MAN", "CE", " OF", " THIS", " SOFTWARE", ".", " -", " */", " -", " -", " -", "#", "if", "def", " HAVE", "_", "D", "IX", "_", "CON", "FIG", "_", "H", " -", "#", "include", " <", "d", "ix", "-", "config", ".", "h", ">", " -", "#", "endif", " -", " -", "#", "include", " <", "std", "lib", ".", "h", ">", " -", " -", "#", "include", " \"", "r", "adeon", "_", "g", "lam", "or", "_", "wra", "ppers", ".", "h", "\"", " -", "#", "include", " \"", "m", "ip", "ict", ".", "h", "\"", " -", " -", " -", "#", "if", " HAS", "_", "DEV", "PR", "IV", "ATE", "KEY", "REC", " -", "Dev", "Private", "Key", "Rec", " glam", "or", "_", "screen", "_", "index", ";", " -", "#", "else", " -", "int", " glam", "or", "_", "screen", "_", "index", ";", " -", "#", "endif", " -", " -", "/**", " -", " *", " glam", "or", "_", "get", "_", "draw", "able", "_", "p", "ix", "map", "()", " returns", " a", " backing", " p", "ix", "map", " for", " a", " given", " draw", "able", ".", " -", " *", " -", " *", " @", "param", " p", "Draw", "able", " the", " draw", "able", " being", " requested", ".", " -", " *", " -", " *", " This", " function", " returns", " the", " backing", " p", "ix", "map", " for", " a", " draw", "able", ",", " whether", " it", " is", " a", " -", " *", " redirected", " window", ",", " un", "red", "irect", "ed", " window", ",", " or", " already", " a", " p", "ix", "map", ".", " Note", " that", " -", " *", " coordinate", " translation", " is", " needed", " when", " drawing", " to", " the", " backing", " p", "ix", "map", " of", " a", " -", " *", " redirected", " window", ",", " and", " the", " translation", " coordinates", " are", " provided", " by", " calling", " -", " *", " glam", "or", "_", "get", "_", "draw", "able", "_", "p", "ix", "map", "()", " on", " the", " draw", "able", ".", " -", " */", " -", "static", " Pix", "map", "Ptr", " glam", "or", "_", "get", "_", "draw", "able", "_", "p", "ix", "map", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ")", " -", "{", " -", " if", " (", "p", "Draw", "able", "->", "type", " ==", " D", "RAW", "ABLE", "_", "WIND", "OW", ")", " -", " return", " p", "Draw", "able", "->", "p", "Screen", "->", " -", " Get", "Window", "P", "ix", "map", "((", "Window", "Ptr", ")", " p", "Draw", "able", ");", " -", " else", " -", " return", " (", "P", "ix", "map", "Ptr", ")", " p", "Draw", "able", ";", " -", "}", " -", " -", "/**", " -", " *", " Sets", " the", " offsets", " to", " add", " to", " coordinates", " to", " make", " them", " address", " the", " same", " bits", " in", " -", " *", " the", " backing", " draw", "able", ".", " These", " coordinates", " are", " non", "zero", " only", " for", " redirected", " -", " *", " windows", ".", " -", " */", " -", "static", " void", " -", "g", "lam", "or", "_", "get", "_", "draw", "able", "_", "d", "elt", "as", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " Pix", "map", "Ptr", " p", "P", "ix", "map", ",", " -", " int", " *", "xp", ",", " int", " *", "yp", ")", " -", "{", " -", "#", "if", "def", " COMP", "OS", "ITE", " -", " if", " (", "p", "Draw", "able", "->", "type", " ==", " D", "RAW", "ABLE", "_", "WIND", "OW", ")", " {", " -", " *", "xp", " =", " -", "p", "P", "ix", "map", "->", "screen", "_", "x", ";", " -", " *", "yp", " =", " -", "p", "P", "ix", "map", "->", "screen", "_", "y", ";", " -", " return", ";", " -", " }", " -", "#", "endif", " -", " -", " *", "xp", " =", " 0", ";", " -", " *", "yp", " =", " 0", ";", " -", "}", " -", " -", "/**", " -", " *", " glam", "or", "_", "draw", "able", "_", "is", "_", "off", "screen", "()", " is", " a", " convenience", " wrapper", " for", " -", " *", " r", "adeon", "_", "g", "lam", "or", "_", "p", "ix", "map", "_", "is", "_", "off", "screen", "().", " -", " */", " -", "static", " B", "ool", " glam", "or", "_", "draw", "able", "_", "is", "_", "off", "screen", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ")", " -", "{", " -", " return", " r", "adeon", "_", "g", "lam", "or", "_", "p", "ix", "map", "_", "is", "_", "off", "screen", "(", "g", "lam", "or", "_", "get", "_", "draw", "able", "_", "p", "ix", "map", "(", "p", "Draw", "able", "));", " -", "}", " -", " -", "/**", " -", " *", " glam", "or", "_", "prep", "are", "_", "access", "()", " is", " GL", "AM", "OR", "'s", " wrapper", " for", " the", " driver", "'s", " Prepare", "Access", "()", " handler", ".", " -", " *", " -", " *", " It", " deals", " with", " waiting", " for", " synchronization", " with", " the", " card", ",", " determining", " if", " -", " *", " Prepare", "Access", "()", " is", " necessary", ",", " and", " working", " around", " Prepare", "Access", "()", " failure", ".", " -", " */", " -", "static", " B", "ool", " glam", "or", "_", "prep", "are", "_", "access", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " glam", "or", "_", "access", "_", "t", " access", ")", " -", "{", " -", " Pix", "map", "Ptr", " p", "P", "ix", "map", " =", " glam", "or", "_", "get", "_", "draw", "able", "_", "p", "ix", "map", "(", "p", "Draw", "able", ");", " -", " -", " return", " r", "adeon", "_", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "P", "ix", "map", ",", " access", ");", " -", "}", " -", " -", "/**", " -", " *", " glam", "or", "_", "fin", "ish", "_", "access", "()", " is", " GL", "AM", "OR", "'s", " wrapper", " for", " the", " driver", "'s", " finish", "_", "access", "()", " handler", ".", " -", " *", " -", " *", " It", " deals", " with", " calling", " the", " driver", "'s", " finish", "_", "access", "()", " only", " if", " necessary", ".", " -", " */", " -", "static", " void", " glam", "or", "_", "fin", "ish", "_", "access", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " glam", "or", "_", "access", "_", "t", " access", ")", " -", "{", " -", " Pix", "map", "Ptr", " p", "P", "ix", "map", " =", " glam", "or", "_", "get", "_", "draw", "able", "_", "p", "ix", "map", "(", "p", "Draw", "able", ");", " -", " -", " r", "adeon", "_", "g", "lam", "or", "_", "fin", "ish", "_", "access", "(", "p", "P", "ix", "map", ",", " access", ");", " -", "}", " -", " -", "static", " B", "ool", " glam", "or", "_", "prep", "are", "_", "access", "_", "window", "(", "Window", "Ptr", " p", "Win", ")", " -", "{", " -", " if", " (", "p", "Win", "->", "background", "State", " ==", " Background", "P", "ix", "map", ")", " {", " -", " if", " (!", "g", "lam", "or", "_", "prep", "are", "_", "access", " -", " (&", "p", "Win", "->", "background", ".", "p", "ix", "map", "->", "draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", "))", " -", " return", " FALSE", ";", " -", " }", " -", " -", " if", " (", "p", "Win", "->", "border", "Is", "Pixel", " ==", " FALSE", ")", " {", " -", " if", " (!", "g", "lam", "or", "_", "prep", "are", "_", "access", " -", " (&", "p", "Win", "->", "border", ".", "p", "ix", "map", "->", "draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", "))", " {", " -", " if", " (", "p", "Win", "->", "background", "State", " ==", " Background", "P", "ix", "map", ")", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(&", "p", "Win", "->", "background", ".", "p", "ix", "map", "->", " -", " draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " return", " FALSE", ";", " -", " }", " -", " }", " -", " return", " TRUE", ";", " -", "}", " -", " -", "static", " void", " glam", "or", "_", "fin", "ish", "_", "access", "_", "window", "(", "Window", "Ptr", " p", "Win", ")", " -", "{", " -", " if", " (", "p", "Win", "->", "background", "State", " ==", " Background", "P", "ix", "map", ")", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(&", "p", "Win", "->", "background", ".", "p", "ix", "map", "->", "draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " -", " if", " (", "p", "Win", "->", "border", "Is", "Pixel", " ==", " FALSE", ")", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(&", "p", "Win", "->", "border", ".", "p", "ix", "map", "->", "draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ");", " -", "}", " -", " -", "static", " B", "ool", " glam", "or", "_", "change", "_", "window", "_", "att", "ributes", "(", "Window", "Ptr", " p", "Win", ",", " unsigned", " long", " mask", ")", " -", "{", " -", " B", "ool", " ret", ";", " -", " -", " if", " (!", "g", "lam", "or", "_", "prep", "are", "_", "access", "_", "window", "(", "p", "Win", "))", " -", " return", " FALSE", ";", " -", " ret", " =", " f", "b", "Change", "Window", "Attributes", "(", "p", "Win", ",", " mask", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "_", "window", "(", "p", "Win", ");", " -", " return", " ret", ";", " -", "}", " -", " -", "static", " Region", "Ptr", " glam", "or", "_", "bit", "map", "_", "to", "_", "region", "(", "P", "ix", "map", "Ptr", " p", "P", "ix", ")", " -", "{", " -", " Region", "Ptr", " ret", ";", " -", " if", " (!", "g", "lam", "or", "_", "prep", "are", "_", "access", "(&", "p", "P", "ix", "->", "draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", "))", " -", " return", " NULL", ";", " -", " ret", " =", " f", "b", "P", "ix", "map", "To", "Region", "(", "p", "P", "ix", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(&", "p", "P", "ix", "->", "draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " return", " ret", ";", " -", "}", " -", " -", "void", " glam", "or", "_", "set", "_", "fall", "back", "_", "debug", "(", "Screen", "Ptr", " screen", ",", " B", "ool", " enable", ")", " -", "{", " -", " glam", "or", "_", "screen", "_", "t", " *", "g", "lam", "or", "_", "screen", " =", " glam", "or", "_", "get", "_", "screen", "(", "screen", ");", " -", " -", " glam", "or", "_", "screen", "->", "fall", "back", "_", "debug", " =", " enable", ";", " -", "}", " -", " -", " -", "/*", " -", " *", " These", " functions", " wrap", " the", " low", "-", "level", " f", "b", " rendering", " functions", " and", " -", " *", " synchron", "ize", " frame", "buffer", "/", "ac", "celer", "ated", " drawing", " by", " st", "alling", " until", " -", " *", " the", " accelerator", " is", " idle", " -", " */", " -", " -", "/**", " -", " *", " Calls", " glam", "or", "_", "prep", "are", "_", "access", " with", " GL", "AM", "OR", "_", "P", "REP", "ARE", "_", "S", "RC", " for", " the", " tile", ",", " if", " that", " is", " the", " -", " *", " current", " fill", " style", ".", " -", " *", " -", " *", " Solid", " doesn", "'t", " use", " an", " extra", " p", "ix", "map", " source", ",", " and", " St", "ipp", "led", "/", "O", "pa", "que", "St", "ipp", "led", " are", " -", " *", " 1", "b", "pp", " and", " never", " in", " f", "b", ",", " so", " we", " don", "'t", " worry", " about", " them", ".", " -", " *", " We", " should", " worry", " about", " them", " for", " comple", "teness", " sake", " and", " going", " forward", ".", " -", " */", " -", "static", " B", "ool", " glam", "or", "_", "prep", "are", "_", "access", "_", "gc", "(", "G", "CP", "tr", " p", "GC", ")", " -", "{", " -", " if", " (", "p", "GC", "->", "st", "ipple", ")", " -", " if", " (!", "g", "lam", "or", "_", "prep", "are", "_", "access", "(&", "p", "GC", "->", "st", "ipple", "->", "draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", "))", " -", " return", " FALSE", ";", " -", " if", " (", "p", "GC", "->", "fill", "Style", " ==", " Fill", "T", "iled", ")", " -", " if", " (!", "g", "lam", "or", "_", "prep", "are", "_", "access", " -", " (&", "p", "GC", "->", "tile", ".", "p", "ix", "map", "->", "draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", "))", " {", " -", " if", " (", "p", "GC", "->", "st", "ipple", ")", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(&", "p", "GC", "->", "st", "ipple", "->", "draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " return", " FALSE", ";", " -", " }", " -", " return", " TRUE", ";", " -", "}", " -", " -", "/**", " -", " *", " Fin", "ishes", " access", " to", " the", " tile", " in", " the", " GC", ",", " if", " used", ".", " -", " */", " -", "static", " void", " glam", "or", "_", "fin", "ish", "_", "access", "_", "gc", "(", "G", "CP", "tr", " p", "GC", ")", " -", "{", " -", " if", " (", "p", "GC", "->", "fill", "Style", " ==", " Fill", "T", "iled", ")", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(&", "p", "GC", "->", "tile", ".", "p", "ix", "map", "->", "draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " if", " (", "p", "GC", "->", "st", "ipple", ")", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(&", "p", "GC", "->", "st", "ipple", "->", "draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ");", " -", "}", " -", " -", "static", " B", "ool", " glam", "or", "_", "picture", "_", "prep", "are", "_", "access", "(", "Picture", "Ptr", " picture", ",", " int", " mode", ")", " -", "{", " -", " if", " (", "picture", "->", "p", "Draw", "able", " ==", " NULL", ")", " -", " return", " TRUE", ";", " -", " -", " if", " (!", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "picture", "->", "p", "Draw", "able", ",", " mode", "))", " -", " return", " FALSE", ";", " -", " -", " if", " (", "picture", "->", "alpha", "Map", " &&", " -", "!", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "picture", "->", "alpha", "Map", "->", "p", "Draw", "able", ",", " mode", "))", " {", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "picture", "->", "p", "Draw", "able", ",", " mode", ");", " -", " return", " FALSE", ";", " -", " }", " -", " -", " return", " TRUE", ";", " -", "}", " -", " -", "static", " void", " glam", "or", "_", "picture", "_", "fin", "ish", "_", "access", "(", "Picture", "Ptr", " picture", ",", " int", " mode", ")", " -", "{", " -", " if", " (", "picture", "->", "p", "Draw", "able", " ==", " NULL", ")", " -", " return", ";", " -", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "picture", "->", "p", "Draw", "able", ",", " mode", ");", " -", " if", " (", "picture", "->", "alpha", "Map", ")", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "picture", "->", "alpha", "Map", "->", "p", "Draw", "able", ",", " mode", ");", " -", "}", " -", " -", " -", "static", " char", " glam", "or", "_", "draw", "able", "_", "location", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ")", " -", "{", " -", " return", " glam", "or", "_", "draw", "able", "_", "is", "_", "off", "screen", "(", "p", "Draw", "able", ")", "?", " '", "s", "'", " :", " '", "m", "';", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "fill", "_", "sp", "ans", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " int", " n", "sp", "ans", ",", " -", " DD", "X", "Point", "Ptr", " p", "pt", ",", " int", " *", "p", "width", ",", " int", " f", "S", "orted", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "to", " %", "p", " (%", "c", ")", "\n", "\n", "\",", " p", "Draw", "able", ",", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "Draw", "able", "))", ");", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", "))", " {", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "_", "gc", "(", "p", "GC", "))", " {", " -", " f", "b", "Fill", "Sp", "ans", "(", "p", "Draw", "able", ",", " p", "GC", ",", " n", "sp", "ans", ",", " p", "pt", ",", " p", "width", ",", " -", " f", "S", "orted", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "_", "gc", "(", "p", "GC", ");", " -", " }", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "set", "_", "sp", "ans", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " char", " *", "ps", "rc", ",", " -", " DD", "X", "Point", "Ptr", " p", "pt", ",", " int", " *", "p", "width", ",", " int", " n", "sp", "ans", ",", " int", " f", "S", "orted", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "to", " %", "p", " (%", "c", ")", "\n", "\n", "\",", " p", "Draw", "able", ",", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "Draw", "able", "))", ");", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", "))", " {", " -", " f", "b", "Set", "Sp", "ans", "(", "p", "Draw", "able", ",", " p", "GC", ",", " p", "src", ",", " p", "pt", ",", " p", "width", ",", " n", "sp", "ans", ",", " f", "S", "orted", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "put", "_", "image", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " int", " depth", ",", " -", " int", " x", ",", " int", " y", ",", " int", " w", ",", " int", " h", ",", " int", " left", "Pad", ",", " int", " format", ",", " -", " char", " *", "bits", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "to", " %", "p", " (%", "c", ")", "\n", "\n", "\",", " p", "Draw", "able", ",", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "Draw", "able", "))", ");", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", "))", " {", " -", " f", "b", "Put", "Image", "(", "p", "Draw", "able", ",", " p", "GC", ",", " depth", ",", " x", ",", " y", ",", " w", ",", " h", ",", " left", "Pad", ",", " format", ",", " -", " bits", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", "}", " -", " -", "static", " Region", "Ptr", " -", "g", "lam", "or", "_", "check", "_", "copy", "_", "plane", "(", "Draw", "able", "Ptr", " p", "S", "rc", ",", " Draw", "able", "Ptr", " p", "D", "st", ",", " G", "CP", "tr", " p", "GC", ",", " -", " int", " src", "x", ",", " int", " sr", "cy", ",", " int", " w", ",", " int", " h", ",", " int", " dst", "x", ",", " int", " dst", "y", ",", " -", " unsigned", " long", " bit", "Pl", "ane", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "S", "rc", "->", "p", "Screen", ";", " -", " Region", "Ptr", " ret", " =", " NULL", ";", " -", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "from", " %", "p", " to", " %", "p", " (%", "c", ",", "%", "c", ")", "\n", "\n", "\",", " p", "S", "rc", ",", " p", "D", "st", ",", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "S", "rc", "),", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "D", "st", "))", ");", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "D", "st", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", "))", " {", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "S", "rc", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", "))", " {", " -", " ret", " =", " -", " f", "b", "Copy", "Pl", "ane", "(", "p", "S", "rc", ",", " p", "D", "st", ",", " p", "GC", ",", " src", "x", ",", " sr", "cy", ",", " w", ",", " h", ",", " dst", "x", ",", " -", " dst", "y", ",", " bit", "Pl", "ane", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "S", "rc", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " }", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "D", "st", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", " return", " ret", ";", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "poly", "_", "point", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " int", " mode", ",", " int", " n", "pt", ",", " -", " DD", "X", "Point", "Ptr", " p", "pt", "Init", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "to", " %", "p", " (%", "c", ")", "\n", "\n", "\",", " p", "Draw", "able", ",", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "Draw", "able", "))", ");", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", "))", " {", " -", " f", "b", "Poly", "Point", "(", "p", "Draw", "able", ",", " p", "GC", ",", " mode", ",", " n", "pt", ",", " p", "pt", "Init", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "poly", "_", "lines", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " -", " int", " mode", ",", " int", " n", "pt", ",", " DD", "X", "Point", "Ptr", " p", "pt", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "to", " %", "p", " (%", "c", "),", " width", " %", "d", ",", " mode", " %", "d", ",", " count", " %", "d", "\n", "\n", "\",", " -", " p", "Draw", "able", ",", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "Draw", "able", "),", " -", " p", "GC", "->", "line", "Width", ",", " mode", ",", " n", "pt", "));", " -", " -", " if", " (", "p", "GC", "->", "line", "Width", " ==", " 0", ")", " {", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", "))", " {", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "_", "gc", "(", "p", "GC", "))", " {", " -", " f", "b", "Poly", "Line", "(", "p", "Draw", "able", ",", " p", "GC", ",", " mode", ",", " n", "pt", ",", " p", "pt", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "_", "gc", "(", "p", "GC", ");", " -", " }", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", " return", ";", " -", " }", " -", " /*", " f", "b", " calls", " mi", " functions", " in", " the", " line", "Width", "!=", " 0", " case", ".", " */", " -", " f", "b", "Poly", "Line", "(", "p", "Draw", "able", ",", " p", "GC", ",", " mode", ",", " n", "pt", ",", " p", "pt", ");", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "poly", "_", "se", "gment", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " -", " int", " n", "se", "g", "Init", ",", " x", "Seg", "ment", " *", " p", "Seg", "Init", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "to", " %", "p", " (%", "c", ")", " width", " %", "d", ",", " count", " %", "d", "\n", "\n", "\",", " p", "Draw", "able", ",", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "Draw", "able", "),", " p", "GC", "->", "line", "Width", ",", " -", " n", "se", "g", "Init", "));", " -", " if", " (", "p", "GC", "->", "line", "Width", " ==", " 0", ")", " {", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", "))", " {", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "_", "gc", "(", "p", "GC", "))", " {", " -", " f", "b", "Poly", "Seg", "ment", "(", "p", "Draw", "able", ",", " p", "GC", ",", " n", "se", "g", "Init", ",", " -", " p", "Seg", "Init", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "_", "gc", "(", "p", "GC", ");", " -", " }", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", " return", ";", " -", " }", " -", " /*", " f", "b", " calls", " mi", " functions", " in", " the", " line", "Width", "!=", " 0", " case", ".", " */", " -", " f", "b", "Poly", "Seg", "ment", "(", "p", "Draw", "able", ",", " p", "GC", ",", " n", "se", "g", "Init", ",", " p", "Seg", "Init", ");", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "poly", "_", "arc", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " int", " narc", "s", ",", " x", "Arc", " *", " p", "Ar", "cs", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "to", " %", "p", " (%", "c", ")", "\n", "\n", "\",", " p", "Draw", "able", ",", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "Draw", "able", "))", ");", " -", " -", " /*", " Disable", " this", " as", " f", "b", "Poly", "Arc", " can", " call", " mi", "Zero", "Poly", "Arc", " which", " in", " turn", " -", " *", " can", " call", " accelerated", " functions", ",", " that", " as", " yet", ",", " haven", "'t", " been", " notified", " -", " *", " with", " glam", "or", "_", "fin", "ish", "_", "access", "().", " -", " */", " -", "#", "if", " 0", " -", " if", " (", "p", "GC", "->", "line", "Width", " ==", " 0", ")", " {", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", "))", " {", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "_", "gc", "(", "p", "GC", "))", " {", " -", " f", "b", "Poly", "Arc", "(", "p", "Draw", "able", ",", " p", "GC", ",", " narc", "s", ",", " p", "Ar", "cs", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "_", "gc", "(", "p", "GC", ");", " -", " }", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", " return", ";", " -", " }", " -", "#", "endif", " -", " mi", "Poly", "Arc", "(", "p", "Draw", "able", ",", " p", "GC", ",", " narc", "s", ",", " p", "Ar", "cs", ");", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "poly", "_", "fill", "_", "rect", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " -", " int", " n", "rect", ",", " x", "Rect", "angle", " *", " pre", "ct", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "to", " %", "p", " (%", "c", ")", "\n", "\n", "\",", " p", "Draw", "able", ",", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "Draw", "able", "))", ");", " -", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", "))", " {", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "_", "gc", "(", "p", "GC", "))", " {", " -", " f", "b", "Poly", "Fill", "Rect", "(", "p", "Draw", "able", ",", " p", "GC", ",", " n", "rect", ",", " pre", "ct", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "_", "gc", "(", "p", "GC", ");", " -", " }", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "image", "_", "gly", "ph", "_", "bl", "t", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " -", " int", " x", ",", " int", " y", ",", " unsigned", " int", " n", "gly", "ph", ",", " -", " Char", "Info", "Ptr", " *", " pp", "ci", ",", " pointer", " p", "gly", "ph", "Base", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "to", " %", "p", " (%", "c", ")", "\n", "\n", "\",", " p", "Draw", "able", ",", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "Draw", "able", "))", ");", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", "))", " {", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "_", "gc", "(", "p", "GC", "))", " {", " -", " f", "b", "Image", "G", "ly", "ph", "B", "lt", "(", "p", "Draw", "able", ",", " p", "GC", ",", " x", ",", " y", ",", " n", "gly", "ph", ",", " pp", "ci", ",", " -", " p", "gly", "ph", "Base", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "_", "gc", "(", "p", "GC", ");", " -", " }", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "poly", "_", "gly", "ph", "_", "bl", "t", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " -", " int", " x", ",", " int", " y", ",", " unsigned", " int", " n", "gly", "ph", ",", " -", " Char", "Info", "Ptr", " *", " pp", "ci", ",", " pointer", " p", "gly", "ph", "Base", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "to", " %", "p", " (%", "c", "),", " style", " %", "d", " al", "u", " %", "d", "\n", "\n", "\",", " p", "Draw", "able", ",", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "Draw", "able", "),", " p", "GC", "->", "fill", "Style", ",", " -", " p", "GC", "->", "al", "u", "));", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", "))", " {", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "_", "gc", "(", "p", "GC", "))", " {", " -", " f", "b", "Poly", "G", "ly", "ph", "B", "lt", "(", "p", "Draw", "able", ",", " p", "GC", ",", " x", ",", " y", ",", " n", "gly", "ph", ",", " pp", "ci", ",", " -", " p", "gly", "ph", "Base", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "_", "gc", "(", "p", "GC", ");", " -", " }", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "push", "_", "p", "ixels", "(", "G", "CP", "tr", " p", "GC", ",", " Pix", "map", "Ptr", " p", "Bit", "map", ",", " -", " Draw", "able", "Ptr", " p", "Draw", "able", ",", " int", " w", ",", " int", " h", ",", " int", " x", ",", " int", " y", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "from", " %", "p", " to", " %", "p", " (%", "c", ",", "%", "c", ")", "\n", "\n", "\",", " p", "Bit", "map", ",", " p", "Draw", "able", ",", " -", " glam", "or", "_", "draw", "able", "_", "location", "(&", "p", "Bit", "map", "->", "draw", "able", "),", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "Draw", "able", "))", ");", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", "))", " {", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(&", "p", "Bit", "map", "->", "draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", "))", " {", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "_", "gc", "(", "p", "GC", "))", " {", " -", " f", "b", "Push", "P", "ixels", "(", "p", "GC", ",", " p", "Bit", "map", ",", " p", "Draw", "able", ",", " w", ",", " h", ",", " x", ",", " -", " y", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "_", "gc", "(", "p", "GC", ");", " -", " }", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(&", "p", "Bit", "map", "->", "draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " }", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "get", "_", "sp", "ans", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " -", " int", " w", "Max", ",", " -", " DD", "X", "Point", "Ptr", " p", "pt", ",", " int", " *", "p", "width", ",", " int", " n", "sp", "ans", ",", " char", " *", "pd", "st", "Start", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "from", " %", "p", " (%", "c", ")", "\n", "\n", "\",", " p", "Draw", "able", ",", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "Draw", "able", "))", ");", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", "))", " {", " -", " f", "b", "Get", "Sp", "ans", "(", "p", "Draw", "able", ",", " w", "Max", ",", " p", "pt", ",", " p", "width", ",", " n", "sp", "ans", ",", " p", "d", "st", "Start", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " }", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "com", "pos", "ite", "(", "C", "ARD", "8", " op", ",", " -", " Picture", "Ptr", " p", "S", "rc", ",", " -", " Picture", "Ptr", " p", "Mask", ",", " -", " Picture", "Ptr", " p", "D", "st", ",", " -", " INT", "16", " x", "S", "rc", ",", " INT", "16", " y", "S", "rc", ",", " -", " INT", "16", " x", "Mask", ",", " INT", "16", " y", "Mask", ",", " -", " INT", "16", " x", "D", "st", ",", " INT", "16", " y", "D", "st", ",", " -", " CARD", "16", " width", ",", " CARD", "16", " height", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "D", "st", "->", "p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "from", " pict", "s", " %", "p", "/", "%", "p", " to", " pict", " %", "p", "\n", "\n", "\",", " p", "S", "rc", ",", " p", "Mask", ",", " p", "D", "st", "));", " -", " -", " if", " (", "g", "lam", "or", "_", "picture", "_", "prep", "are", "_", "access", "(", "p", "D", "st", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", "))", " {", " -", " if", " (", "g", "lam", "or", "_", "picture", "_", "prep", "are", "_", "access", "(", "p", "S", "rc", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", "))", " {", " -", " if", " (!", "p", "Mask", " ||", " glam", "or", "_", "picture", "_", "prep", "are", "_", "access", "(", "p", "Mask", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", "))", " {", " -", " f", "b", "Com", "pos", "ite", "(", "op", ",", " p", "S", "rc", ",", " p", "Mask", ",", " p", "D", "st", ",", " -", " x", "S", "rc", ",", " y", "S", "rc", ",", " -", " x", "Mask", ",", " y", "Mask", ",", " -", " x", "D", "st", ",", " y", "D", "st", ",", " -", " width", ",", " height", ");", " -", " if", " (", "p", "Mask", ")", " -", " glam", "or", "_", "picture", "_", "fin", "ish", "_", "access", "(", "p", "Mask", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " }", " -", " glam", "or", "_", "picture", "_", "fin", "ish", "_", "access", "(", "p", "S", "rc", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " }", " -", " glam", "or", "_", "picture", "_", "fin", "ish", "_", "access", "(", "p", "D", "st", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "add", "_", "tra", "ps", "(", "Picture", "Ptr", " p", "Picture", ",", " -", " INT", "16", " x", "_", "off", ",", " INT", "16", " y", "_", "off", ",", " int", " n", "trap", ",", " x", "T", "rap", " *", " traps", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "Picture", "->", "p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "to", " pict", " %", "p", " (%", "c", ")", "\n", "\n", "\",", " p", "Picture", ",", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "Picture", "->", "p", "Draw", "able", "))", ");", " -", " if", " (", "g", "lam", "or", "_", "picture", "_", "prep", "are", "_", "access", "(", "p", "Picture", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", "))", " {", " -", " f", "b", "Add", "Tra", "ps", "(", "p", "Picture", ",", " x", "_", "off", ",", " y", "_", "off", ",", " n", "trap", ",", " traps", ");", " -", " glam", "or", "_", "picture", "_", "fin", "ish", "_", "access", "(", "p", "Picture", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", "}", " -", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "fill", "_", "sp", "ans", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " int", " n", ",", " -", " DD", "X", "Point", "Ptr", " p", "pt", ",", " int", " *", "p", "width", ",", " int", " f", "S", "orted", ")", " -", "{", " -", " int", " ok", ";", " -", " -", " ok", " =", " glam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " if", " (", "ok", ")", " {", " -", " ok", " =", " glam", "or", "_", "fill", "_", "sp", "ans", "_", "n", "f", "(", "p", "Draw", "able", ",", " -", " p", "GC", ",", " n", ",", " p", "pt", ",", " p", "width", ",", " f", "S", "orted", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", " -", " if", " (!", "ok", ")", " -", " glam", "or", "_", "check", "_", "fill", "_", "sp", "ans", "(", "p", "Draw", "able", ",", " p", "GC", ",", " n", ",", " p", "pt", ",", " p", "width", ",", " f", "S", "orted", ");", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "put", "_", "image", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " int", " depth", ",", " int", " x", ",", " int", " y", ",", " -", " int", " w", ",", " int", " h", ",", " int", " left", "Pad", ",", " int", " format", ",", " char", " *", "bits", ")", " -", "{", " -", " int", " ok", ";", " -", " -", " ok", " =", " glam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " if", " (", "ok", ")", " {", " -", " ok", " =", " glam", "or", "_", "put", "_", "image", "_", "n", "f", "(", "p", "Draw", "able", ",", " -", " p", "GC", ",", " depth", ",", " x", ",", " y", ",", " w", ",", " h", ",", " -", " left", "Pad", ",", " format", ",", " bits", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", " -", " if", " (!", "ok", ")", " -", " glam", "or", "_", "check", "_", "put", "_", "image", "(", "p", "Draw", "able", ",", " p", "GC", ",", " depth", ",", " x", ",", " y", ",", " w", ",", " h", ",", " left", "Pad", ",", " -", " format", ",", " bits", ");", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "copy", "_", "n", "_", "to", "_", "n", "(", "Draw", "able", "Ptr", " p", "S", "rc", "Draw", "able", ",", " -", " Draw", "able", "Ptr", " p", "D", "st", "Draw", "able", ",", " -", " G", "CP", "tr", " p", "GC", ",", " -", " Box", "Ptr", " p", "box", ",", " -", " int", " n", "box", ",", " -", " int", " dx", ",", " -", " int", " dy", ",", " -", " B", "ool", " reverse", ",", " B", "ool", " ups", "ided", "own", ",", " Pixel", " bit", "plane", ",", " void", " *", "closure", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "D", "st", "Draw", "able", "->", "p", "Screen", ";", " -", " int", " ok", ";", " -", " -", " if", " (!", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "S", "rc", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", "))", " -", " goto", " fall", "back", ";", " -", " ok", " =", " glam", "or", "_", "prep", "are", "_", "access", "(", "p", "D", "st", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " if", " (!", "ok", ")", " -", " goto", " finish", "_", "src", ";", " -", " ok", " =", " glam", "or", "_", "copy", "_", "n", "_", "to", "_", "n", "_", "n", "f", "(", "p", "S", "rc", "Draw", "able", ",", " p", "D", "st", "Draw", "able", ",", " -", " p", "GC", ",", " p", "box", ",", " n", "box", ",", " dx", ",", " dy", ",", " -", " reverse", ",", " ups", "ided", "own", ",", " bit", "plane", ",", " -", " closure", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "D", "st", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", "fin", "ish", "_", "src", ":", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "S", "rc", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " -", " if", " (", "ok", ")", " -", " return", ";", " -", " -", "fall", "back", ":", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "from", " %", "p", " to", " %", "p", " (%", "c", ",", "%", "c", ")", "\n", "\n", "\",", " p", "S", "rc", "Draw", "able", ",", " p", "D", "st", "Draw", "able", ",", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "S", "rc", "Draw", "able", "),", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "D", "st", "Draw", "able", "))", ");", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "D", "st", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", "))", " {", " -", " if", " (", "p", "S", "rc", "Draw", "able", " ==", " p", "D", "st", "Draw", "able", " ||", " -", " glam", "or", "_", "prep", "are", "_", "access", "(", "p", "S", "rc", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", "))", " {", " -", " f", "b", "Copy", "N", "to", "N", "(", "p", "S", "rc", "Draw", "able", ",", " p", "D", "st", "Draw", "able", ",", " p", "GC", ",", " p", "box", ",", " n", "box", ",", " -", " dx", ",", " dy", ",", " reverse", ",", " ups", "ided", "own", ",", " bit", "plane", ",", " -", " closure", ");", " -", " if", " (", "p", "S", "rc", "Draw", "able", "!=", " p", "D", "st", "Draw", "able", ")", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "S", "rc", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " }", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "D", "st", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", "}", " -", " -", "static", " Region", "Ptr", " -", "g", "lam", "or", "_", "copy", "_", "area", "(", "Draw", "able", "Ptr", " p", "S", "rc", "Draw", "able", ",", " Draw", "able", "Ptr", " p", "D", "st", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " -", " int", " src", "x", ",", " int", " sr", "cy", ",", " int", " width", ",", " int", " height", ",", " int", " dst", "x", ",", " int", " dst", "y", ")", " -", "{", " -", " return", " mi", "Do", "Copy", "(", "p", "S", "rc", "Draw", "able", ",", " p", "D", "st", "Draw", "able", ",", " p", "GC", ",", " -", " src", "x", ",", " sr", "cy", ",", " width", ",", " height", ",", " -", " dst", "x", ",", " dst", "y", ",", " glam", "or", "_", "copy", "_", "n", "_", "to", "_", "n", ",", " 0", ",", " NULL", ");", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "poly", "_", "point", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " int", " mode", ",", " int", " n", "pt", ",", " -", " DD", "X", "Point", "Ptr", " p", "pt", ")", " -", "{", " -", " int", " i", ";", " -", " x", "Rect", "angle", " *", "p", "rect", ";", " -", " int", " ok", ";", " -", " -", " ok", " =", " glam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " if", " (", "ok", ")", " {", " -", " ok", " =", " glam", "or", "_", "poly", "_", "point", "_", "n", "f", "(", "p", "Draw", "able", ",", " p", "GC", ",", " mode", ",", " n", "pt", ",", " p", "pt", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", " -", " if", " (", "ok", ")", " -", " return", ";", " -", " -", " /*", " If", " we", " can", "'t", " reuse", " the", " current", " GC", " as", " is", ",", " don", "'t", " bother", " accelerating", " the", " -", " *", " points", ".", " -", " */", " -", " if", " (", "p", "GC", "->", "fill", "Style", "!=", " Fill", "Solid", ")", " {", " -", " glam", "or", "_", "check", "_", "poly", "_", "point", "(", "p", "Draw", "able", ",", " p", "GC", ",", " mode", ",", " n", "pt", ",", " p", "pt", ");", " -", " return", ";", " -", " }", " -", " -", " pre", "ct", " =", " mall", "oc", "(", "size", "of", "(", "x", "Rect", "angle", ")", " *", " n", "pt", ");", " -", " if", " (!", "p", "rect", ")", " -", " return", ";", " -", " for", " (", "i", " =", " 0", ";", " i", " <", " n", "pt", ";", " i", "++)", " {", " -", " pre", "ct", "[", "i", "].", "x", " =", " p", "pt", "[", "i", "].", "x", ";", " -", " pre", "ct", "[", "i", "].", "y", " =", " p", "pt", "[", "i", "].", "y", ";", " -", " if", " (", "i", " >", " 0", " &&", " mode", " ==", " Coord", "Mode", "Previous", ")", " {", " -", " pre", "ct", "[", "i", "].", "x", " +=", " pre", "ct", "[", "i", " -", " 1", "].", "x", ";", " -", " pre", "ct", "[", "i", "].", "y", " +=", " pre", "ct", "[", "i", " -", " 1", "].", "y", ";", " -", " }", " -", " pre", "ct", "[", "i", "].", "width", " =", " 1", ";", " -", " pre", "ct", "[", "i", "].", "height", " =", " 1", ";", " -", " }", " -", " p", "GC", "->", "ops", "->", "Poly", "Fill", "Rect", "(", "p", "Draw", "able", ",", " p", "GC", ",", " n", "pt", ",", " pre", "ct", ");", " -", " free", "(", "p", "rect", ");", " -", "}", " -", " -", "/**", " -", " *", " glam", "or", "_", "poly", "_", "lines", "()", " checks", " if", " it", " can", " accelerate", " the", " lines", " as", " a", " group", " of", " -", " *", " horizontal", " or", " vertical", " lines", " (", "rect", "angles", "),", " and", " uses", " existing", " rectangle", " fill", " -", " *", " acceleration", " if", " so", ".", " -", " */", " -", "static", " void", " -", "g", "lam", "or", "_", "poly", "_", "lines", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " int", " mode", ",", " int", " n", "pt", ",", " -", " DD", "X", "Point", "Ptr", " p", "pt", ")", " -", "{", " -", " x", "Rect", "angle", " *", "p", "rect", ";", " -", " int", " x", "1", ",", " x", "2", ",", " y", "1", ",", " y", "2", ";", " -", " int", " i", ";", " -", " int", " ok", ";", " -", " -", " if", " (!", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", "))", " -", " goto", " fall", "back", ";", " -", " ok", " =", " glam", "or", "_", "poly", "_", "lines", "_", "n", "f", "(", "p", "Draw", "able", ",", " p", "GC", ",", " mode", ",", " n", "pt", ",", " p", "pt", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " -", " if", " (", "ok", ")", " -", " return", ";", " -", " -", "fall", "back", ":", " -", " /*", " Don", "'t", " try", " to", " do", " wide", " lines", " or", " non", "-", "solid", " fill", " style", ".", " */", " -", " if", " (", "p", "GC", "->", "line", "Width", "!=", " 0", " ||", " p", "GC", "->", "line", "Style", "!=", " Line", "Solid", " ||", " -", " p", "GC", "->", "fill", "Style", "!=", " Fill", "Solid", ")", " {", " -", " glam", "or", "_", "check", "_", "poly", "_", "lines", "(", "p", "Draw", "able", ",", " p", "GC", ",", " mode", ",", " n", "pt", ",", " p", "pt", ");", " -", " return", ";", " -", " }", " -", " -", " pre", "ct", " =", " mall", "oc", "(", "size", "of", "(", "x", "Rect", "angle", ")", " *", " (", "n", "pt", " -", " 1", "));", " -", " if", " (!", "p", "rect", ")", " -", " return", ";", " -", " x", "1", " =", " p", "pt", "[", "0", "].", "x", ";", " -", " y", "1", " =", " p", "pt", "[", "0", "].", "y", ";", " -", " /*", " If", " we", " have", " any", " non", "-", "hor", "izontal", "/", "vert", "ical", ",", " fall", " back", ".", " */", " -", " for", " (", "i", " =", " 0", ";", " i", " <", " n", "pt", " -", " 1", ";", " i", "++)", " {", " -", " if", " (", "mode", " ==", " Coord", "Mode", "Previous", ")", " {", " -", " x", "2", " =", " x", "1", " +", " p", "pt", "[", "i", " +", " 1", "].", "x", ";", " -", " y", "2", " =", " y", "1", " +", " p", "pt", "[", "i", " +", " 1", "].", "y", ";", " -", " }", " else", " {", " -", " x", "2", " =", " p", "pt", "[", "i", " +", " 1", "].", "x", ";", " -", " y", "2", " =", " p", "pt", "[", "i", " +", " 1", "].", "y", ";", " -", " }", " -", " -", " if", " (", "x", "1", "!=", " x", "2", " &&", " y", "1", "!=", " y", "2", ")", " {", " -", " free", "(", "p", "rect", ");", " -", " glam", "or", "_", "check", "_", "poly", "_", "lines", "(", "p", "Draw", "able", ",", " p", "GC", ",", " mode", ",", " n", "pt", ",", " p", "pt", ");", " -", " return", ";", " -", " }", " -", " -", " if", " (", "x", "1", " <", " x", "2", ")", " {", " -", " pre", "ct", "[", "i", "].", "x", " =", " x", "1", ";", " -", " pre", "ct", "[", "i", "].", "width", " =", " x", "2", " -", " x", "1", " +", " 1", ";", " -", " }", " else", " {", " -", " pre", "ct", "[", "i", "].", "x", " =", " x", "2", ";", " -", " pre", "ct", "[", "i", "].", "width", " =", " x", "1", " -", " x", "2", " +", " 1", ";", " -", " }", " -", " if", " (", "y", "1", " <", " y", "2", ")", " {", " -", " pre", "ct", "[", "i", "].", "y", " =", " y", "1", ";", " -", " pre", "ct", "[", "i", "].", "height", " =", " y", "2", " -", " y", "1", " +", " 1", ";", " -", " }", " else", " {", " -", " pre", "ct", "[", "i", "].", "y", " =", " y", "2", ";", " -", " pre", "ct", "[", "i", "].", "height", " =", " y", "1", " -", " y", "2", " +", " 1", ";", " -", " }", " -", " -", " x", "1", " =", " x", "2", ";", " -", " y", "1", " =", " y", "2", ";", " -", " }", " -", " p", "GC", "->", "ops", "->", "Poly", "Fill", "Rect", "(", "p", "Draw", "able", ",", " p", "GC", ",", " n", "pt", " -", " 1", ",", " pre", "ct", ");", " -", " free", "(", "p", "rect", ");", " -", "}", " -", " -", "/**", " -", " *", " glam", "or", "_", "poly", "_", "se", "gment", "()", " checks", " if", " it", " can", " accelerate", " the", " lines", " as", " a", " group", " of", " -", " *", " horizontal", " or", " vertical", " lines", " (", "rect", "angles", "),", " and", " uses", " existing", " rectangle", " fill", " -", " *", " acceleration", " if", " so", ".", " -", " */", " -", "static", " void", " -", "g", "lam", "or", "_", "poly", "_", "se", "gment", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " int", " n", "se", "g", ",", " x", "Seg", "ment", " *", " p", "Seg", ")", " -", "{", " -", " x", "Rect", "angle", " *", "p", "rect", ";", " -", " int", " i", ";", " -", " int", " ok", ";", " -", " -", " if", " (!", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", "))", " -", " goto", " fall", "back", ";", " -", " ok", " =", " glam", "or", "_", "poly", "_", "se", "gment", "_", "n", "f", "(", "p", "Draw", "able", ",", " p", "GC", ",", " n", "se", "g", ",", " p", "Seg", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " -", " if", " (", "ok", ")", " -", " return", ";", " -", " -", "fall", "back", ":", " -", " /*", " Don", "'t", " try", " to", " do", " wide", " lines", " or", " non", "-", "solid", " fill", " style", ".", " */", " -", " if", " (", "p", "GC", "->", "line", "Width", "!=", " 0", " ||", " p", "GC", "->", "line", "Style", "!=", " Line", "Solid", " ||", " -", " p", "GC", "->", "fill", "Style", "!=", " Fill", "Solid", ")", " {", " -", " glam", "or", "_", "check", "_", "poly", "_", "se", "gment", "(", "p", "Draw", "able", ",", " p", "GC", ",", " n", "se", "g", ",", " p", "Seg", ");", " -", " return", ";", " -", " }", " -", " -", " /*", " If", " we", " have", " any", " non", "-", "hor", "izontal", "/", "vert", "ical", ",", " fall", " back", ".", " */", " -", " for", " (", "i", " =", " 0", ";", " i", " <", " n", "se", "g", ";", " i", "++)", " {", " -", " if", " (", "p", "Seg", "[", "i", "].", "x", "1", "!=", " p", "Seg", "[", "i", "].", "x", "2", " &&", " p", "Seg", "[", "i", "].", "y", "1", "!=", " p", "Seg", "[", "i", "].", "y", "2", ")", " {", " -", " glam", "or", "_", "check", "_", "poly", "_", "se", "gment", "(", "p", "Draw", "able", ",", " p", "GC", ",", " n", "se", "g", ",", " p", "Seg", ");", " -", " return", ";", " -", " }", " -", " }", " -", " -", " pre", "ct", " =", " mall", "oc", "(", "size", "of", "(", "x", "Rect", "angle", ")", " *", " n", "se", "g", ");", " -", " if", " (!", "p", "rect", ")", " -", " return", ";", " -", " for", " (", "i", " =", " 0", ";", " i", " <", " n", "se", "g", ";", " i", "++)", " {", " -", " if", " (", "p", "Seg", "[", "i", "].", "x", "1", " <", " p", "Seg", "[", "i", "].", "x", "2", ")", " {", " -", " pre", "ct", "[", "i", "].", "x", " =", " p", "Seg", "[", "i", "].", "x", "1", ";", " -", " pre", "ct", "[", "i", "].", "width", " =", " p", "Seg", "[", "i", "].", "x", "2", " -", " p", "Seg", "[", "i", "].", "x", "1", " +", " 1", ";", " -", " }", " else", " {", " -", " pre", "ct", "[", "i", "].", "x", " =", " p", "Seg", "[", "i", "].", "x", "2", ";", " -", " pre", "ct", "[", "i", "].", "width", " =", " p", "Seg", "[", "i", "].", "x", "1", " -", " p", "Seg", "[", "i", "].", "x", "2", " +", " 1", ";", " -", " }", " -", " if", " (", "p", "Seg", "[", "i", "].", "y", "1", " <", " p", "Seg", "[", "i", "].", "y", "2", ")", " {", " -", " pre", "ct", "[", "i", "].", "y", " =", " p", "Seg", "[", "i", "].", "y", "1", ";", " -", " pre", "ct", "[", "i", "].", "height", " =", " p", "Seg", "[", "i", "].", "y", "2", " -", " p", "Seg", "[", "i", "].", "y", "1", " +", " 1", ";", " -", " }", " else", " {", " -", " pre", "ct", "[", "i", "].", "y", " =", " p", "Seg", "[", "i", "].", "y", "2", ";", " -", " pre", "ct", "[", "i", "].", "height", " =", " p", "Seg", "[", "i", "].", "y", "1", " -", " p", "Seg", "[", "i", "].", "y", "2", " +", " 1", ";", " -", " }", " -", " -", " /*", " don", "'t", " paint", " last", " pixel", " */", " -", " if", " (", "p", "GC", "->", "cap", "Style", " ==", " Cap", "Not", "Last", ")", " {", " -", " if", " (", "p", "rect", "[", "i", "].", "width", " ==", " 1", ")", " -", " pre", "ct", "[", "i", "].", "height", "--", ";", " -", " else", " -", " pre", "ct", "[", "i", "].", "width", "--", ";", " -", " }", " -", " }", " -", " p", "GC", "->", "ops", "->", "Poly", "Fill", "Rect", "(", "p", "Draw", "able", ",", " p", "GC", ",", " n", "se", "g", ",", " pre", "ct", ");", " -", " free", "(", "p", "rect", ");", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "poly", "_", "fill", "_", "rect", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " -", " G", "CP", "tr", " p", "GC", ",", " int", " n", "rect", ",", " x", "Rect", "angle", " *", " pre", "ct", ")", " -", "{", " -", " int", " ok", ";", " -", " -", " ok", " =", " glam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " if", " (", "ok", ")", " {", " -", " ok", " =", " glam", "or", "_", "poly", "_", "fill", "_", "rect", "_", "n", "f", "(", "p", "Draw", "able", ",", " p", "GC", ",", " n", "rect", ",", " pre", "ct", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", " -", " if", " (!", "ok", ")", " -", " glam", "or", "_", "check", "_", "poly", "_", "fill", "_", "rect", "(", "p", "Draw", "able", ",", " p", "GC", ",", " n", "rect", ",", " pre", "ct", ");", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "get", "_", "sp", "ans", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " -", " int", " w", "Max", ",", " -", " DD", "X", "Point", "Ptr", " p", "pt", ",", " int", " *", "p", "width", ",", " int", " n", "sp", "ans", ",", " char", " *", "pd", "st", "Start", ")", " -", "{", " -", " int", " ok", ";", " -", " -", " ok", " =", " glam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " if", " (", "ok", ")", " {", " -", " ok", " =", " glam", "or", "_", "get", "_", "sp", "ans", "_", "n", "f", "(", "p", "Draw", "able", ",", " w", "Max", ",", " p", "pt", ",", " -", " p", "width", ",", " n", "sp", "ans", ",", " p", "d", "st", "Start", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", " -", " if", " (!", "ok", ")", " -", " glam", "or", "_", "check", "_", "get", "_", "sp", "ans", "(", "p", "Draw", "able", ",", " w", "Max", ",", " p", "pt", ",", " p", "width", ",", " n", "sp", "ans", ",", " p", "d", "st", "Start", ");", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "set", "_", "sp", "ans", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " g", "c", ",", " char", " *", "src", ",", " -", " DD", "X", "Point", "Ptr", " points", ",", " int", " *", "width", "s", ",", " int", " n", ",", " int", " sorted", ")", " -", "{", " -", " int", " ok", ";", " -", " -", " ok", " =", " glam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " if", " (", "ok", ")", " {", " -", " ok", " =", " glam", "or", "_", "set", "_", "sp", "ans", "_", "n", "f", "(", "p", "Draw", "able", ",", " g", "c", ",", " src", ",", " -", " points", ",", " width", "s", ",", " n", ",", " sorted", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", " -", " if", " (!", "ok", ")", " -", " glam", "or", "_", "check", "_", "set", "_", "sp", "ans", "(", "p", "Draw", "able", ",", " g", "c", ",", " src", ",", " points", ",", " width", "s", ",", " n", ",", " sorted", ");", " -", "}", " -", " -", "static", " Region", "Ptr", " -", "g", "lam", "or", "_", "copy", "_", "plane", "(", "Draw", "able", "Ptr", " p", "S", "rc", ",", " Draw", "able", "Ptr", " p", "D", "st", ",", " G", "CP", "tr", " p", "GC", ",", " -", " int", " src", "x", ",", " int", " sr", "cy", ",", " int", " w", ",", " int", " h", ",", " int", " dst", "x", ",", " int", " dst", "y", ",", " -", " unsigned", " long", " bit", "Pl", "ane", ")", " -", "{", " -", " int", " ok", ";", " -", " Region", "Ptr", " region", ";", " -", " -", " if", " (!", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "D", "st", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", "))", " -", " goto", " fall", "back", ";", " -", " ok", " =", " glam", "or", "_", "prep", "are", "_", "access", "(", "p", "S", "rc", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " if", " (!", "ok", ")", " -", " goto", " finish", "_", "d", "st", ";", " -", " ok", " =", " glam", "or", "_", "copy", "_", "plane", "_", "n", "f", "(", "p", "S", "rc", ",", " p", "D", "st", ",", " p", "GC", ",", " src", "x", ",", " sr", "cy", ",", " w", ",", " h", ",", " -", " dst", "x", ",", " dst", "y", ",", " bit", "Pl", "ane", ",", " \u00ae", "ion", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "S", "rc", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ");", " -", "fin", "ish", "_", "d", "st", ":", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "D", "st", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " -", " if", " (", "ok", ")", " -", " return", " region", ";", " -", " -", "fall", "back", ":", " -", " return", " glam", "or", "_", "check", "_", "copy", "_", "plane", "(", "p", "S", "rc", ",", " p", "D", "st", ",", " p", "GC", ",", " src", "x", ",", " sr", "cy", ",", " w", ",", " h", ",", " -", " dst", "x", ",", " dst", "y", ",", " bit", "Pl", "ane", ");", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "image", "_", "gly", "ph", "_", "bl", "t", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " -", " int", " x", ",", " int", " y", ",", " unsigned", " int", " n", "gly", "ph", ",", " -", " Char", "Info", "Ptr", " *", " pp", "ci", ",", " pointer", " p", "gly", "ph", "Base", ")", " -", "{", " -", " int", " ok", ";", " -", " -", " ok", " =", " glam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " if", " (", "ok", ")", " {", " -", " ok", " =", " glam", "or", "_", "image", "_", "gly", "ph", "_", "bl", "t", "_", "n", "f", "(", "p", "Draw", "able", ",", " p", "GC", ",", " x", ",", " y", ",", " n", "gly", "ph", ",", " pp", "ci", ",", " p", "gly", "ph", "Base", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", " -", " if", " (!", "ok", ")", " -", " glam", "or", "_", "check", "_", "image", "_", "gly", "ph", "_", "bl", "t", "(", "p", "Draw", "able", ",", " p", "GC", ",", " x", ",", " y", ",", " n", "gly", "ph", ",", " pp", "ci", ",", " p", "gly", "ph", "Base", ");", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "poly", "_", "gly", "ph", "_", "bl", "t", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " G", "CP", "tr", " p", "GC", ",", " -", " int", " x", ",", " int", " y", ",", " unsigned", " int", " n", "gly", "ph", ",", " -", " Char", "Info", "Ptr", " *", " pp", "ci", ",", " pointer", " p", "gly", "ph", "Base", ")", " -", "{", " -", " int", " ok", ";", " -", " -", " ok", " =", " glam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " if", " (", "ok", ")", " {", " -", " ok", " =", " glam", "or", "_", "poly", "_", "gly", "ph", "_", "bl", "t", "_", "n", "f", "(", "p", "Draw", "able", ",", " p", "GC", ",", " x", ",", " y", ",", " n", "gly", "ph", ",", " pp", "ci", ",", " p", "gly", "ph", "Base", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", " -", " if", " (!", "ok", ")", " -", " glam", "or", "_", "check", "_", "poly", "_", "gly", "ph", "_", "bl", "t", "(", "p", "Draw", "able", ",", " p", "GC", ",", " x", ",", " y", ",", " n", "gly", "ph", ",", " pp", "ci", ",", " p", "gly", "ph", "Base", ");", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "push", "_", "p", "ixels", "(", "G", "CP", "tr", " p", "GC", ",", " Pix", "map", "Ptr", " p", "Bit", "map", ",", " -", " Draw", "able", "Ptr", " p", "Draw", "able", ",", " int", " w", ",", " int", " h", ",", " int", " x", ",", " int", " y", ")", " -", "{", " -", " int", " ok", ";", " -", " -", " if", " (!", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", "))", " -", " goto", " fall", "back", ";", " -", " ok", " =", " glam", "or", "_", "prep", "are", "_", "access", "(&", "p", "Bit", "map", "->", "draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " if", " (!", "ok", ")", " -", " goto", " finish", "_", "draw", "able", ";", " -", " ok", " =", " glam", "or", "_", "push", "_", "p", "ixels", "_", "n", "f", "(", "p", "GC", ",", " p", "Bit", "map", ",", " p", "Draw", "able", ",", " w", ",", " h", ",", " x", ",", " y", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(&", "p", "Bit", "map", "->", "draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ");", " -", "fin", "ish", "_", "draw", "able", ":", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " -", " if", " (", "ok", ")", " -", " return", ";", " -", " -", "fall", "back", ":", " -", " glam", "or", "_", "check", "_", "push", "_", "p", "ixels", "(", "p", "GC", ",", " p", "Bit", "map", ",", " p", "Draw", "able", ",", " w", ",", " h", ",", " x", ",", " y", ");", " -", "}", " -", " -", "const", " G", "CO", "ps", " glam", "or", "_", "ops", " =", " {", " -", " glam", "or", "_", "fill", "_", "sp", "ans", ",", " -", " glam", "or", "_", "set", "_", "sp", "ans", ",", " -", " glam", "or", "_", "put", "_", "image", ",", " -", " glam", "or", "_", "copy", "_", "area", ",", " -", " glam", "or", "_", "copy", "_", "plane", ",", " -", " glam", "or", "_", "poly", "_", "point", ",", " -", " glam", "or", "_", "poly", "_", "lines", ",", " -", " glam", "or", "_", "poly", "_", "se", "gment", ",", " -", " mi", "Poly", "Rect", "angle", ",", " -", " glam", "or", "_", "check", "_", "poly", "_", "arc", ",", " -", " mi", "Fill", "Poly", "gon", ",", " -", " glam", "or", "_", "poly", "_", "fill", "_", "rect", ",", " -", " mi", "Poly", "Fill", "Arc", ",", " -", " mi", "Poly", "Text", "8", ",", " -", " mi", "Poly", "Text", "16", ",", " -", " mi", "Image", "Text", "8", ",", " -", " mi", "Image", "Text", "16", ",", " -", " glam", "or", "_", "image", "_", "gly", "ph", "_", "bl", "t", ",", " -", " glam", "or", "_", "poly", "_", "gly", "ph", "_", "bl", "t", ",", " -", " glam", "or", "_", "push", "_", "p", "ixels", ",", " -", "};", " -", " -", "/**", " -", " *", " glam", "or", "_", "valid", "ate", "_", "gc", "()", " sets", " the", " ops", " to", " GL", "AM", "OR", "'s", " implementations", ",", " which", " may", " be", " -", " *", " accelerated", " or", " may", " sync", " the", " card", " and", " fall", " back", " to", " f", "b", ".", " -", " */", " -", "static", " void", " -", "r", "adeon", "_", "g", "lam", "or", "_", "valid", "ate", "_", "gc", "(", "G", "CP", "tr", " p", "GC", ",", " unsigned", " long", " changes", ",", " Draw", "able", "Ptr", " p", "Draw", "able", ")", " -", "{", " -", " glam", "or", "_", "valid", "ate", "_", "gc", "(", "p", "GC", ",", " changes", ",", " p", "Draw", "able", ");", " -", " p", "GC", "->", "ops", " =", " (", "G", "CO", "ps", " *)", " &", " glam", "or", "_", "ops", ";", " -", "}", " -", " -", "static", " GC", "Fun", "cs", " glam", "or", "GC", "Fun", "cs", " =", " {", " -", " r", "adeon", "_", "g", "lam", "or", "_", "valid", "ate", "_", "gc", ",", " -", " mi", "Change", "GC", ",", " -", " mi", "Copy", "GC", ",", " -", " mi", "Destroy", "GC", ",", " -", " mi", "Change", "Cl", "ip", ",", " -", " mi", "Destroy", "Cl", "ip", ",", " -", " mi", "Copy", "Cl", "ip", " -", "};", " -", " -", "/**", " -", " *", " r", "adeon", "_", "g", "lam", "or", "_", "create", "_", "gc", " makes", " a", " new", " GC", " and", " hooks", " up", " its", " fun", "cs", " handler", ",", " so", " that", " -", " *", " r", "adeon", "_", "g", "lam", "or", "_", "valid", "ate", "_", "gc", "()", " will", " get", " called", ".", " -", " */", " -", "static", " int", " r", "adeon", "_", "g", "lam", "or", "_", "create", "_", "gc", "(", "G", "CP", "tr", " p", "GC", ")", " -", "{", " -", " if", " (!", "fb", "Create", "GC", "(", "p", "GC", "))", " -", " return", " FALSE", ";", " -", " -", " p", "GC", "->", "fun", "cs", " =", " &", "g", "lam", "or", "GC", "Fun", "cs", ";", " -", " -", " return", " TRUE", ";", " -", "}", " -", " -", "static", " void", " glam", "or", "_", "copy", "_", "window", "(", "Window", "Ptr", " p", "Win", ",", " DD", "X", "Point", "Rec", " pt", "Old", "Org", ",", " Region", "Ptr", " pr", "gn", "S", "rc", ")", " -", "{", " -", " Region", "Rec", " r", "gn", "D", "st", ";", " -", " int", " dx", ",", " dy", ";", " -", " Pix", "map", "Ptr", " p", "P", "ix", "map", " =", " (*", "p", "Win", "->", "draw", "able", ".", "p", "Screen", "->", "Get", "Window", "P", "ix", "map", ")", " (", "p", "Win", ");", " -", " -", " dx", " =", " pt", "Old", "Org", ".", "x", " -", " p", "Win", "->", "draw", "able", ".", "x", ";", " -", " dy", " =", " pt", "Old", "Org", ".", "y", " -", " p", "Win", "->", "draw", "able", ".", "y", ";", " -", " REG", "ION", "_", "TR", "AN", "SL", "ATE", "(", "p", "Win", "->", "draw", "able", ".", "p", "Screen", ",", " pr", "gn", "S", "rc", ",", " -", "dx", ",", " -", "dy", ");", " -", " -", " REG", "ION", "_", "IN", "IT", "(", "p", "Win", "->", "draw", "able", ".", "p", "Screen", ",", " &", "r", "gn", "D", "st", ",", " Null", "Box", ",", " 0", ");", " -", " -", " REG", "ION", "_", "INT", "ERS", "ECT", "(", "p", "Win", "->", "draw", "able", ".", "p", "Screen", ",", " &", "r", "gn", "D", "st", ",", " &", "p", "Win", "->", "border", "Cl", "ip", ",", " -", " pr", "gn", "S", "rc", ");", " -", "#", "if", "def", " COMP", "OS", "ITE", " -", " if", " (", "p", "P", "ix", "map", "->", "screen", "_", "x", " ||", " p", "P", "ix", "map", "->", "screen", "_", "y", ")", " -", " REG", "ION", "_", "TR", "AN", "SL", "ATE", "(", "p", "Win", "->", "draw", "able", ".", "p", "Screen", ",", " &", "r", "gn", "D", "st", ",", " -", " -", "p", "P", "ix", "map", "->", "screen", "_", "x", ",", " -", "p", "P", "ix", "map", "->", "screen", "_", "y", ");", " -", "#", "endif", " -", " -", " mi", "Copy", "Region", "(&", "p", "P", "ix", "map", "->", "draw", "able", ",", " &", "p", "P", "ix", "map", "->", "draw", "able", ",", " -", " NULL", ",", " &", "r", "gn", "D", "st", ",", " dx", ",", " dy", ",", " glam", "or", "_", "copy", "_", "n", "_", "to", "_", "n", ",", " 0", ",", " NULL", ");", " -", " -", " REG", "ION", "_", "UN", "IN", "IT", "(", "p", "Win", "->", "draw", "able", ".", "p", "Screen", ",", " &", "r", "gn", "D", "st", ");", " -", "}", " -", " -", "/**", " -", " *", " Acceler", "ates", " Get", "Image", " for", " solid", " Z", "P", "ix", "map", " downloads", " from", " frame", "buffer", " memory", ".", " -", " *", " -", " *", " This", " is", " probably", " the", " only", " case", " we", " actually", " care", " about", ".", " The", " rest", " fall", " through", " -", " *", " to", " migration", " and", " f", "b", "Get", "Image", ",", " which", " hopefully", " will", " result", " in", " migration", " pushing", " -", " *", " the", " p", "ix", "map", " out", " of", " frame", "buffer", ".", " -", " */", " -", "void", " -", "static", " glam", "or", "_", "get", "_", "image", "(", "Draw", "able", "Ptr", " p", "Draw", "able", ",", " int", " x", ",", " int", " y", ",", " int", " w", ",", " int", " h", ",", " -", " unsigned", " int", " format", ",", " unsigned", " long", " plane", "Mask", ",", " char", " *", "d", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " p", "Draw", "able", "->", "p", "Screen", ";", " -", " Box", "Rec", " Box", ";", " -", " Pix", "map", "Ptr", " p", "P", "ix", " =", " glam", "or", "_", "get", "_", "draw", "able", "_", "p", "ix", "map", "(", "p", "Draw", "able", ");", " -", " int", " x", "off", ",", " y", "off", ";", " -", " B", "ool", " ok", ";", " -", " -", " if", " (!", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", "))", " -", " goto", " fall", "back", ";", " -", " -", " glam", "or", "_", "get", "_", "draw", "able", "_", "d", "elt", "as", "(", "p", "Draw", "able", ",", " p", "P", "ix", ",", " &", "x", "off", ",", " &", "y", "off", ");", " -", " -", " Box", ".", "x", "1", " =", " p", "Draw", "able", "->", "y", " +", " x", " +", " x", "off", ";", " -", " Box", ".", "y", "1", " =", " p", "Draw", "able", "->", "y", " +", " y", " +", " y", "off", ";", " -", " Box", ".", "x", "2", " =", " Box", ".", "x", "1", " +", " w", ";", " -", " Box", ".", "y", "2", " =", " Box", ".", "y", "1", " +", " h", ";", " -", " -", " ok", " =", " glam", "or", "_", "get", "_", "image", "_", "n", "f", "(", "p", "Draw", "able", ",", " x", ",", " y", ",", " w", ",", " h", ",", " -", " format", ",", " plane", "Mask", ",", " d", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " -", " if", " (", "ok", ")", " -", " return", ";", " -", " -", "fall", "back", ":", " -", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "(\"", "from", " %", "p", " (%", "c", ")", "\n", "\n", "\",", " p", "Draw", "able", ",", " -", " glam", "or", "_", "draw", "able", "_", "location", "(", "p", "Draw", "able", "))", ");", " -", " -", " if", " (", "g", "lam", "or", "_", "prep", "are", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", "))", " {", " -", " f", "b", "Get", "Image", "(", "p", "Draw", "able", ",", " x", ",", " y", ",", " w", ",", " h", ",", " format", ",", " plane", "Mask", ",", " d", ");", " -", " glam", "or", "_", "fin", "ish", "_", "access", "(", "p", "Draw", "able", ",", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " }", " -", " -", " return", ";", " -", "}", " -", " -", " -", "/*", " Cut", " and", " paste", " from", " render", "/", "gly", "ph", ".", "c", " -", " probably", " should", " export", " it", " instead", " */", " -", "static", " void", " -", "g", "lam", "or", "_", "gly", "ph", "_", "ext", "ents", "(", "int", " n", "list", ",", " -", " Gly", "ph", "List", "Ptr", " list", ",", " Gly", "ph", "Ptr", " *", " glyph", "s", ",", " Box", "Ptr", " ext", "ents", ")", " -", "{", " -", " int", " x", "1", ",", " x", "2", ",", " y", "1", ",", " y", "2", ";", " -", " int", " x", ",", " y", ",", " n", ";", " -", " -", " x", "1", " =", " y", "1", " =", " MAX", "SH", "ORT", ";", " -", " x", "2", " =", " y", "2", " =", " MIN", "SH", "ORT", ";", " -", " x", " =", " y", " =", " 0", ";", " -", " while", " (", "n", "list", "--", ")", " {", " -", " x", " +=", " list", "->", "x", "Off", ";", " -", " y", " +=", " list", "->", "y", "Off", ";", " -", " n", " =", " list", "->", "len", ";", " -", " list", "++;", " -", " while", " (", "n", "--", ")", " {", " -", " Gly", "ph", "Ptr", " glyph", " =", " *", "gly", "ph", "s", "++;", " -", " int", " v", ";", " -", " -", " v", " =", " x", " -", " glyph", "->", "info", ".", "x", ";", " -", " if", " (", "v", " <", " x", "1", ")", " -", " x", "1", " =", " v", ";", " -", " v", " +=", " glyph", "->", "info", ".", "width", ";", " -", " if", " (", "v", " >", " x", "2", ")", " -", " x", "2", " =", " v", ";", " -", " -", " v", " =", " y", " -", " glyph", "->", "info", ".", "y", ";", " -", " if", " (", "v", " <", " y", "1", ")", " -", " y", "1", " =", " v", ";", " -", " v", " +=", " glyph", "->", "info", ".", "height", ";", " -", " if", " (", "v", " >", " y", "2", ")", " -", " y", "2", " =", " v", ";", " -", " -", " x", " +=", " glyph", "->", "info", ".", "x", "Off", ";", " -", " y", " +=", " glyph", "->", "info", ".", "y", "Off", ";", " -", " }", " -", " }", " -", " -", " ext", "ents", "->", "x", "1", " =", " x", "1", " <", " MIN", "SH", "ORT", "?", " MIN", "SH", "ORT", " :", " x", "1", ";", " -", " ext", "ents", "->", "x", "2", " =", " x", "2", " >", " MAX", "SH", "ORT", "?", " MAX", "SH", "ORT", " :", " x", "2", ";", " -", " ext", "ents", "->", "y", "1", " =", " y", "1", " <", " MIN", "SH", "ORT", "?", " MIN", "SH", "ORT", " :", " y", "1", ";", " -", " ext", "ents", "->", "y", "2", " =", " y", "2", " >", " MAX", "SH", "ORT", "?", " MAX", "SH", "ORT", " :", " y", "2", ";", " -", "}", " -", " -", "#", "define", " Needs", "Component", "(", "f", ")", " (", "P", "ICT", "_", "FORM", "AT", "_", "A", "(", "f", ")", "!=", " 0", " &&", " P", "ICT", "_", "FORM", "AT", "_", "RGB", "(", "f", ")", "!=", " 0", ")", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "gly", "ph", "s", "(", "C", "ARD", "8", " op", ",", " -", " Picture", "Ptr", " src", ",", " -", " Picture", "Ptr", " dst", ",", " -", " Pict", "Format", "Ptr", " mask", "Format", ",", " -", " INT", "16", " x", "S", "rc", ",", " -", " INT", "16", " y", "S", "rc", ",", " int", " n", "list", ",", " Gly", "ph", "List", "Ptr", " list", ",", " Gly", "ph", "Ptr", " *", " glyph", "s", ")", " -", "{", " -", " p", "ix", "man", "_", "image", "_", "t", " *", "image", ";", " -", " Pix", "map", "Ptr", " scratch", ";", " -", " Picture", "Ptr", " mask", ";", " -", " int", " width", " =", " 0", ",", " height", " =", " 0", ";", " -", " int", " x", ",", " y", ",", " n", ";", " -", " int", " x", "D", "st", " =", " list", "->", "x", "Off", ",", " y", "D", "st", " =", " list", "->", "y", "Off", ";", " -", " Box", "Rec", " ext", "ents", " =", " {", " 0", ",", " 0", ",", " 0", ",", " 0", " };", " -", " -", " if", " (", "mask", "Format", ")", " {", " -", " p", "ix", "man", "_", "format", "_", "code", "_", "t", " format", ";", " -", " CARD", "32", " component", "_", "alpha", ";", " -", " int", " error", ";", " -", " -", " glam", "or", "_", "gly", "ph", "_", "ext", "ents", "(", "n", "list", ",", " list", ",", " glyph", "s", ",", " &", "ext", "ents", ");", " -", " if", " (", "ext", "ents", ".", "x", "2", " <=", " ext", "ents", ".", "x", "1", " ||", " ext", "ents", ".", "y", "2", " <=", " ext", "ents", ".", "y", "1", ")", " -", " return", ";", " -", " -", " width", " =", " ext", "ents", ".", "x", "2", " -", " ext", "ents", ".", "x", "1", ";", " -", " height", " =", " ext", "ents", ".", "y", "2", " -", " ext", "ents", ".", "y", "1", ";", " -", " -", " format", " =", " mask", "Format", "->", "format", " |", " -", " (", "B", "its", "Per", "Pixel", "(", "mask", "Format", "->", "depth", ")", " <<", " 24", ");", " -", " image", " =", " -", " p", "ix", "man", "_", "image", "_", "create", "_", "bits", "(", "format", ",", " width", ",", " height", ",", " NULL", ",", " 0", ");", " -", " if", " (!", "image", ")", " -", " return", ";", " -", " -", " scratch", " =", " Get", "Sc", "ratch", "P", "ix", "map", "Header", "(", "d", "st", "->", "p", "Draw", "able", "->", "p", "Screen", ",", " width", ",", " height", ",", " -", " P", "IX", "MAN", "_", "FORM", "AT", "_", "DEP", "TH", "(", "format", "),", " -", " P", "IX", "MAN", "_", "FORM", "AT", "_", "B", "PP", "(", "format", "),", " -", " p", "ix", "man", "_", "image", "_", "get", "_", "str", "ide", "(", "image", "),", " -", " p", "ix", "man", "_", "image", "_", "get", "_", "data", "(", "image", "));", " -", " -", " if", " (!", "sc", "ratch", ")", " {", " -", " p", "ix", "man", "_", "image", "_", "un", "ref", "(", "image", ");", " -", " return", ";", " -", " }", " -", " -", " component", "_", "alpha", " =", " Needs", "Component", "(", "mask", "Format", "->", "format", ");", " -", " mask", " =", " Create", "Picture", "(", "0", ",", " &", "sc", "ratch", "->", "draw", "able", ",", " -", " mask", "Format", ",", " CPC", "omp", "onent", "Alpha", ",", " -", " &", "component", "_", "alpha", ",", " server", "Client", ",", " &", "error", ");", " -", " if", " (!", "mask", ")", " {", " -", " Free", "Sc", "ratch", "P", "ix", "map", "Header", "(", "sc", "ratch", ");", " -", " p", "ix", "man", "_", "image", "_", "un", "ref", "(", "image", ");", " -", " return", ";", " -", " }", " -", " Val", "idate", "Picture", "(", "mask", ");", " -", " -", " x", " =", " -", "ext", "ents", ".", "x", "1", ";", " -", " y", " =", " -", "ext", "ents", ".", "y", "1", ";", " -", " }", " else", " {", " -", " mask", " =", " dst", ";", " -", " x", " =", " 0", ";", " -", " y", " =", " 0", ";", " -", " }", " -", " -", " while", " (", "n", "list", "--", ")", " {", " -", " x", " +=", " list", "->", "x", "Off", ";", " -", " y", " +=", " list", "->", "y", "Off", ";", " -", " n", " =", " list", "->", "len", ";", " -", " while", " (", "n", "--", ")", " {", " -", " Gly", "ph", "Ptr", " glyph", " =", " *", "gly", "ph", "s", "++;", " -", " Picture", "Ptr", " g", " =", " Get", "G", "ly", "ph", "Picture", "(", "gly", "ph", ",", " dst", "->", "p", "Draw", "able", "->", "p", "Screen", ");", " -", " if", " (", "g", ")", " {", " -", " if", " (", "mask", "Format", ")", " {", " -", " Composite", "Picture", "(", "Pict", "Op", "Add", ",", " g", ",", " NULL", ",", " mask", ",", " -", " 0", ",", " 0", ",", " -", " 0", ",", " 0", ",", " -", " x", " -", " glyph", "->", "info", ".", "x", ",", " -", " y", " -", " glyph", "->", "info", ".", "y", ",", " -", " glyph", "->", "info", ".", "width", ",", " -", " glyph", "->", "info", ".", "height", ");", " -", " }", " else", " {", " -", " Composite", "Picture", "(", "op", ",", " src", ",", " g", ",", " dst", ",", " -", " x", "S", "rc", " +", " (", "x", " -", " glyph", "->", "info", ".", "x", ")", " -", " x", "D", "st", ",", " -", " y", "S", "rc", " +", " (", "y", " -", " glyph", "->", "info", ".", "y", ")", " -", " y", "D", "st", ",", " -", " 0", ",", " 0", ",", " -", " x", " -", " glyph", "->", "info", ".", "x", ",", " -", " y", " -", " glyph", "->", "info", ".", "y", ",", " -", " glyph", "->", "info", ".", "width", ",", " -", " glyph", "->", "info", ".", "height", ");", " -", " }", " -", " }", " -", " -", " x", " +=", " glyph", "->", "info", ".", "x", "Off", ";", " -", " y", " +=", " glyph", "->", "info", ".", "y", "Off", ";", " -", " }", " -", " list", "++;", " -", " }", " -", " -", " if", " (", "mask", "Format", ")", " {", " -", " x", " =", " ext", "ents", ".", "x", "1", ";", " -", " y", " =", " ext", "ents", ".", "y", "1", ";", " -", " Composite", "Picture", "(", "op", ",", " src", ",", " mask", ",", " dst", ",", " -", " x", "S", "rc", " +", " x", " -", " x", "D", "st", ",", " -", " y", "S", "rc", " +", " y", " -", " y", "D", "st", ",", " -", " 0", ",", " 0", ",", " -", " x", ",", " y", ",", " -", " width", ",", " height", ");", " -", " Free", "Picture", "(", "mask", ",", " 0", ");", " -", " Free", "Sc", "ratch", "P", "ix", "map", "Header", "(", "sc", "ratch", ");", " -", " p", "ix", "man", "_", "image", "_", "un", "ref", "(", "image", ");", " -", " }", " -", "}", " -", " -", "void", " -", "g", "lam", "or", "_", "gly", "ph", "s", "(", "C", "ARD", "8", " op", ",", " -", " Picture", "Ptr", " p", "S", "rc", ",", " -", " Picture", "Ptr", " p", "D", "st", ",", " -", " Pict", "Format", "Ptr", " mask", "Format", ",", " -", " INT", "16", " x", "S", "rc", ",", " INT", "16", " y", "S", "rc", ",", " -", " int", " n", "list", ",", " Gly", "ph", "List", "Ptr", " list", ",", " Gly", "ph", "Ptr", " *", " glyph", "s", ")", " -", "{", " -", " int", " ok", ";", " -", " -", " if", " (!", "g", "lam", "or", "_", "picture", "_", "prep", "are", "_", "access", "(", "p", "D", "st", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", "))", " -", " goto", " fall", "back", ";", " -", " ok", " =", " glam", "or", "_", "picture", "_", "prep", "are", "_", "access", "(", "p", "S", "rc", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " if", " (!", "ok", ")", " -", " goto", " finish", "_", "d", "st", ";", " -", " ok", " =", " glam", "or", "_", "gly", "ph", "s", "_", "n", "f", "(", "op", ",", " -", " p", "S", "rc", ",", " p", "D", "st", ",", " mask", "Format", ",", " -", " x", "S", "rc", ",", " y", "S", "rc", ",", " n", "list", ",", " list", ",", " glyph", "s", ");", " -", " glam", "or", "_", "picture", "_", "fin", "ish", "_", "access", "(", "p", "S", "rc", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ");", " -", "fin", "ish", "_", "d", "st", ":", " -", " glam", "or", "_", "picture", "_", "fin", "ish", "_", "access", "(", "p", "D", "st", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " -", " if", " (", "ok", ")", " -", " return", ";", " -", " -", "fall", "back", ":", " -", " glam", "or", "_", "check", "_", "gly", "ph", "s", "(", "op", ",", " p", "S", "rc", ",", " p", "D", "st", ",", " mask", "Format", ",", " x", "S", "rc", ",", " y", "S", "rc", ",", " n", "list", ",", " list", ",", " glyph", "s", ");", " -", "}", " -", " -", " -", "#", "if", "def", " R", "END", "ER", " -", " -", "/*", " Note", ":", " when", " using", " glam", "or", " we", " can", " not", " fail", " through", " to", " the", " ordinary", " GL", "AM", "OR", " -", " *", " code", " paths", ",", " as", " glam", "or", " keeps", " an", " internal", " texture", " which", " will", " become", " -", " *", " inconsistent", " with", " the", " original", " bo", ".", " (", "The", " texture", " is", " replaced", " whenever", " -", " *", " the", " format", " changes", ",", " e", ".", "g", ".", " switching", " between", " x", "RGB", " and", " AR", "GB", ",", " for", " which", " mes", "a", " -", " *", " will", " allocate", " its", " own", " bo", ".)", " -", " *", " -", " *", " Er", "go", " it", " is", " unsafe", " to", " fall", " through", " to", " the", " original", " backend", " operations", " if", " -", " *", " glam", "or", " is", " enabled", ".", " -", " *", " -", " *", " XXX", " This", " has", " some", " serious", " implications", " for", " mixing", " Render", ",", " D", "RI", ",", " scan", "out", "...", " -", " */", " -", " -", "static", " void", " glam", "or", "_", "com", "pos", "ite", "_", "fall", "back", "_", "pict", "_", "desc", "(", "Picture", "Ptr", " pict", ",", " char", " *", "string", ",", " -", " int", " n", ")", " -", "{", " -", " char", " format", "[", "20", "];", " -", " char", " size", "[", "20", "];", " -", " char", " loc", ";", " -", " -", " if", " (!", "pict", ")", " {", " -", " sn", "printf", "(", "string", ",", " n", ",", " \"", "None", "\");", " -", " return", ";", " -", " }", " -", " -", " if", " (", "pict", "->", "p", "Draw", "able", " ==", " NULL", ")", " {", " -", " sn", "printf", "(", "string", ",", " n", ",", " \"", "source", "-", "only", "\");", " -", " return", ";", " -", " }", " -", " -", " switch", " (", "pict", "->", "format", ")", " {", " -", " case", " P", "ICT", "_", "a", "8", "r", "8", "g", "8", "b", "8", ":", " -", " sn", "printf", "(", "format", ",", " 20", ",", " \"", "AR", "GB", "88", "88", "\");", " -", " break", ";", " -", " case", " P", "ICT", "_", "x", "8", "r", "8", "g", "8", "b", "8", ":", " -", " sn", "printf", "(", "format", ",", " 20", ",", " \"", "X", "RGB", "88", "88", "\");", " -", " break", ";", " -", " case", " P", "ICT", "_", "r", "5", "g", "6", "b", "5", ":", " -", " sn", "printf", "(", "format", ",", " 20", ",", " \"", "RGB", "565", " \"", ");", " -", " break", ";", " -", " case", " P", "ICT", "_", "x", "1", "r", "5", "g", "5", "b", "5", ":", " -", " sn", "printf", "(", "format", ",", " 20", ",", " \"", "RGB", "555", " \"", ");", " -", " break", ";", " -", " case", " P", "ICT", "_", "a", "8", ":", " -", " sn", "printf", "(", "format", ",", " 20", ",", " \"", "A", "8", " \"", ");", " -", " break", ";", " -", " case", " P", "ICT", "_", "a", "1", ":", " -", " sn", "printf", "(", "format", ",", " 20", ",", " \"", "A", "1", " \"", ");", " -", " break", ";", " -", " default", ":", " -", " sn", "printf", "(", "format", ",", " 20", ",", " \"", "0", "x", "%", "x", "\",", " (", "int", ")", "pict", "->", "format", ");", " -", " break", ";", " -", " }", " -", " -", " loc", " =", " glam", "or", "_", "draw", "able", "_", "is", "_", "off", "screen", "(", "pict", "->", "p", "Draw", "able", ")", "?", " '", "s", "'", " :", " '", "m", "';", " -", " -", " sn", "printf", "(", "size", ",", " 20", ",", " \"%", "dx", "%", "d", "%", "s", "\",", " pict", "->", "p", "Draw", "able", "->", "width", ",", " -", " pict", "->", "p", "Draw", "able", "->", "height", ",", " pict", "->", "repeat", "?", " \"", " R", "\"", " :", " \"\"", ");", " -", " -", " sn", "printf", "(", "string", ",", " n", ",", " \"%", "p", ":", "%", "c", " fmt", " %", "s", " (%", "s", ")", "%", "s", "\",", " -", " pict", "->", "p", "Draw", "able", ",", " loc", ",", " format", ",", " size", ",", " -", " pict", "->", "alpha", "Map", "?", " \"", " with", " alpha", " map", "\"", " :", "\"", "\");", " -", "}", " -", " -", "static", " const", " char", " *", " -", "op", "_", "to", "_", "string", "(", "C", "ARD", "8", " op", ")", " -", "{", " -", " switch", " (", "op", ")", " {", " -", "#", "define", " C", "(", "x", ")", " case", " Pict", "Op", "##", "x", ":", " return", " #", "x", " -", " C", "(", "Clear", ");", " -", " C", "(", "S", "rc", ");", " -", " C", "(", "D", "st", ");", " -", " C", "(", "Over", ");", " -", " C", "(", "Over", "R", "ever", "se", ");", " -", " C", "(", "In", ");", " -", " C", "(", "In", "R", "ever", "se", ");", " -", " C", "(", "Out", ");", " -", " C", "(", "Out", "R", "ever", "se", ");", " -", " C", "(", "At", "op", ");", " -", " C", "(", "At", "op", "R", "ever", "se", ");", " -", " C", "(", "X", "or", ");", " -", " C", "(", "Add", ");", " -", " C", "(", "S", "atur", "ate", ");", " -", " -", " /*", " -", " *", " Oper", "ators", " only", " available", " in", " version", " 0", ".", "2", " -", " */", " -", "#", "if", " R", "END", "ER", "_", "MA", "J", "OR", " >=", " 1", " ||", " R", "END", "ER", "_", "MIN", "OR", " >=", " 2", " -", " C", "(", "Dis", "j", "oint", "Clear", ");", " -", " C", "(", "Dis", "j", "oint", "S", "rc", ");", " -", " C", "(", "Dis", "j", "oint", "D", "st", ");", " -", " C", "(", "Dis", "j", "oint", "Over", ");", " -", " C", "(", "Dis", "j", "oint", "Over", "R", "ever", "se", ");", " -", " C", "(", "Dis", "j", "oint", "In", ");", " -", " C", "(", "Dis", "j", "oint", "In", "R", "ever", "se", ");", " -", " C", "(", "Dis", "j", "oint", "Out", ");", " -", " C", "(", "Dis", "j", "oint", "Out", "R", "ever", "se", ");", " -", " C", "(", "Dis", "j", "oint", "At", "op", ");", " -", " C", "(", "Dis", "j", "oint", "At", "op", "R", "ever", "se", ");", " -", " C", "(", "Dis", "j", "oint", "X", "or", ");", " -", " -", " C", "(", "Con", "j", "oint", "Clear", ");", " -", " C", "(", "Con", "j", "oint", "S", "rc", ");", " -", " C", "(", "Con", "j", "oint", "D", "st", ");", " -", " C", "(", "Con", "j", "oint", "Over", ");", " -", " C", "(", "Con", "j", "oint", "Over", "R", "ever", "se", ");", " -", " C", "(", "Con", "j", "oint", "In", ");", " -", " C", "(", "Con", "j", "oint", "In", "R", "ever", "se", ");", " -", " C", "(", "Con", "j", "oint", "Out", ");", " -", " C", "(", "Con", "j", "oint", "Out", "R", "ever", "se", ");", " -", " C", "(", "Con", "j", "oint", "At", "op", ");", " -", " C", "(", "Con", "j", "oint", "At", "op", "R", "ever", "se", ");", " -", " C", "(", "Con", "j", "oint", "X", "or", ");", " -", "#", "endif", " -", " -", " /*", " -", " *", " Oper", "ators", " only", " available", " in", " version", " 0", ".", "11", " -", " */", " -", "#", "if", " R", "END", "ER", "_", "MA", "J", "OR", " >=", " 1", " ||", " R", "END", "ER", "_", "MIN", "OR", " >=", " 11", " -", " C", "(", "Mult", "ip", "ly", ");", " -", " C", "(", "Screen", ");", " -", " C", "(", "Over", "lay", ");", " -", " C", "(", "Dark", "en", ");", " -", " C", "(", "Light", "en", ");", " -", " C", "(", "Color", "D", "odge", ");", " -", " C", "(", "Color", "Burn", ");", " -", " C", "(", "Hard", "Light", ");", " -", " C", "(", "Soft", "Light", ");", " -", " C", "(", "Diff", "erence", ");", " -", " C", "(", "Ex", "clusion", ");", " -", " C", "(", "HS", "L", "H", "ue", ");", " -", " C", "(", "HS", "LS", "aturation", ");", " -", " C", "(", "HS", "L", "Color", ");", " -", " C", "(", "HS", "LL", "umin", "osity", ");", " -", "#", "endif", " -", " default", ":", " return", " \"", "gar", "bage", "\";", " -", "#", "und", "ef", " C", " -", " }", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "print", "_", "com", "pos", "ite", "_", "fall", "back", "(", "const", " char", " *", "func", ",", " CARD", "8", " op", ",", " -", " Picture", "Ptr", " p", "S", "rc", ",", " Picture", "Ptr", " p", "Mask", ",", " Picture", "Ptr", " p", "D", "st", ")", " -", "{", " -", " glam", "or", "_", "screen", "_", "t", " *", "g", "lam", "or", "_", "screen", " =", " glam", "or", "_", "get", "_", "screen", "(", "p", "D", "st", "->", "p", "Draw", "able", "->", "p", "Screen", ");", " -", " char", " src", "desc", "[", "40", "],", " mask", "desc", "[", "40", "],", " d", "std", "esc", "[", "40", "];", " -", " -", " if", " (!", " glam", "or", "_", "screen", "->", "fall", "back", "_", "debug", ")", " -", " return", ";", " -", " -", " glam", "or", "_", "com", "pos", "ite", "_", "fall", "back", "_", "pict", "_", "desc", "(", "p", "S", "rc", ",", " src", "desc", ",", " 40", ");", " -", " glam", "or", "_", "com", "pos", "ite", "_", "fall", "back", "_", "pict", "_", "desc", "(", "p", "Mask", ",", " mask", "desc", ",", " 40", ");", " -", " glam", "or", "_", "com", "pos", "ite", "_", "fall", "back", "_", "pict", "_", "desc", "(", "p", "D", "st", ",", " d", "std", "esc", ",", " 40", ");", " -", " -", " Error", "F", "(\"", "Com", "pos", "ite", " fall", "back", " at", " %", "s", ":", "\n", "\n", "\"", " -", " \"", " op", " %", "s", ",", "\n", "\n", "\"", " -", " \"", " src", " %", "s", ",", "\n", "\n", "\"", " -", " \"", " mask", " %", "s", ",", "\n", "\n", "\"", " -", " \"", " dst", " %", "s", ",", "\n", "\n", "\",", " -", " func", ",", " op", "_", "to", "_", "string", " (", "op", "),", " src", "desc", ",", " mask", "desc", ",", " d", "std", "esc", ");", " -", "}", " -", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "com", "pos", "ite", "(", "C", "ARD", "8", " op", ",", " -", " Picture", "Ptr", " p", "S", "rc", ",", " -", " Picture", "Ptr", " p", "Mask", ",", " -", " Picture", "Ptr", " p", "D", "st", ",", " -", " INT", "16", " x", "S", "rc", ",", " INT", "16", " y", "S", "rc", ",", " -", " INT", "16", " x", "Mask", ",", " INT", "16", " y", "Mask", ",", " -", " INT", "16", " x", "D", "st", ",", " INT", "16", " y", "D", "st", ",", " -", " CARD", "16", " width", ",", " CARD", "16", " height", ")", " -", "{", " -", " int", " ok", ";", " -", " -", " if", " (!", "g", "lam", "or", "_", "picture", "_", "prep", "are", "_", "access", "(", "p", "D", "st", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", "))", " -", " goto", " fall", "back", ";", " -", " ok", " =", " glam", "or", "_", "picture", "_", "prep", "are", "_", "access", "(", "p", "S", "rc", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " if", " (!", "ok", ")", " -", " goto", " finish", "_", "d", "st", ";", " -", " if", " (", "p", "Mask", ")", " {", " -", " ok", " =", " glam", "or", "_", "picture", "_", "prep", "are", "_", "access", "(", "p", "Mask", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " if", " (!", "ok", ")", " -", " goto", " finish", "_", "src", ";", " -", " }", " -", " -", " ok", " =", " glam", "or", "_", "com", "pos", "ite", "_", "n", "f", "(", "op", ",", " -", " p", "S", "rc", ",", " p", "Mask", ",", " p", "D", "st", ",", " x", "S", "rc", ",", " y", "S", "rc", ",", " -", " x", "Mask", ",", " y", "Mask", ",", " x", "D", "st", ",", " y", "D", "st", ",", " -", " width", ",", " height", ");", " -", " -", " if", " (", "p", "Mask", ")", " -", " glam", "or", "_", "picture", "_", "fin", "ish", "_", "access", "(", "p", "Mask", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ");", " -", "fin", "ish", "_", "src", ":", " -", " glam", "or", "_", "picture", "_", "fin", "ish", "_", "access", "(", "p", "S", "rc", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ");", " -", "fin", "ish", "_", "d", "st", ":", " -", " glam", "or", "_", "picture", "_", "fin", "ish", "_", "access", "(", "p", "D", "st", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " -", " if", " (", "ok", ")", " -", " return", ";", " -", " -", "fall", "back", ":", " -", " glam", "or", "_", "print", "_", "com", "pos", "ite", "_", "fall", "back", "(\"", "g", "lam", "or", "_", "com", "pos", "ite", "\",", " -", " op", ",", " p", "S", "rc", ",", " p", "Mask", ",", " p", "D", "st", ");", " -", " -", " glam", "or", "_", "check", "_", "com", "pos", "ite", "(", "op", ",", " p", "S", "rc", ",", " p", "Mask", ",", " p", "D", "st", ",", " x", "S", "rc", ",", " y", "S", "rc", ",", " -", " x", "Mask", ",", " y", "Mask", ",", " x", "D", "st", ",", " y", "D", "st", ",", " width", ",", " height", ");", " -", "}", " -", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "tra", "pez", "oids", "(", "C", "ARD", "8", " op", ",", " Picture", "Ptr", " src", ",", " Picture", "Ptr", " dst", ",", " -", " Pict", "Format", "Ptr", " mask", "Format", ",", " INT", "16", " x", "S", "rc", ",", " INT", "16", " y", "S", "rc", ",", " -", " int", " n", "trap", ",", " x", "T", "rape", "z", "oid", " *", " traps", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " dst", "->", "p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " if", " (", "mask", "Format", ")", " {", " -", " Pix", "map", "Ptr", " scratch", " =", " NULL", ";", " -", " Picture", "Ptr", " mask", ";", " -", " INT", "16", " x", "D", "st", ",", " y", "D", "st", ";", " -", " INT", "16", " x", "Rel", ",", " y", "Rel", ";", " -", " Box", "Rec", " bounds", ";", " -", " int", " width", ",", " height", ";", " -", " p", "ix", "man", "_", "image", "_", "t", " *", "image", ";", " -", " p", "ix", "man", "_", "format", "_", "code", "_", "t", " format", ";", " -", " int", " error", ";", " -", " -", " x", "D", "st", " =", " traps", "[", "0", "].", "left", ".", "p", "1", ".", "x", " >>", " 16", ";", " -", " y", "D", "st", " =", " traps", "[", "0", "].", "left", ".", "p", "1", ".", "y", " >>", " 16", ";", " -", " -", " mi", "T", "rape", "z", "oid", "B", "ounds", " (", "nt", "rap", ",", " traps", ",", " &", "b", "ounds", ");", " -", " if", " (", "b", "ounds", ".", "y", "1", " >=", " bounds", ".", "y", "2", " ||", " bounds", ".", "x", "1", " >=", " bounds", ".", "x", "2", ")", " -", " return", ";", " -", " -", " width", " =", " bounds", ".", "x", "2", " -", " bounds", ".", "x", "1", ";", " -", " height", " =", " bounds", ".", "y", "2", " -", " bounds", ".", "y", "1", ";", " -", " -", " format", " =", " mask", "Format", "->", "format", " |", " -", " (", "B", "its", "Per", "Pixel", "(", "mask", "Format", "->", "depth", ")", " <<", " 24", ");", " -", " image", " =", " -", " p", "ix", "man", "_", "image", "_", "create", "_", "bits", "(", "format", ",", " width", ",", " height", ",", " NULL", ",", " 0", ");", " -", " if", " (!", "image", ")", " -", " return", ";", " -", " -", " for", " (", ";", " n", "trap", ";", " n", "trap", "--", ",", " traps", "++)", " -", " p", "ix", "man", "_", "r", "aster", "ize", "_", "tra", "pez", "oid", "(", "image", ",", " -", " (", "p", "ix", "man", "_", "tra", "pez", "oid", "_", "t", " *)", " traps", ",", " -", " -", "b", "ounds", ".", "x", "1", ",", " -", "b", "ounds", ".", "y", "1", ");", " -", " -", " -", " scratch", " =", " Get", "Sc", "ratch", "P", "ix", "map", "Header", "(", "screen", ",", " width", ",", " height", ",", " -", " P", "IX", "MAN", "_", "FORM", "AT", "_", "DEP", "TH", "(", "format", "),", " -", " P", "IX", "MAN", "_", "FORM", "AT", "_", "B", "PP", "(", "format", "),", " -", " p", "ix", "man", "_", "image", "_", "get", "_", "str", "ide", "(", "image", "),", " -", " p", "ix", "man", "_", "image", "_", "get", "_", "data", "(", "image", "));", " -", " if", " (!", "sc", "ratch", ")", " {", " -", " p", "ix", "man", "_", "image", "_", "un", "ref", "(", "image", ");", " -", " return", ";", " -", " }", " -", " -", " mask", " =", " Create", "Picture", "(", "0", ",", " &", "sc", "ratch", "->", "draw", "able", ",", " -", " Picture", "Match", "Format", "(", "screen", ",", " -", " P", "IX", "MAN", "_", "FORM", "AT", "_", "DEP", "TH", "(", "format", "),", " -", " format", "),", " -", " 0", ",", " 0", ",", " server", "Client", ",", " &", "error", ");", " -", " if", " (!", "mask", ")", " {", " -", " Free", "Sc", "ratch", "P", "ix", "map", "Header", "(", "sc", "ratch", ");", " -", " p", "ix", "man", "_", "image", "_", "un", "ref", "(", "image", ");", " -", " return", ";", " -", " }", " -", " -", " x", "Rel", " =", " bounds", ".", "x", "1", " +", " x", "S", "rc", " -", " x", "D", "st", ";", " -", " y", "Rel", " =", " bounds", ".", "y", "1", " +", " y", "S", "rc", " -", " y", "D", "st", ";", " -", " Composite", "Picture", "(", "op", ",", " src", ",", " mask", ",", " dst", ",", " -", " x", "Rel", ",", " y", "Rel", ",", " -", " 0", ",", " 0", ",", " -", " bounds", ".", "x", "1", ",", " bounds", ".", "y", "1", ",", " -", " width", ",", " height", ");", " -", " Free", "Picture", "(", "mask", ",", " 0", ");", " -", " -", " Free", "Sc", "ratch", "P", "ix", "map", "Header", "(", "sc", "ratch", ");", " -", " p", "ix", "man", "_", "image", "_", "un", "ref", "(", "image", ");", " -", " }", " else", " {", " -", " if", " (", "d", "st", "->", "poly", "Edge", " ==", " Poly", "Edge", "Sharp", ")", " -", " mask", "Format", " =", " Picture", "Match", "Format", "(", "screen", ",", " 1", ",", " P", "ICT", "_", "a", "1", ");", " -", " else", " -", " mask", "Format", " =", " Picture", "Match", "Format", "(", "screen", ",", " 8", ",", " P", "ICT", "_", "a", "8", ");", " -", " -", " for", " (", ";", " n", "trap", ";", " n", "trap", "--", ",", " traps", "++)", " -", " glam", "or", "_", "check", "_", "tra", "pez", "oids", "(", "op", ",", " src", ",", " dst", ",", " mask", "Format", ",", " x", "S", "rc", ",", " y", "S", "rc", ",", " 1", ",", " traps", ");", " -", " }", " -", "}", " -", " -", "/**", " -", " *", " glam", "or", "_", "tra", "pez", "oids", " is", " essentially", " a", " copy", " of", " mi", "T", "rape", "z", "oids", " that", " uses", " -", " *", " glam", "or", "_", "create", "_", "alpha", "_", "picture", " instead", " of", " mi", "Create", "Alpha", "Picture", ".", " -", " *", " -", " *", " The", " problem", " with", " mi", "Create", "Alpha", "Picture", " is", " that", " it", " calls", " Poly", "Fill", "Rect", " -", " *", " to", " initialize", " the", " contents", " after", " creating", " the", " p", "ix", "map", ",", " which", " -", " *", " causes", " the", " p", "ix", "map", " to", " be", " moved", " in", " for", " acceleration", ".", " The", " subsequent", " -", " *", " call", " to", " R", "aster", "ize", "T", "rape", "z", "oid", " won", "'t", " be", " accelerated", " however", ",", " which", " -", " *", " forces", " the", " p", "ix", "map", " to", " be", " moved", " out", " again", ".", " -", " *", " -", " *", " glam", "or", "_", "create", "_", "alpha", "_", "picture", " avoids", " this", " round", "trip", " by", " using", " -", " *", " glam", "or", "_", "check", "_", "poly", "_", "fill", "_", "rect", " to", " initialize", " the", " contents", ".", " -", " */", " -", "static", " void", " -", "g", "lam", "or", "_", "tra", "pez", "oids", "(", "C", "ARD", "8", " op", ",", " Picture", "Ptr", " src", ",", " Picture", "Ptr", " dst", ",", " -", " Pict", "Format", "Ptr", " mask", "Format", ",", " INT", "16", " x", "S", "rc", ",", " INT", "16", " y", "S", "rc", ",", " -", " int", " n", "trap", ",", " x", "T", "rape", "z", "oid", " *", " traps", ")", " -", "{", " -", " int", " ok", ";", " -", " -", " if", " (!", "g", "lam", "or", "_", "picture", "_", "prep", "are", "_", "access", "(", "d", "st", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", "))", " -", " goto", " fall", "back", ";", " -", " ok", " =", " glam", "or", "_", "picture", "_", "prep", "are", "_", "access", "(", "src", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " if", " (!", "ok", ")", " -", " goto", " finish", "_", "d", "st", ";", " -", " ok", " =", " glam", "or", "_", "tra", "pez", "oids", "_", "n", "f", "(", "op", ",", " -", " src", ",", " dst", ",", " mask", "Format", ",", " x", "S", "rc", ",", " -", " y", "S", "rc", ",", " n", "trap", ",", " traps", ");", " -", " glam", "or", "_", "picture", "_", "fin", "ish", "_", "access", "(", "src", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ");", " -", "fin", "ish", "_", "d", "st", ":", " -", " glam", "or", "_", "picture", "_", "fin", "ish", "_", "access", "(", "d", "st", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " -", " if", " (", "ok", ")", " -", " return", ";", " -", " -", "fall", "back", ":", " -", " glam", "or", "_", "check", "_", "tra", "pez", "oids", "(", "op", ",", " src", ",", " dst", ",", " mask", "Format", ",", " x", "S", "rc", ",", " y", "S", "rc", ",", " n", "trap", ",", " traps", ");", " -", "}", " -", " -", "static", " void", " -", "g", "lam", "or", "_", "check", "_", "tri", "angles", "(", "C", "ARD", "8", " op", ",", " Picture", "Ptr", " src", ",", " Picture", "Ptr", " dst", ",", " -", " Pict", "Format", "Ptr", " mask", "Format", ",", " INT", "16", " x", "S", "rc", ",", " INT", "16", " y", "S", "rc", ",", " -", " int", " n", "tri", ",", " x", "Tri", "angle", " *", "tri", ")", " -", "{", " -", " Screen", "Ptr", " screen", " =", " dst", "->", "p", "Draw", "able", "->", "p", "Screen", ";", " -", " -", " if", " (", "mask", "Format", ")", " {", " -", " Pix", "map", "Ptr", " scratch", " =", " NULL", ";", " -", " Picture", "Ptr", " mask", ";", " -", " INT", "16", " x", "D", "st", ",", " y", "D", "st", ";", " -", " INT", "16", " x", "Rel", ",", " y", "Rel", ";", " -", " Box", "Rec", " bounds", ";", " -", " int", " width", ",", " height", ";", " -", " p", "ix", "man", "_", "image", "_", "t", " *", "image", ";", " -", " p", "ix", "man", "_", "format", "_", "code", "_", "t", " format", ";", " -", " int", " error", ";", " -", " -", " x", "D", "st", " =", " p", "ix", "man", "_", "fixed", "_", "to", "_", "int", "(", "tri", "[", "0", "].", "p", "1", ".", "x", ");", " -", " y", "D", "st", " =", " p", "ix", "man", "_", "fixed", "_", "to", "_", "int", "(", "tri", "[", "0", "].", "p", "1", ".", "y", ");", " -", " -", " mi", "Tri", "angle", "B", "ounds", " (", "nt", "ri", ",", " tri", ",", " &", "b", "ounds", ");", " -", " if", " (", "b", "ounds", ".", "y", "1", " >=", " bounds", ".", "y", "2", " ||", " bounds", ".", "x", "1", " >=", " bounds", ".", "x", "2", ")", " -", " return", ";", " -", " -", " width", " =", " bounds", ".", "x", "2", " -", " bounds", ".", "x", "1", ";", " -", " height", " =", " bounds", ".", "y", "2", " -", " bounds", ".", "y", "1", ";", " -", " -", " format", " =", " mask", "Format", "->", "format", " |", " -", " (", "B", "its", "Per", "Pixel", "(", "mask", "Format", "->", "depth", ")", " <<", " 24", ");", " -", " image", " =", " -", " p", "ix", "man", "_", "image", "_", "create", "_", "bits", "(", "format", ",", " width", ",", " height", ",", " NULL", ",", " 0", ");", " -", " if", " (!", "image", ")", " -", " return", ";", " -", " -", " p", "ix", "man", "_", "add", "_", "tri", "angles", "(", "image", ",", " -", " -", "b", "ounds", ".", "x", "1", ",", " -", "b", "ounds", ".", "y", "1", ",", " -", " n", "tri", ",", " (", "p", "ix", "man", "_", "tri", "angle", "_", "t", " *)", "tri", ");", " -", " -", " scratch", " =", " Get", "Sc", "ratch", "P", "ix", "map", "Header", "(", "screen", ",", " width", ",", " height", ",", " -", " P", "IX", "MAN", "_", "FORM", "AT", "_", "DEP", "TH", "(", "format", "),", " -", " P", "IX", "MAN", "_", "FORM", "AT", "_", "B", "PP", "(", "format", "),", " -", " p", "ix", "man", "_", "image", "_", "get", "_", "str", "ide", "(", "image", "),", " -", " p", "ix", "man", "_", "image", "_", "get", "_", "data", "(", "image", "));", " -", " if", " (!", "sc", "ratch", ")", " {", " -", " p", "ix", "man", "_", "image", "_", "un", "ref", "(", "image", ");", " -", " return", ";", " -", " }", " -", " -", " mask", " =", " Create", "Picture", "(", "0", ",", " &", "sc", "ratch", "->", "draw", "able", ",", " -", " Picture", "Match", "Format", "(", "screen", ",", " -", " P", "IX", "MAN", "_", "FORM", "AT", "_", "DEP", "TH", "(", "format", "),", " -", " format", "),", " -", " 0", ",", " 0", ",", " server", "Client", ",", " &", "error", ");", " -", " if", " (!", "mask", ")", " {", " -", " Free", "Sc", "ratch", "P", "ix", "map", "Header", "(", "sc", "ratch", ");", " -", " p", "ix", "man", "_", "image", "_", "un", "ref", "(", "image", ");", " -", " return", ";", " -", " }", " -", " -", " x", "Rel", " =", " bounds", ".", "x", "1", " +", " x", "S", "rc", " -", " x", "D", "st", ";", " -", " y", "Rel", " =", " bounds", ".", "y", "1", " +", " y", "S", "rc", " -", " y", "D", "st", ";", " -", " Composite", "Picture", "(", "op", ",", " src", ",", " mask", ",", " dst", ",", " -", " x", "Rel", ",", " y", "Rel", ",", " -", " 0", ",", " 0", ",", " -", " bounds", ".", "x", "1", ",", " bounds", ".", "y", "1", ",", " -", " width", ",", " height", ");", " -", " Free", "Picture", "(", "mask", ",", " 0", ");", " -", " -", " Free", "Sc", "ratch", "P", "ix", "map", "Header", "(", "sc", "ratch", ");", " -", " p", "ix", "man", "_", "image", "_", "un", "ref", "(", "image", ");", " -", " }", " else", " {", " -", " if", " (", "d", "st", "->", "poly", "Edge", " ==", " Poly", "Edge", "Sharp", ")", " -", " mask", "Format", " =", " Picture", "Match", "Format", "(", "screen", ",", " 1", ",", " P", "ICT", "_", "a", "1", ");", " -", " else", " -", " mask", "Format", " =", " Picture", "Match", "Format", "(", "screen", ",", " 8", ",", " P", "ICT", "_", "a", "8", ");", " -", " -", " for", " (", ";", " n", "tri", ";", " n", "tri", "--", ",", " tri", "++)", " -", " glam", "or", "_", "check", "_", "tri", "angles", "(", "op", ",", " src", ",", " dst", ",", " mask", "Format", ",", " x", "S", "rc", ",", " y", "S", "rc", ",", " 1", ",", " tri", ");", " -", " }", " -", "}", " -", " -", "/**", " -", " *", " glam", "or", "_", "tri", "angles", " is", " essentially", " a", " copy", " of", " mi", "Tri", "angles", " that", " uses", " -", " *", " glam", "or", "_", "create", "_", "alpha", "_", "picture", " instead", " of", " mi", "Create", "Alpha", "Picture", ".", " -", " *", " -", " *", " The", " problem", " with", " mi", "Create", "Alpha", "Picture", " is", " that", " it", " calls", " Poly", "Fill", "Rect", " -", " *", " to", " initialize", " the", " contents", " after", " creating", " the", " p", "ix", "map", ",", " which", " -", " *", " causes", " the", " p", "ix", "map", " to", " be", " moved", " in", " for", " acceleration", ".", " The", " subsequent", " -", " *", " call", " to", " Add", "Tri", "angles", " won", "'t", " be", " accelerated", " however", ",", " which", " forces", " the", " p", "ix", "map", " -", " *", " to", " be", " moved", " out", " again", ".", " -", " *", " -", " *", " glam", "or", "_", "create", "_", "alpha", "_", "picture", " avoids", " this", " round", "trip", " by", " using", " -", " *", " glam", "or", "_", "check", "_", "poly", "_", "fill", "_", "rect", " to", " initialize", " the", " contents", ".", " -", " */", " -", "static", " void", " -", "g", "lam", "or", "_", "tri", "angles", "(", "C", "ARD", "8", " op", ",", " Picture", "Ptr", " p", "S", "rc", ",", " Picture", "Ptr", " p", "D", "st", ",", " -", " Pict", "Format", "Ptr", " mask", "Format", ",", " INT", "16", " x", "S", "rc", ",", " INT", "16", " y", "S", "rc", ",", " -", " int", " n", "tri", ",", " x", "Tri", "angle", " *", " tr", "is", ")", " -", "{", " -", " int", " ok", ";", " -", " -", " if", " (!", "g", "lam", "or", "_", "picture", "_", "prep", "are", "_", "access", "(", "p", "D", "st", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", "))", " -", " goto", " fall", "back", ";", " -", " ok", " =", " glam", "or", "_", "picture", "_", "prep", "are", "_", "access", "(", "p", "S", "rc", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ");", " -", " if", " (!", "ok", ")", " -", " goto", " finish", "_", "d", "st", ";", " -", " ok", " =", " glam", "or", "_", "tri", "angles", "_", "n", "f", "(", "op", ",", " -", " p", "S", "rc", ",", " p", "D", "st", ",", " mask", "Format", ",", " x", "S", "rc", ",", " -", " y", "S", "rc", ",", " n", "tri", ",", " tr", "is", ");", " -", " glam", "or", "_", "picture", "_", "fin", "ish", "_", "access", "(", "p", "S", "rc", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ");", " -", "fin", "ish", "_", "d", "st", ":", " -", " glam", "or", "_", "picture", "_", "fin", "ish", "_", "access", "(", "p", "D", "st", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " -", " if", " (", "ok", ")", " -", " return", ";", " -", " -", "fall", "back", ":", " -", " glam", "or", "_", "check", "_", "tri", "angles", "(", "op", ",", " p", "S", "rc", ",", " p", "D", "st", ",", " mask", "Format", ",", " -", " x", "S", "rc", ",", " y", "S", "rc", ",", " n", "tri", ",", " tr", "is", ");", " -", "}", " -", " -", "void", " -", "g", "lam", "or", "_", "add", "_", "tra", "ps", "(", "Picture", "Ptr", " p", "Picture", ",", " -", " INT", "16", " x", "_", "off", ",", " INT", "16", " y", "_", "off", ",", " int", " n", "trap", ",", " x", "T", "rap", " *", " traps", ")", " -", "{", " -", " int", " ok", ";", " -", " -", " ok", " =", " glam", "or", "_", "picture", "_", "prep", "are", "_", "access", "(", "p", "Picture", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " if", " (", "ok", ")", " {", " -", " ok", " =", " glam", "or", "_", "add", "_", "tra", "ps", "_", "n", "f", "(", "p", "Picture", ",", " -", " x", "_", "off", ",", " y", "_", "off", ",", " n", "trap", ",", " traps", ");", " -", " glam", "or", "_", "picture", "_", "fin", "ish", "_", "access", "(", "p", "Picture", ",", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", ");", " -", " }", " -", " -", " if", " (!", "ok", ")", " -", " glam", "or", "_", "check", "_", "add", "_", "tra", "ps", "(", "p", "Picture", ",", " x", "_", "off", ",", " y", "_", "off", ",", " n", "trap", ",", " traps", ");", " -", "}", " -", " -", "#", "endif", " /*", " R", "END", "ER", " */", " -", " -", " -", "/**", " -", " *", " r", "adeon", "_", "g", "lam", "or", "_", "close", "_", "screen", "()", " unw", "ra", "ps", " its", " wrapped", " screen", " functions", " and", " tears", " down", " GL", "AM", "OR", "'s", " -", " *", " screen", " private", ",", " before", " calling", " down", " to", " the", " next", " Close", "S", "cc", "reen", ".", " -", " */", " -", "static", " B", "ool", " r", "adeon", "_", "g", "lam", "or", "_", "close", "_", "screen", "(", "CLOSE", "_", "SC", "RE", "EN", "_", "AR", "GS", "_", "DEC", "L", ")", " -", "{", " -", " glam", "or", "_", "screen", "_", "t", " *", "g", "lam", "or", "_", "screen", " =", " glam", "or", "_", "get", "_", "screen", "(", "p", "Screen", ");", " -", "#", "if", "def", " R", "END", "ER", " -", " Picture", "Screen", "Ptr", " ps", " =", " Get", "Picture", "Screen", "If", "Set", "(", "p", "Screen", ");", " -", "#", "endif", " -", " -", " p", "Screen", "->", "Create", "GC", " =", " glam", "or", "_", "screen", "->", "S", "aved", "Create", "GC", ";", " -", " p", "Screen", "->", "Close", "Screen", " =", " glam", "or", "_", "screen", "->", "S", "aved", "Close", "Screen", ";", " -", " p", "Screen", "->", "Get", "Image", " =", " glam", "or", "_", "screen", "->", "S", "aved", "Get", "Image", ";", " -", " p", "Screen", "->", "Get", "Sp", "ans", " =", " glam", "or", "_", "screen", "->", "S", "aved", "Get", "Sp", "ans", ";", " -", " p", "Screen", "->", "Create", "P", "ix", "map", " =", " glam", "or", "_", "screen", "->", "S", "aved", "Create", "P", "ix", "map", ";", " -", " p", "Screen", "->", "Destroy", "P", "ix", "map", " =", " glam", "or", "_", "screen", "->", "S", "aved", "Destroy", "P", "ix", "map", ";", " -", " p", "Screen", "->", "Copy", "Window", " =", " glam", "or", "_", "screen", "->", "S", "aved", "Copy", "Window", ";", " -", " p", "Screen", "->", "Change", "Window", "Attributes", " =", " -", " glam", "or", "_", "screen", "->", "S", "aved", "Change", "Window", "Attributes", ";", " -", " p", "Screen", "->", "Bit", "map", "To", "Region", " =", " glam", "or", "_", "screen", "->", "S", "aved", "Bit", "map", "To", "Region", ";", " -", "#", "if", "def", " R", "END", "ER", " -", " if", " (", "ps", ")", " {", " -", " ps", "->", "Com", "pos", "ite", " =", " glam", "or", "_", "screen", "->", "S", "aved", "Com", "pos", "ite", ";", " -", " ps", "->", "G", "ly", "ph", "s", " =", " glam", "or", "_", "screen", "->", "S", "aved", "G", "ly", "ph", "s", ";", " -", " ps", "->", "T", "rape", "z", "oids", " =", " glam", "or", "_", "screen", "->", "S", "aved", "T", "rape", "z", "oids", ";", " -", " ps", "->", "Add", "Tra", "ps", " =", " glam", "or", "_", "screen", "->", "S", "aved", "Add", "Tra", "ps", ";", " -", " ps", "->", "Tri", "angles", " =", " glam", "or", "_", "screen", "->", "S", "aved", "Tri", "angles", ";", " -", " -", " ps", "->", "Un", "real", "ize", "G", "ly", "ph", " =", " glam", "or", "_", "screen", "->", "S", "aved", "Un", "real", "ize", "G", "ly", "ph", ";", " -", " }", " -", "#", "endif", " -", " -", " free", "(", "g", "lam", "or", "_", "screen", ");", " -", " -", " return", " (*", "p", "Screen", "->", "Close", "Screen", ")", " (", "CLOSE", "_", "SC", "RE", "EN", "_", "AR", "GS", ");", " -", "}", " -", " -", "/**", " -", " *", " @", "param", " screen", " screen", " being", " initialized", " -", " */", " -", "B", "ool", " glam", "or", "_", "screen", "_", "init", "(", "Screen", "Ptr", " screen", ")", " -", "{", " -", " glam", "or", "_", "screen", "_", "t", " *", "g", "lam", "or", "_", "screen", ";", " -", " -", "#", "if", " HAS", "_", "D", "IX", "REG", "ISTER", "PR", "IV", "ATE", "KEY", " -", " if", " (!", "d", "ix", "Register", "Private", "Key", "(&", "g", "lam", "or", "_", "screen", "_", "index", ",", " PR", "IV", "ATE", "_", "SC", "RE", "EN", ",", " 0", "))", " -", " return", " FALSE", ";", " -", "#", "endif", " -", " glam", "or", "_", "screen", " =", " call", "oc", "(", "size", "of", "(", "g", "lam", "or", "_", "screen", "_", "t", "),", " 1", ");", " -", " -", " if", " (!", "g", "lam", "or", "_", "screen", ")", " {", " -", " Log", "Message", "(", "X", "_", "WARNING", ",", " -", " \"", "GL", "AM", "OR", "(", "%", "d", "):", " Failed", " to", " allocate", " screen", " private", "\n", "\n", "\",", " -", " screen", "->", "my", "Num", ");", " -", " return", " FALSE", ";", " -", " }", " -", " -", " d", "ix", "Set", "Private", "(&", "screen", "->", "dev", "Priv", "ates", ",", " &", "g", "lam", "or", "_", "screen", "_", "index", ",", " glam", "or", "_", "screen", ");", " -", " -", " /*", " -", " *", " Replace", " various", " f", "b", " screen", " functions", " -", " */", " -", " glam", "or", "_", "screen", "->", "S", "aved", "Close", "Screen", " =", " screen", "->", "Close", "Screen", ";", " -", " screen", "->", "Close", "Screen", " =", " r", "adeon", "_", "g", "lam", "or", "_", "close", "_", "screen", ";", " -", " -", " glam", "or", "_", "screen", "->", "S", "aved", "Create", "GC", " =", " screen", "->", "Create", "GC", ";", " -", " screen", "->", "Create", "GC", " =", " r", "adeon", "_", "g", "lam", "or", "_", "create", "_", "gc", ";", " -", " -", " glam", "or", "_", "screen", "->", "S", "aved", "Get", "Image", " =", " screen", "->", "Get", "Image", ";", " -", " screen", "->", "Get", "Image", " =", " glam", "or", "_", "get", "_", "image", ";", " -", " -", " glam", "or", "_", "screen", "->", "S", "aved", "Get", "Sp", "ans", " =", " screen", "->", "Get", "Sp", "ans", ";", " -", " screen", "->", "Get", "Sp", "ans", " =", " glam", "or", "_", "get", "_", "sp", "ans", ";", " -", " -", " glam", "or", "_", "screen", "->", "S", "aved", "Create", "P", "ix", "map", " =", " screen", "->", "Create", "P", "ix", "map", ";", " -", " glam", "or", "_", "screen", "->", "S", "aved", "Destroy", "P", "ix", "map", " =", " screen", "->", "Destroy", "P", "ix", "map", ";", " -", " -", " glam", "or", "_", "screen", "->", "S", "aved", "Copy", "Window", " =", " screen", "->", "Copy", "Window", ";", " -", " screen", "->", "Copy", "Window", " =", " glam", "or", "_", "copy", "_", "window", ";", " -", " -", " glam", "or", "_", "screen", "->", "S", "aved", "Change", "Window", "Attributes", " =", " -", " screen", "->", "Change", "Window", "Attributes", ";", " -", " screen", "->", "Change", "Window", "Attributes", " =", " glam", "or", "_", "change", "_", "window", "_", "att", "ributes", ";", " -", " -", " glam", "or", "_", "screen", "->", "S", "aved", "Bit", "map", "To", "Region", " =", " screen", "->", "Bit", "map", "To", "Region", ";", " -", " screen", "->", "Bit", "map", "To", "Region", " =", " glam", "or", "_", "bit", "map", "_", "to", "_", "region", ";", " -", " -", "#", "if", "def", " R", "END", "ER", " -", " {", " -", " Picture", "Screen", "Ptr", " ps", " =", " Get", "Picture", "Screen", "If", "Set", "(", "screen", ");", " -", " if", " (", "ps", ")", " {", " -", " glam", "or", "_", "screen", "->", "S", "aved", "Com", "pos", "ite", " =", " ps", "->", "Com", "pos", "ite", ";", " -", " ps", "->", "Com", "pos", "ite", " =", " glam", "or", "_", "com", "pos", "ite", ";", " -", " -", " glam", "or", "_", "screen", "->", "S", "aved", "G", "ly", "ph", "s", " =", " ps", "->", "G", "ly", "ph", "s", ";", " -", " ps", "->", "G", "ly", "ph", "s", " =", " glam", "or", "_", "gly", "ph", "s", ";", " -", " -", " glam", "or", "_", "screen", "->", "S", "aved", "Tri", "angles", " =", " ps", "->", "Tri", "angles", ";", " -", " ps", "->", "Tri", "angles", " =", " glam", "or", "_", "tri", "angles", ";", " -", " -", " glam", "or", "_", "screen", "->", "S", "aved", "T", "rape", "z", "oids", " =", " ps", "->", "T", "rape", "z", "oids", ";", " -", " ps", "->", "T", "rape", "z", "oids", " =", " glam", "or", "_", "tra", "pez", "oids", ";", " -", " -", " glam", "or", "_", "screen", "->", "S", "aved", "Add", "Tra", "ps", " =", " ps", "->", "Add", "Tra", "ps", ";", " -", " ps", "->", "Add", "Tra", "ps", " =", " glam", "or", "_", "add", "_", "tra", "ps", ";", " -", " }", " -", " }", " -", "#", "endif", " -", " -", " return", " TRUE", ";", " -", "}", "\n", "\n", "de", "leted", " file", " mode", " 100", "644", "\n", "\n", "index", " 53", "ce", "969", "..", "0000000", "\n", "\n", "---", " a", "/", "\n", "\n", "+++", " /", "dev", "/", "null", " diff", " --", "git", " a", "/", "src", "/", "r", "adeon", "_", "g", "lam", "or", "_", "wra", "ppers", ".", "h", " b", "/", "src", "/", "r", "adeon", "_", "g", "lam", "or", "_", "wra", "ppers", ".", "h", "de", "leted", " file", " mode", " 100", "644", "index", " 53", "ce", "969", "..", "0000000", "---", " a", "/", " src", "/", "r", "adeon", "_", "g", "lam", "or", "_", "wra", "ppers", ".", "h", " +++", " /", "dev", "/", "null", " @@", " -", "1", ",", "178", " +", "0", ",", "0", " @@", " -", "/*", " -", " *", " Copyright", " \u00a9", " 2000", ",", "2008", " Keith", " Pack", "ard", " -", " *", " 2004", " Eric", " An", "hol", "t", " -", " *", " 2005", " Zack", " Rus", "in", ",", " Troll", "tech", " -", " *", " 2012", " Advanced", " Micro", " Devices", ",", " Inc", ".", " -", " *", " -", " *", " Per", "mission", " to", " use", ",", " copy", ",", " modify", ",", " distribute", ",", " and", " sell", " this", " software", " and", " its", " -", " *", " documentation", " for", " any", " purpose", " is", " hereby", " granted", " without", " fee", ",", " provided", " that", " -", " *", " the", " above", " copyright", " notice", " appear", " in", " all", " copies", " and", " that", " both", " that", " -", " *", " copyright", " notice", " and", " this", " permission", " notice", " appear", " in", " supporting", " -", " *", " documentation", ",", " and", " that", " the", " name", " of", " The", " copyright", " holders", " not", " be", " used", " in", " -", " *", " advertising", " or", " publicity", " pertaining", " to", " distribution", " of", " the", " software", " without", " -", " *", " specific", ",", " written", " prior", " permission", ".", " The", " copyright", " holders", " make", " no", " -", " *", " representations", " about", " the", " suit", "ability", " of", " this", " software", " for", " any", " purpose", ".", " It", " -", " *", " is", " provided", " \"", "as", " is", "\"", " without", " express", " or", " implied", " warranty", ".", " -", " *", " -", " *", " THE", " COP", "YR", "IGHT", " H", "OLD", "ERS", " DIS", "CLAIM", " ALL", " WARRANT", "IES", " WITH", " REG", "ARD", " TO", " THIS", " -", " *", " SOFTWARE", ",", " INCLUD", "ING", " ALL", " IM", "PLIED", " WARRANT", "IES", " OF", " MER", "CH", "AN", "TA", "BILITY", " AND", " -", " *", " F", "ITNESS", ",", " IN", " NO", " EVENT", " SHALL", " THE", " COP", "YR", "IGHT", " H", "OLD", "ERS", " BE", " LIA", "BLE", " FOR", " ANY", " -", " *", " SPECIAL", ",", " IN", "DI", "RECT", " OR", " CON", "SE", "QU", "ENT", "IAL", " DAM", "AGES", " OR", " ANY", " DAM", "AGES", " -", " *", " WHAT", "SO", "E", "VER", " RES", "ULT", "ING", " FROM", " L", "OSS", " OF", " USE", ",", " DATA", " OR", " PR", "OF", "ITS", ",", " WH", "ET", "HER", " IN", " -", " *", " AN", " ACTION", " OF", " CONTR", "ACT", ",", " N", "EG", "L", "IG", "ENCE", " OR", " OTHER", " T", "ORT", "I", "OUS", " ACTION", ",", " AR", "IS", "ING", " -", " *", " OUT", " OF", " OR", " IN", " CON", "N", "ECTION", " WITH", " THE", " USE", " OR", " PER", "FOR", "MAN", "CE", " OF", " THIS", " -", " *", " SOFTWARE", ".", " -", " */", " -", " -", "#", "if", "nd", "ef", " R", "ADE", "ON", "_", "GL", "AM", "OR", "_", "WR", "APP", "ERS", "_", "H", " -", "#", "define", " R", "ADE", "ON", "_", "GL", "AM", "OR", "_", "WR", "APP", "ERS", "_", "H", " -", " -", "#", "if", "def", " HAVE", "_", "CON", "FIG", "_", "H", " -", "#", "include", " <", "config", ".", "h", ">", " -", "#", "endif", " -", "#", "if", "def", " HAVE", "_", "D", "IX", "_", "CON", "FIG", "_", "H", " -", "#", "include", " <", "d", "ix", "-", "config", ".", "h", ">", " -", "#", "endif", " -", "#", "include", " <", "x", "org", "-", "server", ".", "h", ">", " -", "#", "include", " \"", "xf", "86", ".", "h", "\"", " -", " -", "#", "include", " <", "X", "11", "/", "X", ".", "h", ">", " -", "#", "include", " <", "X", "11", "/", "X", "pro", "to", ".", "h", ">", " -", "#", "include", " \"", "sc", "rn", "int", "str", ".", "h", "\"", " -", "#", "include", " \"", "p", "ix", "map", "str", ".", "h", "\"", " -", "#", "include", " \"", "window", "str", ".", "h", "\"", " -", "#", "include", " \"", "server", "md", ".", "h", "\"", " -", "#", "include", " \"", "col", "orm", "ap", "st", ".", "h", "\"", " -", "#", "include", " \"", "gc", "struct", ".", "h", "\"", " -", "#", "include", " \"", "input", ".", "h", "\"", " -", "#", "include", " \"", "m", "ip", "o", "inter", ".", "h", "\"", " -", "#", "include", " \"", "mi", ".", "h", "\"", " -", "#", "include", " \"", "d", "ix", ".", "h", "\"", " -", "#", "include", " \"", "fb", ".", "h", "\"", " -", "#", "include", " \"", "f", "bo", "ver", "lay", ".", "h", "\"", " -", "#", "if", "def", " R", "END", "ER", " -", "//", "#", "include", " \"", "fb", "pict", ".", "h", "\"", " -", "#", "include", " \"", "gly", "ph", "str", ".", "h", "\"", " -", "#", "include", " \"", "picture", "str", ".", "h", "\"", " -", "#", "endif", " -", "#", "include", " \"", "damage", ".", "h", "\"", " -", " -", "#", "include", " \"", "../", "src", "/", "comp", "at", "-", "api", ".", "h", "\"", " -", " -", "/*", " Provide", " substitutes", " for", " gcc", "'s", " __", "FUN", "CT", "ION", "__", " on", " other", " comp", "ilers", " */", " -", "#", "if", "!", "defined", "(", "__", "GN", "UC", "__", ")", " &&", "!", "defined", "(", "__", "FUN", "CT", "ION", "__", ")", " -", "#", " if", " defined", "(", "__", "ST", "DC", "__", ")", " &&", " (", "__", "ST", "DC", "_", "VERSION", "__", ">", "=", "1999", "01", "L", ")", " /*", " C", "99", " */", " -", "#", " define", " __", "FUN", "CT", "ION", "__", " __", "func", "__", " -", "#", " else", " -", "#", " define", " __", "FUN", "CT", "ION", "__", " \"\"", " -", "#", " endif", " -", "#", "endif", " -", " -", "/*", " 1", ".", "6", " and", " earlier", " server", " compat", " */", " -", "#", "if", "nd", "ef", " mi", "Get", "Com", "pos", "ite", "Cl", "ip", " -", "#", "define", " mi", "Copy", "Region", " f", "b", "Copy", "Region", " -", "#", "define", " mi", "Do", "Copy", " f", "b", "Do", "Copy", " -", "#", "endif", " -", " -", "ty", "ped", "ef", " enum", " {", " -", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RO", ",", " -", " GL", "AM", "OR", "_", "CPU", "_", "ACC", "ESS", "_", "RW", ",", " -", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RO", ",", " -", " GL", "AM", "OR", "_", "GPU", "_", "ACC", "ESS", "_", "RW", " -", "}", " glam", "or", "_", "access", "_", "t", ";", " -", " -", "#", "include", " \"", "r", "adeon", ".", "h", "\"", " -", "#", "include", " \"", "g", "lam", "or", ".", "h", "\"", " -", " -", " -", "B", "ool", " glam", "or", "_", "screen", "_", "init", "(", "Screen", "Ptr", " screen", ");", " -", " -", "void", " glam", "or", "_", "set", "_", "fall", "back", "_", "debug", "(", "Screen", "Ptr", " screen", ",", " B", "ool", " enable", ");", " -", " -", "#", "define", " DEBUG", "_", "M", "IG", "R", "ATE", " 0", " -", "#", "define", " DEBUG", "_", "P", "IX", "MAP", " 0", " -", "#", "define", " DEBUG", "_", "OFF", "SC", "RE", "EN", " 0", " -", "#", "define", " DEBUG", "_", "GL", "Y", "PH", "_", "C", "AC", "HE", " 0", " -", " -", "#", "define", " GL", "AM", "OR", "_", "F", "ALL", "BACK", "(", "x", ")", " \\", " -", "if", " (", "g", "lam", "or", "_", "get", "_", "screen", "(", "screen", ")", "->", "fall", "back", "_", "debug", ")", " {", " \\", " -", " Error", "F", "(\"", "GL", "AM", "OR", " fall", "back", " at", " %", "s", ":", " \",", " __", "FUN", "CT", "ION", "__", ");", " \\", " -", " Error", "F", " x", ";", " \\", " -", "}", " -", " -", "#", "if", " DEBUG", "_", "P", "IX", "MAP", " -", "#", "define", " DB", "G", "_", "P", "IX", "MAP", "(", "a", ")", " Error", "F", " a", " -", "#", "else", " -", "#", "define", " DB", "G", "_", "P", "IX", "MAP", "(", "a", ")", " -", "#", "endif", " -", " -", "ty", "ped", "ef", " void", " (*", "Enable", "Disable", "F", "BA", "ccess", "Pro", "c", "Ptr", ")", " (", "int", ",", " B", "ool", ");", " -", "ty", "ped", "ef", " struct", " {", " -", " Create", "GC", "Pro", "c", "Ptr", " Sav", "ed", "Create", "GC", ";", " -", " Close", "Screen", "Pro", "c", "Ptr", " Sav", "ed", "Close", "Screen", ";", " -", " Get", "Image", "Pro", "c", "Ptr", " Sav", "ed", "Get", "Image", ";", " -", " Get", "Sp", "ans", "Pro", "c", "Ptr", " Sav", "ed", "Get", "Sp", "ans", ";", " -", " Create", "P", "ix", "map", "Pro", "c", "Ptr", " Sav", "ed", "Create", "P", "ix", "map", ";", " -", " Destroy", "P", "ix", "map", "Pro", "c", "Ptr", " Sav", "ed", "Destroy", "P", "ix", "map", ";", " -", " Copy", "Window", "Pro", "c", "Ptr", " Sav", "ed", "Copy", "Window", ";", " -", " Change", "Window", "Attributes", "Pro", "c", "Ptr", " Sav", "ed", "Change", "Window", "Attributes", ";", " -", " Bit", "map", "To", "Region", "Pro", "c", "Ptr", " Sav", "ed", "Bit", "map", "To", "Region", ";", " -", "#", "if", "def", " R", "END", "ER", " -", " Composite", "Pro", "c", "Ptr", " Sav", "ed", "Com", "pos", "ite", ";", " -", " Tri", "angles", "Pro", "c", "Ptr", " Sav", "ed", "Tri", "angles", ";", " -", " Gly", "ph", "s", "Pro", "c", "Ptr", " Sav", "ed", "G", "ly", "ph", "s", ";", " -", " Tra", "pez", "oids", "Pro", "c", "Ptr", " Sav", "ed", "T", "rape", "z", "oids", ";", " -", " Add", "Tra", "ps", "Pro", "c", "Ptr", " Sav", "ed", "Add", "Tra", "ps", ";", " -", " Unreal", "ize", "G", "ly", "ph", "Pro", "c", "Ptr", " Sav", "ed", "Un", "real", "ize", "G", "ly", "ph", ";", " -", "#", "endif", " -", " -", " B", "ool", " fall", "back", "_", "debug", ";", " -", "}", " glam", "or", "_", "screen", "_", "t", ";", " -", " -", "/*", " -", " *", " This", " is", " the", " only", " completely", " portable", " way", " to", " -", " *", " compute", " this", " info", ".", " -", " */", " -", "#", "if", "nd", "ef", " Bits", "Per", "Pixel", " -", "#", "define", " Bits", "Per", "Pixel", "(", "d", ")", " (", "\\", " -", " Pix", "map", "Width", "P", "adding", "Info", "[", "d", "].", "not", "Power", "2", "?", " \\", " -", " (", "P", "ix", "map", "Width", "P", "adding", "Info", "[", "d", "].", "bytes", "Per", "Pixel", " *", " 8", ")", " :", " \\", " -", " ((", "1", " <<", " Pix", "map", "Width", "P", "adding", "Info", "[", "d", "].", "pad", "Bytes", "Log", "2", ")", " *", " 8", " /", " \\", " -", " (", "P", "ix", "map", "Width", "P", "adding", "Info", "[", "d", "].", "pad", "Round", "Up", "+", "1", ")))", " -", "#", "endif", " -", " -", "#", "if", " HAS", "_", "DEV", "PR", "IV", "ATE", "KEY", "REC", " -", "ex", "tern", " Dev", "Private", "Key", "Rec", " glam", "or", "_", "screen", "_", "index", ";", " -", "#", "else", " -", "ex", "tern", " int", " glam", "or", "_", "screen", "_", "index", ";", " -", "#", "endif", " -", " -", "static", " inline", " glam", "or", "_", "screen", "_", "t", " *", "g", "lam", "or", "_", "get", "_", "screen", "(", "Screen", "Ptr", " screen", ")", " -", "{", " -", "#", "if", " HAS", "_", "DEV", "PR", "IV", "ATE", "KEY", "REC", " -", " return", " d", "ix", "Get", "Private", "(&", "screen", "->", "dev", "Priv", "ates", ",", " &", "g", "lam", "or", "_", "screen", "_", "index", ");", " -", "#", "else", " -", " return", " d", "ix", "Look", "up", "Private", "(&", "screen", "->", "dev", "Priv", "ates", ",", " &", "g", "lam", "or", "_", "screen", "_", "index", ");", " -", "#", "endif", " -", "}", " -", " -", "#", "if", "def", " R", "END", "ER", " -", " -", "/*", " XXX", " these", " are", " in", " f", "b", "pict", ".", "h", ",", " which", " is", " not", " installed", " */", " -", "void", " -", "fb", "Com", "pos", "ite", "(", "C", "ARD", "8", " op", ",", " -", " Picture", "Ptr", " p", "S", "rc", ",", " -", " Picture", "Ptr", " p", "Mask", ",", " -", " Picture", "Ptr", " p", "D", "st", ",", " -", " INT", "16", " x", "S", "rc", ",", " -", " INT", "16", " y", "S", "rc", ",", " -", " INT", "16", " x", "Mask", ",", " -", " INT", "16", " y", "Mask", ",", " INT", "16", " x", "D", "st", ",", " INT", "16", " y", "D", "st", ",", " CARD", "16", " width", ",", " CARD", "16", " height", ");", " -", " -", "void", " -", "fb", "Add", "Tra", "ps", "(", "Picture", "Ptr", " p", "Picture", ",", " -", " INT", "16", " x", "Off", ",", " INT", "16", " y", "Off", ",", " int", " n", "trap", ",", " x", "T", "rap", " *", " traps", ");", " -", " -", "#", "endif", " -", " -", "#", "endif", " /*", " R", "ADE", "ON", "_", "GL", "AM", "OR", "_", "WR", "APP", "ERS", "_", "H", " */"]