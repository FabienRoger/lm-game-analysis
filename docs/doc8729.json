["Using", " anonymous", " classes", " to", " write", " simpler", " tests", " 15", " January", " 2017", " -", " Matth", "ieu", " Nap", "oli", "\n", "\n", "Anonymous", " classes", " were", " added", " to", " PHP", " 7", ".", " This", " article", " intends", " to", " show", " how", " useful", " they", " can", " be", " for", " writing", " tests", ".", "\n", "\n", "M", "ocks", "\n", "\n", "Imagine", " the", " following", " interface", ":", "\n", "\n", "interface", " Ur", "l", "Gener", "ator", " {", " public", " function", " generate", "Url", "($", "route", ");", " }", "\n", "\n", "If", " you", " are", " testing", " a", " class", " that", " depends", " on", " a", " Ur", "l", "Gener", "ator", " implementation", ",", " you", " can", " write", " an", " anonymous", " class", " to", " implement", " this", " on", " the", " fly", ":", "\n", "\n", "class", " My", "Test", " extends", " Test", "Case", " {", " public", " function", " test", "Something", "()", " {", " $", "url", "Gener", "ator", " =", " new", " class", "()", " implements", " Ur", "l", "Gener", "ator", " {", " public", " function", " generate", "Url", "($", "route", ")", " {", " return", " ''", ";", " }", " };", " $", "foo", " =", " new", " Foo", "($", "url", "Gener", "ator", ");", " //", "...", " }", " }", "\n", "\n", "In", " the", " example", " above", " we", " have", " written", " a", " very", " dumb", " implementation", ".", " That", "'s", " often", " useful", " when", " the", " mock", " will", " not", " be", " used", " or", " its", " behavior", " isn", "'t", " important", " for", " the", " use", " case", " we", " are", " testing", ".", "\n", "\n", "Sp", "ies", "\n", "\n", "If", " we", " wanted", " to", " spy", " on", " inv", "ocations", " of", " the", " mock", ",", " it", "'s", " trivial", " as", " well", ":", "\n", "\n", "public", " function", " test", "()", " {", " $", "url", "Gener", "ator", " =", " new", " class", "()", " implements", " Ur", "l", "Gener", "ator", " {", " public", " $", "route", "To", "Gener", "ate", ";", " public", " function", " generate", "Url", "($", "route", ")", " {", " $", "this", "->", "route", "To", "Gener", "ate", " =", " $", "route", ";", " return", " ''", ";", " }", " };", " $", "foo", " =", " new", " Foo", "($", "url", "Gener", "ator", ");", " //", "...", " self", "::", "assert", "Equ", "als", "('", "ab", "cd", "',", " $", "url", "Gener", "ator", "->", "route", "To", "Gener", "ate", ");", " }", "\n", "\n", "Depending", " on", " the", " scenario", ",", " writing", " m", "ocks", " or", " spies", " using", " anonymous", " classes", " can", " be", " a", " bit", " more", " verb", "ose", " than", " using", " a", " mocking", " framework", " (", "like", " PHP", "Unit", ",", " Ph", "p", "Spec", ",", " \u2026", "),", " so", " it", "'s", " not", " a", " silver", " bullet", ".", " However", " it", "'s", " worth", " keeping", " in", " mind", " that", " vanilla", " PHP", " code", " is", " often", " easier", " to", " understand", " and", " debug", " than", " a", " mocking", " framework", ".", "\n", "\n", "F", "ixture", " classes", "\n", "\n", "Sometimes", " when", " writing", " tests", ",", " you", " need", " fixture", " data", ".", " But", " in", " some", " cases", " you", " need", " fixture", " classes", ".", " That", " can", " happen", " when", " testing", " tools", " that", " use", " reflection", " (", "I", "'ve", " faced", " that", " a", " lot", " with", " PHP", "-", "DI", " for", " example", ").", "\n", "\n", "Writing", " 5", "-", "10", " fixture", " classes", " is", " verb", "ose", ",", " boring", " and", " more", " importantly", " it", " makes", " tests", " very", " hard", " to", " read", ":", " you", " have", " to", " jump", " between", " separate", " files", " to", " retrieve", " and", " understand", " the", " fixture", " classes", ".", "\n", "\n", "Here", " is", " an", " example", " of", " a", " test", " relying", " on", " fixture", " classes", ":", "\n", "\n", "class", " Some", "D", "epend", "ency", "In", "jection", "Container", "Test", " extends", " Test", "Case", " {", " public", " function", " test", "Something", "()", " {", " $", "container", " =", " new", " Container", "();", " $", "obj", " =", " $", "container", "->", "get", "(", "Class", "1", "::", "class", ");", " self", "::", "assert", "Instance", "Of", "(", "Class", "1", "::", "class", ",", " $", "obj", ");", " self", "::", "assert", "Not", "Instance", "Of", "(", "Class", "2", "::", "class", ",", " $", "obj", ");", " }", " }", " class", " Class", "1", " {", " }", " class", " Class", "2", " {", " }", "\n", "\n", "Class", "1", " and", " Class", "2", " and", " \"", "f", "ixture", " classes", "\",", " i", ".", "e", ".", " those", " are", " classes", " written", " only", " for", " tests", ".", " You", " can", " put", " them", " inside", " the", " file", " containing", " the", " test", " class", " (", "but", " it", "'s", " not", " PS", "R", "-", "4", " compliant", " and", " it", " leads", " to", " conflicts", " if", " you", " have", " similar", " classes", " in", " other", " files", " of", " the", " same", " namespace", "),", " or", " in", " separate", " files", " (", "but", " then", " it", "'s", " very", " hard", " to", " keep", " a", " track", " of", " which", " test", " uses", " which", " fixture", " class", ").", "\n", "\n", "Here", " is", " an", " alternative", " written", " using", " anonymous", " classes", ":", "\n", "\n", "class", " Some", "D", "epend", "ency", "In", "jection", "Container", "Test", " extends", " Test", "Case", " {", " public", " function", " test", "Something", "()", " {", " //", " We", " create", " 2", " fake", " classes", " on", " the", " fly", " $", "class", "1", " =", " get", "_", "class", "(", "new", " class", "()", " {", "});", " $", "class", "2", " =", " get", "_", "class", "(", "new", " class", "()", " {", "});", " $", "container", " =", " new", " Container", "();", " $", "obj", " =", " $", "container", "->", "get", "($", "class", "1", ");", " self", "::", "assert", "Instance", "Of", "($", "class", "1", ",", " $", "obj", ");", " self", "::", "assert", "Not", "Instance", "Of", "($", "class", "2", ",", " $", "obj", ");", " }", " }", "\n", "\n", "Don", "'t", " let", " get", "_", "class", "(", "new", " class", "()", " {", "});", " confuse", " you", ",", " it", " simply", " allows", " us", " to", " declare", " a", " new", " class", " and", " get", " its", " name", ".", " It", "'s", " the", " same", " as", " doing", " this", ":", "\n", "\n", "class", " Ab", "cd", " {", " }", " $", "obj", " =", " new", " Ab", "cd", "();", " $", "class", "Name", " =", " get", "_", "class", "($", "obj", ");", "\n", "\n", "With", " this", " solution", " fixture", " classes", " are", " declared", " inside", " the", " test", ",", " which", " means", " you", " only", " need", " to", " read", " the", " test", " method", " to", " understand", " the", " test", " entirely", ".", "\n", "\n", "The", " obvious", " downside", " is", " that", " you", " need", " to", " understand", " the", " concept", " of", " anonymous", " classes", ",", " which", " isn", "'t", " very", " widespread", " today", " in", " PHP", ".", " But", " like", " all", " new", " language", " feature", ",", " with", " time", " it", " should", " be", " more", " and", " more", " familiar", " to", " everyone", "."]