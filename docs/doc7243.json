["(", "This", " article", " has", " been", " translated", " into", " Russian", " by", " Every", "cloud", "tech", "\u2014", "thanks", "!)", "\n", "\n", "I", " have", " a", " hilar", "iously", " unfinished", " Python", " module", " I", " work", " on", " from", " time", " to", " time", " named", " san", "per", "a", ".", " It", "\ufffd", "\ufffd", "s", " an", " imaging", " library", " for", " Python", ",", " with", " the", " vain", " hope", " that", " it", " might", " replace", " P", "IL", " someday", ".", " But", " this", " isn", "\ufffd", "\ufffd", "t", " about", " san", "per", "a", ".", "\n", "\n", "san", "per", "a", " happens", " to", " be", " powered", " by", " Image", "Mag", "ick", ".", " I", " distinguish", " this", " from", " being", " an", " \ufffd", "\ufffd", "Image", "Mag", "ick", " wrapper", "\ufffd", "\ufffd", ",", " as", " it", " explicitly", " has", " nothing", " resembling", " the", " Image", "Mag", "ick", " API", ",", " because", " said", " API", " is", " insane", ".", " But", " this", " isn", "\ufffd", "\ufffd", "t", " about", " Image", "Mag", "ick", ",", " either", ".", "\n", "\n", "Using", " Image", "Mag", "ick", " requires", " binding", " Python", " to", " C", ",", " and", " that", "\ufffd", "\ufffd", "s", " what", " this", " is", " about", ".", " There", " are", " several", " ways", " to", " use", " C", " libraries", " from", " Python", ":", "\n", "\n", "Writing", " an", " extension", " module", " means", " the", " Python", " API", " is", " defined", " in", " C", ",", " so", " the", " library", " is", " used", " exactly", " as", " it", " was", " intended", ":", " with", " C", " code", ".", " Unfortunately", " this", " requires", " writing", " a", " lot", " of", " C", ",", " as", " well", " as", " a", " lot", " of", " careful", " Python", " ref", "count", "ing", ".", " My", " C", " is", " pass", "able", ",", " but", " I", "\ufffd", "\ufffd", "ve", " done", " far", " more", " reading", " it", " than", " writing", " it", ",", " so", " this", " is", " not", " an", " appealing", " option", ".", "\n", "\n", "ct", "ypes", " is", " a", " standard", "-", "library", " module", " that", " can", " load", " shared", " libraries", " and", " call", " functions", " from", " them", " without", " the", " use", " of", " a", " C", " compiler", " or", " any", " new", " C", " code", ".", " Con", "venient", ",", " especially", " if", " you", " hate", " dependencies", " (", "in", " which", " case", " why", " are", " you", " binding", " to", " C", "?),", " but", " all", " the", " c", "types", "-", "powered", " code", " I", "\ufffd", "\ufffd", "ve", " read", " has", " been", " tedious", " and", " f", "idd", "ly", " and", " ugly", ".", "\n", "\n", "C", "ython", ",", " a", " spiritual", " port", "/", "ev", "olution", "/", "fork", "/", "something", " of", " the", " older", " Py", "rex", ",", " is", " a", " language", " similar", " to", " Python", " that", " translates", " to", " C", " and", " then", " comp", "iles", " into", " an", " extension", " module", ".", " C", "ython", " code", " can", " define", " Python", " classes", " and", " functions", ",", " but", " also", " call", " C", " functions", " and", " perform", " other", " C", " operations", " directly", ".", " Code", " with", " C", " semantics", " is", " translated", " fairly", " directly", " to", " C", ";", " code", " with", " Python", " semantics", " is", " translated", " to", " appropriate", " use", " of", " the", " CP", "ython", " API", ";", " and", " C", "ython", " fills", " in", " all", " the", " bits", " to", " translate", " between", " the", " two", ".", "\n", "\n", "I", " went", " with", " C", "ython", " because", " it", " looked", " interesting", ",", " it", " seemed", " to", " reduce", " the", " number", " of", " translation", " layers", " I", "\ufffd", "\ufffd", "d", " have", " to", " care", " about", ",", " and", " it", " would", " even", " let", " me", " write", " hot", " loops", " (", "this", " is", " an", " imaging", " library", ")", " in", " C", " without", " actually", " writing", " any", " C", ".", " Plus", ",", " since", " it", "\ufffd", "\ufffd", "s", " not", " actually", " Python", " code", ",", " it", " can", " compile", " to", " both", " Python", " 2", " and", " Python", " 3", " extension", " modules", " with", " very", " little", " effort", " on", " my", " part", ".", "\n", "\n", "Here", "\ufffd", "\ufffd", "s", " what", " C", "ython", " looks", " like", ":", "\n", "\n", "1", " 2", " 3", " 4", " 5", " 6", " 7", " 8", " 9", " 10", " 11", " 12", " 13", " 14", " 15", " 16", " 17", " 18", " 19", " 20", " 21", " 22", " 23", " 24", " 25", " 26", " 27", " 28", " 29", " 30", " @", "class", "method", " def", " read", " (", " type", " cl", "s", ",", " bytes", " filename", " not", " None", " ):", " c", "def", " lib", "c", ".", " std", "io", ".", " FILE", " *", " f", "h", " =", " lib", "c", ".", " std", "io", ".", " f", "open", " (", " <", " char", " *", ">", " filename", ",", " \"", "rb", "\"", " )", " if", " f", "h", " ==", " NULL", " :", " c", "python", ".", " exc", ".", " Py", "Er", "r", "_", "Set", "From", "Er", "r", "no", "With", "Filename", " (", " IO", "Error", ",", " filename", " )", " c", "def", " c", "_", "api", ".", " Image", "Info", " *", " image", "_", "info", " =", " c", "_", "api", ".", " Clone", "Image", "Info", " (", " NULL", " )", " c", "def", " Mag", "ick", "Exception", " exc", " =", " Mag", "ick", "Exception", " ()", " c", "def", " int", " ret", " c", "def", " Image", " self", " =", " cl", "s", " ()", " try", " :", " #", " Force", " reading", " from", " this", " file", " descriptor", " image", "_", "info", ".", " file", " =", " f", "h", " self", ".", " _", "stack", " =", " c", "_", "api", ".", " Read", "Image", " (", " image", "_", "info", ",", " exc", ".", " ptr", " )", " exc", ".", " check", " ()", " #", " Blank", " out", " the", " filename", " so", " IM", " doesn", "'t", " try", " to", " write", " to", " it", " later", " self", ".", " _", "stack", ".", " filename", " [", " 0", " ]", " =", " <", " char", " >", " 0", " finally", " :", " c", "_", "api", ".", " Destroy", "Image", "Info", " (", " image", "_", "info", " )", " ret", " =", " lib", "c", ".", " std", "io", ".", " f", "close", " (", " f", "h", " )", " if", " ret", "!=", " 0", " :", " c", "python", ".", " exc", ".", " Py", "Er", "r", "_", "Set", "From", "Er", "r", "no", "With", "Filename", " (", " IO", "Error", ",", " filename", " )", " self", ".", " _", "post", "_", "init", " ()", " return", " self", "\n", "\n", "(", "Wow", ",", " it", "\ufffd", "\ufffd", "s", " even", " syntax", "-", "high", "light", "ed", ".", " Imp", "ressive", ".)", "\n", "\n", "Clearly", " Python", "-", "inspired", ",", " with", " C", " bits", " sprinkled", " around", ".", " c", "def", " for", " a", " statically", "-", "ty", "ped", " variable", " declaration", ",", " static", " types", " on", " function", " arguments", ",", " comparisons", " to", " NULL", ",", " brief", " dipping", " into", " the", " Python", " C", " API", " when", " useful", ".", " Certainly", " easier", " than", " writing", " plain", " C", ",", " especially", " when", " dealing", " with", " Image", "Mag", "ick", "\ufffd", "\ufffd", "s", "\u2026", " idiosyncr", "acies", ".", " But", " I", " can", "\ufffd", "\ufffd", "t", " easily", " use", " some", " features", " like", " with", ",", " and", " so", " my", " code", " is", " sprinkled", " with", " pointer", "-", "free", "ing", " finally", " s", " and", " manual", " conversion", " of", " Image", "Mag", "ick", " exceptions", " into", " Python", " ones", ".", "\n", "\n", "This", " was", " all", " well", " and", " good", ",", " and", " I", " tin", "kered", " with", " the", " library", " every", " so", " often", ",", " wrestling", " the", " underlying", " API", " more", " than", " getting", " many", " features", " implemented", ".", "\n", "\n", "Then", " Py", "Py", " started", " to", " gain", " in", " popularity", ".", " Py", "Py", " didn", "\ufffd", "\ufffd", "t", " originally", " have", " a", " C", " API", ",", " being", " not", " written", " in", " C", " and", " all", ".", " More", " recent", " releases", " have", " a", " C", " API", " emulation", " layer", ",", " and", " C", "ython", " even", " has", " support", " for", " targeting", " it", ",", " but", " it", "\ufffd", "\ufffd", "s", " full", " of", " caveats", " that", " do", " not", " fill", " me", " with", " confidence", ".", " I", " do", " like", " Py", "Py", ",", " and", " not", " supporting", " it", " would", " be", " a", " shame", ",", " but", " navigating", " the", " quirks", " of", " two", " different", " memory", " models", " is", " exactly", " the", " kind", " of", " thing", " I", " was", " trying", " to", " avoid", " by", " using", " C", "ython", " in", " the", " first", " place", ".", "\n", "\n", "L", "ucky", " for", " me", ",", " several", " Py", "Py", " fans", " strongly", " advised", " that", " I", " port", " to", " C", "FF", "I", ".", " This", " is", " yet", " another", " way", " to", " bind", " to", " C", " libraries", ",", " with", " an", " interface", " borrowed", " from", " Lua", ",", " which", " sure", " sounds", " impressive", " to", " me", ".", " It", "\ufffd", "\ufffd", "s", " based", " on", " the", " same", " underlying", " library", " (", "lib", "ff", "i", ")", " as", " c", "types", ",", " but", " is", " more", " am", "enable", " to", " Py", "Py", " for", " reasons", " beyond", " my", " comprehension", ",", " and", " gets", " its", " C", " interface", " definitions", " by", " parsing", " C", " header", " files", " so", " I", " don", "\ufffd", "\ufffd", "t", " have", " to", " translate", " them", " all", " to", " pretty", " cl", "unky", " Python", ".", "\n", "\n", "That", " sounded", " like", " a", " whole", " lot", " of", " work", ",", " but", " I", " didn", "\ufffd", "\ufffd", "t", " want", " to", " write", " more", " C", "ython", " code", " that", " I", " might", " be", " port", "ing", " later", ",", " so", " I", " avoided", " working", " on", " san", "per", "a", " at", " all", " for", " a", " while", ".", " Until", " I", " finally", " sat", " down", " and", " gave", " C", "FF", "I", " a", " wh", "irl", " over", " the", " past", " few", " days", ".", "\n", "\n", "1", " 2", " 3", " 4", " 5", " 6", " 7", " 8", " 9", " 10", " 11", " 12", " 13", " @", "class", "method", " def", " read", " (", " cl", "s", ",", " filename", " ):", " with", " open", " (", " filename", ",", " \"", "rb", "\"", " )", " as", " f", "h", " :", " image", "_", "info", " =", " blank", "_", "image", "_", "info", " ()", " image", "_", "info", ".", " file", " =", " f", "fi", ".", " cast", " (", " \"", "FILE", " *", "\"", ",", " f", "h", " )", " with", " mag", "ick", "_", "try", " ()", " as", " exc", " :", " ptr", " =", " f", "fi", ".", " g", "c", " (", " lib", ".", " Read", "Image", " (", " image", "_", "info", ",", " exc", ".", " ptr", " ),", " lib", ".", " Destroy", "Image", "List", " )", " exc", ".", " check", " (", " ptr", " ==", " f", "fi", ".", " NULL", " )", " return", " cl", "s", " (", " ptr", " )", "\n", "\n", "Which", " brings", " me", " to", " what", " this", " post", " is", " actually", " about", ":", " my", " experience", " port", "ing", " a", " modest", " amount", " of", " C", "ython", " to", " C", "FF", "I", ".", "\n", "\n", "You", " can", " eyeb", "all", "-", "diff", " the", " C", "ython", " and", " C", "FF", "I", " implementations", " above", " to", " get", " an", " idea", " of", " what", " was", " involved", ".", " For", " the", " most", " part", " this", " was", " a", " matter", " of", " ted", "iously", " and", " mechanically", " removing", " c", "def", " and", " type", " annotations", ",", " copying", " the", " C", " function", " definitions", " from", " the", " original", " headers", " into", " a", " file", " for", " C", "FF", "I", " to", " parse", ",", " and", " replacing", " the", " reference", " to", " c", "_", "api", " with", " the", " new", " lib", " object", " C", "FF", "I", " sp", "its", " out", ".", "\n", "\n", "I", " actually", " did", " this", " one", " module", " at", " a", " time", ",", " with", " moderate", " success", ";", " my", " C", "ython", " code", " mostly", " interacted", " by", " going", " through", " Python", " interfaces", ",", " which", " continued", " to", " work", " fine", " after", " those", " Python", " interfaces", " were", " ported", " to", " C", "FF", "I", ".", " And", " of", " course", " it", "\ufffd", "\ufffd", "s", " all", " using", " the", " same", " library", " in", " the", " same", " process", ",", " so", " the", " library", " doesn", "\ufffd", "\ufffd", "t", " know", " or", " care", " about", " my", " hybrid", " mon", "stros", "ity", " sitting", " above", " it", ".", "\n", "\n", "There", " were", " a", " few", " places", " that", " took", " more", " effort", ",", " and", " this", " is", " where", " C", "FF", "I", " started", " to", " shine", ".", " Notice", " that", " the", " try", " /", " finally", " is", " completely", " gone", " in", " the", " above", " code", ";", " it", "\ufffd", "\ufffd", "s", " been", " replaced", " by", " f", "fi", ".", "gc", ",", " which", " adds", " a", " little", " Python", "-", "land", " wrapper", " to", " a", " C", " pointer", " and", " gives", " it", " a", " destruct", "or", ".", " When", " the", " wrapper", " is", " destroyed", ",", " the", " pointer", " is", " freed", ".", " Of", " course", ",", " in", " the", " non", "-", "ref", "count", "ed", " land", " of", " Py", "Py", " that", " I", "\ufffd", "\ufffd", "m", " actually", " trying", " to", " port", " to", ",", " it", "\ufffd", "\ufffd", "s", " completely", " arbitrary", " when", " this", " actually", " happens", "\u2014", "but", " most", " of", " my", " pointers", " are", " stored", " inside", " Python", " objects", " anyway", " so", " they", "\ufffd", "\ufffd", "ll", " likely", " go", " away", " at", " the", " same", " time", ".", "\n", "\n", "Writing", " Python", " code", " meant", " with", " actually", " works", ",", " too", ",", " and", " I", " ported", " my", " crappy", " exception", " wrapper", " into", " a", " tiny", " context", "manager", ".", " Image", "Mag", "ick", " handles", " errors", " by", " passing", " pointers", " to", " Exception", "Info", " struct", "s", " around", ",", " and", " writing", " into", " them", " when", " something", " goes", " wrong", ";", " the", " object", " returned", " from", " mag", "ick", "_", "try", " is", " just", " a", " thin", " container", " for", " such", " a", " pointer", ".", " When", " the", " with", " block", " ends", ",", " if", " the", " struct", " contains", " an", " error", ",", " it", "\ufffd", "\ufffd", "s", " converted", " to", " a", " Python", " error", " and", " raised", ".", " Between", " with", " and", " f", "fi", ".", "gc", ",", " a", " lot", " of", " the", " memory", "-", "man", "aging", " cru", "ft", " went", " away", ",", " and", " I", "\ufffd", "\ufffd", "m", " left", " with", " something", " that", " actually", " looks", " like", " Python", " code", ".", "\n", "\n", "The", " C", "FF", "I", " version", " also", " passes", " a", " pointer", " directly", " to", " the", " constructor", ",", " rather", " than", " building", " an", " object", " manually", " (", "or", " using", " an", " awkwardly", "-", "named", " factory", " function", ",", " as", " I", " did", " elsewhere", ").", " This", " was", " a", " restriction", " of", " C", "ython", ":", " no", " function", " exposed", " to", " Python", " can", " accept", " C", "-", "specific", " types", " as", " arguments", ",", " and", " __", "init", "__", " is", " necessarily", " exposed", " to", " Python", ".", " Any", "time", " I", " needed", " an", " object", " initially", " populated", " with", " C", " fields", ",", " I", " had", " to", " create", " it", " empty", " with", " Class", ".", "__", "new", "__", "(", "Class", ")", " and", " then", " assign", " attributes", " manually", ".", " But", " in", " C", "FF", "I", ",", " pointers", " are", " just", " Python", " objects", " like", " anything", " else", ",", " so", " I", " can", " pass", " them", " around", " freely", ".", " This", " simplified", " my", " life", " a", " great", " deal", ",", " especially", " with", " common", " post", "-", "setup", " code", " like", " the", " self", "._", "post", "_", "init", "()", " above", ",", " which", " was", " easy", " to", " forget", " to", " call", ".", "\n", "\n", "Image", "Mag", "ick", " uses", " typed", "ef", " for", " most", " of", " its", " numeric", " types", ",", " and", " the", " actual", " concrete", " type", " depends", " on", " how", " Image", "Mag", "ick", " was", " configured", ".", " C", "FF", "I", " can", "\ufffd", "\ufffd", "t", " deal", " with", " this", ",", " because", " it", " needs", " to", " know", " the", " sizes", " of", " types", " to", " interact", " with", " C", " calling", " conventions", ".", " Po", "inters", " to", " struct", "s", " of", " unknown", " size", " are", " fine", ",", " because", " they", "\ufffd", "\ufffd", "re", " ultimately", " pointers", " and", " those", " are", " always", " a", " known", " size", ",", " but", " if", " I", " don", "\ufffd", "\ufffd", "t", " know", " whether", " I", " have", " a", " float", " or", " a", " double", " then", " I", " have", " a", " bit", " of", " a", " problem", ".", "\n", "\n", "The", " main", " offender", " is", " Quantum", ",", " which", " holds", " the", " value", " of", " a", " single", " channel", " in", " a", " pixel", ";", " depending", " on", " the", " build", " it", " might", " be", " an", " unsigned", " char", ",", " unsigned", " long", ",", " or", " long", " long", " double", " that", " ranges", " from", " 0", " to", " 1", " (", "?!", ").", " Luckily", " Quantum", " only", " really", " exists", " as", " a", " field", " in", " a", " pixel", " structure", ",", " so", " there", " was", " room", " for", " a", " hack", ":", " I", " wrote", " tiny", " wra", "ppers", " in", " C", " that", " converted", " a", " pixel", " to", " an", " array", " of", " 0", "\u2013", "1", " double", " s", " and", " back", ",", " and", " left", " the", " pixel", " struct", " as", " an", " opaque", " type", ".", " C", "FF", "I", " was", " more", " than", " happy", " to", " compile", " them", " for", " me", " and", " expose", " them", " to", " Python", " code", " the", " same", " way", " as", " the", " rest", " of", " the", " library", ".", "\n", "\n", "Po", "inters", " in", " C", "FF", "I", " can", " be", " de", "ref", "eren", "ced", " by", " index", "ing", ",", " much", " like", " C", " (", "and", " c", "types", "):", " ptr", "[", "0", "]", " is", " the", " spiritual", " equivalent", " of", " *", "ptr", ".", "\n", "\n", "But", " part", " of", " Image", "Mag", "ick", "\ufffd", "\ufffd", "s", " API", " requires", " pointer", " increment", "ing", ".", " In", " C", "ython", " this", " had", " to", " be", " done", " by", " a", " dedicated", " function", ",", " inc", "(", "ptr", ")", ",", " which", " would", " be", " compiled", " to", " ptr", "++", ".", " In", " c", "types", ",", " well", "\u2026", " you", " can", " always", " de", "reference", " with", " an", " increasing", " index", ",", " but", " an", " actual", " increment", " appears", " to", " be", "\u2026", " cumbersome", ".", "\n", "\n", "I", " was", " about", " to", " write", " another", " C", " wrapper", " just", " to", " return", " ptr", " +", " 1", " and", " I", " thought", " to", " try", " the", " obvious", " thing", ":", " ptr", " +=", " 1", ".", "\n", "\n", "Which", " works", ".", " Huh", ".", " Ne", "at", ".", "\n", "\n", "C", "ython", " generates", " a", " lot", " of", " C", ".", " Like", "\u2026", " a", " lot", ".", " san", "per", "a", ".", "image", " is", " 30", "K", " of", " C", "ython", ",", " and", " it", " becomes", " 6", "07", "K", " of", " C", ".", " That", " takes", " a", " little", " while", " to", " build", ".", " It", "\ufffd", "\ufffd", "s", " only", " some", " 9", " seconds", " to", " build", " all", " of", " san", "per", "a", " from", " scratch", " on", " my", " machine", ",", " and", " there", " are", " partial", " builds", " as", " you", " might", " expect", ",", " but", " it", "\ufffd", "\ufffd", "s", " a", " bit", " of", " a", " bump", " in", " the", " road", " when", " I", "\ufffd", "\ufffd", "m", " trying", " to", " cycle", " quickly", " between", " writing", " code", " and", " running", " tests", ".", "\n", "\n", "Oh", ",", " and", " I", " have", " to", " compile", " manually", " after", " every", " change", ".", " And", " sometimes", " the", " translation", " fails", ",", " and", " C", "ython", "\ufffd", "\ufffd", "s", " error", " messages", " aren", "\ufffd", "\ufffd", "t", " great", " at", " times", ".", " And", " sometimes", " the", " compile", " fails", ",", " and", " I", " have", " to", " debug", " generated", " C", " code", ".", " And", " sometimes", " Python", " se", "g", "f", "aults", ",", " and", " I", " am", " very", " sad", " about", " that", ".", "\n", "\n", "On", " the", " other", " hand", ",", " C", "FF", "I", " still", " has", " to", " compile", " some", " boiler", "plate", " code", " and", " the", " little", " wra", "ppers", " I", " wrote", ",", " but", " it", " does", " so", " automatically", " when", " needed", ",", " and", " it", " only", " takes", " about", " a", " second", ".", " I", "\ufffd", "\ufffd", "ve", " gotten", " a", " few", " C", " errors", ",", " but", " they", "\ufffd", "\ufffd", "ve", " been", " pretty", " straightforward", " and", " usually", " are", " mistakes", " in", " my", " declarations", ".", " Definitely", " much", " nicer", ".", "\n", "\n", "One", " downside", ":", " C", "FF", "I", " claims", " a", " parse", " error", " when", " you", " use", " a", " C", " type", " that", " hasn", "\ufffd", "\ufffd", "t", " been", " declared", " yet", ",", " and", " lays", " the", " blame", " on", " the", " next", " token", " with", " no", " mention", " of", " the", " name", " it", " didn", "\ufffd", "\ufffd", "t", " recognize", ".", " This", " was", " not", " obvious", " at", " first", ".", "\n", "\n", "I", " admit", " I", " was", " dread", "ing", " finding", " out", " that", " my", " library", " was", " some", " 10", "\u00d7", " slower", ",", " but", " this", " was", " hard", " to", " measure", " before", " I", "\ufffd", "\ufffd", "d", " ported", " most", " of", " it", ".", "\n", "\n", "CP", "ython", " 2", ".", "7", " +", " C", "ython", ":", " 2", ".", "0", "s", "\n", "\n", "CP", "ython", " 2", ".", "7", " +", " C", "FF", "I", " :", " 2", ".", "7", "s", "\n", "\n", ":", " 2", ".", "7", "s", " Py", "Py", " 2", ".", "1", " +", " C", "FF", "I", " :", " 4", ".", "3", "s", "\n", "\n", "That", "\ufffd", "\ufffd", "s", " the", " time", " it", " takes", ",", " from", " a", " warm", " start", ",", " to", " run", " the", " test", " suite", ".", " (", "Which", " is", " hilar", "iously", " broken", " at", " the", " moment", ",", " but", " it", "\ufffd", "\ufffd", "s", " equally", " broken", " in", " all", " three", " cases", ".)", "\n", "\n", "I", " guess", " that", "\ufffd", "\ufffd", "s", " not", " too", " awful", " a", " drop", ",", " considering", " I", " was", " running", " compiled", " C", " code", " before", ",", " but", " I", "\ufffd", "\ufffd", "d", " still", " like", " to", " work", " on", " improving", " it", ".", " (", "Only", " 49", " tests", " actually", " run", ",", " for", " crying", " out", " loud", ".)", " And", " while", " Py", "Py", "\ufffd", "\ufffd", "s", " performance", " is", " pretty", " lousy", ",", " it", " didn", "\ufffd", "\ufffd", "t", " work", " at", " all", " before", ",", " so", " this", " is", " a", " stark", " improvement", ".", " :)", "\n", "\n", "I", " put", " this", " off", " for", " way", " too", " long", ",", " but", " it", " ended", " up", " being", " much", " easier", " than", " I", " expected", ",", " and", " way", " less", " ugly", " than", " any", " of", " the", " c", "types", " code", " I", "\ufffd", "\ufffd", "ve", " read", ".", " Using", " a", " C", "FF", "I", "-", "wra", "pped", " library", " is", " a", " delight", " so", " far", ",", " and", " I", " expect", " this", " will", " get", " me", " much", " more", " motivated", " to", " work", " on", " san", "per", "a", " in", " the", " future", "\u2014", "at", " least", " if", " Wand", " doesn", "\ufffd", "\ufffd", "t", " beat", " me", " to", " the", " mind", "share", ".", "\n", "\n", "I", "\ufffd", "\ufffd", "m", " saving", " this", " for", " last", " because", " it", "\ufffd", "\ufffd", "s", " really", " just", " grip", "ing", " about", " Image", "Mag", "ick", " and", " has", " nothing", " to", " do", " with", " C", "FF", "I", ".", "\n", "\n", "Image", "Mag", "ick", " is", " fucking", " insane", ",", " let", "\ufffd", "\ufffd", "s", " make", " that", " clear", ".", " You", " probably", " know", " that", " it", " claims", " super", "-", "generic", " CLI", " names", " like", " convert", " and", " identify", ",", " but", " that", "\ufffd", "\ufffd", "s", " just", " the", " tip", " of", " the", " iceberg", ".", " Large", " chunks", " of", " the", " core", " API", ",", " including", " such", " basic", " functions", " as", " Read", "Image", ",", " are", " themselves", " the", " implementations", " of", " parts", " of", " the", " CLI", " utilities", "\u2014", "you", " actually", " cannot", " ask", " Image", "Mag", "ick", " to", " read", " an", " image", " from", " a", " filename", " without", " trying", " to", " parse", " out", " all", " the", " p", "ng", ":", "fo", "obar", ".", "jpg", "[", "20", "x", "20", "]", " cru", "ft", ".", " Oh", " and", " it", "\ufffd", "\ufffd", "s", " written", " like", " 1991", " C", ",", " the", " function", " and", " type", " names", " are", " un", "-", "names", "paced", " Camel", "C", "aps", ",", " none", " of", " the", " types", " are", " documented", ",", " most", " of", " the", " numeric", " types", " are", " actually", " typed", "ef", "s", " that", " vary", " depending", " on", " how", " it", " was", " compiled", ",", " and", " a", " lot", " of", " the", " interesting", " stuff", " exists", " only", " in", " macros", ".", "\n", "\n", "But", " what", " haunted", " my", " very", " first", " foray", " into", " C", "FF", "I", " was", " merely", " finding", " the", " library", " and", " its", " headers", ".", " Image", "Mag", "ick", " headers", " don", "\ufffd", "\ufffd", "t", " live", " in", " standard", " locations", ";", " they", "\ufffd", "\ufffd", "re", " usually", " installed", " in", " a", " sub", "directory", " of", " /", "usr", "/", "include", " (", "which", " varies", " by", " platform", " and", " configuration", ",", " of", " course", "),", " and", " inside", " that", " is", " a", " mag", "ick", "/", " directory", " that", " actually", " contains", " the", " headers", ".", " The", " library", " used", " to", " be", " fairly", " easy", " to", " find", ",", " but", " now", " it", " has", " some", " combination", " of", " up", " to", " three", " types", " of", " suffix", " in", " the", " name", ",", " again", " depending", " on", " how", " it", " was", " compiled", ".", "\n", "\n", "This", " is", " all", " ostensibly", " because", " Image", "Mag", "ick", " can", " be", " compiled", " with", " different", " bit", "-", "dep", "ths", ",", " and", " they", " want", " to", " support", " having", " multiple", " different", " flavors", " of", " the", " library", " installed", " side", "-", "by", "-", "side", ",", " but", " the", " resulting", " confusion", " makes", " it", " awkward", " to", " use", " the", " library", " at", " all", ".", "\n", "\n", "The", " easy", " way", " to", " get", " all", " the", " right", " paths", " is", " p", "kg", "-", "config", ",", " but", " I", " can", " only", " take", " that", " for", " granted", " on", " Linux", " and", " perhaps", " other", " not", "-", "Mac", " Unix", " flavors", ",", " so", " in", " the", " interest", " of", " being", " multicultural", " I", " set", " out", " to", " find", " a", " robust", " fall", "back", ".", " (", "The", " C", "ython", " approach", " just", " relied", " on", " p", "kg", "-", "config", " and", " spat", " out", " a", " useless", " error", " message", " if", " it", " weren", "\ufffd", "\ufffd", "t", " available", ";", " lame", "!)", "\n", "\n", "First", " attempt", ":", " happy", " day", "!", " Image", "Mag", "ick", " ships", " with", " and", " installs", " a", " program", " called", " Mag", "ick", "-", "config", ",", " which", " is", " like", " p", "kg", "-", "config", " but", " specific", " to", " Image", "Mag", "ick", ".", " Whe", "w", ",", " that", " was", " easy", ".", "\n", "\n", "Then", " I", " had", " a", " look", ",", " and", " it", " turns", " out", " Mag", "ick", "-", "config", " is", " just", " a", " one", "-", "page", " shell", " script", " that", " calls", " p", "kg", "-", "config", ".", " Why", " does", " this", " even", " exist", ",", " then", "?", " Who", " the", " fuck", " knows", ".", "\n", "\n", "Second", " attempt", ":", " Image", "Mag", "ick", " also", " installs", " some", " configuration", " files", ",", " which", " are", " promised", " to", " contain", " some", " compile", "-", "time", " information", ".", " Excellent", ";", " I", "\ufffd", "\ufffd", "ll", " just", " find", " those", ".", " Except", " Image", "Mag", "ick", " looks", " for", " them", " in", " each", " of", " half", " a", " dozen", " places", " that", " are", " different", " on", " every", " platform", "\u2014", "and", " the", " most", " likely", " home", " contains", " the", " Image", "Mag", "ick", " version", ",", " which", " I", " don", "\ufffd", "\ufffd", "t", " know", " until", " I", "\ufffd", "\ufffd", "ve", " found", " the", " configuration", " files", ".", "\n", "\n", "Okay", ",", " okay", ".", " Luckily", " the", " convert", " program", " has", " a", " sh", "oddy", " interface", " to", " these", " configuration", " files", ";", " convert", " -", "list", " configure", " will", " spit", " out", " all", " the", " juicy", " details", ".", " So", " I", " tried", " that", ",", " and", " it", " worked", " well", ".", " Sort", " of", ".", "\n", "\n", "Turn", "s", " out", " this", " file", " will", " only", " tell", " me", " how", " Image", "Mag", "ick", " itself", " was", " built", ",", " not", " how", " to", " link", " to", " it", ".", " It", " contains", " an", " include", " path", " which", " happens", " to", " match", " one", " on", " my", " machine", ",", " but", " somehow", " I", " suspect", " it", "\ufffd", "\ufffd", "s", " not", " necessarily", " intended", " to", ".", " And", " of", " course", " the", " name", " of", " the", " library", " itself", " doesn", "\ufffd", "\ufffd", "t", " appear", " anywhere", ".", "\n", "\n", "At", " this", " point", " I", " gave", " up", " and", " I", "\ufffd", "\ufffd", "ll", " have", " to", " revisit", " it", " later", ".", " I", " know", " I", " can", " ignore", " the", " headers", " and", " just", " look", " for", " the", " library", " on", " OS", " X", ",", " which", " is", " certainly", " easier", ".", " The", " related", " Wand", " library", ",", " which", " also", " seeks", " to", " wrap", " Image", "Mag", "ick", ",", " is", " currently", " just", " fl", "ailing", " wildly", " until", " it", " finds", " a", " library", " that", " actually", " exists", ".", " (", "Oh", ",", " and", " they", " have", " these", " very", " specific", " instructions", " for", " installing", " Image", "Mag", "ick", " on", " Windows", " which", " involve", " setting", " a", " specific", " environment", " variable", " so", " Image", "Mag", "ick", " can", " even", " find", " its", " own", " files", ".)"]