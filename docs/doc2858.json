["Mon", "ads", " Made", " Diff", "icult", "\n", "\n", "C", "ave", "at", ":", " This", " is", " not", " a", " mon", "ad", " tutorial", ",", " you", " should", " not", " read", " this", " to", " understand", " mon", "ads", " initially", ".", " If", " you", " aren", "\ufffd", "\ufffd", "t", " already", " comfortable", " with", " mon", "ads", " and", " have", " used", " them", " in", " production", " code", ",", " please", " don", "\ufffd", "\ufffd", "t", " read", " this", ".", " It", " will", " not", " impart", " any", " int", "ution", ".", "\n", "\n", "This", " is", " a", " short", ",", " fast", " and", " analogy", "-", "free", " introduction", " to", " Haskell", " mon", "ads", " derived", " from", " a", " categ", "orical", " perspective", ".", " This", " assumes", " you", " are", " familiar", " with", " Haskell", " and", " basic", " category", " theory", ".", "\n", "\n", "C", "ategories", "\n", "\n", "We", " have", " a", " abstract", " category", " \\(\\", "math", "cal", "{", "C", "}", "\\)", " which", " consists", " of", " objects", " and", " morph", "isms", ".", "\n", "\n", "Object", "s", " :", " \\(", "\u25cf", "\\)", "\n", "\n", "M", "orph", "isms", " :", " \\(", "\u25cf", " \\", "right", "arrow", " \u25cf", "\\)", "\n", "\n", "For", " each", " object", " there", " is", " an", " identity", " morph", "ism", " id", " and", " a", " composition", " rule", " \\(", "(\\", "circ", ")\\", ")", " for", " combining", " morph", "isms", " associ", "atively", ".", " We", " can", " model", " this", " with", " the", " following", " type", " class", " in", " Haskell", " with", " kind", " polymorph", "ism", ".", "\n", "\n", "--", " Morph", "isms", " type", " (", "a", " ~", ">", " b", ")", " c", " =", " c", " a", " b", " class", " Category", " (", " c", " ::", " k", " ->", " k", " ->", " *", " )", " where", " id", " ::", " (", "a", " ~", ">", " a", ")", " c", " (", ".)", " ::", " (", "y", " ~", ">", " z", ")", " c", " ->", " (", "x", " ~", ">", " y", ")", " c", " ->", " (", "x", " ~", ">", " z", ")", " c", "\n", "\n", "In", " Haskell", " we", " call", " this", " category", " H", "ask", ",", " over", " the", " type", " constructor", " (", "->", ")", " of", " function", " types", " between", " Haskell", " types", ".", "\n", "\n", "type", " H", "ask", " =", " (", " ->", " )", " instance", " Category", " H", "ask", " where", " id", " x", " =", " x", " (", "f", ".", " g", ")", " x", " =", " f", " (", "g", " x", ")", "\n", "\n", "The", " constructor", " (", "->", ")", " is", " sometimes", " confusing", " to", " read", " in", " type", "class", " signatures", " as", " a", " type", "level", " operator", " since", " it", "\ufffd", "\ufffd", "s", " first", " argument", " usually", " appears", " to", " the", " left", " of", " it", " in", " inf", "ix", " form", " and", " the", " second", " to", " the", " right", ".", " For", " example", " the", " following", " are", " equivalent", ".", "\n", "\n", "(", " ->", " )", " ((", " ->", " )", " a", " b", ")", " ((", " ->", " )", " a", " c", ")", "\n", "\n", "(", "a", " ->", " b", ")", " ->", " (", "a", " ->", " c", ")", "\n", "\n", "Fun", "ctors", "\n", "\n", "Between", " two", " categories", " we", " can", " construct", " a", " fun", "ctor", " den", "oted", " \\(", "T", "\\", "),", " which", " maps", " between", " objects", " and", " morph", "isms", " of", " categories", " that", " preserves", " morph", "ism", " composition", " and", " identities", ".", "\n", "\n", "Object", "s", " :", " \\(", "T", "(", "\u25cf", ")\\", ")", "\n", "\n", "M", "orph", "isms", " :", " \\(", "T", " (", "\u25cf", " \\", "right", "arrow", " \u25cf", ")\\", ")", "\n", "\n", "Represent", "ed", " in", " Haskell", " by", ":", "\n", "\n", "class", " (", " Category", " c", ",", " Category", " d", ")", " =>", " Fun", "ctor", " c", " d", " t", " where", " f", "map", " ::", " c", " a", " b", " ->", " d", " (", "t", " a", ")", " (", "t", " b", ")", "\n", "\n", "With", " the", " familiar", " fun", "ctors", " laws", ":", "\n", "\n", "f", "map", " id", " \u2261", " id", " f", "map", " (", "a", ".", " b", ")", " \u2261", " (", "f", "map", " a", ")", ".", " (", "f", "map", " b", ")", "\n", "\n", "The", " identity", " fun", "ctor", " \\(", "1", "_", "\\", "math", "cal", "{", "C", "}", "\\)", " for", " a", " category", " \\(\\", "math", "cal", "{", "C", "}", "\\)", " is", " a", " fun", "ctor", " mapping", " all", " objects", " to", " themselves", " and", " all", " morph", "isms", " to", " themselves", ".", "\n", "\n", "new", "type", " Id", " a", " =", " Id", " a", " instance", " Fun", "ctor", " H", "ask", " H", "ask", " Id", " where", " f", "map", " f", " (", " Id", " a", ")", " =", " Id", " (", "f", " a", ")", " instance", " Fun", "ctor", " H", "ask", " H", "ask", " []", " where", " f", "map", " f", " []", " =", " []", " f", "map", " f", " (", "x", " :", " x", "s", ")", " =", " f", " x", " :", " (", "f", "map", " f", " x", "s", ")", " instance", " Fun", "ctor", " H", "ask", " H", "ask", " Maybe", " where", " f", "map", " f", " Nothing", " =", " Nothing", " f", "map", " f", " (", " Just", " x", ")", " =", " Just", " (", "f", " x", ")", "\n", "\n", "An", " end", "of", "un", "ctor", " is", " a", " fun", "ctor", " from", " a", " category", " to", " itself", ",", " i", ".", "e", ".", " (", "\\", "(", "T", " :", " \\", "math", "cal", "{", "C", "}", " \\", "to", " \\", "math", "cal", "{", "C", "}", "\\)", ").", "\n", "\n", "type", " End", "of", "un", "ctor", " c", " t", " =", " Fun", "ctor", " c", " c", " t", "\n", "\n", "The", " composition", " of", " two", " fun", "ctors", " is", " itself", " a", " fun", "ctor", " as", " well", ".", " Conv", "inc", "ing", " Haskell", " of", " this", " fact", " requires", " some", " trick", "ery", " with", " constraint", " kinds", " and", " sc", "oped", " type", " variables", ".", "\n", "\n", "new", "type", " F", "Comp", " g", " f", " x", " =", " C", " {", " un", "C", " ::", " g", " (", "f", " x", ")", " }", " new", "type", " Hom", " (", " c", " ::", " *", " ->", " Con", "str", "aint", " )", " a", " b", " =", " Hom", " (", "a", " ->", " b", ")", " instance", " (", " Fun", "ctor", " a", " b", " f", ",", " Fun", "ctor", " b", " c", " g", ",", " c", " ~", " Hom", " k", ")", " =>", " Fun", "ctor", " a", " c", " (", " F", "Comp", " g", " f", ")", " where", " f", "map", " f", " =", " (", " Hom", " C", " )", ".", " (", "f", "map", "g", " (", "f", "map", "f", " f", ")", ".", " (", " Hom", " un", "C", "))", " where", " f", "map", "f", " =", " f", "map", " ::", " a", " x", " y", " ->", " b", " (", "f", " x", ")", " (", "f", " y", ")", " f", "map", "g", " =", " f", "map", " ::", " b", " s", " t", " ->", " c", " (", "g", " s", ")", " (", "g", " t", ")", "\n", "\n", "The", " repeated", " composition", " of", " an", " end", "of", "un", "ctor", " over", " a", " category", " is", " written", " with", " exponential", " notation", ":", "\n", "\n", "\\", "[", " \\", "begin", "{", "align", "*", "}", " T", "^", "2", " &", "=", " T", " T", " :", " \\", "math", "cal", "{", "C", "}", " \\", "right", "arrow", " \\", "math", "cal", "{", "C", "}", " \\\\", " T", "^", "3", " &", "=", " T", " T", " T", ":", " \\", "math", "cal", "{", "C", "}", " \\", "right", "arrow", " \\", "math", "cal", "{", "C", "}", " \\", "end", "{", "align", "*", "}", " \\", "]", "\n", "\n", "The", " category", " of", " small", " categories", " \\(\\", "text", "bf", "{", "Cat", "}", "\\)", " is", " a", " category", " with", " categories", " as", " objects", " and", " fun", "ctors", " as", " morph", "isms", " between", " categories", ".", "\n", "\n", "Natural", " Transform", "ations", "\n", "\n", "For", " two", " fun", "ctors", " \\(", "F", ",", "G", "\\)", " between", " two", " categories", " \\(\\", "math", "cal", "{", "A", ",", "B", "}\\", "):", "\n", "\n", "\\", "[", " F", " :", " \\", "math", "cal", "{", "A", "}", " \\", "right", "arrow", " \\", "math", "cal", "{", "B", "}", " \\\\", " G", " :", " \\", "math", "cal", "{", "A", "}", " \\", "right", "arrow", " \\", "math", "cal", "{", "B", "}", " \\", "]", "\n", "\n", "We", " can", " construct", " a", " mapping", " called", " a", " natural", " transformation", " \\(\\", "eta", "\\)", " which", " is", " a", " mapping", " between", " fun", "ctors", " \\(\\", "eta", " :", " F", " \\", "right", "arrow", " G", "\\)", " that", " associates", " every", " object", " \\(", "X", "\\)", " in", " \\(\\", "math", "cal", "{", "A", "}", "\\)", " to", " a", " morph", "ism", " in", " \\(\\", "math", "cal", "{", "B", "}\\", "):", "\n", "\n", "\\", "[", " \\", "eta", "_", "X", " :", " F", "(", "X", ")", " \\", "right", "arrow", " G", "(", "X", ")", " \\", "]", "\n", "\n", "Such", " that", " the", " following", " n", "atur", "ality", " condition", " holds", " for", " any", " morph", "ism", " \\(", "f", " :", " X", " \\", "right", "arrow", " Y", "\\", ").", " Sh", "own", " as", " a", " n", "atur", "ality", " square", ":", "\n", "\n", "\\", "[", " \\", "eta", "_", "Y", " \\", "circ", " F", "(", "f", ")", " =", " G", "(", "f", ")", " \\", "circ", " \\", "eta", "_", "X", " \\", "]", "\n", "\n", "The", " natural", " transformation", " itself", " is", " shown", " diagram", "matically", " between", " two", " fun", "ctors", " as", ":", "\n", "\n", "This", " is", " express", "ible", " in", " our", " general", " category", " class", " as", " the", " following", " existential", " type", ":", "\n", "\n", "type", " Nat", " c", " f", " g", " =", " for", "all", " a", ".", " c", " (", "f", " a", ")", " (", "g", " a", ")", "\n", "\n", "In", " the", " case", " of", " H", "ask", " we", " a", " family", " of", " polymorph", "ic", " functions", " with", " signature", ":", "\n", "\n", "type", " Nat", "H", "ask", " f", " g", " =", " for", "all", " a", ".", " (", "f", " a", ")", " ->", " (", "g", " a", ")", "\n", "\n", "With", " the", " n", "atur", "ality", " condition", " as", " the", " following", " law", " for", " a", " natural", " transformation", " (", " h", " ),", " which", " happens", " to", " be", " a", " free", " theorem", " in", " Haskell", "\ufffd", "\ufffd", "s", " type", " system", ".", "\n", "\n", "f", "map", " f", ".", " h", " \u2261", " h", ".", " f", "map", " f", "\n", "\n", "The", " canonical", " example", " is", " the", " natural", " transformation", " between", " the", " List", " fun", "ctor", " and", " the", " Maybe", " fun", "ctor", " (", " where", " f", " =", " List", ",", " g", " =", " Maybe", " ).", "\n", "\n", "head", "May", " ::", " for", "all", " a", ".", " [", "a", "]", " ->", " Maybe", " a", " head", "May", " []", " =", " Nothing", " head", "May", " (", "x", " :", " x", "s", ")", " =", " Just", " x", "\n", "\n", "Either", " way", " we", " chase", " the", " diagram", " we", " end", " up", " at", " the", " same", " place", ".", "\n", "\n", "f", "map", " f", " (", "head", "May", " x", "s", ")", " \u2261", " head", "May", " (", "f", "map", " f", " x", "s", ")", "\n", "\n", "Run", " through", " each", " of", " the", " cases", " of", " the", " n", "atur", "ality", " square", " for", " head", "May", " if", " you", " need", " to", " convince", " yourself", " of", " this", ".", "\n", "\n", "f", "map", " f", " (", "head", "May", " [", "])", " =", " f", "map", " f", " Nothing", " =", " Nothing", " head", "May", " (", "f", "map", " f", " [", "])", " =", " head", "May", " []", " =", " Nothing", "\n", "\n", "f", "map", " f", " (", "head", "May", " (", "x", " :", " x", "s", "))", " =", " f", "map", " f", " (", " Just", " x", ")", " =", " Just", " (", "f", " x", ")", " head", "May", " (", "f", "map", " f", " (", "x", " :", " x", "s", "))", " =", " head", "May", " [", "f", " x", "]", " =", " Just", " (", "f", " x", ")", "\n", "\n", "Fun", "ctor", " Categories", "\n", "\n", "A", " natural", " transformation", " \\(\\", "eta", " :", " C", " \\", "right", "arrow", " D", "\\)", " is", " itself", " a", " morph", "ism", " in", " the", " fun", "ctor", " category", " \\(\\", "text", "bf", "{", "Fun", "}", "(\\", "math", "cal", "{", "C", "},", " \\", "math", "cal", "{", "D", "}", ")\\", ")", " of", " fun", "ctors", " between", " \\(\\", "math", "cal", "{", "C", "}", "\\)", " and", " \\(\\", "math", "cal", "{", "D", "}\\", ").", " The", " category", " \\(\\", "text", "bf", "{", "End", "}", "\\)", " is", " the", " category", " of", " end", "of", "un", "ctors", " between", " a", " category", " and", " itself", ".", "\n", "\n", "--", " Fun", "ctor", " category", " new", "type", " Fun", " f", " g", " a", " b", " =", " FN", "at", " (", "f", " a", " ->", " g", " b", ")", " --", " End", "of", "un", "ctor", " category", " type", " End", " f", " =", " Fun", " f", " f", " instance", " Category", " (", " End", " f", ")", " where", " id", " =", " FN", "at", " id", " (", " FN", "at", " f", ")", ".", " (", " FN", "at", " g", ")", " =", " FN", "at", " (", "f", ".", " g", ")", "\n", "\n", "Mon", "ads", "\n", "\n", "We", " can", " finally", " define", " a", " mon", "ad", " over", " a", " category", " \\(\\", "math", "cal", "{", "C", "}", "\\)", " to", " be", " a", " triple", " \\(", "(", "T", ",", " \\", "eta", ",", " \\", "mu", ")\\", ")", " of", ":", "\n", "\n", "An", " end", "of", "un", "ctor", " \\(", "T", ":", " \\", "math", "cal", "{", "C", "}", " \\", "right", "arrow", " \\", "math", "cal", "{", "C", "}", "\\)", " A", " natural", " transformation", " \\(\\", "eta", " :", " 1", "_", "\\", "math", "cal", "{", "C", "}", " \\", "right", "arrow", " T", "\\)", " A", " natural", " transformation", " \\(\\", "mu", " :", " T", "^", "2", " \\", "right", "arrow", " T", "\\)", "\n", "\n", "class", " End", "of", "un", "ctor", " c", " t", " =>", " Mon", "ad", " c", " t", " where", " et", "a", " ::", " c", " a", " (", "t", " a", ")", " mu", " ::", " c", " (", "t", " (", "t", " a", "))", " (", "t", " a", ")", "\n", "\n", "With", " an", " associ", "ativity", " square", ":", "\n", "\n", "\\", "[", " \\", "mu", " \\", "circ", " T", " \\", "mu", " =", " \\", "mu", " \\", "circ", " \\", "mu", " T", " \\\\", " \\", "]", "\n", "\n", "And", " a", " triangle", " equality", ":", "\n", "\n", "\\", "[", " \\", "mu", " \\", "circ", " T", " \\", "eta", " =", " \\", "mu", " \\", "circ", " \\", "eta", " T", " =", " 1", "_", "C", " \\\\", " \\", "]", "\n", "\n", "Alternatively", " we", " can", " express", " our", " triple", " as", " a", " series", " of", " string", " diagrams", " in", " which", " we", " in", "vert", " the", " traditional", " comm", "ut", "ative", " diagram", " of", " lines", " as", " morph", "ism", " and", " objects", " as", " points", " and", " morph", "isms", " as", " points", " and", " objects", " as", " lines", ".", " In", " this", " form", " the", " mon", "ad", " laws", " have", " a", " nice", " geometric", " symmetry", ".", "\n", "\n", "With", " the", " co", "herence", " conditions", " given", " diagram", "matically", ":", "\n", "\n", "Bind", "/", "Return", " Form", "ulation", "\n", "\n", "There", " is", " an", " equivalent", " formulations", " of", " mon", "ads", " in", " terms", " of", " two", " functions", " (", " (", ">>", "=", "),", " return", " )", " which", " can", " be", " written", " in", " terms", " of", " mu", ",", " et", "a", " )", "\n", "\n", "In", " Haskell", " we", " define", " a", " bind", " (", ">>", "=", ")", " operator", " defined", " in", " terms", " of", " the", " natural", " transformations", " and", " f", "map", " of", " the", " underlying", " fun", "ctor", ".", " The", " join", " and", " return", " functions", " can", " be", " defined", " in", " terms", " of", " mu", " and", " et", "a", ".", "\n", "\n", "(", ">>", "=", ")", " ::", " (", " Mon", "ad", " c", " t", ")", " =>", " c", " a", " (", "t", " b", ")", " ->", " c", " (", "t", " a", ")", " (", "t", " b", ")", " (", " >>", "=", " )", " f", " =", " mu", ".", " f", "map", " f", " return", " ::", " (", " Mon", "ad", " c", " t", ")", " =>", " c", " a", " (", "t", " a", ")", " return", " =", " et", "a", "\n", "\n", "In", " this", " form", " equivalent", " n", "atur", "ality", " conditions", " for", " the", " mon", "ad", "\ufffd", "\ufffd", "s", " natural", " transformations", " give", " rise", " to", " the", " regular", " mon", "ad", " laws", " by", " substitution", " with", " our", " new", " definitions", ".", "\n", "\n", "f", "map", " f", ".", " return", " \u2261", " return", ".", " f", " f", "map", " f", ".", " join", " \u2261", " join", ".", " f", "map", " (", "f", "map", " f", ")", "\n", "\n", "And", " the", " equivalent", " co", "herence", " conditions", " expressed", " in", " terms", " of", " bind", " and", " return", " are", " the", " well", " known", " Mon", "ad", " laws", ":", "\n", "\n", "return", " a", " >>", "=", " f", " \u2261", " f", " a", " m", " >>", "=", " return", " \u2261", " m", " (", "m", " >>", "=", " f", ")", " >>", "=", " g", " \u2261", " m", " >>", "=", " (", "\\", "x", " ->", " f", " x", " >>", "=", " g", ")", "\n", "\n", "K", "le", "isl", "i", " Category", "\n", "\n", "The", " final", " result", " is", " given", " a", " mon", "ad", " we", " can", " form", " a", " new", " category", " called", " the", " Kle", "isl", "i", " category", " from", " the", " mon", "ad", ".", " The", " objects", " are", " embedded", " in", " our", " original", " c", " category", ",", " but", " our", " arrows", " are", " now", " Kle", "isl", "i", " arrows", " a", " ->", " T", " b", ".", " Given", " this", " class", " of", " \ufffd", "\ufffd", "actions", "\ufffd", "\ufffd", " we", "\ufffd", "\ufffd", "d", " like", " to", " write", " an", " operator", " which", " combined", " these", " morph", "isms", " just", " like", " we", " combine", " functions", " in", " our", " host", " category", ".", "\n", "\n", "\\", "[", " \\", "begin", "{", "align", "}", " &", " (", "b", " \\", "to", " T", " c", ")", " \\", "to", " (", "a", " \\", "to", " T", " b", ")", " \\", "to", " (", "a", " \\", "to", " T", " c", ")", " \\\\", " &", " (", "b", " \\", "to", " c", ")", " \\", "to", " (", "a", " \\", "to", " b", ")", " \\", "to", " (", "a", " \\", "to", " c", ")", " \\", "end", "{", "align", "}", " \\", "]", "\n", "\n", "In", " turns", " we", " out", " can", " for", " a", " specific", " function", " (<", "=", "<", ")", " expressed", " in", " terms", " of", " \\(\\", "mu", "\\)", " and", " the", " underlying", " fun", "ctor", ",", " which", " gives", " associ", "ative", " composition", " operator", " of", " Kle", "isl", "i", " arrows", ".", " The", " Kle", "isl", "i", " category", " models", " \ufffd", "\ufffd", "com", "position", " of", " actions", "\ufffd", "\ufffd", " and", " form", " a", " very", " general", " model", " of", " computation", ".", "\n", "\n", "The", " mapping", " between", " a", " Kle", "isl", "i", " category", " formed", " from", " a", " category", " \\(\\", "math", "cal", "{", "C", "}", "\\)", " is", " that", ":", "\n", "\n", "Object", "s", " in", " the", " Kle", "isl", "i", " category", " are", " objects", " from", " the", " underlying", " category", ".", " Morph", "isms", " are", " Kle", "isl", "i", " arrows", " of", " the", " form", " :", " \\(", "f", " :", " A", " \\", "right", "arrow", " T", " B", "\\)", " Identity", " morph", "isms", " in", " the", " Kle", "isl", "i", " category", " are", " precisely", " \\(\\", "eta", "\\)", " in", " the", " underlying", " category", ".", " Com", "position", " of", " morph", "isms", " \\(", "f", " \\", "circ", " g", "\\)", " in", " terms", " of", " the", " host", " category", " is", " defined", " by", " the", " mapping", ":", "\n", "\n", "\\", "[", " f", " \\", "circ", " g", " =", " \\", "mu", " (", " T", " f", " )", " g", " \\", "]", "\n", "\n", "--", " Kle", "isl", "i", " category", " new", "type", " Kle", "isl", "i", " c", " t", " a", " b", " =", " K", " (", "c", " a", " (", "t", " b", "))", " --", " Kle", "isl", "i", " morph", "isms", " (", " c", " a", " (", "t", " b", ")", " )", " type", " (", "a", " :", "~", ">", " b", ")", " c", " t", " =", " Kle", "isl", "i", " c", " t", " a", " b", " --", " Kle", "isl", "i", " morph", "ism", " composition", " (<", "=", "<", ")", " ::", " (", " Mon", "ad", " c", " t", ")", " =>", " c", " y", " (", "t", " z", ")", " ->", " c", " x", " (", "t", " y", ")", " ->", " c", " x", " (", "t", " z", ")", " f", " <=", "<", " g", " =", " mu", ".", " f", "map", " f", ".", " g", " instance", " Mon", "ad", " c", " t", " =>", " Category", " (", " Kle", "isl", "i", " c", " t", ")", " where", " --", " id", " ::", " (", "Mon", "ad", " c", " t", ")", " =>", " c", " a", " (", "t", " a", ")", " id", " =", " K", " et", "a", " --", " (", ".)", " ::", " (", "Mon", "ad", " c", " t", ")", " =>", " c", " y", " (", "t", " z", ")", " ->", " c", " x", " (", "t", " y", ")", " ->", " c", " x", " (", "t", " z", ")", " (", " K", " f", ")", ".", " (", " K", " g", ")", " =", " K", " (", " f", " <=", "<", " g", " )", "\n", "\n", "In", " the", " case", " of", " H", "ask", " where", " c", " =", " (", "->", ")", " we", " see", " the", " usual", " instances", ":", "\n", "\n", "--", " Kle", "isl", "i", " category", " new", "type", " Kle", "isl", "i", " m", " a", " b", " =", " K", " (", "a", " ->", " m", " b", ")", " --", " Kle", "isl", "i", " morph", "isms", " (", " a", " ->", " m", " b", " )", " type", " (", "a", " :", "~", ">", " b", ")", " m", " =", " Kle", "isl", "i", " m", " a", " b", " (<", "=", "<", ")", " ::", " Mon", "ad", " m", " =>", " (", "b", " ->", " m", " c", ")", " ->", " (", "a", " ->", " m", " b", ")", " ->", " a", " ->", " m", " c", " f", " <=", "<", " g", " =", " mu", ".", " f", "map", " f", ".", " g", " instance", " Mon", "ad", " m", " =>", " Category", " (", " Kle", "isl", "i", " m", ")", " where", " id", " =", " K", " return", " (", " K", " f", ")", ".", " (", " K", " g", ")", " =", " K", " (", "f", " <=", "<", " g", ")", "\n", "\n", "class", " Fun", "ctor", " t", " where", " f", "map", " ::", " (", "a", " ->", " b", ")", " ->", " t", " a", " ->", " t", " b", " class", " Fun", "ctor", " t", " =>", " Mon", "ad", " t", " where", " et", "a", " ::", " a", " ->", " (", "t", " a", ")", " mu", " ::", " t", " (", "t", " a", ")", " ->", " (", "t", " a", ")", " (", ">>", "=", ")", " ::", " Mon", "ad", " t", " =>", " t", " a", " ->", " (", "a", " ->", " t", " b", ")", " ->", " t", " b", " ma", " >>", "=", " f", " =", " join", ".", " f", "map", " f", "\n", "\n", "St", "ated", " simply", " that", " the", " mon", "ad", " laws", " above", " are", " just", " the", " category", " laws", " in", " the", " Kle", "isl", "i", " category", ",", " specifically", " the", " mon", "ad", " laws", " in", " terms", " of", " the", " Kle", "isl", "i", " category", " of", " a", " mon", "ad", " m", " are", ":", "\n", "\n", "(", "f", " >", "=>", " g", ")", " >", "=>", " h", " \u2261", " f", " >", "=>", " (", "g", " >", "=>", " h", ")", " return", " >", "=>", " f", " \u2261", " f", " f", " >", "=>", " return", " \u2261", " f", "\n", "\n", "For", " example", ",", " Just", " is", " just", " an", " identity", " morph", "ism", " in", " the", " Kle", "isl", "i", " category", " of", " the", " Maybe", " mon", "ad", ".", "\n", "\n", "Just", " >", "=>", " f", " =", " f", " f", " >", "=>", " Just", " =", " f", "\n", "\n", "just", " ::", " (", "a", " :", "~", ">", " a", ")", " Maybe", " just", " =", " K", " Just", " left", " ::", " for", "all", " a", " b", ".", " (", "a", " :", "~", ">", " b", ")", " Maybe", " ->", " (", "a", " :", "~", ">", " b", ")", " Maybe", " left", " f", " =", " just", ".", " f", " right", " ::", " for", "all", " a", " b", ".", " (", "a", " :", "~", ">", " b", ")", " Maybe", " ->", " (", "a", " :", "~", ">", " b", ")", " Maybe", " right", " f", " =", " f", ".", " just", "\n", "\n", "Has", "kell", " Mon", "ads", "\n", "\n", "For", " instance", " the", " List", " mon", "ad", " would", " have", ":", "\n", "\n", "\\", "(\\", "eta", "\\)", " returns", " a", " single", "ton", " list", " from", " a", " single", " element", ".", " \\(\\", "mu", "\\)", " turns", " a", " nested", " list", " into", " a", " flat", " list", ".", " \\(\\", "math", "tt", "{", "f", "map", "}", "\\)", " applies", " a", " function", " over", " the", " elements", " of", " a", " list", ".", "\n", "\n", "instance", " Fun", "ctor", " []", " where", " --", " f", "map", " ::", " (", "a", " ->", " b", ")", " ->", " [", "a", "]", " ->", " [", "b", "]", " f", "map", " f", " (", "x", " :", " x", "s", ")", " =", " f", " x", " :", " f", "map", " f", " x", "s", " instance", " Mon", "ad", " []", " where", " --", " et", "a", " ::", " a", " ->", " [", "a", "]", " et", "a", " x", " =", " [", "x", "]", " --", " mu", " ::", " [[", "a", "]]", " ->", " [", "a", "]", " mu", " =", " conc", "at", "\n", "\n", "The", " Maybe", " mon", "ad", " would", " have", ":", "\n", "\n", "\\", "(\\", "eta", "\\)", " is", " the", " Just", " constructor", ".", " \\(\\", "mu", "\\)", " combines", " two", " levels", " of", " Just", " construct", "ors", " yielding", " the", " inner", " value", " or", " Nothing", ".", " \\(\\", "math", "tt", "{", "f", "map", "}", "\\)", " applies", " a", " function", " under", " the", " Just", " constructor", " or", " nothing", " for", " Nothing", ".", "\n", "\n", "instance", " Fun", "ctor", " []", " where", " --", " f", "map", " ::", " (", "a", " ->", " b", ")", " ->", " Maybe", " a", " ->", " Maybe", " b", " f", "map", " f", " (", " Just", " x", ")", " =", " Just", " (", "f", " x", ")", " f", "map", " f", " Nothing", " =", " Nothing", " instance", " Mon", "ad", " Maybe", " where", " --", " et", "a", " ::", " a", " ->", " Maybe", " a", " et", "a", " x", " =", " Just", " x", " --", " mu", " ::", " (", "Maybe", " (", "Maybe", " a", "))", " ->", " Maybe", " a", " mu", " (", " Just", " (", " Just", " x", "))", " =", " Just", " x", " mu", " (", " Just", " Nothing", " )", " =", " Nothing", "\n", "\n", "The", " IO", " mon", "ad", " would", " intuitive", "ly", " have", " the", " implementation", ":", "\n", "\n", "\\", "(\\", "eta", "\\)", " returns", " a", " pure", " value", " to", " a", " value", " within", " the", " context", " of", " the", " computation", ".", " \\(\\", "mu", "\\)", " turns", " a", " sequence", " of", " IO", " operation", " into", " a", " single", " IO", " operation", ".", " \\(\\", "math", "tt", "{", "f", "map", "}", "\\)", " applies", " a", " function", " over", " the", " result", " of", " the", " computation", "."]