["Follow", " up", " to", " \"", "The", " Un", "reasonable", " Effect", "iveness", " of", " C", "\"", "\n", "\n", "My", " post", " The", " Un", "reasonable", " Effect", "iveness", " of", " C", " generated", " a", " ton", " discussion", " on", " Reddit", " and", " Hacker", " News", ",", " nearly", " 1200", " comments", " combined", " as", " people", " got", " in", " to", " all", " sorts", " of", " heated", " arguments", ".", " I", " also", " got", " a", " bunch", " of", " private", " correspondence", " about", " it", ".", "\n", "\n", "So", " I", "'m", " going", " to", " answer", " some", " of", " the", " most", " common", " questions", ",", " feedback", " and", " misunderstand", "ings", " it", "'s", " gotten", ".", "\n", "\n", "Is", " C", " the", " best", " language", " for", " everything", "?", "\n", "\n", "Hell", " no", "!", " Higher", " level", " languages", ",", " like", " Python", " and", " Ruby", ",", " are", " extremely", " useful", " and", " should", " definitely", " be", " used", " where", " appropriate", ".", " Java", " has", " a", " lot", " of", " advantages", ",", " C", "++", " does", " too", ".", " Er", "lang", " is", " amazing", ".", " Most", " every", " popular", " language", " has", " uses", " where", " it", "'s", " a", " better", " choice", ".", "\n", "\n", "But", " when", " both", " raw", " performance", " and", " reliability", " are", " critical", ",", " C", " is", " very", " very", " hard", " to", " beat", ".", " At", " Couch", "base", " we", " need", " industrial", " grade", " reliability", " without", " compromising", " performance", ".", "\n", "\n", "I", " love", " me", " some", " Er", "lang", ".", " It", "'s", " very", " reliable", " and", " predictable", ",", " and", " the", " whole", " design", " of", " the", " language", " is", " about", " robust", "ness", ",", " even", " in", " the", " face", " of", " hardware", " failures", ".", " Just", " because", " we", " experienced", " a", " crash", " problem", " in", " the", " core", " of", " Er", "lang", " shouldn", "'t", " tarn", "ish", " its", " otherwise", " excellent", " track", " record", ".", "\n", "\n", "However", " it", "'s", " not", " fast", " enough", " for", " our", " and", " our", " customers", " needs", ".", " This", " is", " key", ",", " the", " hard", " work", " to", " make", " our", " code", " as", " efficient", " and", " fast", " as", " possible", " in", " C", " now", " benefits", " our", " many", " thousands", " of", " Couch", "base", " server", " deployments", " all", " over", " the", " world", ",", " saving", " a", " ton", " of", " money", " and", " resources", ".", " It", "'s", " an", " investment", " that", " is", " pay", "ed", " back", " many", ",", " many", " times", ".", "\n", "\n", "But", " for", " most", " projects", " the", " extra", " engineering", " cost", " isn", "'t", " worth", " it", ".", " if", " you", " are", " building", " something", " that", "'s", " only", " used", " by", " your", " organization", ",", " or", " small", " #", " of", " customers", ",", " your", " money", " is", " likely", " better", " spent", " on", " faster", "/", "more", " hardware", " than", " very", " expensive", " engineers", " coding", ",", " testing", " and", " debugging", " C", " code", ".", " There", " is", " a", " good", " chance", " you", " don", "'t", " have", " the", " same", " economies", " of", " scale", " we", " do", " at", " Couch", "base", " where", " the", " costs", " are", " spread", " over", " high", " #", " of", " customers", ".", "\n", "\n", "Don", "'t", " just", " blindly", " use", " C", ",", " understand", " its", " own", " trade", "offs", " and", " if", " it", " makes", " sense", " in", " your", " situation", ".", " Er", "lang", " is", " quite", " good", " for", " us", ",", " but", " to", " stay", " competitive", " we", " need", " to", " move", " on", " to", " something", " faster", " and", " industrial", " grade", " for", " our", " performance", " oriented", " code", ".", " And", " Er", "lang", " itself", " is", " written", " in", " C", ".", "\n", "\n", "If", " a", " big", " problem", " was", " C", " code", " in", " Er", "lang", ",", " why", " would", " using", " more", " C", " be", " good", "?", "\n", "\n", "Because", " it", "'s", " easier", " to", " debug", " when", " you", " don", "'t", " lose", " context", " between", " the", " \"", "application", "\"", " layer", " and", " the", " lower", " level", " code", ".", " The", " big", " problem", " we", "'ve", " seen", " is", " when", " C", " code", " is", " getting", " called", " from", " higher", " level", " code", " in", " the", " same", " process", ",", " we", " lose", " all", " the", " debugging", " context", " between", " the", " higher", " level", " code", " and", " the", " underlying", " C", " code", ".", "\n", "\n", "So", " when", " we", " were", " getting", " these", " crashes", ",", " we", " didn", "'t", " have", " the", " expertise", " and", " tool", "ing", " to", " figure", " out", " what", " exactly", " the", " Er", "lang", " code", " was", " doing", " at", " the", " moment", " it", " crashed", ".", " Er", "lang", " is", " highly", " concurrent", " and", " many", " different", " things", " were", " all", " being", " executed", " at", " the", " same", " time", ".", " We", " knew", " it", " had", " something", " to", " do", " with", " the", " async", " IO", " settings", " we", " were", " using", " in", " the", " VM", " and", " the", " opening", " and", " closing", " of", " files", ",", " but", " exactly", " what", " or", " why", " still", " el", "uded", " us", ".", "\n", "\n", "Also", ",", " we", " couldn", "'t", " manifest", " the", " crash", " with", " test", " code", ",", " though", " we", " tried", ",", " making", " it", " hard", " to", " report", " the", " issue", " to", " Er", "lang", " maintain", "ers", ".", " We", " had", " to", " run", " the", " full", " Couch", "base", " stack", " with", " heavy", " load", " in", " order", " to", " trigger", " the", " crash", ",", " and", " it", " would", " often", " take", " 6", " or", " more", " hours", " before", " we", " saw", " it", ".", " This", " made", " debugging", " problematic", " as", " we", " had", " confounding", " factors", " of", " our", " own", " in", "-", "process", " C", " code", " that", " also", " could", " have", " been", " the", " source", " of", " the", " crashes", ".", "\n", "\n", "In", " the", " end", ",", " we", " found", " through", " code", " inspection", " the", " problem", " was", " Er", "lang", "'s", " disk", " based", " sorting", " code", ",", " the", " compression", " options", " it", " was", " using", ",", " and", " the", " interaction", " with", " how", " Er", "lang", " closes", " files", ".", " When", " Er", "lang", " closed", " files", " with", " the", " compression", " option", " it", " would", " occasionally", " have", " a", " race", " condition", " low", " down", " in", " VM", " that", " would", " lead", " to", " a", " dangling", " pointer", " and", " a", " double", "-", "free", ".", " If", " we", " hadn", "'t", " lost", " all", " the", " context", " between", " the", " Er", "lang", " user", " code", " and", " the", " underlying", " C", " code", ",", " we", " could", " have", " tracked", " this", " problem", " down", " much", " sooner", ".", " We", " would", " have", " had", " a", " complete", " C", " stack", "trace", " of", " what", " our", " code", " was", " doing", " when", " the", " library", " code", " crashed", ",", " allowing", " us", " to", " narrow", " down", " very", " quickly", " the", " flawed", " C", " code", "/", "modules", ".", "\n", "\n", "Why", " Isn", "'t", " C", "++", " a", " suitable", " replacement", " for", " C", "?", "\n", "\n", "Often", " it", " is", ",", " but", " the", " problem", " with", " C", "++", " you", " have", " to", " be", " very", " disciplined", " to", " use", " it", " and", " not", " complicate", "/", "ob", "fusc", "ate", " your", " code", " unnecessarily", ".", " It", "'s", " also", " not", " as", " portable", " to", " as", " many", " environments", " (", "particularly", " embedded", "),", " and", " tends", " to", " have", " much", " higher", " compilation", " and", " build", " times", ",", " which", " negatively", " affects", " developer", " productivity", ".", "\n", "\n", "C", "++", " is", " also", " a", " complicated", " mess", ",", " so", " when", " you", " adopt", " C", "++", " for", " its", " libraries", " and", " community", ",", " you", " have", " to", " take", " the", " good", " with", " the", " bad", " and", " weird", " to", " get", " the", " benefits", ".", " And", " there", " is", " a", " lot", " of", " disagreement", " what", " constitutes", " bad", " or", " weird", ".", " Your", " sane", " subset", " of", " the", " language", " is", " very", " likely", " to", " be", " at", " odds", " with", " others", " ideas", " of", " a", " sane", " subset", ".", " C", " has", " this", " problem", " to", " a", " much", " much", " smaller", " degree", ".", "\n", "\n", "What", " about", " Go", " as", " a", " replacement", " for", " C", "?", "\n", "\n", "Perhaps", " someday", ".", " Right", " now", " Go", " is", " far", " slower", " than", " C", ".", " It", " also", " doesn", "'t", " give", " as", " good", " of", " control", " over", " memory", " since", " it", "'s", " garbage", " collected", ".", " It", "'s", " not", " as", " portable", ",", " and", " you", " also", " can", "'t", " host", " Go", " code", " in", " other", " environments", " or", " language", " V", "Ms", ",", " limiting", " what", " you", " can", " do", " with", " your", " code", ".", "\n", "\n", "Go", " however", " has", " a", " lot", " of", " momentum", " and", " a", " very", " bright", " future", ",", " they", "'ve", " made", " some", " very", " nice", " and", " pragmatic", " choices", " in", " its", " design", ".", " If", " it", " continues", " to", " flourish", " I", " expect", " every", " objection", " I", " listed", ",", " except", " for", " the", " garbage", " collection", ",", " will", " eventually", " be", " addressed", ".", "\n", "\n", "What", " about", " D", " as", " a", " replacement", " for", " C", "?", "\n", "\n", "It", "'s", " not", " there", " for", " the", " same", " reasons", " as", " Go", ".", " It", "'s", " possible", " that", " someday", " it", " will", " be", " suitable", ",", " but", " I", "'m", " less", " optimistic", " about", " it", " strictly", " from", " a", " momentum", " perspective", ",", " it", " doesn", "'t", " have", " a", " big", " backer", " like", " Google", " and", " doesn", "'t", " seem", " to", " be", " growing", " very", " rapidly", ".", " But", " perhaps", " it", " will", " get", " there", " someday", ".", "\n", "\n", "Is", " there", " anything", " else", " that", " could", " replace", " C", "?", "\n", "\n", "I", " don", "'t", " know", " a", " lot", " of", " what", "'s", " out", " there", " on", " the", " horizon", ",", " and", " there", " are", " some", " efforts", " to", " create", " a", " better", " C", ".", " But", " for", " completely", " new", " languages", " as", " a", " replacement", ",", " I", "'m", " most", " hopeful", " and", " optimistic", " about", " Mozilla", "'s", " Rust", ".", " It", "'s", " designed", " to", " be", " fast", " and", " portable", ",", " call", "able", " from", " any", " language", "/", "environment", " much", " like", " C", ",", " with", " no", " garbage", " collection", " yet", " still", " safe", " from", " buffer", " overrun", "s", ",", " leaks", " and", " race", " conditions", ".", " It", " also", " has", " Er", "lang", " style", " conc", "urrency", " features", " built", " in", ".", "\n", "\n", "But", " it", "'s", " a", " very", " young", " and", " rapidly", " evolving", " language", ".", " The", " performance", " is", " not", " yet", " close", " to", " C", ".", " The", " syntax", " might", " be", " too", " foreign", " for", " the", " masses", " to", " ever", " hit", " the", " mainstream", ",", " and", " it", " may", " suffer", " the", " same", " niche", " fate", " as", " Er", "lang", " because", " of", " that", ".", "\n", "\n", "However", " if", " Rust", " achieves", " its", " stated", " goals", ",", " C", "-", "like", " performance", " but", " safe", " with", " Er", "lang", " conc", "urrency", " and", " robust", "ness", " built", " in", ",", " it", " would", " be", " the", " language", " of", " my", " dreams", ".", " I", "'ll", " be", " watching", " its", " progress", " very", " closely", ".", "\n", "\n", "That", "'s", " just", ",", " like", ",", " your", " opinion", ",", " man", "\n", "\n", "Yes", ",", " my", " post", " was", " an", " opinion", " piece", ".", "\n", "\n", "But", " I", "'m", " not", " new", " to", " this", " programming", " game", ".", " I", "'ve", " done", " this", " professionally", " since", " 1995", ".", "\n", "\n", "I", "'ve", " coded", " GU", "Is", " using", " very", " high", " level", " languages", " likes", " HTML", "/", "J", "avascript", " and", " Visual", " Basic", ",", " and", " with", " lower", " level", " languages", " like", " Java", ",", " C", " and", " C", "++", ".", "\n", "\n", "I", "'ve", " built", " a", " ton", " of", " backend", " code", " in", " C", ",", " C", "++", " and", " Er", "lang", ".", " I", "'ve", " written", " in", " excess", " of", " 100", "k", " lines", " of", " C", " and", " C", "++", " code", ".", " I", "'ve", " easily", " read", ",", " line", " by", " line", ",", " 300", "k", " lines", " of", " C", " code", ".", "\n", "\n", "I", "'ve", " written", " a", " byte", " code", " VM", " in", " C", "++", " that", "'s", " been", " deployed", " on", " 100", " million", "+", " desk", "tops", " and", " 100", "'s", " of", " thousands", " of", " servers", ".", " I", " used", " C", "++", " inheritance", ",", " templates", ",", " exceptions", ",", " custom", " memory", " allocation", " and", " a", " bunch", " of", " other", " features", " I", " thought", " were", " very", " cool", " at", " the", " time", ".", " Now", " I", " feel", " bad", " for", " the", " people", " who", " have", " to", " maintain", " it", ".", "\n", "\n", "I", "'ve", " fixed", " many", " bugs", " in", " MySQL", " and", " its", " C", "++", " code", "base", ".", " I", " wrote", " the", " Enterprise", " Edition", " thread", " pool", "ing", " and", " event", "ed", " network", " IO", " feature", " that", " increases", " client", " scal", "ability", " by", " over", " an", " order", " of", " magnitude", ".", "\n", "\n", "Also", " created", " and", " wrote", ",", " from", " scratch", ",", " Apache", " Couch", "DB", ",", " including", " the", " storage", " engine", " &", " tail", " append", " b", "t", "rees", ",", " incremental", " Map", "/", "Red", "uce", " index", "er", " and", " query", " engine", ",", " master", "/", "master", " replication", " with", " conflict", " management", ",", " and", " the", " HTTP", " API", ",", " plus", " a", " z", "illion", " of", " small", " details", " necessary", " to", " make", " it", " all", " work", ".", "\n", "\n", "In", " short", ",", " I", " have", " substantial", " real", " world", " experience", " in", " projects", " used", " by", " millions", " of", " people", " everyday", ".", " Maybe", " I", " know", " what", " I", "'m", " talking", " about", ".", "\n", "\n", "So", " while", " most", " of", " what", " I", " wrote", " is", " my", " opinion", " and", " difficult", " to", " back", " up", " with", " hard", " data", ",", " it", "'s", " born", " from", " being", " cut", " so", " many", " times", " with", " the", " newest", " and", " coolest", " stuff", ".", " My", " view", " of", " C", " has", " changed", " over", " the", " years", ",", " and", " I", " used", " to", " think", " the", " older", " guys", " who", " loved", " C", " were", " just", " behind", " the", " times", ".", " Now", " I", " see", " why", " many", " of", " them", " felt", " that", " way", ",", " they", " saw", " what", " is", " traded", " away", " when", " you", " stray", " from", " the", " simple", " and", " effective", ".", "\n", "\n", "Think", " about", " the", " most", " widely", " used", " backend", " projects", " around", " and", " see", " how", " they", " are", " able", " to", " get", " both", " reliability", " and", " performance", ".", " Ch", "ances", " are", ",", " they", " are", " using", " plain", " C", ".", " That", "'s", " not", " just", " a", " coincidence", ".", "\n", "\n", "Follow", " me", " on", " Twitter", " for", " more", " of", " my", " coding", " opinions", " and", " updates", " on", " Couch", "base", " progress", ".", "\n", "\n", "Posted", " January", " 17", ",", " 2013", " 11", ":", "27", " AM"]