["R", "aster", " L", "ayers", "\u00b6", "\n", "\n", "Close", " a", " r", "aster", " dataset", "\u00b6", " This", " recipe", " shows", " how", " to", " close", " a", " r", "aster", " dataset", ".", " It", " is", " useful", " in", " the", " middle", " of", " a", " script", ",", " to", " recover", " the", " resources", " held", " by", " accessing", " the", " dataset", ",", " remove", " file", " locks", ",", " etc", ".", " It", " is", " not", " necessary", " at", " the", " end", " of", " the", " script", ",", " as", " the", " Python", " garbage", " collector", " will", " do", " the", " same", " thing", " automatically", " when", " the", " script", " exits", ".", " Further", " discussion", " of", " this", " topic", " can", " be", " found", " in", " this", " G", "IS", " Stack", "Ex", "change", " question", ".", " import", " g", "dal", " #", " open", " dataset", " d", "s", " =", " g", "dal", ".", " Open", " (", " '", "test", ".", "tif", "'", " )", " #", " close", " dataset", " d", "s", " =", " None", "\n", "\n", "Get", " R", "aster", " Met", "adata", "\u00b6", " Get", " r", "aster", " metadata", " for", " quick", "-", "and", "-", "dirty", " resolution", " checks", " from", " os", "ge", "o", " import", " g", "dal", " g", "tif", " =", " g", "dal", ".", " Open", " (", " \"", "IN", "PUT", ".", "tif", "\"", " )", " print", " g", "tif", ".", " Get", "Met", "adata", " ()", "\n", "\n", "Get", " R", "aster", " Band", "\u00b6", " Get", " a", " r", "aster", " band", ".", " Notice", " how", " we", " are", " handling", " runtime", " errors", " this", " function", " might", " throw", ".", " from", " os", "ge", "o", " import", " g", "dal", " import", " sys", " #", " this", " allows", " GD", "AL", " to", " throw", " Python", " Ex", "ceptions", " g", "dal", ".", " Use", "Ex", "ceptions", " ()", " try", " :", " src", "_", "ds", " =", " g", "dal", ".", " Open", " (", " \"", "IN", "PUT", ".", "tif", "\"", " )", " except", " Runtime", "Error", ",", " e", " :", " print", " '", "Un", "able", " to", " open", " IN", "PUT", ".", "tif", "'", " print", " e", " sys", ".", " exit", " (", " 1", " )", " try", " :", " src", "band", " =", " src", "_", "ds", ".", " Get", "R", "aster", "Band", " (", " 1", " )", " except", " Runtime", "Error", ",", " e", " :", " #", " for", " example", ",", " try", " Get", "R", "aster", "Band", "(", "10", ")", " print", " '", "Band", " (", " %", "i", " )", " not", " found", "'", " %", " band", "_", "num", " print", " e", " sys", ".", " exit", " (", " 1", " )", "\n", "\n", "Loop", " Through", " All", " R", "aster", " B", "ands", "\u00b6", " Loop", " through", " all", " r", "aster", " bands", " and", " do", " something", " useful", " like", " listing", " band", " statistics", ".", " from", " os", "ge", "o", " import", " g", "dal", " import", " sys", " src", "_", "ds", " =", " g", "dal", ".", " Open", " (", " \"", "IN", "PUT", ".", "tif", "\"", " )", " if", " src", "_", "ds", " is", " None", " :", " print", " '", "Un", "able", " to", " open", " IN", "PUT", ".", "tif", "'", " sys", ".", " exit", " (", " 1", " )", " print", " \"[", " R", "AS", "TER", " B", "AND", " C", "OUNT", " ]", ":", " \"", ",", " src", "_", "ds", ".", " R", "aster", "Count", " for", " band", " in", " range", " (", " src", "_", "ds", ".", " R", "aster", "Count", " ):", " band", " +=", " 1", " print", " \"[", " GET", "TING", " B", "AND", " ]", ":", " \"", ",", " band", " src", "band", " =", " src", "_", "ds", ".", " Get", "R", "aster", "Band", " (", " band", " )", " if", " src", "band", " is", " None", " :", " continue", " stats", " =", " src", "band", ".", " Get", "Statistics", " (", " True", ",", " True", " )", " if", " stats", " is", " None", " :", " continue", " print", " \"[", " STATS", " ]", " =", " Minimum", "=", " %", ".", "3", "f", ",", " Maximum", "=", " %", ".", "3", "f", ",", " Mean", "=", " %", ".", "3", "f", ",", " St", "d", "Dev", "=", " %", ".", "3", "f", " \"", " %", " (", " \\", " stats", " [", " 0", " ],", " stats", " [", " 1", " ],", " stats", " [", " 2", " ],", " stats", " [", " 3", " ]", " )", "\n", "\n", "Get", " R", "aster", " Band", " Information", "\u00b6", " Using", " the", " documentation", " on", " the", " Band", " API", " we", " can", " write", " a", " script", " that", " dumps", " out", " single", " band", " information", " from", " os", "ge", "o", " import", " g", "dal", " import", " sys", " g", "dal", ".", " Use", "Ex", "ceptions", " ()", " def", " Usage", " (", "):", " print", " (", " \"\"\"", " $", " get", "r", "aster", "band", ".", "py", " [", " band", " number", " ]", " input", "-", "r", "aster", " \"\"\"", " )", " sys", ".", " exit", " (", " 1", " )", " def", " main", " (", " band", "_", "num", ",", " input", "_", "file", " ):", " src", "_", "ds", " =", " g", "dal", ".", " Open", " (", " input", "_", "file", " )", " if", " src", "_", "ds", " is", " None", " :", " print", " '", "Un", "able", " to", " open", " %", "s", " '", " %", " input", "_", "file", " sys", ".", " exit", " (", " 1", " )", " try", " :", " src", "band", " =", " src", "_", "ds", ".", " Get", "R", "aster", "Band", " (", " band", "_", "num", " )", " except", " Runtime", "Error", ",", " e", " :", " print", " '", "No", " band", " %", "i", " found", "'", " %", " band", "_", "num", " print", " e", " sys", ".", " exit", " (", " 1", " )", " print", " \"[", " NO", " DATA", " VAL", "UE", " ]", " =", " \"", ",", " src", "band", ".", " Get", "No", "Data", "Value", " ()", " print", " \"[", " MIN", " ]", " =", " \"", ",", " src", "band", ".", " Get", "Minimum", " ()", " print", " \"[", " MAX", " ]", " =", " \"", ",", " src", "band", ".", " Get", "Maximum", " ()", " print", " \"[", " SC", "ALE", " ]", " =", " \"", ",", " src", "band", ".", " Get", "Scale", " ()", " print", " \"[", " UN", "IT", " TYPE", " ]", " =", " \"", ",", " src", "band", ".", " Get", "Unit", "Type", " ()", " c", "table", " =", " src", "band", ".", " Get", "Color", "Table", " ()", " if", " c", "table", " is", " None", " :", " print", " '", "No", " Color", "Table", " found", "'", " sys", ".", " exit", " (", " 1", " )", " print", " \"[", " COL", "OR", " TABLE", " C", "OUNT", " ]", " =", " \"", ",", " c", "table", ".", " Get", "Count", " ()", " for", " i", " in", " range", " (", " 0", ",", " c", "table", ".", " Get", "Count", " ()", " ):", " entry", " =", " c", "table", ".", " Get", "Color", "Entry", " (", " i", " )", " if", " not", " entry", " :", " continue", " print", " \"[", " COL", "OR", " EN", "TRY", " RGB", " ]", " =", " \"", ",", " c", "table", ".", " Get", "Color", "Entry", "As", "RGB", " (", " i", ",", " entry", " )", " if", " __", "name", "__", " ==", " '", "__", "main", "__", "'", " :", " if", " len", " (", " sys", ".", " arg", "v", " )", " <", " 3", " :", " print", " \"\"\"", " [", " ERROR", " ]", " you", " must", " supply", " at", " least", " two", " arguments", ":", " 1", ")", " the", " band", " number", " to", " retrieve", " and", " 2", ")", " input", " r", "aster", " \"\"\"", " Usage", " ()", " main", " (", " int", " (", " sys", ".", " arg", "v", " [", " 1", " ]", "),", " sys", ".", " arg", "v", " [", " 2", " ]", " )", "\n", "\n", "Poly", "gon", "ize", " a", " R", "aster", " Band", "\u00b6", " Turn", " a", " single", " r", "aster", " band", " into", " a", " vector", " poly", "gon", "!", " If", " you", " haven", "\ufffd", "\ufffd", "t", " before", ",", " notice", " that", " some", " of", " the", " g", "dal", " ut", "ilt", "ies", " are", " actually", " Python", " scripts", ".", " Go", " find", " them", " on", " your", " computer", ",", " read", " the", " source", " code", " and", " mine", " them", " for", " API", " tricks", ".", " It", " turns", " out", " the", " g", "dal", "_", "poly", "gon", "ize", " utility", " just", " wraps", " a", " call", " to", " GD", "AL", "FP", "oly", "gon", "ize", " so", " writing", " your", " own", " hack", "y", " poly", "gon", "ize", " Python", " script", " is", " pretty", " easy", ".", " The", " r", "aster", " we", " are", " going", " to", " poly", "gon", "ize", ":", " from", " os", "ge", "o", " import", " g", "dal", ",", " o", "gr", " import", " sys", " #", " this", " allows", " GD", "AL", " to", " throw", " Python", " Ex", "ceptions", " g", "dal", ".", " Use", "Ex", "ceptions", " ()", " #", " #", " get", " r", "aster", " datas", "ource", " #", " src", "_", "ds", " =", " g", "dal", ".", " Open", " (", " \"", "IN", "PUT", ".", "tif", "\"", " )", " if", " src", "_", "ds", " is", " None", " :", " print", " '", "Un", "able", " to", " open", " %", "s", " '", " %", " src", "_", "filename", " sys", ".", " exit", " (", " 1", " )", " try", " :", " src", "band", " =", " src", "_", "ds", ".", " Get", "R", "aster", "Band", " (", " 3", " )", " except", " Runtime", "Error", ",", " e", " :", " #", " for", " example", ",", " try", " Get", "R", "aster", "Band", "(", "10", ")", " print", " '", "Band", " (", " %", "i", " )", " not", " found", "'", " %", " band", "_", "num", " print", " e", " sys", ".", " exit", " (", " 1", " )", " #", " #", " create", " output", " datas", "ource", " #", " dst", "_", "lay", "ername", " =", " \"", "POL", "Y", "G", "ON", "IZ", "ED", "_", "ST", "UFF", "\"", " dr", "v", " =", " o", "gr", ".", " Get", "Driver", "By", "Name", " (", " \"", "ES", "RI", " Shape", "file", "\"", " )", " dst", "_", "ds", " =", " dr", "v", ".", " Create", "Data", "Source", " (", " dst", "_", "lay", "ername", " +", " \".", "sh", "p", "\"", " )", " dst", "_", "layer", " =", " dst", "_", "ds", ".", " Create", "Layer", " (", " dst", "_", "lay", "ername", ",", " s", "rs", " =", " None", " )", " g", "dal", ".", " Poly", "gon", "ize", " (", " src", "band", ",", " None", ",", " dst", "_", "layer", ",", " -", " 1", ",", " [", "],", " callback", " =", " None", " )", " A", " close", "up", " of", " the", " vector", " output", " \u2013", " this", " is", " northern", " Italy", ":", "\n", "\n", "Con", "vert", " an", " O", "GR", " File", " to", " a", " R", "aster", "\u00b6", " This", " recipe", " takes", " in", " a", " O", "GR", " file", " (", "e", ".", "g", ".", " shape", "file", ")", " and", " creates", " a", " new", " r", "aster", " Tiff", " file", " based", " on", " the", " shape", "file", ".", " from", " os", "ge", "o", " import", " g", "dal", ",", " o", "gr", " #", " Def", "ine", " pixel", "_", "size", " and", " No", "Data", " value", " of", " new", " r", "aster", " pixel", "_", "size", " =", " 25", " No", "Data", "_", "value", " =", " -", " 9", "999", " #", " Fil", "ename", " of", " input", " O", "GR", " file", " vector", "_", "fn", " =", " '", "test", ".", "sh", "p", "'", " #", " Fil", "ename", " of", " the", " r", "aster", " Tiff", " that", " will", " be", " created", " r", "aster", "_", "fn", " =", " '", "test", ".", "tif", "'", " #", " Open", " the", " data", " source", " and", " read", " in", " the", " extent", " source", "_", "ds", " =", " o", "gr", ".", " Open", " (", " vector", "_", "fn", " )", " source", "_", "layer", " =", " source", "_", "ds", ".", " Get", "Layer", " ()", " x", "_", "min", ",", " x", "_", "max", ",", " y", "_", "min", ",", " y", "_", "max", " =", " source", "_", "layer", ".", " Get", "Ext", "ent", " ()", " #", " Create", " the", " destination", " data", " source", " x", "_", "res", " =", " int", " ((", " x", "_", "max", " -", " x", "_", "min", " )", " /", " pixel", "_", "size", " )", " y", "_", "res", " =", " int", " ((", " y", "_", "max", " -", " y", "_", "min", " )", " /", " pixel", "_", "size", " )", " target", "_", "ds", " =", " g", "dal", ".", " Get", "Driver", "By", "Name", " (", " '", "GT", "iff", "'", " )", ".", " Create", " (", " r", "aster", "_", "fn", ",", " x", "_", "res", ",", " y", "_", "res", ",", " 1", ",", " g", "dal", ".", " G", "DT", "_", "Byte", " )", " target", "_", "ds", ".", " Set", "Ge", "o", "Transform", " ((", " x", "_", "min", ",", " pixel", "_", "size", ",", " 0", ",", " y", "_", "max", ",", " 0", ",", " -", " pixel", "_", "size", " ))", " band", " =", " target", "_", "ds", ".", " Get", "R", "aster", "Band", " (", " 1", " )", " band", ".", " Set", "No", "Data", "Value", " (", " No", "Data", "_", "value", " )", " #", " R", "aster", "ize", " g", "dal", ".", " R", "aster", "ize", "Layer", " (", " target", "_", "ds", ",", " [", " 1", " ],", " source", "_", "layer", ",", " burn", "_", "values", " =", " [", " 0", " ])", "\n", "\n", "Cl", "ip", " a", " Geo", "T", "iff", " with", " Shape", "file", "\u00b6", " Let", "\ufffd", "\ufffd", "s", " use", " some", " Natural", " Earth", " data", " and", " clip", " a", " 10", "m", " relief", " ge", "ot", "iff", " with", " the", " Europe", "/", "Paris", " time", "zone", " poly", "gon", ".", " Most", " of", " the", " following", " workflow", " came", " from", " this", " ge", "osp", "atial", "python", " post", ".", " However", ",", " the", " source", " code", " on", " that", " site", " assumes", " your", " clipping", " poly", "gon", " is", " the", " same", " extent", " as", " the", " input", " ge", "ot", "iff", ".", " If", " it", " is", " not", ",", " then", " your", " clipped", " ge", "ot", "iff", " will", " take", " the", " input", " ge", "ot", "iff", "\ufffd", "\ufffd", "s", " extent", ",", " which", " will", " be", " incorrect", ".", " The", " modified", " script", " below", " takes", " this", " into", " account", " and", " sets", " the", " correct", " x", ",", "y", " offsets", " for", " the", " clipped", " ge", "ot", "iff", ".", " Note", ",", " in", " the", " following", " example", " we", " are", " assuming", " you", " have", " the", " Python", " Imaging", " Library", " installed", ".", " Before", " Image", ":", " the", " input", " Natural", " Earth", " 10", "m", " ge", "ot", "iff", " with", " the", " time", "zone", " overlay", " we", " want", " to", " clip", " out", ":", " from", " os", "ge", "o", " import", " g", "dal", ",", " g", "dal", "n", "umeric", ",", " o", "gr", ",", " o", "sr", " import", " Image", ",", " Image", "Draw", " import", " os", ",", " sys", " g", "dal", ".", "Use", "Ex", "ceptions", " ()", " #", " This", " function", " will", " convert", " the", " r", "aster", "ized", " cl", "ipper", " shape", "file", " #", " to", " a", " mask", " for", " use", " within", " GD", "AL", ".", " def", " image", "To", "Array", " (", " i", " )", " :", " \"\"\"", " Con", "verts", " a", " Python", " Imaging", " Library", " array", " to", " a", " g", "dal", "n", "umeric", " image", ".", " \"\"\"", " a", " =", " g", "dal", "n", "umeric", ".", "from", "string", " (", " i", ".", "t", "ost", "ring", " ()", ",", " '", "b", "'", " )", " a", ".", "shape", " =", " i", ".", "im", ".", "size", " [", " 1", " ]", ",", " i", ".", "im", ".", "size", " [", " 0", " ]", " return", " a", " def", " array", "To", "Image", " (", " a", " )", " :", " \"\"\"", " Con", "verts", " a", " g", "dal", "n", "umeric", " array", " to", " a", " Python", " Imaging", " Library", " Image", ".", " \"\"\"", " i", " =", " Image", ".", "from", "string", " (", " '", "L", "'", ",", " (", " a", ".", "shape", " [", " 1", " ]", ",", "a", ".", "shape", " [", " 0", " ])", ",", " (", " a", ".", "ast", "ype", " (", " '", "b", "'", " ))", ".", "t", "ost", "ring", " ())", " return", " i", " def", " world", "2", "Pixel", " (", " geo", "Matrix", ",", " x", ",", " y", " )", " :", " \"\"\"", " Uses", " a", " g", "dal", " ge", "om", "at", "rix", " (", "gd", "al", ".", "Get", "Ge", "o", "Transform", "())", " to", " calculate", " the", " pixel", " location", " of", " a", " ge", "osp", "atial", " coordinate", " \"\"\"", " ul", "X", " =", " geo", "Matrix", " [", " 0", " ]", " ul", "Y", " =", " geo", "Matrix", " [", " 3", " ]", " x", "Dist", " =", " geo", "Matrix", " [", " 1", " ]", " y", "Dist", " =", " geo", "Matrix", " [", " 5", " ]", " r", "tn", "X", " =", " geo", "Matrix", " [", " 2", " ]", " r", "tn", "Y", " =", " geo", "Matrix", " [", " 4", " ]", " pixel", " =", " int", " ((", " x", " -", " ul", "X", " )", " /", " x", "Dist", " )", " line", " =", " int", " ((", " ul", "Y", " -", " y", " )", " /", " x", "Dist", " )", " return", " (", " pixel", ",", " line", " )", " #", " #", " EDIT", ":", " this", " is", " basically", " an", " overloaded", " #", " version", " of", " the", " g", "dal", "_", "array", ".", "Open", "Array", " passing", " in", " x", "off", ",", " y", "off", " explicitly", " #", " so", " we", " can", " pass", " these", " params", " off", " to", " Copy", "Dat", "as", "et", "Info", " #", " def", " Open", "Array", " (", " array", ",", " prototype", "_", "ds", " =", " None", ",", " x", "off", " =", " 0", ",", " y", "off", " =", " 0", " )", " :", " d", "s", " =", " g", "dal", ".", "Open", " (", " g", "dal", "n", "umeric", ".", "Get", "Array", "Filename", " (", " array", " )", " )", " if", " d", "s", " is", " not", " None", " and", " prototype", "_", "ds", " is", " not", " None", ":", " if", " type", " (", " prototype", "_", "ds", " )", ".", "__", "name", "__", " ==", " '", "str", "'", " :", " prototype", "_", "ds", " =", " g", "dal", ".", "Open", " (", " prototype", "_", "ds", " )", " if", " prototype", "_", "ds", " is", " not", " None", ":", " g", "dal", "n", "umeric", ".", "Copy", "Dat", "as", "et", "Info", " (", " prototype", "_", "ds", ",", " d", "s", ",", " x", "off", " =", " x", "off", ",", " y", "off", " =", " y", "off", " )", " return", " d", "s", " def", " hist", "ogram", " (", " a", ",", " bins", " =", " range", " (", " 0", ",", "256", " ))", " :", " \"\"\"", " Hist", "ogram", " function", " for", " multi", "-", "dimensional", " array", ".", " a", " =", " array", " bins", " =", " range", " of", " numbers", " to", " match", " \"\"\"", " fa", " =", " a", ".", "flat", " n", " =", " g", "dal", "n", "umeric", ".", "search", "s", "orted", " (", " g", "dal", "n", "umeric", ".", "sort", " (", " fa", " )", ",", " bins", " )", " n", " =", " g", "dal", "n", "umeric", ".", "con", "cat", "en", "ate", " ([", " n", ",", " [", " len", " (", " fa", " )", "]]", ")", " hist", " =", " n", " [", " 1", ":", " ]", " -", "n", " [", " :", "-", "1", " ]", " return", " hist", " def", " stretch", " (", " a", " )", " :", " \"\"\"", " Per", "forms", " a", " hist", "ogram", " stretch", " on", " a", " g", "dal", "n", "umeric", " array", " image", ".", " \"\"\"", " hist", " =", " hist", "ogram", " (", " a", " )", " im", " =", " array", "To", "Image", " (", " a", " )", " l", "ut", " =", " []", " for", " b", " in", " range", " (", " 0", ",", " len", " (", " hist", " )", ",", " 256", " )", " :", " #", " step", " size", " step", " =", " reduce", " (", " operator", ".", "add", ",", " hist", " [", " b", ":", "b", "+", "256", " ])", " /", " 255", " #", " create", " equal", "ization", " lookup", " table", " n", " =", " 0", " for", " i", " in", " range", " (", " 256", " )", " :", " l", "ut", ".", "append", " (", " n", " /", " step", " )", " n", " =", " n", " +", " hist", " [", " i", "+", "b", " ]", " im", " =", " im", ".", "point", " (", " l", "ut", " )", " return", " image", "To", "Array", " (", " im", " )", " def", " main", " (", " shape", "file", "_", "path", ",", " r", "aster", "_", "path", " )", " :", " #", " Load", " the", " source", " data", " as", " a", " g", "dal", "n", "umeric", " array", " src", "Array", " =", " g", "dal", "n", "umeric", ".", "Load", "File", " (", " r", "aster", "_", "path", " )", " #", " Also", " load", " as", " a", " g", "dal", " image", " to", " get", " ge", "ot", "rans", "form", " #", " (", "world", " file", ")", " info", " src", "Image", " =", " g", "dal", ".", "Open", " (", " r", "aster", "_", "path", " )", " geo", "Trans", " =", " src", "Image", ".", "Get", "Ge", "o", "Transform", " ()", " #", " Create", " an", " O", "GR", " layer", " from", " a", " boundary", " shape", "file", " shape", "f", " =", " o", "gr", ".", "Open", " (", " shape", "file", "_", "path", " )", " lyr", " =", " shape", "f", ".", "Get", "Layer", " (", " os", ".", "path", ".", "split", " (", " os", ".", "path", ".", "spl", "ite", "xt", " (", " shape", "file", "_", "path", " )", "[", " 0", " ]", " )", "[", " 1", " ]", " )", " poly", " =", " lyr", ".", "Get", "Next", "Feature", " ()", " #", " Convert", " the", " layer", " extent", " to", " image", " pixel", " coordinates", " min", "X", ",", " max", "X", ",", " min", "Y", ",", " max", "Y", " =", " lyr", ".", "Get", "Ext", "ent", " ()", " ul", "X", ",", " ul", "Y", " =", " world", "2", "Pixel", " (", " geo", "Trans", ",", " min", "X", ",", " max", "Y", " )", " l", "r", "X", ",", " l", "r", "Y", " =", " world", "2", "Pixel", " (", " geo", "Trans", ",", " max", "X", ",", " min", "Y", " )", " #", " Calcul", "ate", " the", " pixel", " size", " of", " the", " new", " image", " p", "x", "Width", " =", " int", " (", " l", "r", "X", " -", " ul", "X", " )", " p", "x", "Height", " =", " int", " (", " l", "r", "Y", " -", " ul", "Y", " )", " clip", " =", " src", "Array", " [", " :", ",", " ul", "Y", ":", "lr", "Y", ",", " ul", "X", ":", "lr", "X", " ]", " #", " #", " EDIT", ":", " create", " pixel", " offset", " to", " pass", " to", " new", " image", " Project", "ion", " info", " #", " x", "offset", " =", " ul", "X", " y", "offset", " =", " ul", "Y", " print", " \"", "X", "offset", ",", " Y", "offset", " =", " (", " %", "f", ",", " %", "f", " )", "\"", " %", " (", " x", "offset", ",", " y", "offset", " )", " #", " Create", " a", " new", " ge", "om", "at", "rix", " for", " the", " image", " geo", "Trans", " =", " list", " (", " geo", "Trans", " )", " geo", "Trans", " [", " 0", " ]", " =", " min", "X", " geo", "Trans", " [", " 3", " ]", " =", " max", "Y", " #", " Map", " points", " to", " pixels", " for", " drawing", " the", " #", " boundary", " on", " a", " blank", " 8", "-", "bit", ",", " #", " black", " and", " white", ",", " mask", " image", ".", " points", " =", " []", " pixels", " =", " []", " ge", "om", " =", " poly", ".", "Get", "Ge", "ometry", "Ref", " ()", " pts", " =", " ge", "om", ".", "Get", "Ge", "ometry", "Ref", " (", " 0", " )", " for", " p", " in", " range", " (", " pts", ".", "Get", "Point", "Count", " ())", " :", " points", ".", "append", " ((", " pts", ".", "Get", "X", " (", " p", " )", ",", " pts", ".", "Get", "Y", " (", " p", " )))", " for", " p", " in", " points", ":", " pixels", ".", "append", " (", " world", "2", "Pixel", " (", " geo", "Trans", ",", " p", " [", " 0", " ]", ",", " p", " [", " 1", " ]", "))", " r", "aster", "Poly", " =", " Image", ".", "new", " (", " \"", "L", "\"", ",", " (", " p", "x", "Width", ",", " p", "x", "Height", " )", ",", " 1", " )", " r", "aster", "ize", " =", " Image", "Draw", ".", "Draw", " (", " r", "aster", "Poly", " )", " r", "aster", "ize", ".", "poly", "gon", " (", " pixels", ",", " 0", " )", " mask", " =", " image", "To", "Array", " (", " r", "aster", "Poly", " )", " #", " Clip", " the", " image", " using", " the", " mask", " clip", " =", " g", "dal", "n", "umeric", ".", "cho", "ose", " (", " mask", ",", " \\", " (", " clip", ",", " 0", " ))", ".", "ast", "ype", " (", " g", "dal", "n", "umeric", ".", "uint", "8", " )", " #", " This", " image", " has", " 3", " bands", " so", " we", " stretch", " each", " one", " to", " make", " them", " #", " visually", " brighter", " for", " i", " in", " range", " (", " 3", " )", " :", " clip", " [", " i", ",", ":,", ":", " ]", " =", " stretch", " (", " clip", " [", " i", ",", ":,", ":", " ])", " #", " Save", " new", " t", "iff", " #", " #", " EDIT", ":", " instead", " of", " Save", "Array", ",", " let", "'s", " break", " all", " the", " #", " Save", "Array", " steps", " out", " more", " expl", "icity", " so", " #", " we", " can", " overwrite", " the", " offset", " of", " the", " destination", " #", " r", "aster", " #", " ###", " the", " old", " way", " using", " Save", "Array", " #", " #", " g", "dal", "n", "umeric", ".", "Save", "Array", "(", "clip", ",", " \"", "OU", "TP", "UT", ".", "tif", "\",", " format", "=\"", "GT", "iff", "\",", " prototype", "=", "r", "aster", "_", "path", ")", " #", " ###", " #", " g", "t", "iff", "Driver", " =", " g", "dal", ".", "Get", "Driver", "By", "Name", " (", " '", "GT", "iff", "'", " )", " if", " g", "t", "iff", "Driver", " is", " None", ":", " raise", " Value", "Error", " (", " \"", "Can", "'t", " find", " Geo", "T", "iff", " Driver", "\"", " )", " g", "t", "iff", "Driver", ".", "Create", "Copy", " (", " \"", "OU", "TP", "UT", ".", "tif", "\"", ",", " Open", "Array", " (", " clip", ",", " prototype", "_", "ds", " =", " r", "aster", "_", "path", ",", " x", "off", " =", " x", "offset", ",", " y", "off", " =", " y", "offset", " )", " )", " #", " Save", " as", " an", " 8", "-", "bit", " j", "peg", " for", " an", " easy", ",", " quick", " preview", " clip", " =", " clip", ".", "ast", "ype", " (", " g", "dal", "n", "umeric", ".", "uint", "8", " )", " g", "dal", "n", "umeric", ".", "Save", "Array", " (", " clip", ",", " \"", "OU", "TP", "UT", ".", "jpg", "\"", ",", " format", " =", " \"", "JP", "EG", "\"", " )", " g", "dal", ".", "Error", "Res", "et", " ()", " if", " __", "name", "__", " ==", " '", "__", "main", "__", "'", " :", " #", " #", " example", " run", " :", " $", " python", " clip", ".", "py", " /", "<", "full", "-", "path", ">", "/", "<", "shape", "file", "-", "name", ">.", "sh", "p", " /", "<", "full", "-", "path", ">", "/", "<", "r", "aster", "-", "name", ">.", "tif", " #", " if", " len", " (", " sys", ".", "arg", "v", " )", " <", " 2", ":", " print", " \"[", " ERROR", " ]", " you", " must", " two", " args", ".", " 1", ")", " the", " full", " shape", "file", " path", " and", " 2", ")", " the", " full", " r", "aster", " path", "\"", " sys", ".", "exit", " (", " 1", " )", " main", " (", " sys", ".", "arg", "v", " [", " 1", " ]", ",", " sys", ".", "arg", "v", " [", " 2", " ]", " )", " After", " Image", ":", " the", " clipped", " ge", "ot", "iff", " with", " the", " time", "zone", " border", " overlay", "ed", " in", " orange", " on", " top", " of", " input", " ge", "ot", "iff", ":", "\n", "\n", "Cal", "cul", "ate", " z", "onal", " statistics", "\u00b6", " This", " recipe", " calculates", " statistics", " on", " values", " of", " a", " r", "aster", " within", " the", " zones", " of", " a", " vector", " dataset", ".", " It", " returns", " for", " each", " feature", " a", " dictionary", " item", " (", "F", "ID", ")", " with", " the", " statistical", " values", " in", " the", " following", " order", ":", " Average", ",", " Mean", ",", " Med", "ain", ",", " Standard", " Dev", "iation", ",", " Vari", "ance", " While", " this", " recipe", " works", " and", " is", " a", " good", " example", ",", " it", " is", " generally", " recommended", " to", " use", " [", "r", "aster", "stats", "](", "https", "://", "github", ".", "com", "/", "per", "ry", "ge", "o", "/", "python", "-", "r", "aster", "-", "stats", ")", " for", " calculating", " z", "onal", " statistics", " with", " Python", ".", " import", " g", "dal", ",", " o", "gr", ",", " o", "sr", ",", " n", "umpy", " import", " sys", " def", " z", "onal", "_", "stats", " (", " feat", ",", " input", "_", "zone", "_", "poly", "gon", ",", " input", "_", "value", "_", "r", "aster", " ):", " #", " Open", " data", " r", "aster", " =", " g", "dal", ".", " Open", " (", " input", "_", "value", "_", "r", "aster", " )", " sh", "p", " =", " o", "gr", ".", " Open", " (", " input", "_", "zone", "_", "poly", "gon", " )", " lyr", " =", " sh", "p", ".", " Get", "Layer", " ()", " #", " Get", " r", "aster", " ge", "ore", "ference", " info", " transform", " =", " r", "aster", ".", " Get", "Ge", "o", "Transform", " ()", " x", "Origin", " =", " transform", " [", " 0", " ]", " y", "Origin", " =", " transform", " [", " 3", " ]", " pixel", "Width", " =", " transform", " [", " 1", " ]", " pixel", "Height", " =", " transform", " [", " 5", " ]", " #", " Rep", "ro", "ject", " vector", " geometry", " to", " same", " projection", " as", " r", "aster", " source", "SR", " =", " lyr", ".", " Get", "Sp", "atial", "Ref", " ()", " target", "SR", " =", " o", "sr", ".", " Sp", "atial", "Reference", " ()", " target", "SR", ".", " Import", "From", "W", "kt", " (", " r", "aster", ".", " Get", "Project", "ion", "Ref", " ())", " coord", "Trans", " =", " o", "sr", ".", " Coord", "inate", "Trans", "formation", " (", " source", "SR", ",", " target", "SR", " )", " feat", " =", " lyr", ".", " Get", "Next", "Feature", " ()", " ge", "om", " =", " feat", ".", " Get", "Ge", "ometry", "Ref", " ()", " ge", "om", ".", " Transform", " (", " coord", "Trans", " )", " #", " Get", " extent", " of", " feat", " ge", "om", " =", " feat", ".", " Get", "Ge", "ometry", "Ref", " ()", " if", " (", " ge", "om", ".", " Get", "Ge", "ometry", "Name", " ()", " ==", " '", "M", "ULT", "IP", "OL", "Y", "G", "ON", "'", " ):", " count", " =", " 0", " points", "X", " =", " [];", " points", "Y", " =", " []", " for", " poly", "gon", " in", " ge", "om", " :", " ge", "om", "In", "ner", " =", " ge", "om", ".", " Get", "Ge", "ometry", "Ref", " (", " count", " )", " ring", " =", " ge", "om", "In", "ner", ".", " Get", "Ge", "ometry", "Ref", " (", " 0", " )", " n", "ump", "oint", "s", " =", " ring", ".", " Get", "Point", "Count", " ()", " for", " p", " in", " range", " (", " n", "ump", "oint", "s", " ):", " l", "on", ",", " lat", ",", " z", " =", " ring", ".", " Get", "Point", " (", " p", " )", " points", "X", ".", " append", " (", " l", "on", " )", " points", "Y", ".", " append", " (", " lat", " )", " count", " +=", " 1", " el", "if", " (", " ge", "om", ".", " Get", "Ge", "ometry", "Name", " ()", " ==", " '", "POL", "Y", "G", "ON", "'", " ):", " ring", " =", " ge", "om", ".", " Get", "Ge", "ometry", "Ref", " (", " 0", " )", " n", "ump", "oint", "s", " =", " ring", ".", " Get", "Point", "Count", " ()", " points", "X", " =", " [];", " points", "Y", " =", " []", " for", " p", " in", " range", " (", " n", "ump", "oint", "s", " ):", " l", "on", ",", " lat", ",", " z", " =", " ring", ".", " Get", "Point", " (", " p", " )", " points", "X", ".", " append", " (", " l", "on", " )", " points", "Y", ".", " append", " (", " lat", " )", " else", " :", " sys", ".", " exit", " (", " \"", "ERROR", ":", " Ge", "ometry", " needs", " to", " be", " either", " Poly", "gon", " or", " Mult", "ip", "oly", "gon", "\"", " )", " x", "min", " =", " min", " (", " points", "X", " )", " x", "max", " =", " max", " (", " points", "X", " )", " y", "min", " =", " min", " (", " points", "Y", " )", " y", "max", " =", " max", " (", " points", "Y", " )", " #", " Spec", "ify", " offset", " and", " rows", " and", " columns", " to", " read", " x", "off", " =", " int", " ((", " x", "min", " -", " x", "Origin", " )", " /", " pixel", "Width", " )", " y", "off", " =", " int", " ((", " y", "Origin", " -", " y", "max", " )", " /", " pixel", "Width", " )", " x", "count", " =", " int", " ((", " x", "max", " -", " x", "min", " )", " /", " pixel", "Width", " )", " +", " 1", " y", "count", " =", " int", " ((", " y", "max", " -", " y", "min", " )", " /", " pixel", "Width", " )", " +", " 1", " #", " Create", " memory", " target", " r", "aster", " target", "_", "ds", " =", " g", "dal", ".", " Get", "Driver", "By", "Name", " (", " '", "M", "EM", "'", " )", ".", " Create", " (", " ''", ",", " x", "count", ",", " y", "count", ",", " 1", ",", " g", "dal", ".", " G", "DT", "_", "Byte", " )", " target", "_", "ds", ".", " Set", "Ge", "o", "Transform", " ((", " x", "min", ",", " pixel", "Width", ",", " 0", ",", " y", "max", ",", " 0", ",", " pixel", "Height", ",", " ))", " #", " Create", " for", " target", " r", "aster", " the", " same", " projection", " as", " for", " the", " value", " r", "aster", " r", "aster", "_", "s", "rs", " =", " o", "sr", ".", " Sp", "atial", "Reference", " ()", " r", "aster", "_", "s", "rs", ".", " Import", "From", "W", "kt", " (", " r", "aster", ".", " Get", "Project", "ion", "Ref", " ())", " target", "_", "ds", ".", " Set", "Project", "ion", " (", " r", "aster", "_", "s", "rs", ".", " Export", "To", "W", "kt", " ())", " #", " R", "aster", "ize", " zone", " poly", "gon", " to", " r", "aster", " g", "dal", ".", " R", "aster", "ize", "Layer", " (", " target", "_", "ds", ",", " [", " 1", " ],", " lyr", ",", " burn", "_", "values", " =", " [", " 1", " ])", " #", " Read", " r", "aster", " as", " arrays", " band", "d", "atar", "aster", " =", " r", "aster", ".", " Get", "R", "aster", "Band", " (", " 1", " )", " dat", "ar", "aster", " =", " band", "d", "atar", "aster", ".", " Read", "As", "Array", " (", " x", "off", ",", " y", "off", ",", " x", "count", ",", " y", "count", " )", ".", " ast", "ype", " (", " n", "umpy", ".", " float", " )", " band", "mask", " =", " target", "_", "ds", ".", " Get", "R", "aster", "Band", " (", " 1", " )", " dat", "am", "ask", " =", " band", "mask", ".", " Read", "As", "Array", " (", " 0", ",", " 0", ",", " x", "count", ",", " y", "count", " )", ".", " ast", "ype", " (", " n", "umpy", ".", " float", " )", " #", " Mask", " zone", " of", " r", "aster", " z", "oner", "aster", " =", " n", "umpy", ".", " ma", ".", " masked", "_", "array", " (", " dat", "ar", "aster", ",", " n", "umpy", ".", " logical", "_", "not", " (", " dat", "am", "ask", " ))", " #", " Calcul", "ate", " statistics", " of", " z", "onal", " r", "aster", " return", " n", "umpy", ".", " average", " (", " z", "oner", "aster", " ),", " n", "umpy", ".", " mean", " (", " z", "oner", "aster", " ),", " n", "umpy", ".", " median", " (", " z", "oner", "aster", " ),", " n", "umpy", ".", " std", " (", " z", "oner", "aster", " ),", " n", "umpy", ".", " var", " (", " z", "oner", "aster", " )", " def", " loop", "_", "z", "onal", "_", "stats", " (", " input", "_", "zone", "_", "poly", "gon", ",", " input", "_", "value", "_", "r", "aster", " ):", " sh", "p", " =", " o", "gr", ".", " Open", " (", " input", "_", "zone", "_", "poly", "gon", " )", " lyr", " =", " sh", "p", ".", " Get", "Layer", " ()", " feat", "List", " =", " range", " (", " lyr", ".", " Get", "Feature", "Count", " ())", " stat", "D", "ict", " =", " {}", " for", " F", "ID", " in", " feat", "List", " :", " feat", " =", " lyr", ".", " Get", "Feature", " (", " F", "ID", " )", " mean", "Value", " =", " z", "onal", "_", "stats", " (", " feat", ",", " input", "_", "zone", "_", "poly", "gon", ",", " input", "_", "value", "_", "r", "aster", " )", " stat", "D", "ict", " [", " F", "ID", " ]", " =", " mean", "Value", " return", " stat", "D", "ict", " def", " main", " (", " input", "_", "zone", "_", "poly", "gon", ",", " input", "_", "value", "_", "r", "aster", " ):", " return", " loop", "_", "z", "onal", "_", "stats", " (", " input", "_", "zone", "_", "poly", "gon", ",", " input", "_", "value", "_", "r", "aster", " )", " if", " __", "name", "__", " ==", " \"", "__", "main", "__", "\"", " :", " #", " #", " Returns", " for", " each", " feature", " a", " dictionary", " item", " (", "F", "ID", ")", " with", " the", " statistical", " values", " in", " the", " following", " order", ":", " Average", ",", " Mean", ",", " Med", "ain", ",", " Standard", " Dev", "iation", ",", " Vari", "ance", " #", " #", " example", " run", " :", " $", " python", " grid", ".", "py", " <", "full", "-", "path", "><", "output", "-", "shape", "file", "-", "name", ">.", "sh", "p", " x", "min", " x", "max", " y", "min", " y", "max", " grid", "Height", " grid", "Width", " #", " if", " len", " (", " sys", ".", " arg", "v", " )", "!=", " 3", " :", " print", " \"[", " ERROR", " ]", " you", " must", " supply", " two", " arguments", ":", " input", "-", "zone", "-", "shape", "file", "-", "name", ".", "sh", "p", " input", "-", "value", "-", "r", "aster", "-", "name", ".", "tif", " \"", " sys", ".", " exit", " (", " 1", " )", " print", " '", "Returns", " for", " each", " feature", " a", " dictionary", " item", " (", "F", "ID", ")", " with", " the", " statistical", " values", " in", " the", " following", " order", ":", " Average", ",", " Mean", ",", " Med", "ain", ",", " Standard", " Dev", "iation", ",", " Vari", "ance", "'", " print", " main", " (", " sys", ".", " arg", "v", " [", " 1", " ],", " sys", ".", " arg", "v", " [", " 2", " ]", " )", "\n", "\n", "R", "aster", " to", " vector", " line", "\u00b6", " This", " recipe", " converts", " r", "aster", " pixels", " with", " a", " specified", " value", " to", " vector", " lines", ".", " For", " example", " the", " blue", " pixels", " (", "value", " =", " 0", ")", " are", " converted", " to", " vector", " lines", ".", " import", " o", "gr", ",", " g", "dal", ",", " o", "sr", ",", " os", " import", " n", "umpy", " as", " np", " import", " it", "ert", "ools", " from", " math", " import", " sq", "rt", ",", " ce", "il", " def", " pixel", "Offset", "2", "coord", " (", " r", "aster", "fn", ",", " x", "Offset", ",", " y", "Offset", " ):", " r", "aster", " =", " g", "dal", ".", " Open", " (", " r", "aster", "fn", " )", " ge", "ot", "rans", "form", " =", " r", "aster", ".", " Get", "Ge", "o", "Transform", " ()", " origin", "X", " =", " ge", "ot", "rans", "form", " [", " 0", " ]", " origin", "Y", " =", " ge", "ot", "rans", "form", " [", " 3", " ]", " pixel", "Width", " =", " ge", "ot", "rans", "form", " [", " 1", " ]", " pixel", "Height", " =", " ge", "ot", "rans", "form", " [", " 5", " ]", " coord", "X", " =", " origin", "X", " +", " pixel", "Width", " *", " x", "Offset", " coord", "Y", " =", " origin", "Y", " +", " pixel", "Height", " *", " y", "Offset", " return", " coord", "X", ",", " coord", "Y", " def", " r", "aster", "2", "array", " (", " r", "aster", "fn", " ):", " r", "aster", " =", " g", "dal", ".", " Open", " (", " r", "aster", "fn", " )", " band", " =", " r", "aster", ".", " Get", "R", "aster", "Band", " (", " 1", " )", " array", " =", " band", ".", " Read", "As", "Array", " ()", " return", " array", " def", " array", "2", "sh", "p", " (", " array", ",", " out", "SH", "P", "fn", ",", " r", "aster", "fn", ",", " pixel", "Value", " ):", " #", " max", " distance", " between", " points", " r", "aster", " =", " g", "dal", ".", " Open", " (", " r", "aster", "fn", " )", " ge", "ot", "rans", "form", " =", " r", "aster", ".", " Get", "Ge", "o", "Transform", " ()", " pixel", "Width", " =", " ge", "ot", "rans", "form", " [", " 1", " ]", " max", "Distance", " =", " ce", "il", " (", " sq", "rt", " (", " 2", " *", " pixel", "Width", " *", " pixel", "Width", " ))", " print", " max", "Distance", " #", " array", "2", "dict", " count", " =", " 0", " road", "List", " =", " np", ".", " where", " (", " array", " ==", " pixel", "Value", " )", " multip", "oint", " =", " o", "gr", ".", " Ge", "ometry", " (", " o", "gr", ".", " w", "kb", "Multi", "Line", "String", " )", " point", "D", "ict", " =", " {}", " for", " index", "Y", " in", " road", "List", " [", " 0", " ]", ":", " index", "X", " =", " road", "List", " [", " 1", " ][", " count", " ]", " X", "coord", ",", " Y", "coord", " =", " pixel", "Offset", "2", "coord", " (", " r", "aster", "fn", ",", " index", "X", ",", " index", "Y", " )", " point", "D", "ict", " [", " count", " ]", " =", " (", " X", "coord", ",", " Y", "coord", " )", " count", " +=", " 1", " #", " dict", "2", "w", "kb", "Multi", "Line", "String", " mult", "il", "ine", " =", " o", "gr", ".", " Ge", "ometry", " (", " o", "gr", ".", " w", "kb", "Multi", "Line", "String", " )", " for", " i", " in", " it", "ert", "ools", ".", " combinations", " (", " point", "D", "ict", ".", " values", " (),", " 2", " ):", " point", "1", " =", " o", "gr", ".", " Ge", "ometry", " (", " o", "gr", ".", " w", "kb", "Point", " )", " point", "1", ".", " Add", "Point", " (", " i", " [", " 0", " ][", " 0", " ],", " i", " [", " 0", " ][", " 1", " ])", " point", "2", " =", " o", "gr", ".", " Ge", "ometry", " (", " o", "gr", ".", " w", "kb", "Point", " )", " point", "2", ".", " Add", "Point", " (", " i", " [", " 1", " ][", " 0", " ],", " i", " [", " 1", " ][", " 1", " ])", " distance", " =", " point", "1", ".", " Distance", " (", " point", "2", " )", " if", " distance", " <", " max", "Distance", " :", " line", " =", " o", "gr", ".", " Ge", "ometry", " (", " o", "gr", ".", " w", "kb", "Line", "String", " )", " line", ".", " Add", "Point", " (", " i", " [", " 0", " ][", " 0", " ],", " i", " [", " 0", " ][", " 1", " ])", " line", ".", " Add", "Point", " (", " i", " [", " 1", " ][", " 0", " ],", " i", " [", " 1", " ][", " 1", " ])", " mult", "il", "ine", ".", " Add", "Ge", "ometry", " (", " line", " )", " #", " w", "kb", "Multi", "Line", "String", "2", "sh", "p", " sh", "p", "Driver", " =", " o", "gr", ".", " Get", "Driver", "By", "Name", " (", " \"", "ES", "RI", " Shape", "file", "\"", " )", " if", " os", ".", " path", ".", " exists", " (", " out", "SH", "P", "fn", " ):", " sh", "p", "Driver", ".", " Delete", "Data", "Source", " (", " out", "SH", "P", "fn", " )", " out", "Data", "Source", " =", " sh", "p", "Driver", ".", " Create", "Data", "Source", " (", " out", "SH", "P", "fn", " )", " out", "Layer", " =", " out", "Data", "Source", ".", " Create", "Layer", " (", " out", "SH", "P", "fn", ",", " ge", "om", "_", "type", " =", " o", "gr", ".", " w", "kb", "Multi", "Line", "String", " )", " feature", "Def", "n", " =", " out", "Layer", ".", " Get", "Layer", "Def", "n", " ()", " out", "Feature", " =", " o", "gr", ".", " Feature", " (", " feature", "Def", "n", " )", " out", "Feature", ".", " Set", "Ge", "ometry", " (", " mult", "il", "ine", " )", " out", "Layer", ".", " Create", "Feature", " (", " out", "Feature", " )", " def", " main", " (", " r", "aster", "fn", ",", " out", "SH", "P", "fn", ",", " pixel", "Value", " ):", " array", " =", " r", "aster", "2", "array", " (", " r", "aster", "fn", " )", " array", "2", "sh", "p", " (", " array", ",", " out", "SH", "P", "fn", ",", " r", "aster", "fn", ",", " pixel", "Value", " )", " if", " __", "name", "__", " ==", " \"", "__", "main", "__", "\"", " :", " r", "aster", "fn", " =", " '", "test", ".", "tif", "'", " out", "SH", "P", "fn", " =", " '", "test", ".", "sh", "p", "'", " pixel", "Value", " =", " 0", " main", " (", " r", "aster", "fn", ",", " out", "SH", "P", "fn", ",", " pixel", "Value", " )", " The", " green", " lines", " show", " the", " converted", " lines", ".", "\n", "\n", "Create", " r", "aster", " from", " array", "\u00b6", " This", " recipe", " creates", " a", " r", "aster", " from", " an", " array", " import", " g", "dal", ",", " o", "gr", ",", " os", ",", " o", "sr", " import", " n", "umpy", " as", " np", " def", " array", "2", "r", "aster", " (", " new", "R", "aster", "fn", ",", " r", "aster", "Origin", ",", " pixel", "Width", ",", " pixel", "Height", ",", " array", " ):", " col", "s", " =", " array", ".", " shape", " [", " 1", " ]", " rows", " =", " array", ".", " shape", " [", " 0", " ]", " origin", "X", " =", " r", "aster", "Origin", " [", " 0", " ]", " origin", "Y", " =", " r", "aster", "Origin", " [", " 1", " ]", " driver", " =", " g", "dal", ".", " Get", "Driver", "By", "Name", " (", " '", "GT", "iff", "'", " )", " out", "R", "aster", " =", " driver", ".", " Create", " (", " new", "R", "aster", "fn", ",", " col", "s", ",", " rows", ",", " 1", ",", " g", "dal", ".", " G", "DT", "_", "Byte", " )", " out", "R", "aster", ".", " Set", "Ge", "o", "Transform", " ((", " origin", "X", ",", " pixel", "Width", ",", " 0", ",", " origin", "Y", ",", " 0", ",", " pixel", "Height", " ))", " out", "band", " =", " out", "R", "aster", ".", " Get", "R", "aster", "Band", " (", " 1", " )", " out", "band", ".", " Write", "Array", " (", " array", " )", " out", "R", "aster", "S", "RS", " =", " o", "sr", ".", " Sp", "atial", "Reference", " ()", " out", "R", "aster", "S", "RS", ".", " Import", "From", "E", "PS", "G", " (", " 43", "26", " )", " out", "R", "aster", ".", " Set", "Project", "ion", " (", " out", "R", "aster", "S", "RS", ".", " Export", "To", "W", "kt", " ())", " out", "band", ".", " Fl", "ush", "Cache", " ()", " def", " main", " (", " new", "R", "aster", "fn", ",", " r", "aster", "Origin", ",", " pixel", "Width", ",", " pixel", "Height", ",", " array", " ):", " reversed", "_", "arr", " =", " array", " [", "::", " -", " 1", " ]", " #", " reverse", " array", " so", " the", " t", "if", " looks", " like", " the", " array", " array", "2", "r", "aster", " (", " new", "R", "aster", "fn", ",", " r", "aster", "Origin", ",", " pixel", "Width", ",", " pixel", "Height", ",", " reversed", "_", "arr", " )", " #", " convert", " array", " to", " r", "aster", " if", " __", "name", "__", " ==", " \"", "__", "main", "__", "\"", " :", " r", "aster", "Origin", " =", " (", " -", " 123", ".", "257", "45", ",", " 45", ".", "43", "013", " )", " pixel", "Width", " =", " 10", " pixel", "Height", " =", " 10", " new", "R", "aster", "fn", " =", " '", "test", ".", "tif", "'", " array", " =", " np", ".", " array", " ([", "[", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", " ],", " [", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", " ],", " [", " 1", ",", " 0", ",", " 0", ",", " 0", ",", " 0", ",", " 1", ",", " 0", ",", " 0", ",", " 0", ",", " 0", ",", " 1", ",", " 0", ",", " 0", ",", " 0", ",", " 1", ",", " 0", ",", " 1", ",", " 1", ",", " 1", " ],", " [", " 1", ",", " 0", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 0", ",", " 1", ",", " 0", ",", " 1", ",", " 0", ",", " 1", ",", " 0", ",", " 1", ",", " 0", ",", " 1", ",", " 1", ",", " 1", " ],", " [", " 1", ",", " 0", ",", " 1", ",", " 0", ",", " 0", ",", " 1", ",", " 1", ",", " 0", ",", " 1", ",", " 0", ",", " 1", ",", " 0", ",", " 0", ",", " 0", ",", " 1", ",", " 0", ",", " 1", ",", " 1", ",", " 1", " ],", " [", " 1", ",", " 0", ",", " 1", ",", " 1", ",", " 0", ",", " 1", ",", " 1", ",", " 0", ",", " 1", ",", " 0", ",", " 1", ",", " 0", ",", " 1", ",", " 0", ",", " 1", ",", " 0", ",", " 1", ",", " 1", ",", " 1", " ],", " [", " 1", ",", " 0", ",", " 0", ",", " 0", ",", " 0", ",", " 1", ",", " 0", ",", " 0", ",", " 0", ",", " 0", ",", " 1", ",", " 0", ",", " 1", ",", " 0", ",", " 1", ",", " 0", ",", " 0", ",", " 0", ",", " 1", " ],", " [", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", " ],", " [", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", " ],", " [", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", ",", " 1", " ]", "])", " main", " (", " new", "R", "aster", "fn", ",", " r", "aster", "Origin", ",", " pixel", "Width", ",", " pixel", "Height", ",", " array", " )", " The", " create", " r", "aster", " from", " the", " example", " array", " looks", " like", " this", ":", "\n", "\n", "Create", " least", " cost", " path", "\u00b6", " This", " recipe", " creates", " a", " least", " cost", " path", " between", " two", " coordinates", " based", " on", " a", " r", "aster", " cost", " surface", ".", " In", " the", " example", " below", ",", " a", " cost", " path", " between", " point", " 1", " and", " point", " 2", " is", " created", " based", " on", " a", " slope", " r", "aster", ".", " import", " g", "dal", ",", " o", "sr", " from", " sk", "image", ".", "graph", " import", " route", "_", "through", "_", "array", " import", " n", "umpy", " as", " np", " def", " r", "aster", "2", "array", " (", " r", "aster", "fn", " ):", " r", "aster", " =", " g", "dal", ".", " Open", " (", " r", "aster", "fn", " )", " band", " =", " r", "aster", ".", " Get", "R", "aster", "Band", " (", " 1", " )", " array", " =", " band", ".", " Read", "As", "Array", " ()", " return", " array", " def", " coord", "2", "pixel", "Offset", " (", " r", "aster", "fn", ",", " x", ",", " y", " ):", " r", "aster", " =", " g", "dal", ".", " Open", " (", " r", "aster", "fn", " )", " ge", "ot", "rans", "form", " =", " r", "aster", ".", " Get", "Ge", "o", "Transform", " ()", " origin", "X", " =", " ge", "ot", "rans", "form", " [", " 0", " ]", " origin", "Y", " =", " ge", "ot", "rans", "form", " [", " 3", " ]", " pixel", "Width", " =", " ge", "ot", "rans", "form", " [", " 1", " ]", " pixel", "Height", " =", " ge", "ot", "rans", "form", " [", " 5", " ]", " x", "Offset", " =", " int", " ((", " x", " -", " origin", "X", " )", " /", " pixel", "Width", " )", " y", "Offset", " =", " int", " ((", " y", " -", " origin", "Y", " )", " /", " pixel", "Height", " )", " return", " x", "Offset", ",", " y", "Offset", " def", " create", "Path", " (", " Cost", "Sur", "face", "fn", ",", " cost", "Sur", "face", "Array", ",", " start", "Co", "ord", ",", " stop", "Co", "ord", " ):", " #", " coordinates", " to", " array", " index", " start", "Co", "ord", "X", " =", " start", "Co", "ord", " [", " 0", " ]", " start", "Co", "ord", "Y", " =", " start", "Co", "ord", " [", " 1", " ]", " start", "Index", "X", ",", " start", "Index", "Y", " =", " coord", "2", "pixel", "Offset", " (", " Cost", "Sur", "face", "fn", ",", " start", "Co", "ord", "X", ",", " start", "Co", "ord", "Y", " )", " stop", "Co", "ord", "X", " =", " stop", "Co", "ord", " [", " 0", " ]", " stop", "Co", "ord", "Y", " =", " stop", "Co", "ord", " [", " 1", " ]", " stop", "Index", "X", ",", " stop", "Index", "Y", " =", " coord", "2", "pixel", "Offset", " (", " Cost", "Sur", "face", "fn", ",", " stop", "Co", "ord", "X", ",", " stop", "Co", "ord", "Y", " )", " #", " create", " path", " indices", ",", " weight", " =", " route", "_", "through", "_", "array", " (", " cost", "Sur", "face", "Array", ",", " (", " start", "Index", "Y", ",", " start", "Index", "X", " ),", " (", " stop", "Index", "Y", ",", " stop", "Index", "X", " ),", " geometric", " =", " True", ",", " fully", "_", "connected", " =", " True", " )", " indices", " =", " np", ".", " array", " (", " indices", " )", ".", " T", " path", " =", " np", ".", " z", "eros", "_", "like", " (", " cost", "Sur", "face", "Array", " )", " path", " [", " indices", " [", " 0", " ],", " indices", " [", " 1", " ]", "]", " =", " 1", " return", " path", " def", " array", "2", "r", "aster", " (", " new", "R", "aster", "fn", ",", " r", "aster", "fn", ",", " array", " ):", " r", "aster", " =", " g", "dal", ".", " Open", " (", " r", "aster", "fn", " )", " ge", "ot", "rans", "form", " =", " r", "aster", ".", " Get", "Ge", "o", "Transform", " ()", " origin", "X", " =", " ge", "ot", "rans", "form", " [", " 0", " ]", " origin", "Y", " =", " ge", "ot", "rans", "form", " [", " 3", " ]", " pixel", "Width", " =", " ge", "ot", "rans", "form", " [", " 1", " ]", " pixel", "Height", " =", " ge", "ot", "rans", "form", " [", " 5", " ]", " col", "s", " =", " array", ".", " shape", " [", " 1", " ]", " rows", " =", " array", ".", " shape", " [", " 0", " ]", " driver", " =", " g", "dal", ".", " Get", "Driver", "By", "Name", " (", " '", "GT", "iff", "'", " )", " out", "R", "aster", " =", " driver", ".", " Create", " (", " new", "R", "aster", "fn", ",", " col", "s", ",", " rows", ",", " 1", ",", " g", "dal", ".", " G", "DT", "_", "Byte", " )", " out", "R", "aster", ".", " Set", "Ge", "o", "Transform", " ((", " origin", "X", ",", " pixel", "Width", ",", " 0", ",", " origin", "Y", ",", " 0", ",", " pixel", "Height", " ))", " out", "band", " =", " out", "R", "aster", ".", " Get", "R", "aster", "Band", " (", " 1", " )", " out", "band", ".", " Write", "Array", " (", " array", " )", " out", "R", "aster", "S", "RS", " =", " o", "sr", ".", " Sp", "atial", "Reference", " ()", " out", "R", "aster", "S", "RS", ".", " Import", "From", "W", "kt", " (", " r", "aster", ".", " Get", "Project", "ion", "Ref", " ())", " out", "R", "aster", ".", " Set", "Project", "ion", " (", " out", "R", "aster", "S", "RS", ".", " Export", "To", "W", "kt", " ())", " out", "band", ".", " Fl", "ush", "Cache", " ()", " def", " main", " (", " Cost", "Sur", "face", "fn", ",", " output", "Path", "fn", ",", " start", "Co", "ord", ",", " stop", "Co", "ord", " ):", " cost", "Sur", "face", "Array", " =", " r", "aster", "2", "array", " (", " Cost", "Sur", "face", "fn", " )", " #", " creates", " array", " from", " cost", " surface", " r", "aster", " path", "Array", " =", " create", "Path", " (", " Cost", "Sur", "face", "fn", ",", " cost", "Sur", "face", "Array", ",", " start", "Co", "ord", ",", " stop", "Co", "ord", " )", " #", " creates", " path", " array", " array", "2", "r", "aster", " (", " output", "Path", "fn", ",", " Cost", "Sur", "face", "fn", ",", " path", "Array", " )", " #", " converts", " path", " array", " to", " r", "aster", " if", " __", "name", "__", " ==", " \"", "__", "main", "__", "\"", " :", " Cost", "Sur", "face", "fn", " =", " '", "Cost", "Sur", "face", ".", "tif", "'", " start", "Co", "ord", " =", " (", " 345", "387", ".", "8", "71", ",", " 12", "678", "55", ".", "277", " )", " stop", "Co", "ord", " =", " (", " 345", "479", ".", "425", ",", " 12", "677", "99", ".", "626", " )", " output", "Path", "fn", " =", " '", "Path", ".", "tif", "'", " main", " (", " Cost", "Sur", "face", "fn", ",", " output", "Path", "fn", ",", " start", "Co", "ord", ",", " stop", "Co", "ord", " )", " The", " created", " cost", " path", " between", " the", " points", "."]