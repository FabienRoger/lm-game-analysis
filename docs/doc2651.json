["You", " can", " use", " it", " as", " a", " hash", " from", " a", " 2", "D", " coordinate", " to", " an", " integer", ".", "\n", "\n", "Some", " curves", " preserve", " locality", ";", " for", " example", ",", " points", " that", " are", " nearby", " in", " 2", "D", " space", " are", " likely", " to", " have", " similar", " Hilbert", " distances", ".", "\n", "\n", "It", "\ufffd", "\ufffd", "s", " an", " is", "omorph", "ism", ":", " you", " can", " turn", " a", " distance", " back", " into", " a", " 2", "D", " coordinate", ",", " in", " some", " cases", " quite", " easily", ".", "\n", "\n", "Loc", "ality", "-", "pres", "erving", " hashes", " can", " be", " useful", " for", " clust", "ering", " nodes", " of", " an", " R", "-", "tree", ",", " which", " is", " the", " general", "isation", " of", " a", " B", "-", "tree", " to", " spatial", " data", ".", "\n", "\n", "import", " Data", ".", "B", "its", "\n", "\n", "h", "il", "bert", "Distance", " ::", " (", "B", "its", " a", ",", " Ord", " a", ")", " =>", " Int", " ->", " (", "a", ",", "a", ")", " ->", " a", "\n", "\n", "h", "il", "bert", "Distance", " d", " (", "x", ",", "y", ")", "\n", "\n", "|", " x", " <", " 0", " ||", " x", " >=", " 1", " `", "shift", "L", "`", " d", " =", " error", " \"", "x", " bounds", "\"", "\n", "\n", "|", " y", " <", " 0", " ||", " y", " >=", " 1", " `", "shift", "L", "`", " d", " =", " error", " \"", "y", " bounds", "\"", "\n", "\n", "|", " otherwise", " =", " dist", " (", "1", " `", "shift", "L", "`", " (", "d", " -", " 1", "))", " (", "1", " `", "shift", "L", "`", " ((", "d", " -", " 1", ")", " *", " 2", "))", " 0", " x", " y", "\n", "\n", "where", " dist", " 0", " _", " result", " _", " _", " =", " result", "\n", "\n", "dist", " side", " area", " result", " x", " y", " =", "\n", "\n", "case", " (", "comp", "are", " x", " side", ",", " compare", " y", " side", ")", " of", "\n", "\n", "(", "LT", ",", " LT", ")", " ->", " step", " result", " y", " x", "\n", "\n", "(", "LT", ",", " _", ")", " ->", " step", " (", "result", " +", " area", ")", " x", " (", "y", " -", " side", ")", "\n", "\n", "(_", ",", " LT", ")", " ->", " step", " (", "result", " +", " area", " *", " 3", ")", " (", "side", " -", " y", " -", " 1", ")", "\n", "\n", "(", "side", " *", " 2", " -", " x", " -", " 1", ")", "\n", "\n", "(_", ",", " _", ")", " ->", " step", " (", "result", " +", " area", " *", " 2", ")", " (", "x", " -", " side", ")", " (", "y", " -", " side", ")", "\n", "\n", "where", " step", " =", " dist", " (", "side", " `", "shift", "R", "`", " 1", ")", " (", "area", " `", "shift", "R", "`", " 2", ")", "\n", "\n", "le", "bes", "gue", "Distance", " ::", " (", "Int", ",", " Int", ")", " ->", " Int", "\n", "\n", "le", "bes", "gue", "Distance", " (", "x", ",", "y", ")", " =", "\n", "\n", "let", " ms", " =", " [(", "0", "x", "00", "FF", "00", "FF", ",", " 8", "),", " (", "0", "x", "0", "F", "0", "F", "0", "F", "0", "F", ",", " 4", "),", "\n", "\n", "(", "0", "x", "3333", "3333", ",", " 2", "),", " (", "0", "x", "55", "55", "55", "55", ",", " 1", ")]", "\n", "\n", "aa", "ar", "gh", " x", " (", "mask", ",", "shift", ")", " =", " (", "x", ".", "|", ".", " (", "x", " `", "shift", "L", "`", " shift", "))", ".", "&", ".", " mask", "\n", "\n", "x", "'", " =", " fold", "l", " a", "a", "ar", "gh", " x", " ms", "\n", "\n", "y", "'", " =", " fold", "l", " a", "a", "ar", "gh", " y", " ms", "\n", "\n", "in", " x", ".", "|", ".", " (", "y", " `", "shift", "L", "`", " 1", ")", "\n", "\n", "The", " Hilbert", " curve", " is", " a", " fract", "al", " space", "-", "f", "illing", " curve", " that", " is", " rather", " pretty", " to", " look", " at", ".", " A", " Hilbert", " curve", " of", " order", " n", " traces", " a", " single", " path", " over", " a", " square", " of", " side", " 2", "^", "n", " units", ",", " as", " you", " can", " see", " in", " the", " images", " from", " Math", "World", " above", " (", "with", " curves", " of", " order", " 2", " through", " 6", ").", " If", " you", " pick", " a", " point", " p", " from", " within", " the", " square", " covered", " by", " a", " curve", ",", " and", " trace", " out", " the", " curve", " until", " you", " reach", " that", " point", ",", " the", " number", " of", " intermediate", " points", " that", " you", " passed", " through", " along", " your", " way", " to", " p", " is", " called", " the", " Hilbert", " distance", ".", " The", " notion", " of", " distance", " along", " a", " space", "-", "f", "illing", " curve", " is", " useful", " for", " a", " few", " reasons", ".", "There", "\ufffd", "\ufffd", "s", " a", " nice", " algorithm", " for", " computing", " the", " Hilbert", " distance", " of", " a", " 2", "D", " point", " that", "\ufffd", "\ufffd", "s", " linear", " in", " the", " order", " of", " the", " curve", " (", "or", " log", "ar", "ith", "mic", " in", " the", " size", " of", " the", " side", " of", " the", " square", " you", "\ufffd", "\ufffd", "re", " trying", " to", " cover", ").", " To", " put", " this", " into", " useful", " terms", ",", " a", " \ufffd", "\ufffd", "10", " meg", "apixel", "\ufffd", "\ufffd", " camera", " typically", " has", " a", " resolution", " of", " 37", "66", "\u00d7", "28", "00", " pixels", ".", " To", " cover", " every", " pixel", " with", " a", " Hilbert", " curve", ",", " you", "\ufffd", "\ufffd", "d", " need", " a", " curve", " with", " 4096", " points", " on", " a", " side", ",", " which", " is", " an", " order", "-", "12", " curve", ".", " You", " can", " compute", " the", " Hilbert", " distance", " of", " any", " point", " in", " your", " 10", "-", "meg", "apixel", " photo", " with", " 12", " steps", " of", " the", " distance", " algorithm", ".", " Here", "\ufffd", "\ufffd", "s", " an", " implementation", " of", " this", " Hilbert", " distance", " algorithm", " in", " Haskell", ".", "As", " you", " can", " see", ",", " each", " step", " requires", " a", " few", " comparisons", ",", " a", " few", " shifts", ",", " and", " a", " handful", " of", " arithmetic", " operations", ",", " so", " it", "\ufffd", "\ufffd", "s", " fairly", " cheap", ",", " and", " the", " loop", " un", "roll", "s", " and", " constant", "-", "f", "olds", " well", ".", " There", "\ufffd", "\ufffd", "s", " some", " controversy", " in", " the", " literature", " over", " whether", " a", " Hilbert", " curve", " gives", " better", " spatial", " locality", " than", " a", " Le", "bes", "gue", " (", "also", " known", " as", " a", " Z", "-", "order", ",", " or", " Morton", ")", " curve", ".", " It", "\ufffd", "\ufffd", "s", " certainly", " the", " case", " that", " computing", " the", " Le", "bes", "gue", " distance", " is", " much", " cheaper", " than", " the", " Hilbert", " distance", ",", " as", " it", "\ufffd", "\ufffd", "s", " possible", " to", " fin", "agle", " an", " answer", " using", " a", " fixed", ",", " unconditional", " sequence", " of", " bit", "-", "tw", "iddling", " operations", " to", " inter", "leave", " the", " bits", " of", " the", " x", " coordinate", " with", " those", " of", " the", " y", ".", "I", " haven", "\ufffd", "\ufffd", "t", " myself", " checked", " to", " see", " which", " curve", " better", " preserves", " locality", ".", " It", "\ufffd", "\ufffd", "s", " certainly", " easier", " to", " see", " how", " to", " extend", " the", " Le", "bes", "gue", " bit", "-", "f", "iddling", " hack", " to", " a", " higher", " dimension", ",", " while", " the", " given", " Hilbert", " code", " is", " a", " bit", " of", " a", " head", " wreck", "er", "."]