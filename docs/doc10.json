["[", "bitcoin", "-", "dev", "]", " Code", " Review", ":", " The", " Cons", "ensus", " Critical", " Parts", " of", " Seg", "wit", " by", " Peter", " Todd", "\n", "\n", "Thanks", " for", " Peter", " Todd", "\ufffd", "\ufffd", "s", " detailed", " report", ":", " https", "://", "pet", "ertodd", ".", "org", "/", "2016", "/", "se", "g", "wit", "-", "cons", "ensus", "-", "critical", "-", "code", "-", "review", " I", " have", " the", " following", " response", ".", " >", "Since", " the", " reserve", " value", " is", " only", " a", " single", ",", " 32", "-", "byte", " value", ",", " we", "\ufffd", "\ufffd", "re", " setting", " ourselves", " up", " for", " the", " same", " problem", " again", "7", ".", " Please", " note", " that", " unlimited", " space", " has", " been", " reserved", " after", " the", " witness", " commitment", ":", " block", ".", "v", "tx", "[", "0", "].", "v", "out", "[", "o", "].", "script", "Pub", "Key", ".", "size", "()", " >=", " 38", " Which", " means", " anything", " after", " 38", " bytes", " has", " no", " consensus", " meaning", ".", " Any", " new", " consensus", " critical", " commitments", "/", "metadata", " could", " be", " put", " there", ".", " Anyway", ",", " there", " is", " no", " efficient", " way", " to", " add", " a", " new", " commitment", " with", " soft", "fork", ".", " >", " the", " fact", " that", " we", " do", " this", " has", " a", " rather", " odd", " result", ":", " a", " transaction", " spending", " a", " witness", " output", " with", " an", " unknown", " version", " is", " valid", " even", " if", " the", " transaction", " doesn", "\ufffd", "\ufffd", "t", " have", " any", " witnesses", "!", " I", " don", "\ufffd", "\ufffd", "t", " see", " any", " reason", " to", " have", " such", " check", ".", " We", " simply", " leave", " unknown", " witness", " program", " as", " any", "-", "one", "-", "can", "-", "sp", "end", " without", " looking", " at", " the", " witness", ",", " as", " described", " in", " B", "IP", "141", ".", " >", " B", "izz", "are", "ly", " se", "g", "wit", " has", " an", " add", "it", "onal", " pay", "-", "to", "-", "w", "itness", "-", "pub", "key", "-", "hash", "P", "2", "WP", "K", "H", " that", " lets", " you", " use", " a", " 160", "-", "bit", " (", "20", " byte", ")", " commitment", "\u2026\u2026", " Since", " ~", "90", "%", " of", " current", " transactions", " are", " P", "2", "PK", "H", ",", " we", " expect", " many", " people", " will", " keep", " using", " this", " type", " of", " transaction", " in", " the", " future", ".", " P", "2", "WP", "K", "H", " gives", " the", " same", " level", " of", " security", " as", " P", "2", "PK", "H", ",", " and", " smaller", " script", "Pub", "Key", ".", " >", "give", " users", " the", " option", " instead", " to", " choose", " to", " accept", " the", " less", " secure", " 160", "-", "bit", " commitment", " if", " their", " use", "-", "case", " doesn", "\ufffd", "\ufffd", "t", " need", " the", " full", " 256", "-", "bit", " security", " level", " This", " is", " actually", " discussed", " on", " the", " mailing", " list", ".", " P", "2", "W", "SH", " with", " multi", "-", "s", "ig", " is", " subject", " to", " birthday", " attack", ",", " and", " therefore", " 256", "-", "bit", " is", " used", " to", " provide", " 128", "-", "bit", " security", ".", " P", "2", "WP", "K", "H", " is", " used", " as", " single", " sig", " and", " therefore", " 160", "-", "bit", " is", " enough", ".", " >", "Secondly", ",", " if", " you", " are", " going", " to", " give", " a", " 160", "-", "bit", " commitment", " option", ",", " you", " don", "\ufffd", "\ufffd", "t", " need", " the", " extra", " level", " of", " ind", "irection", " in", " the", " P", "2", "SH", " case", ":", " just", " make", " the", " se", "g", "wit", " redeem", "Script", " be", ":", " <", "version", ">", " <", "serial", "ized", " witness", " script", ">", " Something", " wrong", " here", "?", " In", " P", "2", "WP", "K", "H", ",", " the", " witness", " is", " <", "s", "ig", ">", " <", "pub", "key", ">", " >", "The", " only", " downside", " is", " the", " serial", "ized", " witness", " script", " is", " constrained", " to", " 520", " bytes", " max", " 520", " is", " the", " original", " limit", ".", " B", "IP", "141", " tries", " to", " mimic", " the", " existing", " behaviour", " as", " much", " as", " possible", ".", " Anyway", ",", " normally", " nothing", " in", " the", " current", " scripts", " should", " use", " a", " push", " with", " more", " than", " 75", " bytes", " >", "we", " haven", "\ufffd", "\ufffd", "t", " explicitly", " ensured", " that", " signatures", " for", " the", " new", " signature", " hash", " can", "\ufffd", "\ufffd", "t", " be", " reused", " for", " the", " old", " signature", " hash", " How", " could", " that", " be", "?", " That", "\ufffd", "\ufffd", "d", " be", " a", " hash", " collision", ".", " ", "--------------", " next", " part", " ", "--------------", " A", " non", "-", "text", " attachment", " was", " scrub", "bed", "...", " Name", ":", " signature", ".", "asc", " Type", ":", " application", "/", "pg", "p", "-", "sign", "ature", " Size", ":", " 6", "71", " bytes", " Desc", ":", " Message", " signed", " with", " Open", "PG", "P", " using", " G", "PG", "Mail", " URL", ":", " <", "http", "://", "lists", ".", "linux", "foundation", ".", "org", "/", "p", "iper", "mail", "/", "bitcoin", "-", "dev", "/", "attach", "ments", "/", "201", "606", "29", "/", "ce", "fe", "2", "cd", "2", "/", "att", "achment", ".", "s", "ig", ">"]