["We", " have", " recently", " carried", " out", " an", " experiment", " with", " checking", " the", " gl", "ib", "c", " library", " by", " P", "VS", "-", "Studio", ".", " Its", " purpose", " was", " to", " study", " how", " good", " our", " analy", "zer", " is", " at", " checking", " Linux", "-", "projects", ".", " The", " basic", " conclusion", " is", ",", " not", " much", " good", " yet", ".", " Non", "-", "standard", " extensions", " used", " in", " such", " projects", " make", " the", " analy", "zer", " generate", " a", " huge", " pile", " of", " false", " positives", ".", " However", ",", " we", " have", " found", " some", " interesting", " bugs", ".", "\n", "\n", "gl", "ib", "c", "\n", "\n", "gl", "ib", "c", " -", " is", " the", " GNU", " Project", "'s", " implementation", " of", " the", " C", " standard", " library", ".", " Originally", " written", " by", " the", " Free", " Software", " Foundation", " (", "FS", "F", ")", " for", " the", " GNU", " operating", " system", ".", "\n", "\n", "Released", " under", " the", " GNU", " Less", "er", " General", " Public", " License", ",", " gl", "ib", "c", " is", " free", " software", ".", "\n", "\n", "The", " description", " is", " taken", " from", " the", " Wikipedia", " article", ":", " gl", "ib", "c", ".", "\n", "\n", "Not", " long", " ago", ",", " the", " release", " of", " a", " new", " version", " of", " the", " gl", "ib", "c", " library", " was", " announced", ".", " It", " prompted", " us", " to", " check", " this", " library", " with", " our", " analy", "zer", " P", "VS", "-", "Studio", ".", " Unfortunately", ",", " I", " was", " busy", " with", " another", " task", " for", " the", " last", " two", " weeks", " and", " got", " the", " opportunity", " to", " write", " the", " article", " about", " that", " check", " only", " now", ".", " I", " was", " actually", " engaged", " in", " carrying", " out", " a", " thorough", " comparison", " of", " several", " static", " analy", "zers", " and", " then", " writing", " a", " large", " article", " about", " the", " results", " of", " that", " comparison", ".", " This", " undertaking", " is", " very", " important", " for", " us", " because", " people", " are", " constantly", " asking", " about", " the", " differences", " between", " our", " analy", "zer", " and", " C", "pp", "check", " and", " Visual", " Studio", " 2013", "'s", " static", " analy", "zer", ".", " So", " gl", "ib", "c", " (", "gl", "ib", "c", "-", "2", "-", "19", "-", "90", ")", " had", " to", " wait", " a", " while", " before", " I", " could", " finally", " get", " down", " to", " it", ".", "\n", "\n", "We", " were", " not", " expecting", " to", " find", " anything", " terrible", " there", " -", " and", " we", " haven", "'t", ".", " The", " gl", "ib", "c", " library", " is", " very", " high", "-", "quality", " and", " it", " is", " regularly", " checked", " by", " many", " analy", "zers", ",", " among", " which", " are", " at", " least", " the", " following", " ones", ":", "\n", "\n", "Cover", "ity", ";", "\n", "\n", "Cl", "ang", ";", "\n", "\n", "C", "pp", "check", ".", "\n", "\n", "So", " it", " would", " be", " a", " large", " success", " to", " find", " at", " least", " one", " bug", " in", " its", " code", ".", "\n", "\n", "Diff", "icult", "ies", " of", " analysis", "\n", "\n", "Those", " not", " familiar", " with", " the", " internal", " mechanisms", " and", " principles", " of", " static", " analysis", " tools", " may", " view", " them", " as", " very", " simple", " utilities", ".", " It", "'s", " a", " mistake", ".", " These", " are", " very", " complex", " programs", ".", "\n", "\n", "There", " are", " tools", " like", " R", "ATS", " that", " may", " confuse", " you", ".", " If", " you", " take", " a", " look", " at", " R", "ATS", "'", " code", ",", " you", "'ll", " see", " that", " it", " merely", " searches", " for", " certain", " function", " names", " in", " files", ".", " Tools", " like", " that", " are", " called", " static", " code", " analy", "zers", " too", ",", " but", " their", " job", " is", " actually", " very", " far", " from", " what", " real", " static", " code", " analy", "zers", " do", ".", " Static", " analysis", " has", " nothing", " to", " do", " with", " a", " search", " with", " regular", " expressions", " [", "1", "].", "\n", "\n", "We", " already", " mentioned", " a", " number", " of", " times", " that", " a", " Linux", "-", "version", " of", " an", " application", " is", " absolutely", " not", " the", " same", " thing", " as", " a", " recomp", "iled", " executable", " module", " [", "2", "].", " There", " is", " a", " huge", " gulf", " between", " an", " executable", " module", " and", " a", " ready", " software", " product", ".", " One", " of", " the", " obstacles", " one", " faces", " when", " making", " a", " Linux", "-", "version", " is", " the", " need", " to", " support", " specific", " extensions", " and", " things", " like", " that", ".", "\n", "\n", "An", " ordinary", " programmer", " who", " has", " never", " dealt", " with", " all", " those", " aspects", " doesn", "'t", " have", " a", " slightest", " idea", " of", " how", " difficult", " and", " huge", " this", " work", " is", ".", " For", " example", ",", " take", " a", " call", " of", " the", " str", "cmp", "()", " function", ":", "\n", "\n", "cmp", "res", " =", " str", "cmp", " (", "new", "p", "->", "from", "_", "string", ",", " root", "->", "from", "_", "string", ");", "\n", "\n", "An", " ordinary", " programmer", " doesn", "'t", " even", " suspect", " which", " terrible", " code", " this", " single", " line", " will", " turn", " into", " after", " the", " pre", "processing", " and", " which", " non", "-", "standard", " extensions", " will", " be", " used", " in", " it", ".", " Particularly", " in", " this", " case", ",", " the", " line", " above", " turns", " into", " the", " following", " stuff", ":", "\n", "\n", "cmp", "res", " =", " __", "ext", "ension", "__", " ({", " size", "_", "t", " __", "s", "1", "_", "len", ",", " __", "s", "2", "_", "len", ";", " (", "__", "built", "in", "_", "const", "ant", "_", "p", " (", "new", "p", "->", "from", "_", "string", ")", " &&", " __", "built", "in", "_", "const", "ant", "_", "p", " (", "root", "->", "from", "_", "string", ")", " &&", " (", "__", "s", "1", "_", "len", " =", " str", "len", " (", "new", "p", "->", "from", "_", "string", "),", " __", "s", "2", "_", "len", " =", " str", "len", " (", "root", "->", "from", "_", "string", "),", " (!", "((", "size", "_", "t", ")(", "const", " void", " *", ")(", "(", "new", "p", "->", "from", "_", "string", ")", " +", " 1", ")", " -", " (", "size", "_", "t", ")(", "const", " void", " *", ")(", "new", "p", "->", "from", "_", "string", ")", " ==", " 1", ")", " ||", " __", "s", "1", "_", "len", " >=", " 4", ")", " &&", " (!", "((", "size", "_", "t", ")(", "const", " void", " *", ")(", "(", "root", "->", "from", "_", "string", ")", " +", " 1", ")", " -", " (", "size", "_", "t", ")(", "const", " void", " *", ")(", "root", "->", "from", "_", "string", ")", " ==", " 1", ")", " ||", " __", "s", "2", "_", "len", " >=", " 4", "))", "?", " __", "built", "in", "_", "str", "cmp", " (", "new", "p", "->", "from", "_", "string", ",", " root", "->", "from", "_", "string", ")", " :", " (", "__", "built", "in", "_", "const", "ant", "_", "p", " (", "new", "p", "->", "from", "_", "string", ")", " &&", " ((", "size", "_", "t", ")(", "const", " void", " *", ")(", "(", "new", "p", "->", "from", "_", "string", ")", " +", " 1", ")", " -", " (", "size", "_", "t", ")(", "const", " void", " *", ")(", "new", "p", "->", "from", "_", "string", ")", " ==", " 1", ")", " &&", " (", "__", "s", "1", "_", "len", " =", " str", "len", " (", "new", "p", "->", "from", "_", "string", "),", " __", "s", "1", "_", "len", " <", " 4", ")", "?", " (", "__", "built", "in", "_", "const", "ant", "_", "p", " (", "root", "->", "from", "_", "string", ")", " &&", " ((", "size", "_", "t", ")(", "const", " void", " *", ")(", "(", "root", "->", "from", "_", "string", ")", " +", " 1", ")", " -", " (", "size", "_", "t", ")(", "const", " void", " *", ")(", "root", "->", "from", "_", "string", ")", " ==", " 1", ")", "?", " __", "built", "in", "_", "str", "cmp", " (", "new", "p", "->", "from", "_", "string", ",", " root", "->", "from", "_", "string", ")", " :", " (", "__", "ext", "ension", "__", " ({", " const", " unsigned", " char", " *", "__", "s", "2", " =", " (", "const", " unsigned", " char", " *)", " (", "const", " char", " *)", " (", "root", "->", "from", "_", "string", ");", " int", " __", "result", " =", " ((", "(", "const", " unsigned", " char", " *)", " (", "const", " char", " *)", " (", "new", "p", "->", "from", "_", "string", "))", "[", "0", "]", " -", " __", "s", "2", "[", "0", "]);", " if", " (", "__", "s", "1", "_", "len", " >", " 0", " &&", " __", "result", " ==", " 0", ")", " {", " __", "result", " =", " ((", "(", "const", " unsigned", " char", " *)", " (", "const", " char", " *)", " (", "new", "p", "->", "from", "_", "string", "))", "[", "1", "]", " -", " __", "s", "2", "[", "1", "]);", " if", " (", "__", "s", "1", "_", "len", " >", " 1", " &&", " __", "result", " ==", " 0", ")", " {", " __", "result", " =", " ((", "(", "const", " unsigned", " char", " *)", " (", "const", " char", " *)", " (", "new", "p", "->", "from", "_", "string", "))", "[", "2", "]", " -", " __", "s", "2", "[", "2", "]);", " if", " (", "__", "s", "1", "_", "len", " >", " 2", " &&", " __", "result", " ==", " 0", ")", " __", "result", " =", " ((", "(", "const", " unsigned", " char", " *)", " (", "const", " char", " *)", " (", "new", "p", "->", "from", "_", "string", "))", "[", "3", "]", " -", " __", "s", "2", "[", "3", "]);", " }", " }", " __", "result", ";", " }", ")))", " :", " (", "__", "built", "in", "_", "const", "ant", "_", "p", " (", "root", "->", "from", "_", "string", ")", " &&", " ((", "size", "_", "t", ")(", "const", " void", " *", ")(", "(", "root", "->", "from", "_", "string", ")", " +", " 1", ")", " -", " (", "size", "_", "t", ")(", "const", " void", " *", ")(", "root", "->", "from", "_", "string", ")", " ==", " 1", ")", " &&", " (", "__", "s", "2", "_", "len", " =", " str", "len", " (", "root", "->", "from", "_", "string", "),", " __", "s", "2", "_", "len", " <", " 4", ")", "?", " (", "__", "built", "in", "_", "const", "ant", "_", "p", " (", "new", "p", "->", "from", "_", "string", ")", " &&", " ((", "size", "_", "t", ")(", "const", " void", " *", ")(", "(", "new", "p", "->", "from", "_", "string", ")", " +", " 1", ")", " -", "/", " (", "size", "_", "t", ")(", "const", " void", " *", ")(", "new", "p", "->", "from", "_", "string", ")", " ==", " 1", ")", "?", " __", "built", "in", "_", "str", "cmp", " (", "new", "p", "->", "from", "_", "string", ",", " root", "->", "from", "_", "string", ")", " :", " (-", " (", "__", "ext", "ension", "__", " ({", " const", " unsigned", " char", " *", "__", "s", "2", " =", " (", "const", " unsigned", " char", " *)", " (", "const", " char", " *)", " (", "new", "p", "->", "from", "_", "string", ");", " int", " __", "result", " =", " ((", "(", "const", " unsigned", " char", " *)", " (", "const", " char", " *)", " (", "root", "->", "from", "_", "string", "))", "[", "0", "]", " -", " __", "s", "2", "[", "0", "]);", " if", " (", "__", "s", "2", "_", "len", " >", " 0", " &&", " __", "result", " ==", " 0", ")", " {", " __", "result", " =", " ((", "(", "const", " unsigned", " char", " *)", " (", "const", " char", " *)", " (", "root", "->", "from", "_", "string", "))", "[", "1", "]", " -", " __", "s", "2", "[", "1", "]);", " if", " (", "__", "s", "2", "_", "len", " >", " 1", " &&", " __", "result", " ==", " 0", ")", " {", " __", "result", " =", " ((", "(", "const", " unsigned", " char", " *)", " (", "const", " char", " *)", " (", "root", "->", "from", "_", "string", "))", "[", "2", "]", " -", " __", "s", "2", "[", "2", "]);", " if", " (", "__", "s", "2", "_", "len", " >", " 2", " &&", " __", "result", " ==", " 0", ")", " __", "result", " =", " ((", "(", "const", " unsigned", " char", " *)", " (", "const", " char", " *)", " (", "root", "->", "from", "_", "string", "))", "[", "3", "]", " -", " __", "s", "2", "[", "3", "]);", " }", " }", " __", "result", ";", " }", "))))", " :", " __", "built", "in", "_", "str", "cmp", " (", "new", "p", "->", "from", "_", "string", ",", " root", "->", "from", "_", "string", "))", "));", " });", "\n", "\n", "The", " analy", "zer", " is", " not", " ready", " for", " such", " a", " turn", "-", "up", " and", " starts", " generating", " silly", " false", " positives", " on", " such", " constructs", ".", "\n", "\n", "Let", " me", " explain", " this", " point", " about", " false", " positives", " by", " a", " simpler", " example", ".", " Ass", "ume", " we", " have", " the", " following", " line", " of", " code", ":", "\n", "\n", "assert", "(", "MAP", "_", "FA", "IL", "ED", " ==", " (", "void", " *)", " -", "1", ");", "\n", "\n", "The", " assert", "()", " macro", " expands", " into", " the", " following", " fragment", ":", "\n", "\n", "((", "((", "void", " *)", " -", "1", ")", " ==", " (", "void", " *)", " -", "1", ")", "?", " (", "void", ")", " (", "0", ")", " :", " __", "assert", "_", "fail", " (\"", "((", "void", " *)", " -", "1", ")", " ==", " (", "void", " *)", " -", "1", "\",", " \"", "load", "msg", "cat", ".", "c", "\",", " 840", ",", " __", "P", "RET", "TY", "_", "FUN", "CT", "ION", "__", "));", "\n", "\n", "The", " P", "VS", "-", "Studio", " analy", "zer", " generates", " a", " false", " positive", " on", " the", " comparison", " ((", "(", "void", " *)", " -", "1", ")", " ==", " (", "void", " *)", " -", "1", "):", "\n", "\n", "V", "501", " There", " are", " identical", " sub", "-", "express", "ions", " to", " the", " left", " and", " to", " the", " right", " of", " the", " '", "==", "'", " operator", ":", " ((", "void", " *)", " -", " 1", ")", " ==", " (", "void", " *)", " -", " 1", " load", "msg", "cat", ".", "c", " 840", "\n", "\n", "There", " is", " nothing", " to", " be", " surprised", " at", ".", " We", " have", " already", " been", " through", " all", " that", " stuff", " when", " adapting", " our", " tool", " for", " applications", " built", " with", " Visual", " C", "++", ".", " There", " is", " quite", " a", " lot", " to", " wonder", " at", " there", ",", " too", ".", " It", " takes", " you", " much", " time", " and", " effort", " to", " teach", " the", " analy", "zer", " to", " understand", " all", " those", " nuances", ".", " You", " have", " to", " teach", " it", " to", " understand", " that", " it", " is", " dealing", " with", " the", " macro", " \"", "assert", "\"", " which", " is", " harmless", " and", " whose", " job", " is", " but", " to", " check", " that", " the", " MAP", "_", "FA", "IL", "ED", " macro", " equals", " \"(", "void", " *)", " -", "1", "\".", " We", " have", " already", " done", " all", " that", " for", " Visual", " C", "++", ",", " but", " not", " for", " Linux", ".", "\n", "\n", "It", " is", " teaching", " the", " analy", "zer", " to", " correctly", " handle", " such", " constructs", " that", " makes", " up", " the", " hug", "est", " part", " of", " work", " on", " supporting", " other", " comp", "ilers", ".", " This", " work", " is", " invisible", " to", " others", ",", " but", " it", " really", " requires", " you", " to", " thoroughly", " investigate", ",", " support", " and", " test", " all", " the", " nuances", " of", " the", " compiler", " and", " standard", " libraries", ".", "\n", "\n", "I", "'ve", " just", " slightly", " opened", " this", " door", " to", " Hell", " for", " you", " to", " peek", " in", ".", " I", "'m", " going", " to", " write", " a", " series", " of", " articles", " soon", " to", " show", " all", " the", " difficulties", " of", " static", " analysis", " tools", "'", " development", ".", " Sure", " you", "'ll", " like", " them", ".", "\n", "\n", "S", "usp", "icious", " code", " fragments", " found", " in", " the", " gl", "ib", "c", " library", "\n", "\n", "Although", " gl", "ib", "c", " is", " tested", " by", " many", " tools", ",", " we", " still", " have", " managed", " to", " find", " a", " few", " interesting", " bugs", ".", " Let", "'s", " take", " a", " look", " at", " them", ".", "\n", "\n", "A", " strange", " expression", "\n", "\n", "char", " *", "DC", "IG", "ET", "TEXT", " (", "....", ")", " {", "....", " /*", " Make", " C", "ATE", "G", "ORY", "VALUE", " point", " to", " the", " next", " element", " of", " the", " list", ".", " */", " while", " (", "category", "value", "[", "0", "]", "!=", " '", "\\", "0", "'", " &&", " category", "value", "[", "0", "]", " ==", " '", ":", "')", " ++", "category", "value", ";", "....", " }", "\n", "\n", "V", "590", " Consider", " inspecting", " this", " expression", ".", " The", " expression", " is", " excessive", " or", " contains", " a", " mis", "print", ".", " d", "cig", "et", "text", ".", "c", " 5", "82", "\n", "\n", "The", " condition", " can", " be", " shortened", ":", "\n", "\n", "while", " (", "category", "value", "[", "0", "]", " ==", " '", ":", "')", "\n", "\n", "Perhaps", " there", " is", " no", " error", " here", " and", " the", " first", " part", " of", " the", " (", "category", "value", "[", "0", "]", "!=", " '", "\\", "0", "')", " condition", " is", " simply", " redundant", ".", " But", " I", " suspect", " the", " error", " is", " real", " and", " the", " code", " should", " look", " like", " this", ":", "\n", "\n", "while", " (", "category", "value", "[", "0", "]", "!=", " '", "\\", "0", "'", " &&", " category", "value", "[", "0", "]", "!=", " '", ":", "')", "\n", "\n", "D", "ere", "f", "eren", "cing", " a", " pointer", " before", " checking", " it", "\n", "\n", "This", " fragment", " is", " not", " necessarily", " unsafe", " -", " perhaps", " the", " pointer", " can", " never", " be", " null", ".", " But", " I", " should", " mention", " it", " anyway", ":", "\n", "\n", "static", " enum", " cl", "nt", "_", "stat", " cl", "nt", "raw", "_", "call", " (", "h", ",", " proc", ",", " x", "args", ",", " arg", "sp", ",", " x", "results", ",", " results", "p", ",", " timeout", ")", " CLIENT", " *", "h", ";", " u", "_", "long", " proc", ";", " x", "dr", "proc", "_", "t", " x", "args", ";", " c", "addr", "_", "t", " arg", "sp", ";", " x", "dr", "proc", "_", "t", " x", "results", ";", " c", "addr", "_", "t", " results", "p", ";", " struct", " time", "val", " timeout", ";", " {", " struct", " cl", "nt", "raw", "_", "private", "_", "s", " *", "cl", "p", " =", " cl", "nt", "raw", "_", "private", ";", " X", "DR", " *", "xd", "rs", " =", " &", "cl", "p", "->", "x", "dr", "_", "stream", ";", "....", " if", " (", "cl", "p", " ==", " NULL", ")", " return", " RPC", "_", "FA", "IL", "ED", ";", "....", " }", "\n", "\n", "V", "595", " The", " '", "cl", "p", "'", " pointer", " was", " utilized", " before", " it", " was", " verified", " against", " null", "ptr", ".", " Check", " lines", ":", " 145", ",", " 150", ".", " cl", "nt", "_", "raw", ".", "c", " 145", "\n", "\n", "In", " the", " same", " file", ",", " not", " far", " from", " this", " piece", ",", " there", " is", " a", " similar", " defect", ":", " V", "595", " The", " '", "cl", "p", "'", " pointer", " was", " utilized", " before", " it", " was", " verified", " against", " null", "ptr", ".", " Check", " lines", ":", " 232", ",", " 235", ".", " cl", "nt", "_", "raw", ".", "c", " 232", "\n", "\n", "D", "anger", "ous", " optimization", " (", "a", " vulnerability", ")", "\n", "\n", "char", " *", " __", "sha", "256", "_", "crypt", "_", "r", " (", "key", ",", " salt", ",", " buffer", ",", " bu", "fl", "en", ")", " const", " char", " *", "key", ";", " const", " char", " *", "s", "alt", ";", " char", " *", "buffer", ";", " int", " bu", "fl", "en", ";", " {", "....", " unsigned", " char", " temp", "_", "result", "[", "32", "]", "....", " mem", "set", " (", "temp", "_", "result", ",", " '", "\\", "0", "',", " sizeof", " (", "temp", "_", "result", "));", "....", "....", " //", " temp", "_", "result", " not", " used", " further", " on", " }", "\n", "\n", "V", "597", " The", " compiler", " could", " delete", " the", " '", "mem", "set", "'", " function", " call", ",", " which", " is", " used", " to", " flush", " '", "temp", "_", "result", "'", " buffer", ".", " The", " R", "tl", "Secure", "Zero", "Memory", "()", " function", " should", " be", " used", " to", " erase", " the", " private", " data", ".", " sh", "a", "256", "-", "crypt", ".", "c", " 385", "\n", "\n", "The", " compiler", " is", " allowed", " to", " remove", " the", " call", " of", " the", " mem", "set", "()", " function", " when", " compiling", " the", " Release", " version", ".", " Well", ",", " it", " is", " actually", " obliged", " to", " do", " so", " for", " the", " sake", " of", " optimization", ".", " Since", " the", " '", "temp", "_", "result", "'", " buffer", " is", " not", " used", " anywhere", " after", " calling", " the", " mem", "set", "()", " function", ",", " the", " function", " call", " itself", " is", " not", " needed", " too", ".", "\n", "\n", "This", " is", " a", " vulnerability", " because", " the", " private", " data", " will", " not", " be", " erased", ".", " The", " mem", "set", "()", " function", " should", " be", " replaced", " with", " a", " more", " appropriate", " one", ".", " The", " analy", "zer", " suggests", " R", "tl", "Secure", "Zero", "Memory", "(),", " which", " is", " absent", " in", " Linux", " of", " course", ".", " But", " there", " are", " other", " alternatives", ".", "\n", "\n", "The", " same", " defect", ":", " V", "597", " The", " compiler", " could", " delete", " the", " '", "mem", "set", "'", " function", " call", ",", " which", " is", " used", " to", " flush", " '", "temp", "_", "result", "'", " buffer", ".", " The", " R", "tl", "Secure", "Zero", "Memory", "()", " function", " should", " be", " used", " to", " erase", " the", " private", " data", ".", " sh", "a", "512", "-", "crypt", ".", "c", " 396", "\n", "\n", "Und", "efined", " behavior", "\n", "\n", "One", " might", " expect", " the", " gl", "ib", "c", " library", "'s", " code", " to", " be", " written", " in", " such", " a", " way", " as", " to", " provide", " maximum", " port", "ability", ".", " However", ",", " there", " are", " quite", " a", " lot", " of", " shift", " constructs", " in", " it", ",", " which", " can", "'t", " be", " safe", " from", " the", " viewpoint", " of", " port", "ability", ".", "\n", "\n", "This", " is", " what", " the", " C", " language", " standard", " has", " to", " say", " about", " shifts", ":", "\n", "\n", "The", " integer", " promotions", " are", " performed", " on", " each", " of", " the", " oper", "ands", ".", " The", " type", " of", " the", " result", " is", " that", " of", " the", " promoted", " left", " oper", "and", ".", " If", " the", " value", " of", " the", " right", " oper", "and", " is", " negative", " or", " is", " greater", " than", " or", " equal", " to", " the", " width", " of", " the", " promoted", " left", " oper", "and", ",", " the", " behavior", " is", " undefined", ".", "\n", "\n", "The", " result", " of", " E", "1", " <<", " E", "2", " is", " E", "1", " left", "-", "sh", "ifted", " E", "2", " bit", " positions", ";", " vacated", " bits", " are", " filled", " with", " z", "eros", ".", " If", " E", "1", " has", " an", " unsigned", " type", ",", " the", " value", " of", " the", " result", " is", " E", "1", " *", " 2", " pow", " E", "2", ",", " reduced", " mod", "ulo", " one", " more", " than", " the", " maximum", " value", " represent", "able", " in", " the", " result", " type", ".", " If", " E", "1", " has", " a", " signed", " type", " and", " non", "negative", " value", ",", " and", " E", "1", " *", " 2", " pow", " E", "2", " is", " represent", "able", " in", " the", " result", " type", ",", " then", " that", " is", " the", " resulting", " value", ";", " otherwise", ",", " the", " behavior", " is", " undefined", ".", "\n", "\n", "5", " The", " result", " of", " E", "1", " >>", " E", "2", " is", " E", "1", " right", "-", "sh", "ifted", " E", "2", " bit", " positions", ".", " If", " E", "1", " has", " an", " unsigned", " type", " or", " if", " E", "1", " has", " a", " signed", " type", " and", " a", " non", "negative", " value", ",", " the", " value", " of", " the", " result", " is", " the", " integral", " part", " of", " the", " quot", "ient", " of", " E", "1", " /", " 2", " pow", " E", "2", ".", " If", " E", "1", " has", " a", " signed", " type", " and", " a", " negative", " value", ",", " the", " resulting", " value", " is", " implementation", "-", "defined", ".", "\n", "\n", "It", " follows", " from", " this", " text", " that", " it", " is", " illegal", " to", " shift", " negative", " numbers", ".", " However", ",", " it", " is", " a", " very", " common", " operation", " in", " the", " gl", "ib", "c", " library", ".", "\n", "\n", "An", " example", " of", " left", " shift", ":", "\n", "\n", "static", " void", " init", "_", "cache", "info", " (", "void", ")", " {", "....", " count", "_", "mask", " =", " ~", "(-", "1", " <<", " (", "count", "_", "mask", " +", " 1", "));", "....", " }", "\n", "\n", "V", "610", " Und", "efined", " behavior", ".", " Check", " the", " shift", " operator", " '", "<<", ".", " The", " left", " oper", "and", " '", "-", "1", "'", " is", " negative", ".", " cache", "info", ".", "c", " 6", "45", "\n", "\n", "An", " example", " of", " right", " shift", ":", "\n", "\n", "utf", "8", "_", "en", "code", " (", "char", " *", "buf", ",", " int", " val", ")", " {", "....", " *", "buf", " =", " (", "unsigned", " char", ")", " (~", "0", "xff", " >>", " step", ");", "....", " }", "\n", "\n", "The", " \"", "~", "0", "xff", "\"", " expression", " is", " of", " the", " '", "int", "'", " type", " and", " equals", " -", "256", ".", "\n", "\n", "Below", " is", " a", " list", " of", " all", " the", " code", " fragments", " with", " incorrect", " shift", " operations", ":", "\n", "\n", "str", "x", "fr", "m", "_", "l", ".", "c", " 68", "\n", "\n", "clock", "_", "nan", "os", "leep", ".", "c", " 38", "\n", "\n", "if", "add", "rs", ".", "c", " 7", "86", "\n", "\n", "x", "dr", "_", "int", "XX", "_", "t", ".", "c", " 35", "\n", "\n", "x", "dr", "_", "int", "XX", "_", "t", ".", "c", " 41", "\n", "\n", "private", ".", "h", " 327", "\n", "\n", "private", ".", "h", " 331", "\n", "\n", "z", "ic", ".", "c", " 6", "96", "\n", "\n", "z", "dump", ".", "c", " 212", "\n", "\n", "z", "dump", ".", "c", " 216", "\n", "\n", "timer", "_", "create", ".", "c", " 47", "\n", "\n", "timer", "_", "create", ".", "c", " 49", "\n", "\n", "loop", ".", "c", " 331", "\n", "\n", "loop", ".", "c", " 4", "37", "\n", "\n", "mk", "time", ".", "c", " 207", "\n", "\n", "mk", "time", ".", "c", " 208", "\n", "\n", "mk", "time", ".", "c", " 211", "\n", "\n", "mk", "time", ".", "c", " 212", "\n", "\n", "mk", "time", ".", "c", " 230", "\n", "\n", "mk", "time", ".", "c", " 298", "\n", "\n", "mk", "time", ".", "c", " 298", "\n", "\n", "ld", "-", "coll", "ate", ".", "c", " 298", "\n", "\n", "Using", " an", " un", "initialized", " variable", "\n", "\n", "static", " int", " send", "_", "vc", "(", "....", ")", " {", "....", " int", " trunc", "ating", ",", " conn", "reset", ",", " res", "pl", "en", ",", " n", ";", "....", " #", "if", "def", " _", "STR", "ING", "_", "ARCH", "_", "unal", "igned", " *", "ans", "s", "iz", "p", "2", " =", " orig", "_", "ans", "s", "iz", "p", " -", " res", "pl", "en", ";", " *", "ans", "p", "2", " =", " *", "ans", "p", " +", " res", "pl", "en", ";", " #", "else", "....", " }", " V", "614", " Un", "initialized", " variable", " '", "res", "pl", "en", "'", " used", ".", " res", "_", "send", ".", "c", " 7", "90", "\n", "\n", "In", "correct", " string", " formatting", "\n", "\n", "In", " some", " fragments", ",", " '", "%", "u", "'", " is", " used", " to", " print", " signed", " variables", ",", " and", " in", " some", " other", " fragments", ",", " '", "%", "d", "'", " is", " used", " to", " print", " unsigned", " variables", ".", " These", " are", " tr", "ifles", ",", " of", " course", ",", " but", " they", " are", " worth", " mentioning", ".", "\n", "\n", "For", " example", ":", "\n", "\n", "ty", "ped", "ef", " unsigned", " int", " __", "uid", "_", "t", ";", " typed", "ef", " __", "uid", "_", "t", " u", "id", "_", "t", ";", " int", " user", "2", "net", "name", " (", "....", ",", " const", " u", "id", "_", "t", " u", "id", ",", "....", ")", " {", "....", " sprint", "f", " (", "net", "name", ",", " \"%", "s", ".", "%", "d", "@", "%", "s", "\",", " OPS", "YS", ",", " u", "id", ",", " df", "lt", "dom", ");", "....", " }", "\n", "\n", "V", "576", " Inc", "orrect", " format", ".", " Consider", " checking", " the", " fourth", " actual", " argument", " of", " the", " '", "s", "printf", "'", " function", ".", " The", " SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " net", "name", ".", "c", " 51", "\n", "\n", "Other", " defects", " of", " this", " kind", ":", "\n", "\n", "Consider", " checking", " the", " second", " actual", " argument", " of", " the", " '", "printf", "'", " function", ".", " The", " SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " loc", "archive", ".", "c", " 17", "41", "\n", "\n", "Consider", " checking", " the", " fourth", " actual", " argument", " of", " the", " '", "printf", "'", " function", ".", " The", " SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " loc", "archive", ".", "c", " 17", "41", "\n", "\n", "Consider", " checking", " the", " fifth", " actual", " argument", " of", " the", " '", "f", "printf", "'", " function", ".", " The", " SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " res", "_", "debug", ".", "c", " 236", "\n", "\n", "Consider", " checking", " the", " third", " actual", " argument", " of", " the", " '", "s", "printf", "'", " function", ".", " The", " UN", "SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " in", "et", "_", "net", "_", "nt", "op", ".", "c", " 134", "\n", "\n", "Consider", " checking", " the", " fourth", " actual", " argument", " of", " the", " '", "s", "printf", "'", " function", ".", " The", " SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " ns", "_", "print", ".", "c", " 500", "\n", "\n", "Consider", " checking", " the", " fifth", " actual", " argument", " of", " the", " '", "s", "printf", "'", " function", ".", " The", " SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " ns", "_", "print", ".", "c", " 500", "\n", "\n", "Consider", " checking", " the", " third", " actual", " argument", " of", " the", " '", "s", "printf", "'", " function", ".", " The", " SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " ns", "_", "print", ".", "c", " 5", "72", "\n", "\n", "Consider", " checking", " the", " fourth", " actual", " argument", " of", " the", " '", "s", "printf", "'", " function", ".", " The", " SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " ns", "_", "print", ".", "c", " 5", "72", "\n", "\n", "Consider", " checking", " the", " fifth", " actual", " argument", " of", " the", " '", "s", "printf", "'", " function", ".", " The", " SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " ns", "_", "print", ".", "c", " 5", "72", "\n", "\n", "Consider", " checking", " the", " third", " actual", " argument", " of", " the", " '", "s", "printf", "'", " function", ".", " The", " UN", "SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " ns", "_", "print", ".", "c", " 6", "28", "\n", "\n", "Consider", " checking", " the", " fourth", " actual", " argument", " of", " the", " '", "s", "printf", "'", " function", ".", " The", " UN", "SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " ns", "_", "print", ".", "c", " 6", "28", "\n", "\n", "Consider", " checking", " the", " fifth", " actual", " argument", " of", " the", " '", "s", "printf", "'", " function", ".", " The", " UN", "SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " ns", "_", "print", ".", "c", " 6", "28", "\n", "\n", "Consider", " checking", " the", " third", " actual", " argument", " of", " the", " '", "s", "printf", "'", " function", ".", " The", " SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " ns", "_", "print", ".", "c", " 6", "45", "\n", "\n", "Consider", " checking", " the", " third", " actual", " argument", " of", " the", " '", "s", "printf", "'", " function", ".", " The", " UN", "SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " ns", "_", "print", ".", "c", " 6", "85", "\n", "\n", "Consider", " checking", " the", " second", " actual", " argument", " of", " the", " '", "printf", "'", " function", ".", " The", " SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " n", "is", "_", "print", ".", "c", " 209", "\n", "\n", "Consider", " checking", " the", " second", " actual", " argument", " of", " the", " '", "printf", "'", " function", ".", " The", " SIGN", "ED", " integer", " type", " argument", " is", " expected", ".", " sp", "ro", "f", ".", "c", " 480", "\n", "\n", "Conclusion", "\n", "\n", "We", " should", " admit", " that", " we", " made", " a", " wrong", " choice", " for", " the", " experiment", " with", " testing", " our", " analy", "zer", " on", " code", " from", " the", " Linux", " world", " -", " the", " gl", "ib", "c", " project", " is", " just", " too", " high", "-", "quality", ".", " :)", " There", " are", " too", " few", " worthy", " defects", " to", " make", " the", " article", " interesting", ".", " But", " anyway", ",", " there", " are", " many", " other", " well", "-", "known", " and", " interesting", " projects", " under", " Linux", " waiting", " to", " be", " tested", " by", " P", "VS", "-", "Studio", " to", " demonstrate", " its", " capabilities", ".", "\n", "\n", "References"]