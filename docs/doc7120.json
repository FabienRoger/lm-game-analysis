["In", " a", " previous", " post", ",", " we", " explained", " how", " to", " configure", " a", " proxy", " server", " to", " provide", " load", " balancing", " for", " the", " Imp", "ala", " daemon", ".", " The", " proxy", " software", " used", " was", " HA", "proxy", ",", " a", " free", ",", " open", " source", " load", " bal", "ancer", ".", " This", " post", " will", " demonstrate", " how", " to", " use", " Amazon", "\ufffd", "\ufffd", "s", " Elastic", " Load", " Bal", "ancer", " (", "EL", "B", ")", " to", " perform", " Imp", "ala", " load", " balancing", " when", " running", " in", " Amazon", "\ufffd", "\ufffd", "s", " Elastic", " Comp", "ute", " Cloud", " (", "EC", "2", ").", "\n", "\n", "Details", "\n", "\n", "Similar", " to", " HA", "proxy", ",", " an", " Elastic", " Load", " Bal", "ancer", " is", " a", " reverse", " proxy", " that", " will", " take", " incoming", " TCP", " connections", " and", " distribute", " them", " amongst", " a", " set", " of", " EC", "2", " instances", ".", " This", " is", " done", " partly", " for", " fault", " tolerance", " and", " partly", " for", " load", " distribution", ".", " Cl", "ou", "der", "a", "\ufffd", "\ufffd", "s", " Using", " Imp", "ala", " through", " a", " Proxy", " for", " High", " Availability", " details", " how", " load", " balancing", " applies", " to", " part", " of", " Imp", "ala", ".", "\n", "\n", "To", " summarize", ",", " the", " proxy", " will", " allow", " us", " to", " configure", " our", " Imp", "ala", " clients", " (", "H", "ue", ",", " Table", "au", ",", " etc", ")", " with", " a", " single", " host", "name", " and", " port", ".", " This", " well", "-", "known", " host", "name", " will", " not", " have", " to", " be", " changed", " out", " if", " there", " were", " to", " be", " a", " failure", " of", " one", " or", " multiple", " Imp", "ala", " da", "em", "ons", ".", " It", " will", " also", " distribute", " the", " load", " of", " running", " a", " query", "\ufffd", "\ufffd", "s", " coordinator", " processing", " amongst", " the", " Imp", "ala", " da", "em", "ons", ".", "\n", "\n", "The", " steps", " we", " will", " take", " to", " set", " up", " the", " Imp", "ala", " load", " bal", "ancer", " are", ":", "\n", "\n", "Config", "ure", " security", " groups", ".", " Create", " the", " EL", "B", ".", " Config", "ure", " the", " EL", "B", ".", " Add", " instances", " to", " the", " EL", "B", ".", " Test", " the", " EL", "B", ".", " Config", "ure", " Imp", "ala", ".", "\n", "\n", "Requirements", "\n", "\n", "The", " following", " examples", " require", " that", " you", " have", " the", " AWS", " CLI", " software", " installed", " and", " configured", " on", " your", " system", ".", " This", " can", " be", " on", " your", " Windows", ",", " Mac", ",", " or", " Linux", " work", "station", "/", "l", "aptop", " or", " on", " a", " Linux", " host", " running", " elsewhere", ".", " Sp", "inning", " up", " an", " EC", "2", " instance", " running", " Amazon", " Linux", " might", " be", " the", " fastest", " way", " to", " get", " the", " tools", ".", "\n", "\n", "Of", " course", ",", " you", " will", " need", " an", " AWS", " account", " and", " I", "AM", " privileges", " to", " create", " both", " the", " security", " groups", " and", " the", " EL", "B", ".", "\n", "\n", "Im", "plementation", "\n", "\n", "The", " following", " code", " is", " run", " in", " a", " shell", " (", "bash", " or", " cmd", ".", "exe", ")", " on", " the", " system", " with", " the", " AWS", " CLI", " tools", ".", "\n", "\n", "First", ",", " we", " will", " need", " to", " name", " the", " cluster", " that", " is", " running", " the", " Imp", "ala", " service", ".", " This", " will", " be", " used", " to", " name", " the", " EL", "B", " and", " security", " groups", ".", " Then", ",", " we", " will", " create", " some", " variables", " that", " will", " hold", " the", " ID", " numbers", " of", " existing", " AWS", " infrastructure", ".", " Lastly", ",", " we", " use", " an", " additional", " variable", " named", " $", "OP", "TS", " for", " general", " AWS", " CLI", " options", " we", " may", " need", ".", "\n", "\n", "We", " will", " have", " to", " look", " up", " the", " V", "PC", " ID", ",", " the", " ID", " of", " the", " sub", "net", " where", " we", " will", " be", " deploying", " the", " load", " bal", "ancer", ",", " and", " the", " instance", " IDs", " of", " the", " H", "ado", "op", " cluster", " workers", " that", " are", " running", " the", " Imp", "ala", " Da", "emon", ".", " The", " EL", "B", " can", " reside", " in", " the", " same", " sub", "net", " as", " the", " H", "ado", "op", " cluster", " or", " it", " can", " be", " placed", " in", " a", " separate", " sub", "net", ".", " It", " is", " advisable", " to", " keep", " the", " EL", "B", " in", " the", " same", " Availability", " Zone", " as", " the", " cluster", ".", " (", "You", " are", " deploying", " your", " H", "ado", "op", " cluster", " instances", " to", " the", " same", " AZ", ",", " right", "?)", "\n", "\n", "CL", "NAME", "=", "Cl", "uster", "1", " V", "PC", "ID", "=\"\"", " SUB", "NET", "ID", "=\"\"", " INST", "ANC", "ES", "=\"\"", " #", "OP", "TS", "=\"", "--", "profile", " default", " --", "region", " us", "-", "west", "2", "\"", "\n", "\n", "If", " you", " have", " tagged", " your", " objects", " appropriately", ",", " you", " can", " use", " aw", "s", " ec", "2", " describe", "-", "*", " to", " look", " them", " up", " program", "matically", ".", " These", " are", " examples", ".", " Your", " environment", " will", " be", " different", ".", "\n", "\n", "#", " Return", " the", " V", "PC", "ID", " of", " the", " V", "PC", " named", " \"", "Cl", "uster", "1", "\".", " V", "PC", "ID", "=$", "(", "aws", " $", "OP", "TS", " ec", "2", " describe", "-", "vp", "cs", " --", "output", " text", " --", "query", " '", "V", "p", "cs", "[", "*", "].", "V", "pc", "Id", "'", " \\", " --", "filter", " Name", "=", "tag", ":", "Name", ",", "Values", "=\"", "${", "CL", "NAME", "}", "\")", " #", " Return", " the", " SUB", "NET", "ID", " of", " the", " sub", "net", " named", " \"", "Cl", "uster", "1", " Private", " sub", "net", " 0", "\".", " SUB", "NET", "ID", "=$", "(", "aws", " $", "OP", "TS", " ec", "2", " describe", "-", "sub", "nets", " --", "output", " text", " \\", " --", "query", " '", "Sub", "nets", "[", "*", "].", "Sub", "net", "Id", "'", " \\", " --", "filter", " Name", "=", "tag", ":", "Name", ",", "Values", "=\"", "${", "CL", "NAME", "}", " Private", " sub", "net", " 0", "\")", " #", " Return", " the", " instance", " IDs", " of", " instances", " tagged", " \"", "env", "=", "Cl", "uster", "1", "\"", " and", " \"", "type", "=", "worker", "\".", " INST", "ANC", "ES", "=$", "(", "aws", " $", "OP", "TS", " ec", "2", " describe", "-", "inst", "ances", " --", "output", " text", " \\", " --", "query", " '", "Res", "erv", "ations", "[", "*", "].", "Inst", "ances", "[", "*", "].", "Instance", "Id", "'", " \\", " --", "fil", "ters", " \"", "Name", "=", "tag", ":", "env", ",", "Values", "=", "${", "CL", "NAME", "}\"", " Name", "=", "tag", ":", "type", ",", "Values", "=", "worker", ")", "\n", "\n", "Step", " 1", "\n", "\n", "Second", ",", " we", " will", " define", " new", " security", " groups", ".", " The", " first", " group", " will", " allow", " client", " initiated", " traffic", " to", " reach", " the", " EL", "B", ".", " This", " should", " be", " locked", " down", " to", " something", " smaller", " than", " \ufffd", "\ufffd", "everything", "\ufffd", "\ufffd", " (", "0", ".", "0", ".", "0", ".", "0", "/", "0", ")", " especially", " if", " you", " have", " your", " cluster", " on", " the", " big", ",", " bad", " Internet", ".", "\n", "\n", "The", " second", " group", " will", " allow", " the", " EL", "B", " to", " reach", " the", " Imp", "ala", " da", "em", "ons", " running", " on", " the", " H", "ado", "op", " cluster", " worker", " nodes", ".", "\n", "\n", "echo", " \"", "Allow", " Imp", "ala", " connections", " from", " clients", " to", " the", " load", " bal", "ancer", ".\"", " FR", "ONT", "END", "=$", "(", "aws", " $", "OP", "TS", " ec", "2", " create", "-", "security", "-", "group", " --", "output", " text", " --", "v", "pc", "-", "id", " $", "V", "PC", "ID", " \\", " --", "group", "-", "name", " \"$", "{", "CL", "NAME", "}", " Imp", "ala", " FE", "\"", " --", "description", " \"", "Imp", "ala", " Front", "-", "End", " Traffic", "\")", " aw", "s", " $", "OP", "TS", " ec", "2", " authorize", "-", "security", "-", "group", "-", "ing", "ress", " --", "group", "-", "id", " $", "FR", "ONT", "END", " \\", " --", "prot", "ocol", " tcp", " --", "port", " 21", "000", " --", "c", "id", "r", " 0", ".", "0", ".", "0", ".", "0", "/", "0", " aw", "s", " $", "OP", "TS", " ec", "2", " authorize", "-", "security", "-", "group", "-", "ing", "ress", " --", "group", "-", "id", " $", "FR", "ONT", "END", " \\", " --", "prot", "ocol", " tcp", " --", "port", " 210", "50", " --", "c", "id", "r", " 0", ".", "0", ".", "0", ".", "0", "/", "0", " echo", " \"", "Allow", " Imp", "ala", " connections", " from", " the", " load", " bal", "ancer", " to", " the", " cluster", ".\"", " BACK", "END", "=$", "(", "aws", " $", "OP", "TS", " ec", "2", " create", "-", "security", "-", "group", " --", "output", " text", " --", "v", "pc", "-", "id", " $", "V", "PC", "ID", " \\", " --", "group", "-", "name", " \"$", "{", "CL", "NAME", "}", " Imp", "ala", " BE", "\"", " --", "description", " \"", "Imp", "ala", " Back", "-", "End", " Traffic", "\")", " aw", "s", " $", "OP", "TS", " ec", "2", " authorize", "-", "security", "-", "group", "-", "ing", "ress", " --", "group", "-", "id", " $", "BACK", "END", " \\", " --", "prot", "ocol", " tcp", " --", "port", " 21", "000", " --", "source", "-", "group", " $", "FR", "ONT", "END", " aw", "s", " $", "OP", "TS", " ec", "2", " authorize", "-", "security", "-", "group", "-", "ing", "ress", " --", "group", "-", "id", " $", "BACK", "END", " \\", " --", "prot", "ocol", " tcp", " --", "port", " 210", "50", " --", "source", "-", "group", " $", "FR", "ONT", "END", "\n", "\n", "Then", " we", " will", " add", " each", " EC", "2", " instance", " to", " the", " new", " $", "BACK", "END", " security", " group", ".", "\n", "\n", "for", " INST", "ANCE", "ID", " in", " $", "INST", "ANC", "ES", ";", " do", " GROUP", "ID", "=$", "(", "aws", " $", "OP", "TS", " ec", "2", " describe", "-", "instance", "-", "attribute", " --", "instance", "-", "id", " $", "INST", "ANCE", "ID", " \\", " --", "attribute", " group", "Set", " --", "output", " text", " --", "query", " '", "G", "roups", "[", "*", "].", "Group", "Id", "')", " aw", "s", " $", "OP", "TS", " ec", "2", " modify", "-", "instance", "-", "attribute", " --", "instance", "-", "id", " $", "INST", "ANCE", "ID", " \\", " --", "groups", " $", "GROUP", "ID", " $", "BACK", "END", " done", "\n", "\n", "Step", " 2", "\n", "\n", "Next", " we", " get", " to", " the", " meat", " of", " this", " post", ":", " creating", " the", " load", " bal", "ancer", ".", " We", " will", " create", " an", " EL", "B", " with", " the", " name", " \ufffd", "\ufffd", "el", "b", "-", "imp", "ala", "-", "Cl", "uster", "1", "\ufffd", "\ufffd", " and", " tell", " it", " to", " listen", " on", " ports", " 21", "000", "/", "TC", "P", " and", " 210", "50", "/", "TC", "P", ".", " The", " EL", "B", " will", " reside", " on", " sub", "net", " $", "S", "UB", "NET", "ID", " and", " be", " a", " member", " of", " the", " security", " group", " $", "FR", "ONT", "END", ".", " This", " EL", "B", " will", " be", " internal", "/", "private", " and", " will", " not", " be", " available", " on", " the", " Internet", ".", " You", " can", " change", " this", " with", " the", " --", "sche", "me", " argument", ".", "\n", "\n", "aws", " $", "OP", "TS", " el", "b", " create", "-", "load", "-", "bal", "ancer", " \\", " --", "load", "-", "bal", "ancer", "-", "name", " el", "b", "-", "imp", "ala", "-$", "{", "CL", "NAME", "}", " \\", " --", "list", "eners", " \\", " \"", "Prot", "ocol", "=", "TC", "P", ",", "Load", "Bal", "ancer", "Port", "=", "21", "000", ",", "Instance", "Prot", "ocol", "=", "TC", "P", ",", "Instance", "Port", "=", "21", "000", "\"", " \\", " \"", "Prot", "ocol", "=", "TC", "P", ",", "Load", "Bal", "ancer", "Port", "=", "210", "50", ",", "Instance", "Prot", "ocol", "=", "TC", "P", ",", "Instance", "Port", "=", "210", "50", "\"", " \\", " --", "sub", "nets", " $", "S", "UB", "NET", "ID", " \\", " --", "security", "-", "groups", " $", "FR", "ONT", "END", " \\", " --", "sche", "me", " internal", "\n", "\n", "Step", " 3", "\n", "\n", "After", " creation", ",", " we", " will", " modify", " some", " of", " the", " EL", "B", " configuration", ".", " This", " command", " will", " modify", " the", " Connection", " Idle", " Time", "out", " value", " to", " 36", "00", " seconds", ".", " It", " will", " also", " set", " up", " logging", " to", " go", " to", " a", " previously", " created", " S", "3", " bucket", " named", " \ufffd", "\ufffd", "Cl", "uster", "1", "-", "log", "s", "\ufffd", "\ufffd", " where", " files", " pref", "ixed", " with", " \ufffd", "\ufffd", "Cl", "uster", "1", "-", "Imp", "ala", "\ufffd", "\ufffd", " will", " be", " written", " every", " 60", " minutes", ".", "\n", "\n", "aws", " $", "OP", "TS", " el", "b", " modify", "-", "load", "-", "bal", "ancer", "-", "att", "ributes", " \\", " --", "load", "-", "bal", "ancer", "-", "name", " el", "b", "-", "imp", "ala", "-$", "{", "CL", "NAME", "}", " \\", " --", "load", "-", "bal", "ancer", "-", "att", "ributes", " \\", " Access", "Log", "={", "Enabled", "=", "true", ",", "S", "3", "B", "ucket", "Name", "=", "${", "CL", "NAME", "}", "-", "log", "s", ",", "E", "mit", "Inter", "val", "=", "60", ",", "S", "3", "B", "ucket", "Pref", "ix", "=", "${", "CL", "NAME", "}", "-", "Imp", "ala", ",", "Connection", "Settings", "={", "Id", "le", "Timeout", "=", "36", "00", "}", "\n", "\n", "Further", " modifications", " to", " the", " EL", "B", " will", " add", " a", " health", " check", " for", " the", " EL", "B", " to", " determine", " if", " individual", " instances", " are", " available", ".", " The", " EL", "B", " will", " connect", " to", " port", " 21", "000", "/", "TC", "P", " every", " 30", " seconds", " to", " test", " if", " the", " instance", " application", " is", " listening", ".", " The", " individual", " checks", " will", " timeout", " after", " 5", " seconds", " with", " no", " response", ".", " The", " instance", " will", " be", " considered", " to", " have", " failed", " after", " two", " failed", " checks", ".", " The", " instance", " will", " return", " to", " a", " healthy", " status", " after", " five", " successful", " checks", ".", "\n", "\n", "aws", " $", "OP", "TS", " el", "b", " configure", "-", "health", "-", "check", " \\", " --", "load", "-", "bal", "ancer", "-", "name", " el", "b", "-", "imp", "ala", "-$", "{", "CL", "NAME", "}", " \\", " --", "health", "-", "check", " \\", " Target", "=", "TC", "P", ":", "21", "000", "/", "png", ",", "Inter", "val", "=", "30", ",", "Timeout", "=", "5", ",", "Un", "healthy", "Th", "reshold", "=", "2", ",", "Health", "y", "Th", "reshold", "=", "5", "\n", "\n", "Step", " 4", "\n", "\n", "Finally", ",", " we", " will", " attach", " the", " H", "ado", "op", " worker", " instances", " to", " the", " EL", "B", " and", " load", " balancing", " will", " begin", " to", " be", " available", ".", "\n", "\n", "aws", " $", "OP", "TS", " el", "b", " register", "-", "inst", "ances", "-", "with", "-", "load", "-", "bal", "ancer", " \\", " --", "load", "-", "bal", "ancer", "-", "name", " el", "b", "-", "imp", "ala", "-$", "{", "CL", "NAME", "}", " \\", " --", "inst", "ances", " $", "INST", "ANC", "ES", "\n", "\n", "L", "ets", " not", " forget", " to", " look", " up", " the", " all", "-", "important", " DNS", " name", " that", " we", " will", " be", " using", " to", " talk", " to", " the", " EL", "B", ".", " We", " will", " use", " this", " to", " configure", " our", " client", " applications", " and", " for", " imp", "ala", "-", "shell", ".", "\n", "\n", "EL", "BD", "NS", "NAME", "=$", "(", "aws", " $", "OP", "TS", " el", "b", " describe", "-", "load", "-", "bal", "ancers", " --", "load", "-", "bal", "ancer", "-", "names", " \\", " el", "b", "-", "imp", "ala", "-$", "{", "CL", "NAME", "}", " --", "output", " text", " --", "query", " '", "Load", "Bal", "ancer", "Desc", "ript", "ions", "[", "*", "].", "D", "NS", "Name", "')", " echo", " \"", "***", " SA", "VE", " ME", " ***", "\"", " echo", " \"", "EL", "BD", "NS", "NAME", " :", " ${", "EL", "BD", "NS", "NAME", "}\"", " EL", "BD", "NS", "NAME", "=", "${", "EL", "BD", "NS", "NAME", "}", "\n", "\n", "Testing", "\n", "\n", "Step", " 5", "\n", "\n", "We", " will", " test", " our", " implementation", " to", " confirm", " that", " it", " works", " to", " our", " expectation", ".", "\n", "\n", "for", " ((", " i", " =", " 0", " ;", " i", " <", " 10", ";", " i", "++", " ));", " do", " imp", "ala", "-", "shell", " -", "i", " ${", "EL", "BD", "NS", "NAME", "}", " -", "q", " '", "SELECT", " pid", "();", "'", " 2", ">", "&", "1", " |", " grep", " Coordinator", ":", " done", "\n", "\n", "You", " should", " get", " output", " similar", " to", " the", " following", " which", " shows", " that", " we", " are", " connecting", " to", " a", " new", " coordinator", " each", " time", ":", "\n", "\n", "Query", " submitted", " at", ":", " 2017", "-", "06", "-", "23", " 19", ":", "53", ":", "00", " (", "Co", "ord", "inator", ":", " http", "://", "ip", "-", "10", "-", "30", "-", "1", "-", "35", ".", "ec", "2", ".", "internal", ":", "25", "000", ")", " Query", " submitted", " at", ":", " 2017", "-", "06", "-", "23", " 19", ":", "53", ":", "01", " (", "Co", "ord", "inator", ":", " http", "://", "ip", "-", "10", "-", "30", "-", "1", "-", "4", ".", "ec", "2", ".", "internal", ":", "25", "000", ")", " Query", " submitted", " at", ":", " 2017", "-", "06", "-", "23", " 19", ":", "53", ":", "01", " (", "Co", "ord", "inator", ":", " http", "://", "ip", "-", "10", "-", "30", "-", "1", "-", "46", ".", "ec", "2", ".", "internal", ":", "25", "000", ")", " Query", " submitted", " at", ":", " 2017", "-", "06", "-", "23", " 19", ":", "53", ":", "01", " (", "Co", "ord", "inator", ":", " http", "://", "ip", "-", "10", "-", "30", "-", "1", "-", "33", ".", "ec", "2", ".", "internal", ":", "25", "000", ")", " Query", " submitted", " at", ":", " 2017", "-", "06", "-", "23", " 19", ":", "53", ":", "01", " (", "Co", "ord", "inator", ":", " http", "://", "ip", "-", "10", "-", "30", "-", "1", "-", "10", ".", "ec", "2", ".", "internal", ":", "25", "000", ")", " Query", " submitted", " at", ":", " 2017", "-", "06", "-", "23", " 19", ":", "53", ":", "01", " (", "Co", "ord", "inator", ":", " http", "://", "ip", "-", "10", "-", "30", "-", "1", "-", "35", ".", "ec", "2", ".", "internal", ":", "25", "000", ")", " Query", " submitted", " at", ":", " 2017", "-", "06", "-", "23", " 19", ":", "53", ":", "02", " (", "Co", "ord", "inator", ":", " http", "://", "ip", "-", "10", "-", "30", "-", "1", "-", "4", ".", "ec", "2", ".", "internal", ":", "25", "000", ")", " Query", " submitted", " at", ":", " 2017", "-", "06", "-", "23", " 19", ":", "53", ":", "02", " (", "Co", "ord", "inator", ":", " http", "://", "ip", "-", "10", "-", "30", "-", "1", "-", "46", ".", "ec", "2", ".", "internal", ":", "25", "000", ")", " Query", " submitted", " at", ":", " 2017", "-", "06", "-", "23", " 19", ":", "53", ":", "02", " (", "Co", "ord", "inator", ":", " http", "://", "ip", "-", "10", "-", "30", "-", "1", "-", "33", ".", "ec", "2", ".", "internal", ":", "25", "000", ")", " Query", " submitted", " at", ":", " 2017", "-", "06", "-", "23", " 19", ":", "53", ":", "02", " (", "Co", "ord", "inator", ":", " http", "://", "ip", "-", "10", "-", "30", "-", "1", "-", "10", ".", "ec", "2", ".", "internal", ":", "25", "000", ")", "\n", "\n", "Config", "ure", " Imp", "ala", "\n", "\n", "Step", " 6", "\n", "\n", "Techn", "ically", ",", " there", " is", " nothing", " you", " need", " to", " configure", " in", " Imp", "ala", ".", " At", " least", " not", " on", " an", " insecure", " (", "non", "-", "K", "er", "ber", "ized", ")", " cluster", ".", " You", " do", " need", " to", " tell", " other", " applications", " in", " your", " H", "ado", "op", " distribution", " about", " the", " load", " bal", "ancer", ".", "\n", "\n", "From", " Cl", "ou", "der", "a", "\ufffd", "\ufffd", "s", " Using", " Imp", "ala", " through", " a", " Proxy", " for", " High", " Availability", ":", "\n", "\n", "On", " systems", " managed", " by", " Cl", "ou", "der", "a", " Manager", ",", " on", " the", " page", " Imp", "ala", " >", " Configuration", " >", " Imp", "ala", " Da", "emon", " Default", " Group", ",", " specify", " a", " value", " for", " the", " Imp", "ala", " Da", "em", "ons", " Load", " Bal", "ancer", " field", ".", " Spec", "ify", " the", " address", " of", " the", " load", " bal", "ancer", " in", " host", ":", "port", " format", ".", " This", " setting", " lets", " Cl", "ou", "der", "a", " Manager", " route", " all", " appropriate", " Imp", "ala", "-", "related", " operations", " through", " the", " proxy", " server", ".", "\n", "\n", "Security", "\n", "\n", "Since", " we", " at", " Clair", "voy", "ant", " tend", " to", " do", " a", " lot", " of", " security", "-", "enabled", " H", "ado", "op", " deployments", ",", " it", " makes", " sense", " to", " describe", " how", " to", " get", " TLS", " enabled", " on", " the", " EL", "B", ".", "\n", "\n", "Amazon", " has", " a", " service", " called", " AWS", " Certificate", " Manager", ".", " This", " service", " lets", " you", " provision", " a", " CA", "-", "signed", " TLS", " certificate", " onto", " the", " EL", "B", " with", " very", " little", " effort", " and", " will", " automatically", " update", " the", " certificate", " for", " you", " before", " it", " expires", ".", "\n", "\n", "First", " we", " will", " request", " a", " certificate", ".", " Set", " the", " variable", " $", "D", "NAME", " to", " the", " name", " of", " the", " fully", " qualified", " domain", " name", " that", " you", " are", " using", " for", " the", " certificate", ".", " Then", " we", " will", " add", " tags", " so", " that", " we", " can", " provide", " a", " simple", " name", ".", "\n", "\n", "D", "NAME", "=", " AR", "N", "=$", "(", "aws", " $", "OP", "TS", " ac", "m", " request", "-", "cert", "ificate", " --", "domain", "-", "name", " $", "D", "NAME", " \\", " --", "subject", "-", "altern", "ative", "-", "names", " $", "EL", "BD", "NS", "NAME", " --", "output", " text", ")", " aw", "s", " $", "OP", "TS", " ac", "m", " add", "-", "tags", "-", "to", "-", "cert", "ificate", " --", "cert", "ificate", "-", "arn", " $", "AR", "N", " --", "tags", " \\", " Name", "=", "tag", ":", "Name", ",", "Values", "=\"", "${", "CL", "NAME", "}\"", "\n", "\n", "At", " this", " point", ",", " the", " certificate", " is", " not", " yet", " issued", ".", " Emails", " have", " been", " sent", " to", " the", " domain", " contacts", " for", " approval", " of", " the", " request", ".", " Once", " the", " request", " is", " approved", ",", " we", " can", " continue", " with", " assigning", " the", " certificate", " to", " the", " EL", "B", ".", " We", " can", " list", " the", " certificates", " and", " watch", " to", " see", " if", " it", " has", " been", " approved", ".", " If", " there", " is", " any", " output", " to", " this", " command", ",", " it", " means", " the", " request", " has", " been", " approved", " by", " the", " domain", " owner", ".", "\n", "\n", "aws", " $", "OP", "TS", " ac", "m", " list", "-", "cert", "ific", "ates", " --", "cert", "ificate", "-", "stat", "uses", " IS", "SU", "ED", " --", "output", " text", " \\", " |", " grep", " $", "AR", "N", "\n", "\n", "Lastly", ",", " we", " will", " modify", " the", " EL", "B", " from", " TCP", " mode", " to", " SSL", " mode", " and", " tell", " it", " to", " use", " the", " TLS", " certificate", " on", " ports", " 21", "000", "/", "TC", "P", " and", " 210", "50", "/", "TC", "P", ".", "\n", "\n", "aws", " $", "OP", "TS", " delete", "-", "load", "-", "bal", "ancer", "-", "list", "eners", " \\", " --", "load", "-", "bal", "ancer", "-", "name", " el", "b", "-", "imp", "ala", "-$", "{", "CL", "NAME", "}", " --", "load", "-", "bal", "ancer", "-", "ports", " 21", "000", " aw", "s", " $", "OP", "TS", " el", "b", " create", "-", "load", "-", "bal", "ancer", "-", "list", "eners", " \\", " --", "load", "-", "bal", "ancer", "-", "name", " el", "b", "-", "imp", "ala", "-$", "{", "CL", "NAME", "}", " \\", " --", "list", "eners", " \\", " \"", "Prot", "ocol", "=", "SSL", ",", "Load", "Bal", "ancer", "Port", "=", "21", "000", ",", "Instance", "Prot", "ocol", "=", "SSL", ",", "Instance", "Port", "=", "21", "000", ",", "SS", "LC", "ert", "ificate", "Id", "=", "${", "AR", "N", "}\"", " aw", "s", " $", "OP", "TS", " delete", "-", "load", "-", "bal", "ancer", "-", "list", "eners", " \\", " --", "load", "-", "bal", "ancer", "-", "name", " el", "b", "-", "imp", "ala", "-$", "{", "CL", "NAME", "}", " --", "load", "-", "bal", "ancer", "-", "ports", " 210", "50", " aw", "s", " $", "OP", "TS", " el", "b", " create", "-", "load", "-", "bal", "ancer", "-", "list", "eners", " \\", " --", "load", "-", "bal", "ancer", "-", "name", " el", "b", "-", "imp", "ala", "-$", "{", "CL", "NAME", "}", " \\", " --", "list", "eners", " \\", " \"", "Prot", "ocol", "=", "SSL", ",", "Load", "Bal", "ancer", "Port", "=", "210", "50", ",", "Instance", "Prot", "ocol", "=", "SSL", ",", "Instance", "Port", "=", "210", "50", ",", "SS", "LC", "ert", "ificate", "Id", "=", "${", "AR", "N", "}\"", "\n", "\n", "You", " should", " now", " have", " an", " Amazon", "-", "signed", " TLS", " certificate", " protecting", " your", " EL", "B", " traffic", ".", " To", " confirm", ",", " run", " the", " following", " command", " and", " look", " for", " something", " like", " issuer", "=", " /", "C", "=", "US", "/", "O", "=", "Amazon", "/", "OU", "=", "Server", " CA", " 1", "B", "/", "CN", "=", "Amazon", ".", "\n", "\n", "opens", "sl", " s", "_", "client", " -", "connect", " ${", "EL", "BD", "NS", "NAME", "}:", "21", "000", " -", "nb", "io", " /", "dev", "/", "null", " \\", " |", " opens", "sl", " x", "509", " -", "no", "out", " -", "iss", "uer", "\n", "\n", "Th", "ats", " it", ".", " Happy", " load", " balancing", "!"]