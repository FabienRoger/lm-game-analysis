["I", "\ufffd", "\ufffd", "ve", " recently", " had", " some", " fun", " writing", " a", " browser", " qu", "icks", "ort", ".", "\n", "\n", "As", " part", " of", " a", " recent", " project", ",", " I", " had", " to", " implement", " a", " Knock", "out", " table", " component", " that", " could", " sort", " and", " filter", " its", " entries", " in", " real", "time", ".", " This", " would", " normally", " have", " been", " straightforward", ",", " except", " for", " a", " handful", " of", " use", "-", "cases", " where", " the", " table", " would", " contain", " upwards", " of", " three", " thousand", " entries", " \u2013", " possibly", " more", ".", " Calling", " a", " native", " array", " sort", "()", " on", " such", " a", " large", " set", " with", " a", " particularly", " complex", " compar", "ator", " would", " force", " IE", "8", " to", " freeze", " for", " several", " seconds", " and", " throw", " a", " long", " running", " script", " error", ".", "\n", "\n", "Server", "-", "side", " sorting", " was", " awkward", " for", " various", " reasons", ",", " and", " we", " weren", "\ufffd", "\ufffd", "t", " terribly", " keen", " on", " the", " complications", " that", " AJ", "AX", " imposed", ".", " What", " we", " really", " wanted", " was", " a", " non", "-", "blocking", " JavaScript", " sort", ".", "\n", "\n", "Invest", "igating", " the", " long", " running", " script", " exception", "\n", "\n", "If", " you", "\ufffd", "\ufffd", "ve", " done", " any", " heavy", " lifting", " with", " JavaScript", " in", " IE", "8", ",", " you", "\ufffd", "\ufffd", "ve", " probably", " seen", " the", " following", " exception", ":", "\n", "\n", "The", " exception", " is", " triggered", " by", " a", " maximum", " statement", " count", ".", " When", " the", " IE", "8", " JavaScript", " engine", " executes", " over", " five", " million", " statements", " as", " part", " of", " an", " event", " thread", ",", " it", " tells", " the", " user", " that", " \ufffd", "\ufffd", "A", " script", " on", " this", " page", " is", " causing", " Internet", " Explorer", " to", " run", " slowly", "\ufffd", "\ufffd", ".", " The", " user", " is", " invited", " to", " stop", " the", " thread", " and", " resume", " control", ".", " Sto", "pping", " the", " thread", " doesn", "\ufffd", "\ufffd", "t", " throw", " an", " error", ",", " so", " anything", " relying", " on", " the", " sort", " completing", " is", " left", " hanging", ".", "\n", "\n", "St", "opping", " it", " from", " appearing", "\n", "\n", "The", " real", " purpose", " of", " the", " exception", " is", " to", " stop", " JavaScript", " operations", " from", " h", "ogging", " the", " UI", " thread", " in", " an", " environment", " where", " all", " events", " and", " user", " actions", " need", " to", " run", " in", " serial", ".", " This", " is", " a", " goal", " we", " should", " respect", ".", " So", " the", " most", " obvious", " solution", " would", " be", " to", " find", " a", " way", " to", " perform", " the", " sort", " as", "ynchron", "ously", ",", " yield", " the", " thread", " periodically", " and", " effectively", " only", " run", " the", " sort", " whilst", " the", " UI", " thread", " was", " idle", ".", "\n", "\n", "Actually", ",", " that", "\ufffd", "\ufffd", "s", " a", " lie", " \u2013", " the", " most", " obvious", " solution", " would", " be", " to", " double", " check", " that", " we", " really", " needed", " to", " perform", " such", " a", " massive", " operation", " on", " the", " client", " and", " see", " if", " we", " could", " pass", " it", " to", " the", " server", " instead", ".", " But", " for", " us", " this", " was", " undesirable", ",", " if", " not", " impossible", ",", " and", " it", " seemed", " worthwhile", " to", " try", " and", " solve", " the", " problem", " just", " through", " client", "-", "side", " JavaScript", ".", "\n", "\n", "My", " immediate", " thought", " was", " to", " write", " a", " qu", "icks", "ort", ".", "\n", "\n", "As", "ynchronous", " qu", "icks", "ort", "\n", "\n", "Qu", "icks", "ort", " is", " particularly", " suitable", " for", " non", "-", "blocking", " code", ",", " because", " it", " can", " be", " implemented", " rec", "urs", "ively", ",", " and", " rec", "ursion", " calls", " are", " a", " great", " opportunity", " to", " yield", " the", " thread", ".", " It", "\ufffd", "\ufffd", "s", " fast", ",", " fairly", " well", "-", "under", "stood", " and", " relatively", " easy", " to", " understand", ".", "\n", "\n", "The", " idea", " is", " simple", ":", " we", " perform", " a", " \ufffd", "\ufffd", "part", "ition", "\ufffd", "\ufffd", " operation", " on", " an", " array", ",", " taking", " its", " last", " member", " as", " a", " \ufffd", "\ufffd", "p", "ivot", "\ufffd", "\ufffd", " and", " iter", "ating", " through", " the", " others", " left", " to", " right", ",", " comparing", " each", " to", " the", " pivot", " as", " we", " go", ".", " If", " the", " member", " is", " larger", " or", " equal", " to", " the", " pivot", ",", " we", " put", " it", " to", " the", " right", " hand", " side", ".", " If", " not", ",", " we", " leave", " it", " on", " the", " left", " and", " try", " the", " next", " member", ".", " What", " we", "\ufffd", "\ufffd", "re", " left", " with", " is", " an", " array", " where", " all", " the", " items", " lower", " than", " the", " pivot", " are", " to", " its", " left", " and", " all", " the", " items", " larger", " are", " to", " the", " right", ".", " We", " can", " then", " partition", " the", " left", " and", " right", " sets", " rec", "urs", "ively", " until", " our", " set", " is", " completely", " sorted", ".", "\n", "\n", "(", "A", " handy", " animation", " straight", " from", " Wikipedia", ")", "\n", "\n", "Techn", "ically", ",", " this", " isn", "\ufffd", "\ufffd", "t", " the", " only", " way", " to", " perform", " a", " partition", " \u2013", " it", "\ufffd", "\ufffd", "s", " the", " L", "om", "uto", " Part", "ition", ",", " and", " you", " can", " find", " others", " documented", " online", ",", " but", " the", " basic", " algorithm", " doesn", "\ufffd", "\ufffd", "t", " differ", ":", " partition", " the", " array", ",", " then", " partition", " the", " sub", "-", "part", "itions", " in", " turn", " until", " there", "\ufffd", "\ufffd", "s", " no", " more", " partition", "ing", " to", " be", " done", ".", "\n", "\n", "We", " can", " write", " our", " partition", " as", " follows", ":", "\n", "\n", "1", "\n", "\n", "2", "\n", "\n", "3", "\n", "\n", "4", "\n", "\n", "5", "\n", "\n", "6", "\n", "\n", "7", "\n", "\n", "8", "\n", "\n", "9", "\n", "\n", "10", "\n", "\n", "11", "\n", "\n", "12", "\n", "\n", "13", "\n", "\n", "14", "\n", "\n", "15", "\n", "\n", "16", "\n", "\n", "17", "\n", "\n", "18", "\n", "\n", "19", "\n", "\n", "20", "\n", "\n", "21", "\n", "\n", "22", "\n", "\n", "23", "\n", "\n", "24", "\n", "\n", "25", "\n", "\n", "26", "\n", "\n", "27", "\n", "\n", "28", "\n", "\n", "29", "\n", "\n", "30", "\n", "\n", "31", "\n", "\n", "32", "\n", "\n", "33", "\n", "\n", "34", "\n", "\n", "35", "\n", "\n", "36", "\n", "\n", "37", "\n", "\n", "38", "\n", "\n", "39", "\n", "\n", "40", "\n", "\n", "41", "\n", "\n", "function", " partition", "(", "array", ",", " partition", "Sl", "ice", "Start", ",", " partition", "Sl", "ice", "End", ",", " value", "Compar", "ator", ")", " {", "\n", "\n", "//", " Part", "ition", " a", " sub", "-", "array", " for", " e", ".", "g", ".", " a", " qu", "icks", "ort", "\n", "\n", "//", "\n", "\n", "//", " We", " start", " processing", " from", " the", " left", "most", " element", " (", "I", "),", " and", " use", " the", " right", "most", " as", " the", " pivot", " (", "P", ").", " We", " also", " track", " the", " item", " to", "\n", "\n", "//", " the", " left", " of", " the", " pivot", " (", "L", "),", " such", " that", " we", " end", " up", " with", "\n", "\n", "//", " I", ".", ".", ".", " L", " P", "\n", "\n", "//", " We", " then", " compare", " I", " with", " P", ".", " If", " I", " is", " less", " than", " P", ",", " we", " leave", " it", " where", " is", " and", " increment", " the", " processing", " index", ",", " so", " that", " we", " have", "\n", "\n", "//", " <", " I", ".", ".", " L", " P", "\n", "\n", "//", " (", "where", " '", " //", " Then", ",", " if", " I", " is", " larger", " than", " P", ",", " we", " swap", " the", " positions", " such", " that", "\n", "\n", "//", " <", " L", ".", ".", " P", " I", "\n", "\n", "//", " We", " then", " continue", " processing", " from", " L", ",", "\n", "\n", "//", " <", " I", ".", ".", " P", " >", "\n", "\n", "//", "...", " and", " continue", " until", " we", " end", " up", " with", " all", " lower", " elements", " on", " the", " left", ",", " all", " greater", " than", " /", " equal", " elements", " on", " the", " right", "\n", "\n", "//", " <", " <", " <", " P", " >", " >", "\n", "\n", "//", " Doing", " it", " this", " way", " means", " we", " can", " partition", " our", " array", " in", "-", "place", ",", " which", " makes", " things", " a", " lot", " more", " perform", "ant", ".", "\n\n", "\n", "\n", "var", " p", "Index", " =", " partition", "Sl", "ice", "End", ";", "\n", "\n", "var", " i", "Index", " =", " partition", "Sl", "ice", "Start", ";", "\n", "\n", "var", " l", "Index", " =", " p", "Index", " -", " 1", ";", "\n", "\n", "var", " p", "Value", " =", " array", "[", "p", "Index", "];", "\n", "\n", "var", " i", "Value", " =", " array", "[", "i", "Index", "];", "\n\n", "\n", "\n", "while", " (", "i", "Index", " <", " p", "Index", ")", " {", "\n", "\n", "if", " (", "value", "Compar", "ator", "(", "i", "Value", ",", " p", "Value", ")", " ===", " -", "1", ")", " {", "\n", "\n", "//", " If", " I", " <", " P", ",", " leave", " I", " where", " it", " is", " and", " move", " the", " I", " index", " further", " right", "\n", "\n", "i", "Index", "++;", "\n", "\n", "}", " else", " {", "\n", "\n", "//", " If", " I", " >=", " P", ",", " move", " I", " to", " the", " right", " of", " P", ",", " and", " put", " L", " in", " I", "'s", " original", " place", ".", "\n", "\n", "//", " We", " swap", " I", " and", " L", ",", " then", " L", " and", " P", ".", " We", " don", "'t", " increment", " I", "'s", " index", ";", " we", " process", " L", " next", " instead", ".", "\n", "\n", "array", "Sw", "ap", "(", "array", ",", " i", "Index", ",", " l", "Index", ");", "\n", "\n", "array", "Sw", "ap", "(", "array", ",", " l", "Index", ",", " p", "Index", ");", "\n", "\n", "p", "Index", "--", ";", "\n", "\n", "l", "Index", "--", ";", "\n", "\n", "}", "\n", "\n", "//", " Update", " values", " based", " on", " changed", " indices", "\n", "\n", "i", "Value", " =", " array", "[", "i", "Index", "];", "\n", "\n", "p", "Value", " =", " array", "[", "p", "Index", "];", "\n", "\n", "}", "\n\n", "\n", "\n", "return", " p", "Index", ";", " //", " return", " the", " pivot", " point", " so", " we", " can", " rec", "urs", "ively", " process", " the", " left", " and", " right", " hand", " sides", "\n", "\n", "}", "\n\n", "\n", "\n", "For", "give", " me", " for", " the", " C", "-", "like", " variable", " prefix", "es", ";", " it", " simply", " seemed", " the", " easiest", " way", " to", " associate", " the", " variables", " with", " the", " \ufffd", "\ufffd", "di", "agram", "\ufffd", "\ufffd", " in", " my", " comments", ".", "\n", "\n", "Once", " we", " had", " the", " partition", " operation", ",", " it", " was", " just", " a", " matter", " of", " finding", " a", " way", " to", " yield", " the", " UI", " thread", " between", " the", " operation", " calls", ".", "\n", "\n", "process", ".", "next", "T", "ick", " in", " the", " browser", "\n", "\n", "If", " you", "\ufffd", "\ufffd", "re", " a", " Node", ".", "js", " developer", ",", " you", "\ufffd", "\ufffd", "ve", " likely", " encountered", " process", ".", "next", "T", "ick", "().", " It", " yields", " the", " thread", ",", " allowing", " other", " que", "ued", " call", "backs", " to", " fire", ",", " before", " we", " resume", " our", " operation", ".", " Historically", " client", "-", "side", " JavaScript", " developers", " have", " em", "ulated", " this", " behaviour", " with", " a", " zero", "ed", " set", "Timeout", " :", "\n", "\n", "1", "\n", "\n", "2", "\n", "\n", "3", "\n", "\n", "function", " yielding", "Operation", "(", "fn", ")", " {", "\n", "\n", "window", ".", "set", "Timeout", "(", "fn", ",", " 0", ");", "\n", "\n", "}", "\n\n", "\n", "\n", "This", " works", " well", " enough", " for", " o", "c", "assion", "ally", " yielding", " a", " thread", " in", " the", " middle", " of", " a", " long", " operation", ",", " but", " it", " fails", " when", " we", " pass", " a", " high", " volume", " of", " call", "backs", ",", " because", " the", " timeout", " value", " doesn", "\ufffd", "\ufffd", "t", " really", " end", " up", " being", " zero", ".", " In", " pr", "ct", "ice", ",", " most", " browsers", " don", "\ufffd", "\ufffd", "t", " run", " the", " callback", " in", " less", " than", " 10", " milliseconds", ".", "\n", "\n", "This", " restriction", " is", " partly", " down", " to", " the", " HTML", "5", " specification", " thrott", "ling", " the", " timeout", " to", " no", " less", " than", " 4", "ms", " [", "1", "],", " but", " also", " partly", " down", " to", " the", " way", " the", " browser", " relies", " on", " the", " OS", "\ufffd", "\ufffd", " default", " system", " timer", ",", " as", " explained", " at", " length", " by", " Nicholas", " Zak", "as", ".", " Windows", "\ufffd", "\ufffd", " timer", " has", " a", " gran", "ularity", " of", " 15", "ms", " \u2013", " that", " is", ",", " the", " timer", " is", " only", " updated", " every", " 15", "ms", " \u2013", " so", " it", "\ufffd", "\ufffd", "s", " possible", " for", " a", " set", "Timeout", " to", " wait", " the", " full", " length", " of", " that", " period", ".", "\n", "\n", "When", " each", " operation", " takes", " a", " millisec", "ond", " and", " then", " waits", " 14", " milliseconds", " to", " spawn", " its", " child", " operations", ",", " that", "\ufffd", "\ufffd", "s", " grossly", " inefficient", ".", " Prof", "iling", " the", " sort", " confirmed", " these", " suspicions", " \u2013", " Chrome", " would", " make", " excellent", " head", "way", " whilst", " processing", " the", " larger", " partitions", ",", " but", " then", " slow", " to", " a", " crawl", " as", " it", " processed", " the", " long", " tail", " of", " small", " sub", "part", "itions", ".", "\n", "\n", "set", "Im", "mediate", " to", " the", " rescue", "\n", "\n", "But", " not", " to", " fear", "!", " set", "Timeout", " is", " not", " the", " only", " option", " we", " have", ".", " A", " new", " API", ",", " window", ".", "set", "Im", "mediate", ",", " was", " introduced", " by", " Microsoft", " through", " Internet", " Explorer", " 10", " and", " 11", ".", " It", " works", " much", " like", " process", ".", "next", "T", "ick", " \u2013", " we", " pass", " a", " callback", ",", " yield", " the", " thread", ",", " run", " any", " que", "ued", " events", " and", " pick", " the", " callback", " up", " again", " as", " soon", " as", " possible", ".", " There", "\ufffd", "\ufffd", "s", " no", " 15", "ms", " thrott", "ling", ".", "\n", "\n", "set", "Im", "mediate", " isn", "\ufffd", "\ufffd", "t", " a", " standardized", " API", " yet", ",", " though", ",", " and", " isn", "\ufffd", "\ufffd", "t", " implemented", " in", " Ge", "cko", " or", " Web", "kit", " [", "2", "].", " Fortunately", ",", " a", " Kat", "och", "imoto", "\ufffd", "\ufffd", "s", " set", "Im", "mediate", " sh", "im", " is", " available", " that", " provides", " the", " same", " functionality", " in", " other", " browsers", ",", " and", " even", " fixes", " certain", " bugs", " in", " IE", "10", "/", "11", "\ufffd", "\ufffd", "s", " native", " set", "Im", "mediate", " [", "3", "].", "\n", "\n", "It", " now", " becomes", " possible", " to", " rec", "urs", "ively", " partition", " our", " array", " in", " a", " non", "-", "blocking", " way", ":", "\n", "\n", "1", "\n", "\n", "2", "\n", "\n", "3", "\n", "\n", "4", "\n", "\n", "5", "\n", "\n", "6", "\n", "\n", "7", "\n", "\n", "8", "\n", "\n", "9", "\n", "\n", "10", "\n", "\n", "11", "\n", "\n", "12", "\n", "\n", "13", "\n", "\n", "14", "\n", "\n", "15", "\n", "\n", "16", "\n", "\n", "17", "\n", "\n", "18", "\n", "\n", "function", " non", "Bl", "ocking", "Qu", "icks", "ort", "Operation", "(", "array", ",", " sub", "Array", "Start", ",", " sub", "Array", "End", ",", " value", "Compar", "ator", ")", " {", "\n", "\n", "var", " sorted", "Area", "Length", " =", " (", "sub", "Array", "End", " -", " sub", "Array", "Start", ")", " +", " 1", ";", "\n", "\n", "if", " (", "s", "orted", "Area", "Length", " >", " 1", ")", " {", "\n", "\n", "var", " pivot", "Location", " =", " partition", "(", "array", ",", " sub", "Array", "Start", ",", " sub", "Array", "End", ",", " value", "Compar", "ator", ");", "\n\n", "\n", "\n", "//", " Process", " elements", " to", " the", " left", " of", " the", " pivot", "\n", "\n", "var", " low", "Part", "ition", "End", " =", " pivot", "Location", " -", " 1", ";", "\n", "\n", "set", "Im", "mediate", "(", "function", "(){", "\n", "\n", "non", "Bl", "ocking", "Qu", "icks", "ort", "Operation", "(", "array", ",", " sub", "Array", "Start", ",", " low", "Part", "ition", "End", ",", " value", "Compar", "ator", ");", "\n", "\n", "});", "\n\n", "\n", "\n", "//", " Process", " elements", " to", " the", " right", " of", " the", " pivot", "\n", "\n", "var", " high", "Part", "ition", "Start", " =", " pivot", "Location", " +", " 1", ";", "\n", "\n", "set", "Im", "mediate", "(", "function", "(){", "\n", "\n", "non", "Bl", "ocking", "Qu", "icks", "ort", "Operation", "(", "array", ",", " sub", "Array", "Start", ",", " high", "Part", "ition", "Start", ",", " value", "Compar", "ator", ");", "\n", "\n", "});", "\n", "\n", "}", "\n", "\n", "}", "\n\n", "\n", "\n", "There", "\ufffd", "\ufffd", "s", " just", " one", " problem", " \u2013", " now", " we", "\ufffd", "\ufffd", "ve", " made", " the", " function", " asynchronous", ",", " how", " do", " we", " know", " when", " it", " has", " finished", "?", "\n", "\n", "Monitor", "ing", " progress", "\n", "\n", "Whenever", " we", " complete", " a", " partition", ",", " we", " know", " that", " we", "\ufffd", "\ufffd", "ve", " finalized", " the", " position", " of", " the", " pivot", ".", " We", " only", " further", " process", " its", " neighbours", ".", " So", " we", " can", " trigger", " a", " final", "ization", " callback", " that", " increments", " a", " counter", ",", " and", " when", " the", " counter", " reaches", " the", " length", " of", " the", " array", ",", " we", " know", " that", " the", " array", " is", " stable", ".", "\n", "\n", "We", " could", " perhaps", " implement", " this", " like", " so", ":", "\n", "\n", "1", "\n", "\n", "2", "\n", "\n", "3", "\n", "\n", "4", "\n", "\n", "5", "\n", "\n", "6", "\n", "\n", "7", "\n", "\n", "8", "\n", "\n", "9", "\n", "\n", "10", "\n", "\n", "11", "\n", "\n", "12", "\n", "\n", "13", "\n", "\n", "14", "\n", "\n", "15", "\n", "\n", "16", "\n", "\n", "17", "\n", "\n", "18", "\n", "\n", "19", "\n", "\n", "20", "\n", "\n", "21", "\n", "\n", "22", "\n", "\n", "23", "\n", "\n", "24", "\n", "\n", "function", " non", "Bl", "ocking", "Qu", "icks", "ort", "Operation", "(", "array", ",", " sub", "Array", "Start", ",", " sub", "Array", "End", ",", " value", "Compar", "ator", ",", " on", "Element", "Location", "Final", "ized", ")", " {", "\n", "\n", "var", " sorted", "Area", "Length", " =", " (", "sub", "Array", "End", " -", " sub", "Array", "Start", ")", " +", " 1", ";", "\n", "\n", "if", " (", "s", "orted", "Area", "Length", " >", " 1", ")", " {", "\n", "\n", "var", " pivot", "Location", " =", " partition", "(", "array", ",", " sub", "Array", "Start", ",", " sub", "Array", "End", ",", " value", "Compar", "ator", ");", "\n\n", "\n", "\n", "//", " Process", " elements", " to", " the", " left", " of", " the", " pivot", "\n", "\n", "var", " low", "Part", "ition", "End", " =", " pivot", "Location", " -", " 1", ";", "\n", "\n", "set", "Im", "mediate", "(", "function", "(){", "\n", "\n", "non", "Bl", "ocking", "Qu", "icks", "ort", "Operation", "(", "array", ",", " sub", "Array", "Start", ",", " low", "Part", "ition", "End", ",", " value", "Compar", "ator", ",", " on", "Element", "Location", "Final", "ized", ");", "\n", "\n", "});", "\n\n", "\n", "\n", "//", " Process", " elements", " to", " the", " right", " of", " the", " pivot", "\n", "\n", "var", " high", "Part", "ition", "Start", " =", " pivot", "Location", " +", " 1", ";", "\n", "\n", "set", "Im", "mediate", "(", "function", "(){", "\n", "\n", "non", "Bl", "ocking", "Qu", "icks", "ort", "Operation", "(", "array", ",", " sub", "Array", "Start", ",", " high", "Part", "ition", "Start", ",", " value", "Compar", "ator", ",", " on", "Element", "Location", "Final", "ized", ");", "\n", "\n", "});", "\n\n", "\n", "\n", "//", " The", " pivot", "'s", " location", " is", " finalized", ",", " so", " we", " can", " trigger", " the", " event", "\n", "\n", "on", "Element", "Location", "Final", "ized", "();", "\n", "\n", "}", " else", " if", " (", "s", "orted", "Area", "Length", " ===", " 1", ")", " {", "\n", "\n", "//", " Only", " one", " item", ",", " so", " we", " skip", " the", " partition", " and", " just", " trigger", " the", " event", "\n", "\n", "on", "Element", "Location", "Final", "ized", "();", "\n", "\n", "}", "\n", "\n", "}", "\n\n", "\n", "\n", "1", "\n", "\n", "2", "\n", "\n", "3", "\n", "\n", "4", "\n", "\n", "5", "\n", "\n", "6", "\n", "\n", "7", "\n", "\n", "8", "\n", "\n", "9", "\n", "\n", "10", "\n", "\n", "11", "\n", "\n", "12", "\n", "\n", "13", "\n", "\n", "function", " non", "Bl", "ocking", "Qu", "icks", "ort", "(", "array", ",", " value", "Compar", "ator", ",", " on", "Finish", "Callback", ")", " {", "\n", "\n", "var", " final", "izations", " =", " 0", ";", "\n\n", "\n", "\n", "var", " array", "End", " =", " array", ".", "length", " -", " 1", ";", "\n", "\n", "non", "Bl", "ocking", "Qu", "icks", "ort", "Operation", "(", "array", ",", " 0", ",", " array", "End", ",", " value", "Compar", "ator", ",", " on", "Element", "Location", "Final", "ized", ");", "\n\n", "\n", "\n", "function", " on", "Element", "Location", "Final", "ized", "()", " {", "\n", "\n", "final", "izations", "++;", "\n", "\n", "if", " (", "final", "izations", " ===", " array", ".", "length", ")", " {", "\n", "\n", "on", "Finish", "Callback", "();", "\n", "\n", "}", "\n", "\n", "}", "\n", "\n", "}", "\n\n", "\n", "\n", "Prior", "it", "izing", " native", " sort", "\n", "\n", "The", " non", "Bl", "ocking", "Qu", "icks", "ort", " we", "\ufffd", "\ufffd", "ve", " written", " is", " great", ",", " but", " it", "\ufffd", "\ufffd", "ll", " always", " have", " the", " disadvantage", " of", " not", " being", " native", " code", ".", " Granted", ",", " many", " browsers", " implement", " their", " sort", " directly", " through", " JavaScript", " (", "you", " can", " see", " how", " Chrome", " does", " it", " in", " plain", " JS", " in", " the", " V", "8", " source", "),", " but", " browser", " developers", " will", " always", " have", " the", " advantage", " of", " being", " able", " to", " optimize", " for", " their", " own", " engines", " and", " drop", " into", " compiled", " code", " where", " necessary", ".", " So", " whilst", " our", " qu", "icks", "ort", " r", "ids", " us", " of", " our", " IE", "8", " woes", ",", " it", "\ufffd", "\ufffd", "s", " still", " better", " to", " prefer", " native", " sort", " for", " smaller", " sets", " on", " more", " modern", " browsers", ".", "\n", "\n", "Our", " approach", " was", " simply", " to", " prefer", " the", " native", " implementation", " unless", " working", " in", " IE", "8", " or", " with", " arrays", " over", " a", " thousand", " items", ".", "\n", "\n", "Less", "ons", " learned", "\n", "\n", "If", " nothing", " else", ",", " writing", " a", " non", "-", "blocking", " qu", "icks", "ort", " was", " a", " great", " educational", " exercise", ".", " The", " key", " points", " being", ":", "\n", "\n", "Do", "ing", " heavy", " lifting", " with", " JavaScript", " in", " IE", "8", " is", " just", " not", " fun", ".", " If", " you", "\ufffd", "\ufffd", "re", " going", " to", " have", " to", " do", " it", ",", " be", " mindful", " of", " UI", " responsiveness", " and", " see", " if", " you", " can", " write", " your", " procedure", " in", " a", " non", "-", "blocking", " manner", ",", " using", " set", "Im", "mediate", " and", " its", " sh", "ims", " where", " necessary", " S", "orting", " algorithms", " aren", "\ufffd", "\ufffd", "t", " black", " magic", " and", " don", "\ufffd", "\ufffd", "t", " have", " to", " be", " scary", " if", " you", " don", "\ufffd", "\ufffd", "t", " have", " a", " CS", " background", " (", "like", " me", ")", " set", "Timeout", " and", " browser", " timing", " are", " deceptive", " and", " shouldn", "\ufffd", "\ufffd", "t", " be", " wholly", " trusted", "\n", "\n", "At", " some", " point", ",", " I", "\ufffd", "\ufffd", "ll", " probably", " rewrite", " an", " open", " source", " version", " of", " the", " code", " above", ",", " with", " a", " few", " performance", " tweaks", " and", " optimizations", ".", " I", "\ufffd", "\ufffd", "ll", " probably", " post", " about", " it", " when", " I", " do", " so", ".", "\n", "\n", "Notes", "\n", "\n", "[", "1", "]", " Apparently", ",", " this", " is", " because", " running", " a", " timer", " with", " high", " resolution", " means", " the", " CPU", " can", "\ufffd", "\ufffd", "t", " enter", " low", " power", " modes", ".", " This", " was", " determined", " to", " be", " a", " problem", " for", " battery", " life", " in", " mobile", " devices", ",", " so", " the", " 4", "ms", " was", " agreed", " as", " a", " compromise", " between", " efficiency", " and", " accuracy", ".", "\n", "\n", "[", "2", "]", " Currently", " it", " faces", " some", " opposition", " from", " Google", " and", " Apple", ".", " It", "\ufffd", "\ufffd", "s", " possible", " that", " the", " API", " might", " be", " deprecated", " in", " future", ",", " so", " using", " the", " set", "Im", "mediate", " sh", "im", " is", " probably", " a", " good", " insurance", " policy", " in", " case", " MS", " ever", " withdraw", "s", " the", " API", ".", "\n", "\n", "[", "3", "]", " You", " can", " find", " out", " how", " it", " actually", " performs", " the", " sh", "im", " in", " the", " project", "\ufffd", "\ufffd", "s", " READ", "ME", ".", " It", "\ufffd", "\ufffd", "s", " quite", " interesting", "."]