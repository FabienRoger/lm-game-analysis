["Decl", "ar", "ative", " data", " fetch", "ing", " in", " React", " components", " with", " Ba", "ob", "ab", "\n", "\n", "Den", "is", " K", "olt", "sov", " Bl", "ocked", " Un", "block", " Follow", " Following", " Jul", " 19", ",", " 2015", "\n", "\n", "Re", "active", " future", "\n", "\n", "What", " we", " love", " about", " React", " is", " how", " simple", " and", " enjoyable", " its", " decl", "ar", "ative", " way", " of", " constructing", " components", ".", " And", " when", " Graph", "QL", " was", " introduced", " our", " minds", " were", " blown", " because", " we", " realized", ":", " we", " can", " do", " the", " same", " with", " data", ",", " describing", " what", " our", " components", " need", " and", " not", " caring", " about", " how", " and", " when", " it", " will", " be", " delivered", ".", "\n", "\n", "Also", ",", " Netflix", " introduced", " JSON", "Graph", " and", " Fal", "cor", " this", " May", ".", " What", "\ufffd", "\ufffd", "s", " interesting", " here", " is", " that", " working", " completely", " independent", " from", " Facebook", " they", " came", " up", " with", " very", " similar", " ideas", ".", " So", ",", " basically", " we", " can", " see", " a", " solid", " trend", " here", ".", "\n", "\n", "R", "EST", " present", "\n", "\n", "There", " is", " one", " frustrating", " thing", " about", " Graph", "QL", "/", "Fal", "cor", " though", ":", " both", " of", " them", " require", " certain", " backend", " implementation", " and", " since", " we", " need", " to", " get", " stuff", " done", " on", " existing", " APIs", " in", " our", " company", ",", " we", " decided", " to", " go", " small", " steps", " to", " the", " amazing", " decl", "ar", "ative", " data", " future", ".", "\n", "\n", "So", " what", " do", " we", " have", ":", " a", " bunch", " of", " services", " with", " REST", " API", ",", " React", ",", " very", " simple", " Fl", "ux", " implementation", " and", " Ba", "ob", "ab", " as", " the", " data", " backbone", " holding", " the", " entire", " immutable", " state", " of", " our", " application", ".", " I", "\ufffd", "\ufffd", "m", " not", " gonna", " give", " too", " much", " attention", " to", " Ba", "ob", "ab", " itself", ",", " only", " that", " we", " chose", " it", " over", " Imm", "utable", ".", "js", " at", " the", " time", " because", " of", " it", "\ufffd", "\ufffd", "s", " simplicity", " and", " explicit", "ness", ".", " Also", " the", " maintain", "er", " Gu", "illa", "ume", " is", " very", " nice", " and", " responsive", ".", "\n", "\n", "Enough", " with", " the", " intro", ",", " let", "\ufffd", "\ufffd", "s", " jump", " into", " the", " actual", " code", ".", "\n", "\n", "Global", " immutable", " state", "\n", "\n", "We", " keep", " all", " the", " data", " that", " should", " be", " outside", " components", " local", " state", " in", " one", " big", " global", " immutable", " tree", " which", " we", " call", " just", " \ufffd", "\ufffd", "state", "\ufffd", "\ufffd", ".", " We", " use", " it", " both", " in", " stores", " to", " put", " data", " inside", " different", " parts", " of", " the", " big", " tree", ",", " and", " in", " components", " to", " consume", " and", " use", " this", " data", ".", "\n", "\n", "To", " illustrate", " this", ",", " let", "\ufffd", "\ufffd", "s", " say", " we", " have", " an", " app", " that", " shows", " a", " list", " of", " products", " that", " can", " be", " sorted", " ascending", " or", " descending", ".", " By", " clicking", " on", " each", " of", " these", " products", " we", " can", " see", " its", " description", ".", "\n", "\n", "Here", " is", " the", " structure", " of", " our", " global", " state", ":", "\n", "\n", "//", " selected", " product", " id", "\n", "\n", "[", " '", "ui", "',", " '", "products", "',", " '", "selected", "'", " ]", ":", " <", "number", ">", "\n", "\n", "//", " products", " lists", " with", " different", " sort", "\n", "\n", "[", " '", "data", "',", " '", "products", "',", " '", "list", "'", " ]", ":", " Array", "<", "object", ">", "\n", "\n", "//", " product", " info", "\n", "\n", "[", " '", "data", "',", " '", "products", "',", " '", "details", "',", " product", "ID", " ]", ":", " <", "object", ">", "\n", "\n", "On", " the", " first", " level", " we", " have", " data", " and", " u", "i", " layers", " to", " separate", " concerns", " and", " make", " easier", " reasoning", " about", " the", " app", " state", ".", "\n", "\n", "-", " u", "i", " layer", " usually", " holds", " the", " visual", " state", " that", " can", " be", " shared", " between", " different", " components", " and", " can", " be", " tracked", " if", " you", " have", " history", " in", " your", " application", ".", "\n", "\n", "Example", ":", " data", " about", " dragging", " element", ",", " selected", " item", " in", " the", " list", ".", "\n", "\n", "-", " in", " data", " layer", " we", " store", " something", " we", " either", " create", " ourselves", " or", ",", " which", " is", " a", " more", " common", " case", ",", " receive", " from", " the", " server", ".", "\n", "\n", "Example", ":", " products", " list", ",", " user", " information", ".", " On", " the", " second", " level", " there", " is", " data", " type", ",", " usually", " reflecting", " actions", "-", "stores", " pairs", ".", " In", " this", " simple", " example", " there", " is", " only", " \ufffd", "\ufffd", "products", "\ufffd", "\ufffd", ",", " but", " in", " the", " real", " apps", " you", " can", " see", " something", " like", " \ufffd", "\ufffd", "users", "\ufffd", "\ufffd", ",", " \ufffd", "\ufffd", "wid", "gets", "\ufffd", "\ufffd", ",", " \ufffd", "\ufffd", "settings", "\ufffd", "\ufffd", ",", " etc", ".", " \u2014", " you", " get", " the", " picture", ".", " Finally", ",", " from", " the", " third", " level", " and", " deeper", " we", " can", " go", " bananas", " and", " create", " whatever", " data", " paths", " we", " want", ",", " there", " are", " no", " restrictions", ".", "\n", "\n", "Data", " Wat", "cher", "\n", "\n", "Here", " is", " how", " we", " work", " with", " data", " in", " components", " (", "please", " read", " the", " comments", "):", "\n", "\n", "So", " all", " these", " data", " dependencies", " described", " in", " components", " are", " actually", " cursor", " paths", " (", "c", "urs", "ors", " are", " awesome", ",", " read", " about", " them", " here", ").", " And", " what", " we", " can", " do", " with", " these", " curs", "ors", " is", " track", " whenever", " something", " updates", " there", " and", " then", " put", " it", " into", " the", " components", " local", " state", ".", " That", "\ufffd", "\ufffd", "s", " pretty", " much", " all", " Data", "W", "atcher", " does", "!", "\n", "\n", "Another", " a", " bit", " more", " complex", " example", " is", " products", " list", ".", " Since", " we", " have", " \ufffd", "\ufffd", "sort", "\ufffd", "\ufffd", " option", ",", " and", " products", " list", " can", " be", " very", " long", ",", " we", " let", " server", " do", " the", " sorting", " and", " locally", " store", " different", " lists", " for", " each", " sort", " type", " (", "please", " read", " the", " comments", "):", "\n", "\n", "Talking", " to", " the", " server", "\n", "\n", "There", " is", " one", " missing", " part", " though", ":", " how", " do", " we", " request", " this", " data", " from", " the", " server", "?", " We", " didn", "\ufffd", "\ufffd", "t", " want", " to", " do", " it", " from", " components", ",", " so", " here", " is", " what", " we", " came", " up", " with", ":", " with", " immutable", " data", " tree", " you", " can", " not", " only", " listen", " for", " the", " data", " updates", ",", " but", " even", " when", " someone", " trying", " to", " access", " data", " at", " the", " certain", " cursor", " path", ".", " So", " we", " just", " listen", " for", " \ufffd", "\ufffd", "get", "\ufffd", "\ufffd", "-", "ters", " in", " main", " wrapper", " component", " and", " if", " data", " is", " not", " in", " the", " state", " yet", ",", " we", " fire", " an", " action", " to", " get", " it", ".", " Take", " a", " look", " at", " the", " example", " (", "please", " read", " the", " comments", "):", "\n", "\n", "Now", " we", " came", " full", " circle", " and", " all", " our", " components", " listening", " to", " this", " cursor", " path", " will", " receive", " the", " data", " thanks", " to", " Data", "W", "atcher", " decor", "ator", ".", "\n", "\n", "Conclusion", "\n", "\n", "Here", " is", " the", " awkward", " illustration", " of", " data", " flow", " described", " above", ":", "\n", "\n", "This", " is", " pretty", " much", " still", " the", " good", " old", " flux", ",", " except", " only", " we", " have", " state", " as", " a", " separate", " entity", "\n", "\n", "You", " can", " play", " with", " the", " example", " I", " used", " in", " the", " article", " here", ":", " https", "://", "github", ".", "com", "/", "mist", "ad", "ik", "ay", "/", "react", "-", "auto", "-", "f", "etch", "ing", "-", "example", "/", "\n", "\n", "I", " intentionally", " didn", "\ufffd", "\ufffd", "t", " mention", " how", " we", " save", ",", " reset", " and", " send", " parts", " of", " global", " state", " back", " to", " the", " server", ",", " since", " it", " probably", " deserves", " another", " article", ".", "\n", "\n", "So", ",", " we", " showed", " you", " how", " did", " we", " manage", " to", " simplify", " the", " way", " React", " components", " work", " with", " data", ".", " Though", ",", " I", "\ufffd", "\ufffd", "m", " pretty", " sure", " it", "\ufffd", "\ufffd", "s", " only", " an", " intermediate", " step", " to", " the", " much", " more", " awesome", " reactive", " and", " decl", "ar", "ative", " future", " which", " is", " just", " a", " few", " steps", " away", ".", "\n", "\n", "UPDATE", ":", " following", " the", " feedback", " on", " this", " article", ",", " we", " created", " separate", " tool", " for", " working", " with", " immutable", " state", " in", " React", ".", " It", "\ufffd", "\ufffd", "s", " called", " do", "ob", ".", " Also", ",", " there", " is", " a", " branch", " in", " the", " example", " repository", " using", " do", "ob", ".", " Please", " keep", " in", " mind", " that", " it", "\ufffd", "\ufffd", "s", " still", " W", "IP", "."]