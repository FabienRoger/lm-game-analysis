["Have", " you", " ever", " wondered", " why", " Beam", " has", " P", "Trans", "forms", " for", " everything", " instead", " of", " having", " methods", " on", " PC", "ol", "lection", "?", " Take", " a", " look", " at", " the", " history", " that", " led", " to", " this", " (", "and", " other", ")", " design", " decisions", ".", "\n", "\n", "Though", " Beam", " is", " relatively", " new", ",", " its", " design", " draws", " heavily", " on", " many", " years", " of", " experience", " with", " real", "-", "world", " pipelines", ".", " One", " of", " the", " primary", " inspir", "ations", " is", " Fl", "ume", "Java", ",", " which", " is", " Google", "\ufffd", "\ufffd", "s", " internal", " successor", " to", " Map", "Red", "uce", " first", " introduced", " in", " 2009", ".", "\n", "\n", "The", " original", " Fl", "ume", "Java", " API", " has", " methods", " like", " count", " and", " parallel", "Do", " on", " the", " PC", "ol", "lections", ".", " Though", " slightly", " more", " succinct", ",", " this", " approach", " has", " many", " disadvantages", " to", " ext", "ens", "ibility", ".", " Every", " new", " user", " to", " Fl", "ume", "Java", " wanted", " to", " add", " transforms", ",", " and", " adding", " them", " as", " methods", " to", " PC", "ol", "lection", " simply", " doesn", "\ufffd", "\ufffd", "t", " scale", " well", ".", " In", " contrast", ",", " a", " PC", "ol", "lection", " in", " Beam", " has", " a", " single", " apply", " method", " which", " takes", " any", " P", "Transform", " as", " an", " argument", ".", "\n", "\n", "Fl", "ume", "Java", " Beam", " PC", "ol", "lection", "<", "T", ">", " input", " =", " \u2026", " PC", "ol", "lection", "<", "O", ">", " output", " =", " input", ".", "count", "()", ".", "par", "allel", "Do", "(", "...", ");", " PC", "ol", "lection", "<", "T", ">", " input", " =", " \u2026", " PC", "ol", "lection", "<", "O", ">", " output", " =", " input", ".", "apply", "(", "Count", ".", "per", "Element", "())", ".", "apply", "(", "Par", "Do", ".", "of", "(", "...", "));", "\n", "\n", "This", " is", " a", " more", " scalable", " approach", " for", " several", " reasons", ".", "\n", "\n", "Where", " to", " draw", " the", " line", "?", "\n", "\n", "Adding", " methods", " to", " PC", "ol", "lection", " forces", " a", " line", " to", " be", " drawn", " between", " operations", " that", " are", " \ufffd", "\ufffd", "use", "ful", "\ufffd", "\ufffd", " enough", " to", " merit", " this", " special", " treatment", " and", " those", " that", " are", " not", ".", " It", " is", " easy", " to", " make", " the", " case", " for", " flat", " map", ",", " group", " by", " key", ",", " and", " combine", " per", " key", ".", " But", " what", " about", " filter", "?", " Count", "?", " App", "rox", "imate", " count", "?", " App", "rox", "imate", " quant", "iles", "?", " Most", " frequent", "?", " Write", "To", "My", "Favorite", "Source", "?", " Going", " too", " far", " down", " this", " path", " leads", " to", " a", " single", " enormous", " class", " that", " contains", " nearly", " everything", " one", " could", " want", " to", " do", ".", " (", "Fl", "ume", "Java", "\ufffd", "\ufffd", "s", " PC", "ol", "lection", " class", " is", " over", " 5000", " lines", " long", " with", " around", " 70", " distinct", " operations", ",", " and", " it", " could", " have", " been", " much", " larger", " had", " we", " accepted", " every", " proposal", ".)", " Furthermore", ",", " since", " Java", " doesn", "\ufffd", "\ufffd", "t", " allow", " adding", " methods", " to", " a", " class", ",", " there", " is", " a", " sharp", " synt", "actic", " divide", " between", " those", " operations", " that", " are", " added", " to", " PC", "ol", "lection", " and", " those", " that", " aren", "\ufffd", "\ufffd", "t", ".", " A", " traditional", " way", " to", " share", " code", " is", " with", " a", " library", " of", " functions", ",", " but", " functions", " (", "in", " traditional", " languages", " like", " Java", " at", " least", ")", " are", " written", " prefix", "-", "style", ",", " which", " doesn", "\ufffd", "\ufffd", "t", " mix", " well", " with", " the", " fluent", " builder", " style", " (", "e", ".", "g", ".", " input", ".", "operation", "1", "().", "operation", "2", "().", "operation", "3", "()", " vs", ".", " operation", "3", "(", "operation", "1", "(", "input", ").", "operation", "2", "())", " ).", "\n", "\n", "Instead", " in", " Beam", " we", "\ufffd", "\ufffd", "ve", " chosen", " a", " style", " that", " places", " all", " transforms", "\u2013", "whether", " they", " be", " primitive", " operations", ",", " composite", " operations", " bundled", " in", " the", " SDK", ",", " or", " part", " of", " an", " external", " library", "\u2013", "on", " equal", " footing", ".", " This", " also", " facilitates", " alternative", " implementations", " (", "which", " may", " even", " take", " different", " options", ")", " that", " are", " easily", " interchangeable", ".", "\n", "\n", "Fl", "ume", "Java", " Beam", " PC", "ol", "lection", "<", "O", ">", " output", " =", " External", "Library", ".", "do", "St", "uff", "(", " My", "Library", ".", "transform", "(", "input", ",", " my", "Args", ")", ".", "par", "allel", "Do", "(", "...", "),", " external", "Lib", "Args", ");", " PC", "ol", "lection", "<", "O", ">", " output", " =", " input", ".", "apply", "(", "My", "Library", ".", "transform", "(", "my", "Args", "))", ".", "apply", "(", "Par", "Do", ".", "of", "(", "...", "))", ".", "apply", "(", "External", "Library", ".", "do", "St", "uff", "(", "external", "Lib", "Args", "));", "\n", "\n", "Config", "ur", "ability", "\n", "\n", "It", " makes", " for", " a", " fluent", " style", " to", " let", " values", " (", "P", "Col", "lections", ")", " be", " the", " objects", " passed", " around", " and", " manipulated", " (", "i", ".", "e", ".", " the", " handles", " to", " the", " deferred", " execution", " graph", "),", " but", " it", " is", " the", " operations", " themselves", " that", " need", " to", " be", " compos", "able", ",", " config", "urable", ",", " and", " extend", "able", ".", " Using", " PC", "ol", "lection", " methods", " for", " the", " operations", " doesn", "\ufffd", "\ufffd", "t", " scale", " well", " here", ",", " especially", " in", " a", " language", " without", " default", " or", " keyword", " arguments", ".", " For", " example", ",", " a", " Par", "Do", " operation", " can", " have", " any", " number", " of", " side", " inputs", " and", " side", " outputs", ",", " or", " a", " write", " operation", " may", " have", " configurations", " dealing", " with", " encoding", " and", " compression", ".", " One", " option", " is", " to", " separate", " these", " out", " into", " multiple", " overload", "s", " or", " even", " methods", ",", " but", " that", " exacerb", "ates", " the", " problems", " above", ".", " (", "Fl", "ume", "Java", " evolved", " over", " a", " dozen", " overload", "s", " of", " the", " parallel", "Do", " method", "!)", " Another", " option", " is", " to", " pass", " each", " method", " a", " configuration", " object", " that", " can", " be", " built", " up", " using", " more", " fluent", " idi", "oms", " like", " the", " builder", " pattern", ",", " but", " at", " that", " point", " one", " might", " as", " well", " make", " the", " configuration", " object", " the", " operation", " itself", ",", " which", " is", " what", " Beam", " does", ".", "\n", "\n", "Type", " Safety", "\n", "\n", "Many", " operations", " can", " only", " be", " applied", " to", " collections", " whose", " elements", " are", " of", " a", " specific", " type", ".", " For", " example", ",", " the", " Group", "By", "Key", " operation", " should", " only", " be", " applied", " to", " PC", "ol", "lection", "<", "K", "V", "<", "K", ",", " V", ">>", " s", ".", " In", " Java", " at", " least", ",", " it", "\ufffd", "\ufffd", "s", " not", " possible", " to", " restrict", " methods", " based", " on", " the", " element", " type", " parameter", " alone", ".", " In", " Fl", "ume", "Java", ",", " this", " led", " us", " to", " add", " a", " P", "Table", "<", "K", ",", " V", ">", " subclass", "ing", " PC", "ol", "lection", "<", "K", "V", "<", "K", ",", " V", ">>", " to", " contain", " all", " the", " operations", " specific", " to", " PC", "ol", "lections", " of", " key", "-", "value", " pairs", ".", " This", " leads", " to", " the", " same", " question", " of", " which", " element", " types", " are", " special", " enough", " to", " merit", " being", " captured", " by", " PC", "ol", "lection", " sub", "classes", ".", " It", " is", " not", " very", " ext", "ensible", " for", " third", " parties", " and", " often", " requires", " manual", " down", "casts", "/", "con", "versions", " (", "which", " can", "\ufffd", "\ufffd", "t", " be", " safely", " chained", " in", " Java", ")", " and", " special", " operations", " that", " produce", " these", " PC", "ol", "lection", " special", "izations", ".", "\n", "\n", "This", " is", " particularly", " inconvenient", " for", " transforms", " that", " produce", " outputs", " whose", " element", " types", " are", " the", " same", " as", " (", "or", " related", " to", ")", " their", " input", "\ufffd", "\ufffd", "s", " element", " types", ",", " requiring", " extra", " support", " to", " generate", " the", " right", " sub", "classes", " (", "e", ".", "g", ".", " a", " filter", " on", " a", " P", "Table", " should", " produce", " another", " P", "Table", " rather", " than", " just", " a", " raw", " PC", "ol", "lection", " of", " key", "-", "value", " pairs", ").", "\n", "\n", "Using", " P", "Trans", "forms", " allows", " us", " to", " sid", "est", "ep", " this", " entire", " issue", ".", " We", " can", " place", " arbitrary", " constraints", " on", " the", " context", " in", " which", " a", " transform", " may", " be", " used", " based", " on", " the", " type", " of", " its", " inputs", ";", " for", " instance", " Group", "By", "Key", " is", " statically", " typed", " to", " only", " apply", " to", " a", " PC", "ol", "lection", "<", "K", "V", "<", "K", ",", " V", ">>", ".", " The", " way", " this", " happens", " is", " general", "izable", " to", " arbitrary", " shapes", ",", " without", " needing", " to", " introduce", " specialized", " types", " like", " P", "Table", ".", "\n", "\n", "Re", "us", "ability", " and", " Structure", "\n", "\n", "Though", " P", "Trans", "forms", " are", " generally", " constructed", " at", " the", " site", " at", " which", " they", "\ufffd", "\ufffd", "re", " used", ",", " by", " pulling", " them", " out", " as", " separate", " objects", " one", " is", " able", " to", " store", " them", " and", " pass", " them", " around", ".", "\n", "\n", "As", " pipelines", " grow", " and", " evolve", ",", " it", " is", " useful", " to", " structure", " your", " pipeline", " into", " modular", ",", " often", " reusable", " components", ",", " and", " P", "Trans", "forms", " allow", " one", " to", " do", " this", " nicely", " in", " a", " data", "-", "processing", " pipeline", ".", " In", " addition", ",", " modular", " P", "Trans", "forms", " also", " expose", " the", " logical", " structure", " of", " your", " code", " to", " the", " system", " (", "e", ".", "g", ".", " for", " monitoring", ").", " Of", " the", " three", " different", " representations", " of", " the", " Word", "Count", " pipeline", " below", ",", " only", " the", " structured", " view", " captures", " the", " high", "-", "level", " intent", " of", " the", " pipeline", ".", " Let", "ting", " even", " the", " simple", " operations", " be", " P", "Trans", "forms", " means", " there", "\ufffd", "\ufffd", "s", " less", " of", " an", " abrupt", " edge", " to", " packaging", " things", " up", " into", " composite", " operations", ".", "\n", "\n", "Three", " different", " visual", "izations", " of", " a", " simple", " Word", "Count", " pipeline", " which", " comp", "utes", " the", " number", " of", " occurrences", " of", " every", " word", " in", " a", " set", " of", " text", " files", ".", " The", " flat", " view", " gives", " the", " full", " D", "AG", " of", " all", " operations", " performed", ".", " The", " execution", " view", " groups", " operations", " according", " to", " how", " they", "'re", " executed", ",", " e", ".", "g", ".", " after", " performing", " runner", "-", "specific", " optimizations", " like", " function", " composition", ".", " The", " structured", " view", " nests", " operations", " according", " to", " their", " grouping", " in", " P", "Trans", "forms", ".", "\n", "\n", "Summary", "\n", "\n", "Although", " it", "\ufffd", "\ufffd", "s", " tempting", " to", " add", " methods", " to", " PC", "ol", "lections", ",", " such", " an", " approach", " is", " not", " scalable", ",", " ext", "ensible", ",", " or", " sufficiently", " expressive", ".", " Putting", " a", " single", " apply", " method", " on", " PC", "ol", "lection", " and", " all", " the", " logic", " into", " the", " operation", " itself", " lets", " us", " have", " the", " best", " of", " both", " worlds", ",", " and", " avoids", " hard", " cliffs", " of", " complexity", " by", " having", " a", " single", " consistent", " style", " across", " simple", " and", " complex", " pipelines", ",", " and", " between", " pred", "efined", " and", " user", "-", "defined", " operations", "."]